cscope 15 $HOME/work/sdk_01/sdk/linux/kernel/linux/drivers/net/ethernet/marvell/octeontx2/nic               0000757492
	@bpf_jit.h

7 #iâdeà
_BPF_JIT_H


8 
	#_BPF_JIT_H


	)

10 
	~<asm/š¢.h
>

13 
	#A64_R
(
x
è
AARCH64_INSN_REG_
##
	)
x

14 
	#A64_FP
 
AARCH64_INSN_REG_FP


	)

15 
	#A64_LR
 
AARCH64_INSN_REG_LR


	)

16 
	#A64_ZR
 
AARCH64_INSN_REG_ZR


	)

17 
	#A64_SP
 
AARCH64_INSN_REG_SP


	)

19 
	#A64_VARIANT
(
sf
) \

20 ((
sf
è? 
AARCH64_INSN_VARIANT_64BIT
 : 
AARCH64_INSN_VARIANT_32BIT
)

	)

23 
	#A64_COMP_BRANCH
(
sf
, 
Rt
, 
off£t
, 
ty³
) \

24 
	`¯rch64_š¢_g’_comp_b¿nch_imm
(0, 
off£t
, 
Rt
, 
	`A64_VARIANT
(
sf
), \

25 
AARCH64_INSN_BRANCH_COMP_
##
ty³
)

	)

26 
	#A64_CBZ
(
sf
, 
Rt
, 
imm19
è
	`A64_COMP_BRANCH
(sf, Rt, (imm19è<< 2, 
ZERO
)

	)

27 
	#A64_CBNZ
(
sf
, 
Rt
, 
imm19
è
	`A64_COMP_BRANCH
(sf, Rt, (imm19è<< 2, 
NONZERO
)

	)

30 
	#A64_COND_BRANCH
(
cÚd
, 
off£t
) \

31 
	`¯rch64_š¢_g’_cÚd_b¿nch_imm
(0, 
off£t
, 
cÚd
)

	)

32 
	#A64_COND_EQ
 
AARCH64_INSN_COND_EQ


	)

33 
	#A64_COND_NE
 
AARCH64_INSN_COND_NE


	)

34 
	#A64_COND_CS
 
AARCH64_INSN_COND_CS


	)

35 
	#A64_COND_HI
 
AARCH64_INSN_COND_HI


	)

36 
	#A64_COND_LS
 
AARCH64_INSN_COND_LS


	)

37 
	#A64_COND_CC
 
AARCH64_INSN_COND_CC


	)

38 
	#A64_COND_GE
 
AARCH64_INSN_COND_GE


	)

39 
	#A64_COND_GT
 
AARCH64_INSN_COND_GT


	)

40 
	#A64_COND_LE
 
AARCH64_INSN_COND_LE


	)

41 
	#A64_COND_LT
 
AARCH64_INSN_COND_LT


	)

42 
	#A64_B_
(
cÚd
, 
imm19
è
	`A64_COND_BRANCH
(cÚd, (imm19è<< 2)

	)

45 
	#A64_BRANCH
(
off£t
, 
ty³
è
	`¯rch64_š¢_g’_b¿nch_imm
(0, offset, \

46 
AARCH64_INSN_BRANCH_
##
ty³
)

	)

47 
	#A64_B
(
imm26
è
	`A64_BRANCH
((imm26è<< 2, 
NOLINK
)

	)

48 
	#A64_BL
(
imm26
è
	`A64_BRANCH
((imm26è<< 2, 
LINK
)

	)

51 
	#A64_BR
(
Rn
è
	`¯rch64_š¢_g’_b¿nch_»g
(Rn, 
AARCH64_INSN_BRANCH_NOLINK
)

	)

52 
	#A64_BLR
(
Rn
è
	`¯rch64_š¢_g’_b¿nch_»g
(Rn, 
AARCH64_INSN_BRANCH_LINK
)

	)

53 
	#A64_RET
(
Rn
è
	`¯rch64_š¢_g’_b¿nch_»g
(Rn, 
AARCH64_INSN_BRANCH_RETURN
)

	)

56 
	#A64_LS_REG
(
Rt
, 
Rn
, 
Rm
, 
size
, 
ty³
) \

57 
	`¯rch64_š¢_g’_lßd_¡Üe_»g
(
Rt
, 
Rn
, 
Rm
, \

58 
AARCH64_INSN_SIZE_
##
size
, \

59 
AARCH64_INSN_LDST_
##
ty³
##
_REG_OFFSET
)

	)

60 
	#A64_STRB
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 8, 
STORE
)

	)

61 
	#A64_LDRB
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 8, 
LOAD
)

	)

62 
	#A64_STRH
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 16, 
STORE
)

	)

63 
	#A64_LDRH
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 16, 
LOAD
)

	)

64 
	#A64_STR32
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 32, 
STORE
)

	)

65 
	#A64_LDR32
(
Wt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Wt, Xn, Xm, 32, 
LOAD
)

	)

66 
	#A64_STR64
(
Xt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Xt, Xn, Xm, 64, 
STORE
)

	)

67 
	#A64_LDR64
(
Xt
, 
Xn
, 
Xm
è
	`A64_LS_REG
(Xt, Xn, Xm, 64, 
LOAD
)

	)

70 
	#A64_LS_PAIR
(
Rt
, 
Rt2
, 
Rn
, 
off£t
, 
ls
, 
ty³
) \

71 
	`¯rch64_š¢_g’_lßd_¡Üe_·œ
(
Rt
, 
Rt2
, 
Rn
, 
off£t
, \

72 
AARCH64_INSN_VARIANT_64BIT
, \

73 
AARCH64_INSN_LDST_
##
ls
##
_PAIR_
##
ty³
)

	)

75 
	#A64_PUSH
(
Rt
, 
Rt2
, 
Rn
è
	`A64_LS_PAIR
(Rt, Rt2, Rn, -16, 
STORE
, 
PRE_INDEX
)

	)

77 
	#A64_POP
(
Rt
, 
Rt2
, 
Rn
è
	`A64_LS_PAIR
(Rt, Rt2, Rn, 16, 
LOAD
, 
POST_INDEX
)

	)

80 
	#A64_SIZE
(
sf
) \

81 ((
sf
è? 
AARCH64_INSN_SIZE_64
 : 
AARCH64_INSN_SIZE_32
)

	)

82 
	#A64_LSX
(
sf
, 
Rt
, 
Rn
, 
Rs
, 
ty³
) \

83 
	`¯rch64_š¢_g’_lßd_¡Üe_ex
(
Rt
, 
Rn
, 
Rs
, 
	`A64_SIZE
(
sf
), \

84 
AARCH64_INSN_LDST_
##
ty³
)

	)

86 
	#A64_LDXR
(
sf
, 
Rt
, 
Rn
) \

87 
	`A64_LSX
(
sf
, 
Rt
, 
Rn
, 
A64_ZR
, 
LOAD_EX
)

	)

89 
	#A64_STXR
(
sf
, 
Rt
, 
Rn
, 
Rs
) \

90 
	`A64_LSX
(
sf
, 
Rt
, 
Rn
, 
Rs
, 
STORE_EX
)

	)

93 
	#A64_STADD
(
sf
, 
Rn
, 
Rs
) \

94 
	`¯rch64_š¢_g’_¡add
(
Rn
, 
Rs
, 
	`A64_SIZE
(
sf
))

	)

97 
	#A64_ADDSUB_IMM
(
sf
, 
Rd
, 
Rn
, 
imm12
, 
ty³
) \

98 
	`¯rch64_š¢_g’_add_sub_imm
(
Rd
, 
Rn
, 
imm12
, \

99 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_ADSB_
##
ty³
)

	)

101 
	#A64_ADD_I
(
sf
, 
Rd
, 
Rn
, 
imm12
è
	`A64_ADDSUB_IMM
(sf, Rd, Rn, imm12, 
ADD
)

	)

102 
	#A64_SUB_I
(
sf
, 
Rd
, 
Rn
, 
imm12
è
	`A64_ADDSUB_IMM
(sf, Rd, Rn, imm12, 
SUB
)

	)

104 
	#A64_MOV
(
sf
, 
Rd
, 
Rn
è
	`A64_ADD_I
(sf, Rd, Rn, 0)

	)

107 
	#A64_BITFIELD
(
sf
, 
Rd
, 
Rn
, 
immr
, 
imms
, 
ty³
) \

108 
	`¯rch64_š¢_g’_b™f›ld
(
Rd
, 
Rn
, 
immr
, 
imms
, \

109 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_BITFIELD_MOVE_
##
ty³
)

	)

111 
	#A64_SBFM
(
sf
, 
Rd
, 
Rn
, 
œ
, 
is
è
	`A64_BITFIELD
(sf, Rd, Rn, ir, is, 
SIGNED
)

	)

113 
	#A64_UBFM
(
sf
, 
Rd
, 
Rn
, 
œ
, 
is
è
	`A64_BITFIELD
(sf, Rd, Rn, ir, is, 
UNSIGNED
)

	)

116 
	#A64_LSL
(
sf
, 
Rd
, 
Rn
, 
shiá
) ({ \

117 
sz
 = (
sf
) ? 64 : 32; \

118 
	`A64_UBFM
(
sf
, 
Rd
, 
Rn
, ()-(
shiá
è% 
sz
, sz - 1 - (shift)); \

119 })

	)

121 
	#A64_LSR
(
sf
, 
Rd
, 
Rn
, 
shiá
è
	`A64_UBFM
(sf, Rd, Rn, shiá, (sfè? 63 : 31)

	)

123 
	#A64_ASR
(
sf
, 
Rd
, 
Rn
, 
shiá
è
	`A64_SBFM
(sf, Rd, Rn, shiá, (sfè? 63 : 31)

	)

126 
	#A64_UXTH
(
sf
, 
Rd
, 
Rn
è
	`A64_UBFM
(sf, Rd, Rn, 0, 15)

	)

127 
	#A64_UXTW
(
sf
, 
Rd
, 
Rn
è
	`A64_UBFM
(sf, Rd, Rn, 0, 31)

	)

130 
	#A64_MOVEW
(
sf
, 
Rd
, 
imm16
, 
shiá
, 
ty³
) \

131 
	`¯rch64_š¢_g’_movewide
(
Rd
, 
imm16
, 
shiá
, \

132 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_MOVEWIDE_
##
ty³
)

	)

136 
	#A64_MOVN
(
sf
, 
Rd
, 
imm16
, 
shiá
è
	`A64_MOVEW
(sf, Rd, imm16, shiá, 
INVERSE
)

	)

137 
	#A64_MOVZ
(
sf
, 
Rd
, 
imm16
, 
shiá
è
	`A64_MOVEW
(sf, Rd, imm16, shiá, 
ZERO
)

	)

138 
	#A64_MOVK
(
sf
, 
Rd
, 
imm16
, 
shiá
è
	`A64_MOVEW
(sf, Rd, imm16, shiá, 
KEEP
)

	)

141 
	#A64_ADDSUB_SREG
(
sf
, 
Rd
, 
Rn
, 
Rm
, 
ty³
) \

142 
	`¯rch64_š¢_g’_add_sub_shiáed_»g
(
Rd
, 
Rn
, 
Rm
, 0, \

143 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_ADSB_
##
ty³
)

	)

145 
	#A64_ADD
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_ADDSUB_SREG
(sf, Rd, Rn, Rm, 
ADD
)

	)

146 
	#A64_SUB
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_ADDSUB_SREG
(sf, Rd, Rn, Rm, 
SUB
)

	)

147 
	#A64_SUBS
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_ADDSUB_SREG
(sf, Rd, Rn, Rm, 
SUB_SETFLAGS
)

	)

149 
	#A64_NEG
(
sf
, 
Rd
, 
Rm
è
	`A64_SUB
(sf, Rd, 
A64_ZR
, Rm)

	)

151 
	#A64_CMP
(
sf
, 
Rn
, 
Rm
è
	`A64_SUBS
(sf, 
A64_ZR
, Rn, Rm)

	)

154 
	#A64_DATA1
(
sf
, 
Rd
, 
Rn
, 
ty³
è
	`¯rch64_š¢_g’_d©a1
(Rd, Rn, \

155 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_DATA1_
##
ty³
)

	)

157 
	#A64_REV16
(
sf
, 
Rd
, 
Rn
è
	`A64_DATA1
(sf, Rd, Rn, 
REVERSE_16
)

	)

158 
	#A64_REV32
(
sf
, 
Rd
, 
Rn
è
	`A64_DATA1
(sf, Rd, Rn, 
REVERSE_32
)

	)

159 
	#A64_REV64
(
Rd
, 
Rn
è
	`A64_DATA1
(1, Rd, Rn, 
REVERSE_64
)

	)

163 
	#A64_DATA2
(
sf
, 
Rd
, 
Rn
, 
Rm
, 
ty³
è
	`¯rch64_š¢_g’_d©a2
(Rd, Rn, Rm, \

164 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_DATA2_
##
ty³
)

	)

165 
	#A64_UDIV
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_DATA2
(sf, Rd, Rn, Rm, 
UDIV
)

	)

166 
	#A64_LSLV
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_DATA2
(sf, Rd, Rn, Rm, 
LSLV
)

	)

167 
	#A64_LSRV
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_DATA2
(sf, Rd, Rn, Rm, 
LSRV
)

	)

168 
	#A64_ASRV
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_DATA2
(sf, Rd, Rn, Rm, 
ASRV
)

	)

172 
	#A64_MADD
(
sf
, 
Rd
, 
Ra
, 
Rn
, 
Rm
è
	`¯rch64_š¢_g’_d©a3
(Rd, Ra, Rn, Rm, \

173 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_DATA3_MADD
)

	)

175 
	#A64_MSUB
(
sf
, 
Rd
, 
Ra
, 
Rn
, 
Rm
è
	`¯rch64_š¢_g’_d©a3
(Rd, Ra, Rn, Rm, \

176 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_DATA3_MSUB
)

	)

178 
	#A64_MUL
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_MADD
(sf, Rd, 
A64_ZR
, Rn, Rm)

	)

181 
	#A64_LOGIC_SREG
(
sf
, 
Rd
, 
Rn
, 
Rm
, 
ty³
) \

182 
	`¯rch64_š¢_g’_logiÿl_shiáed_»g
(
Rd
, 
Rn
, 
Rm
, 0, \

183 
	`A64_VARIANT
(
sf
), 
AARCH64_INSN_LOGIC_
##
ty³
)

	)

185 
	#A64_AND
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_LOGIC_SREG
(sf, Rd, Rn, Rm, 
AND
)

	)

186 
	#A64_ORR
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_LOGIC_SREG
(sf, Rd, Rn, Rm, 
ORR
)

	)

187 
	#A64_EOR
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_LOGIC_SREG
(sf, Rd, Rn, Rm, 
EOR
)

	)

188 
	#A64_ANDS
(
sf
, 
Rd
, 
Rn
, 
Rm
è
	`A64_LOGIC_SREG
(sf, Rd, Rn, Rm, 
AND_SETFLAGS
)

	)

190 
	#A64_TST
(
sf
, 
Rn
, 
Rm
è
	`A64_ANDS
(sf, 
A64_ZR
, Rn, Rm)

	)

	@cn10k.c

8 
	~"ú10k.h
"

9 
	~"Ùx2_»g.h
"

10 
	~"Ùx2_¡ruù.h
"

12 
dev_hw_İs
 
	gÙx2_hw_İs
 = {

13 .
sq_aq_š™
 = 
Ùx2_sq_aq_š™
,

14 .
	gsqe_æush
 = 
Ùx2_sqe_æush
,

15 .
	gau¿_ä“±r
 = 
Ùx2_au¿_ä“±r
,

16 .
	g»fl_poŞ_±rs
 = 
Ùx2_»fl_poŞ_±rs
,

19 
dev_hw_İs
 
	gú10k_hw_İs
 = {

20 .
sq_aq_š™
 = 
ú10k_sq_aq_š™
,

21 .
	gsqe_æush
 = 
ú10k_sqe_æush
,

22 .
	gau¿_ä“±r
 = 
ú10k_au¿_ä“±r
,

23 .
	g»fl_poŞ_±rs
 = 
ú10k_»fl_poŞ_±rs
,

26 
	$ú10k_lmt¡_š™
(
Ùx2_nic
 *
pfvf
)

28 
lmt¡_tbl_£tup_»q
 *
»q
;

29 
Ùx2_lmt_šfo
 *
lmt_šfo
;

30 
”r
, 
ıu
;

32 ià(!
	`‹¡_b™
(
CN10K_LMTST
, &
pfvf
->
hw
.
ÿp_æag
)) {

33 
pfvf
->
hw_İs
 = &
Ùx2_hw_İs
;

37 
pfvf
->
hw_İs
 = &
ú10k_hw_İs
;

39 
pfvf
->
tÙ_lmt_lšes
 = (
	`num_Úlše_ıus
(è* 
LMT_BURST_SIZE
);

40 
pfvf
->
hw
.
lmt_šfo
 = 
	`®loc_³rıu
(
Ùx2_lmt_šfo
);

42 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

43 
»q
 = 
	`Ùx2_mbox_®loc_msg_lmt¡_tbl_£tup
(&
pfvf
->
mbox
);

44 ià(!
»q
) {

45 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

46  -
ENOMEM
;

49 
»q
->
u£_loÿl_lmt_»giÚ
 = 
Œue
;

51 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &pfvf->
dync_lmt
,…fvf->
tÙ_lmt_lšes
,

52 
LMT_LINE_SIZE
);

53 ià(
”r
) {

54 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

55  
”r
;

57 
pfvf
->
hw
.
lmt_ba£
 = (
u64
 *ífvf->
dync_lmt
->
ba£
;

58 
»q
->
lmt_iova
 = (
u64
)
pfvf
->
dync_lmt
->
iova
;

60 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

61 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

63 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

64 
lmt_šfo
 = 
	`³r_ıu_±r
(
pfvf
->
hw
.lmt_šfo, 
ıu
);

65 
lmt_šfo
->
lmt_addr
 = ((
u64
)
pfvf
->
hw
.
lmt_ba£
 +

66 (
ıu
 * 
LMT_BURST_SIZE
 * 
LMT_LINE_SIZE
));

67 
lmt_šfo
->
lmt_id
 = 
ıu
 * 
LMT_BURST_SIZE
;

71 
	}
}

72 
EXPORT_SYMBOL
(
ú10k_lmt¡_š™
);

74 
	$ú10k_sq_aq_š™
(*
dev
, 
u16
 
qidx
, 
u8
 
chª_off£t
, u16 
sqb_au¿
)

76 
nix_ú10k_aq_’q_»q
 *
aq
;

77 
Ùx2_nic
 *
pfvf
 = 
dev
;

80 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_ú10k_aq_’q
(&
pfvf
->
mbox
);

81 ià(!
aq
)

82  -
ENOMEM
;

84 
aq
->
sq
.
cq
 = 
pfvf
->
hw
.
rx_queues
 + 
qidx
;

85 
aq
->
sq
.
max_sqe_size
 = 
NIX_MAXSQESZ_W16
;

86 
aq
->
sq
.
cq_’a
 = 1;

87 
aq
->
sq
.
’a
 = 1;

88 
aq
->
sq
.
smq
 = 
	`Ùx2_g‘_smq_idx
(
pfvf
, 
qidx
);

89 
aq
->
sq
.
smq_¼_weight
 = 
	`mtu_to_dw¼_weight
(
pfvf
,…fvf->
tx_max_pk’
);

90 
aq
->
sq
.
deçuÉ_chª
 = 
pfvf
->
hw
.
tx_chª_ba£
 + 
chª_off£t
;

91 
aq
->
sq
.
sqe_¡y³
 = 
NIX_STYPE_STF
;

92 
aq
->
sq
.
sqb_au¿
 = sqb_aura;

93 
aq
->
sq
.
sq_št_’a
 = 
NIX_SQINT_BITS
;

94 
aq
->
sq
.
qšt_idx
 = 0;

98 
aq
->
sq
.
cq_lim™
 = ((
SEND_CQ_SKID
 * 256è/ (
pfvf
->
q£t
.
sqe_út
));

101 
aq
->
qidx
 = qidx;

102 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

103 
aq
->
İ
 = 
NIX_AQ_INSTOP_INIT
;

105  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

106 
	}
}

108 
	#NPA_MAX_BURST
 16

	)

109 
	$ú10k_»fl_poŞ_±rs
(*
dev
, 
Ùx2_cq_queue
 *
cq
)

111 
Ùx2_nic
 *
pfvf
 = 
dev
;

112 
u64
 
±rs
[
NPA_MAX_BURST
];

113 
num_±rs
 = 1;

114 
dma_addr_t
 
buåŒ
;

117 
cq
->
poŞ_±rs
) {

118 ià(
	`Ùx2_®loc_bufãr
(
pfvf
, 
cq
, &
buåŒ
)) {

119 ià(
num_±rs
--)

120 
	`__ú10k_au¿_ä“±r
(
pfvf
, 
cq
->
cq_idx
, 
±rs
,

121 
num_±rs
);

124 
cq
->
poŞ_±rs
--;

125 
±rs
[
num_±rs
] = (
u64
)
buåŒ
 + 
OTX2_HEAD_ROOM
;

126 
num_±rs
++;

127 ià(
num_±rs
 =ğ
NPA_MAX_BURST
 || 
cq
->
poŞ_±rs
 == 0) {

128 
	`__ú10k_au¿_ä“±r
(
pfvf
, 
cq
->
cq_idx
, 
±rs
,

129 
num_±rs
);

130 
num_±rs
 = 1;

133 
	}
}

135 
	$ú10k_sqe_æush
(*
dev
, 
Ùx2_¢d_queue
 *
sq
, 
size
, 
qidx
)

137 
Ùx2_lmt_šfo
 *
lmt_šfo
;

138 
Ùx2_nic
 *
pfvf
 = 
dev
;

139 
u64
 
v®
 = 0, 
r_addr
 = 0;

141 
lmt_šfo
 = 
	`³r_ıu_±r
(
pfvf
->
hw
.lmt_šfo, 
	`smp_´oûssÜ_id
());

146 
v®
 = (
lmt_šfo
->
lmt_id
 & 0x7FF);

151 
r_addr
 |ğ
sq
->
io_addr
 | (((
size
 / 16) - 1) & 0x7) << 4;

152 
	`dma_wmb
();

153 
	`memıy
((
u64
 *)
lmt_šfo
->
lmt_addr
, 
sq
->
sqe_ba£
, 
size
);

154 
	`ú10k_lmt_æush
(
v®
, 
r_addr
);

156 
sq
->
h—d
++;

157 
sq
->
h—d
 &ğ(sq->
sqe_út
 - 1);

158 
	}
}

160 
	$ú10k_ä“_®l_Şiûrs
(
Ùx2_nic
 *
pfvf
)

162 
nix_bªd´of_ä“_»q
 *
»q
;

163 
rc
;

165 ià(
	`is_dev_Ùx2
(
pfvf
->
pdev
))

168 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

170 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_bªd´of_ä“
(&
pfvf
->
mbox
);

171 ià(!
»q
) {

172 
rc
 = -
ENOMEM
;

173 
out
;

177 
»q
->
ä“_®l
 = 
Œue
;

179 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

180 
out
:

181 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

182  
rc
;

183 
	}
}

185 
	$ú10k_®loc_Ëaf_´ofe
(
Ùx2_nic
 *
pfvf
, 
u16
 *
Ëaf
)

187 
nix_bªd´of_®loc_»q
 *
»q
;

188 
nix_bªd´of_®loc_r¥
 *
r¥
;

189 
rc
;

191 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_bªd´of_®loc
(&
pfvf
->
mbox
);

192 ià(!
»q
)

193  -
ENOMEM
;

195 
»q
->
´of_couÁ
[
BAND_PROF_LEAF_LAYER
] = 1;

197 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

198 ià(
rc
)

199 
out
;

201 
r¥
 = (
nix_bªd´of_®loc_r¥
 *)

202 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

203 ià(!
r¥
->
´of_couÁ
[
BAND_PROF_LEAF_LAYER
]) {

204 
rc
 = -
EIO
;

205 
out
;

208 *
Ëaf
 = 
r¥
->
´of_idx
[
BAND_PROF_LEAF_LAYER
][0];

209 
out
:

210 ià(
rc
) {

211 
	`dev_w¬n
(
pfvf
->
dev
,

215  
rc
;

216 
	}
}

218 
	$ú10k_®loc_m©ch®l_Şiûr
(
Ùx2_nic
 *
pfvf
)

220 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

221 
»t
;

223 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

225 
»t
 = 
	`ú10k_®loc_Ëaf_´ofe
(
pfvf
, &
hw
->
m©ch®l_Şiûr
);

227 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

229  
»t
;

230 
	}
}

232 
	#POLICER_TIMESTAMP
 1

	)

233 
	#MAX_RATE_EXP
 22

	)

235 
	$ú10k_g‘_šg»ss_bur¡_cfg
(
u32
 
bur¡
, u32 *
bur¡_exp
,

236 
u32
 *
bur¡_mªtis§
)

238 
tmp
;

245 *
bur¡_exp
 = 
	`og2
(
bur¡
);

246 ià(
bur¡
 < 256) {

248 *
bur¡_mªtis§
 = 0;

252 ià(*
bur¡_exp
 > 
MAX_RATE_EXP
)

253 *
bur¡_exp
 = 
MAX_RATE_EXP
;

259 
tmp
 = 
bur¡
 - 
	`rounddown_pow_of_two
(burst);

260 *
bur¡_mªtis§
 = 
tmp
 / (1UL << (*
bur¡_exp
 - 8));

261 
	}
}

263 
	$ú10k_g‘_šg»ss_¿‹_cfg
(
u64
 
¿‹
, 
u32
 *
¿‹_exp
,

264 
u32
 *
¿‹_mªtis§
, u32 *
rdiv
)

266 
u32
 
div
 = 0;

267 
u32
 
exp
 = 0;

268 
u64
 
tmp
;

279 
tmp
 = 
¿‹
 * 32 * 2;

280 ià(
tmp
 < 256000000) {

281 
tmp
 < 256000000) {

282 
tmp
 =mp * 2;

283 
div
++;

286 
exp
 = 0; 
tmp
 >ğ512000000 &&ƒx°<ğ
MAX_RATE_EXP
;ƒxp++)

287 
tmp
 =mp / 2;

289 ià(
exp
 > 
MAX_RATE_EXP
)

290 
exp
 = 
MAX_RATE_EXP
;

293 *
¿‹_mªtis§
 = (
tmp
 - 256000000) / 1000000;

294 *
¿‹_exp
 = 
exp
;

295 *
rdiv
 = 
div
;

296 
	}
}

298 
	$ú10k_m­_unm­_rq_pŞiûr
(
Ùx2_nic
 *
pfvf
, 
rq_idx
,

299 
u16
 
pŞiûr
, 
boŞ
 
m­
)

301 
nix_ú10k_aq_’q_»q
 *
aq
;

303 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_ú10k_aq_’q
(&
pfvf
->
mbox
);

304 ià(!
aq
)

305  -
ENOMEM
;

308 ià(
m­
)

309 
aq
->
rq
.
pŞiûr_’a
 = 1;

311 
aq
->
rq
.
pŞiûr_’a
 = 0;

312 
aq
->
rq_mask
.
pŞiûr_’a
 = 1;

314 
aq
->
rq
.
bªd_´of_id
 = 
pŞiûr
;

315 
aq
->
rq_mask
.
bªd_´of_id
 = 
	`GENMASK
(9, 0);

318 
aq
->
qidx
 = 
rq_idx
;

319 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_RQ
;

320 
aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

322  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

323 
	}
}

325 
	$ú10k_ä“_Ëaf_´ofe
(
Ùx2_nic
 *
pfvf
, 
u16
 
Ëaf
)

327 
nix_bªd´of_ä“_»q
 *
»q
;

329 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_bªd´of_ä“
(&
pfvf
->
mbox
);

330 ià(!
»q
)

331  -
ENOMEM
;

333 
»q
->
´of_couÁ
[
BAND_PROF_LEAF_LAYER
] = 1;

334 
»q
->
´of_idx
[
BAND_PROF_LEAF_LAYER
][0] = 
Ëaf
;

336  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

337 
	}
}

339 
	$ú10k_ä“_m©ch®l_Şiûr
(
Ùx2_nic
 *
pfvf
)

341 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

342 
qidx
, 
rc
;

344 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

347 
qidx
 = 0; qidx < 
hw
->
rx_queues
; qidx++)

348 
	`ú10k_m­_unm­_rq_pŞiûr
(
pfvf
, 
qidx
,

349 
hw
->
m©ch®l_Şiûr
, 
çl£
);

351 
rc
 = 
	`ú10k_ä“_Ëaf_´ofe
(
pfvf
, 
hw
->
m©ch®l_Şiûr
);

353 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

354  
rc
;

355 
	}
}

357 
	$ú10k_£t_Şiûr_¿‹
(
Ùx2_nic
 *
pfvf
, 
u16
 
´ofe
,

358 
u32
 
bur¡
, 
u64
 
¿‹
, 
boŞ
 
µs
)

360 
nix_ú10k_aq_’q_»q
 *
aq
;

361 
u32
 
bur¡_exp
, 
bur¡_mªtis§
;

362 
u32
 
¿‹_exp
, 
¿‹_mªtis§
;

363 
u32
 
rdiv
;

366 
	`ú10k_g‘_šg»ss_bur¡_cfg
(
bur¡
, &
bur¡_exp
, &
bur¡_mªtis§
);

367 
	`ú10k_g‘_šg»ss_¿‹_cfg
(
¿‹
, &
¿‹_exp
, &
¿‹_mªtis§
, &
rdiv
);

370 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_ú10k_aq_’q
(&
pfvf
->
mbox
);

371 ià(!
aq
)

372  -
ENOMEM
;

375 
aq
->
´of
.
icŞÜ
 = 0x03;

376 
aq
->
´of_mask
.
icŞÜ
 = 0x03;

379 
aq
->
´of
.
cœ_expÚ’t
 = 
¿‹_exp
;

380 
aq
->
´of_mask
.
cœ_expÚ’t
 = 0x1F;

382 
aq
->
´of
.
cœ_mªtis§
 = 
¿‹_mªtis§
;

383 
aq
->
´of_mask
.
cœ_mªtis§
 = 0xFF;

385 
aq
->
´of
.
cbs_expÚ’t
 = 
bur¡_exp
;

386 
aq
->
´of_mask
.
cbs_expÚ’t
 = 0x1F;

388 
aq
->
´of
.
cbs_mªtis§
 = 
bur¡_mªtis§
;

389 
aq
->
´of_mask
.
cbs_mªtis§
 = 0xFF;

391 
aq
->
´of
.
rdiv
 =„div;

392 
aq
->
´of_mask
.
rdiv
 = 0xF;

394 ià(
µs
) {

408 
aq
->
´of
.
adju¡_expÚ’t
 = 1;

409 
aq
->
´of_mask
.
adju¡_expÚ’t
 = 0x1F;

411 
aq
->
´of
.
adju¡_mªtis§
 = 384;

412 
aq
->
´of_mask
.
adju¡_mªtis§
 = 0x1FF;

414 
aq
->
´of
.
lmode
 = 0x1;

415 
aq
->
´of_mask
.
lmode
 = 0x1;

421 
aq
->
´of
.
m‘”_®go
 = 2;

422 
aq
->
´of_mask
.
m‘”_®go
 = 0x3;

424 
aq
->
´of
.
rc_aùiÚ
 = 
NIX_RX_BAND_PROF_ACTIONRESULT_DROP
;

425 
aq
->
´of_mask
.
rc_aùiÚ
 = 0x3;

427 
aq
->
´of
.
yc_aùiÚ
 = 
NIX_RX_BAND_PROF_ACTIONRESULT_PASS
;

428 
aq
->
´of_mask
.
yc_aùiÚ
 = 0x3;

430 
aq
->
´of
.
gc_aùiÚ
 = 
NIX_RX_BAND_PROF_ACTIONRESULT_PASS
;

431 
aq
->
´of_mask
.
gc_aùiÚ
 = 0x3;

438 
aq
->
´of
.
³œ_expÚ’t
 = 24;

439 
aq
->
´of_mask
.
³œ_expÚ’t
 = 0x1F;

441 
aq
->
´of
.
³œ_mªtis§
 = 0;

442 
aq
->
´of_mask
.
³œ_mªtis§
 = 0xFF;

444 
aq
->
´of
.
³bs_expÚ’t
 = 24;

445 
aq
->
´of_mask
.
³bs_expÚ’t
 = 0x1F;

447 
aq
->
´of
.
³bs_mªtis§
 = 0;

448 
aq
->
´of_mask
.
³bs_mªtis§
 = 0xFF;

451 
aq
->
qidx
 = 
´ofe
;

452 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_BANDPROF
;

453 
aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

455  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

456 
	}
}

458 
	$ú10k_£t_m©ch®l_Şiûr_¿‹
(
Ùx2_nic
 *
pfvf
,

459 
u32
 
bur¡
, 
u64
 
¿‹
)

461 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

462 
qidx
, 
rc
;

464 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

466 
rc
 = 
	`ú10k_£t_Şiûr_¿‹
(
pfvf
, 
hw
->
m©ch®l_Şiûr
, 
bur¡
,

467 
¿‹
, 
çl£
);

468 ià(
rc
)

469 
out
;

471 
qidx
 = 0; qidx < 
hw
->
rx_queues
; qidx++) {

472 
rc
 = 
	`ú10k_m­_unm­_rq_pŞiûr
(
pfvf
, 
qidx
,

473 
hw
->
m©ch®l_Şiûr
, 
Œue
);

474 ià(
rc
)

478 
out
:

479 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

480  
rc
;

481 
	}
}

	@cn10k.h

8 #iâdeà
CN10K_H


9 
	#CN10K_H


	)

11 
	~"Ùx2_commÚ.h
"

13 
šlše
 
	$mtu_to_dw¼_weight
(
Ùx2_nic
 *
pfvf
, 
mtu
)

15 
u32
 
weight
;

20 
weight
 = 
mtu
 / 
pfvf
->
hw
.
dw¼_mtu
;

21 ià(
mtu
 % 
pfvf
->
hw
.
dw¼_mtu
)

22 
weight
 += 1;

24  
weight
;

25 
	}
}

27 
ú10k_»fl_poŞ_±rs
(*
dev
, 
Ùx2_cq_queue
 *
cq
);

28 
ú10k_sqe_æush
(*
dev
, 
Ùx2_¢d_queue
 *
sq
, 
size
, 
qidx
);

29 
ú10k_sq_aq_š™
(*
dev
, 
u16
 
qidx
, 
u8
 
chª_off£t
, u16 
sqb_au¿
);

30 
ú10k_lmt¡_š™
(
Ùx2_nic
 *
pfvf
);

31 
ú10k_ä“_®l_Şiûrs
(
Ùx2_nic
 *
pfvf
);

32 
ú10k_®loc_m©ch®l_Şiûr
(
Ùx2_nic
 *
pfvf
);

33 
ú10k_ä“_m©ch®l_Şiûr
(
Ùx2_nic
 *
pfvf
);

34 
ú10k_£t_m©ch®l_Şiûr_¿‹
(
Ùx2_nic
 *
pfvf
,

35 
u32
 
bur¡
, 
u64
 
¿‹
);

36 
ú10k_m­_unm­_rq_pŞiûr
(
Ùx2_nic
 *
pfvf
, 
rq_idx
,

37 
u16
 
pŞiûr
, 
boŞ
 
m­
);

38 
ú10k_®loc_Ëaf_´ofe
(
Ùx2_nic
 *
pfvf
, 
u16
 *
Ëaf
);

39 
ú10k_£t_Şiûr_¿‹
(
Ùx2_nic
 *
pfvf
, 
u16
 
´ofe
,

40 
u32
 
bur¡
, 
u64
 
¿‹
, 
boŞ
 
µs
);

41 
ú10k_ä“_Ëaf_´ofe
(
Ùx2_nic
 *
pfvf
, 
u16
 
Ëaf
);

	@otx2_bpf.c

1 
	~<lšux/Ãtdeviû.h
>

2 
	~<lšux/f‹r.h
>

3 
	~<lšux/´oc_fs.h
>

4 
	~<lšux/bpf.h
>

5 
	~<lšux/bpf_v”if›r.h
>

6 
	~"Ùx2_commÚ.h
"

7 
	~"Ùx2_xdp_debug.h
"

8 
	~"Ùx2_th»ad.h
"

9 
	~"Ùx2_xdp.h
"

10 
	~"Ùx2_bpf.h
"

12 
	eoxt2_bpf_š¢_æag
 {

13 
	mOTX2_BPF_INSN_FLAG_SUBPROG_START
 = 
BIT_ULL
(0),

14 
	mOTX2_BPF_INSN_FLAG_JMP_DST
 = 
BIT_ULL
(1),

15 
	mOTX2_BPF_INSN_FLAG_VERIFIER
 = 
BIT_ULL
(2),

16 
	mOTX2_BPF_INSN_FLAG_FIXUP_INSN
 = 
BIT_ULL
(3),

19 
	$oxt2_bpf_ı_¬ch_ùx2mem
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
u32
 *
exec_mem
, *
off£t
)

21 
idx
 = *
off£t
;

22 
i
;

24 
ùx
->
off£t
 = 
idx
;

26 
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
idx
++) {

27 
exec_mem
[
idx
] = 
ùx
->
bi
[
i
];

30 *
off£t
 = 
idx
;

31 
	}
}

33 
	$Ùx2_bpf_´št_¬ch_š¢
(
Ùx2_bpf_´og
 *
obp
, 
u32
 *
exec_mem
)

35 
Ùx2_bpf_¬ch_ùx
 *
ùx
;

36 
Ùx2_bpf_š¢
 *
š¢
;

37 
off
 = 0;

38 
i
;

40 
	`´_”r
("prologue\n");

41 
ùx
 = &
obp
->
´Şogue
;

42  
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

43 
	`´_”r
("0x%04x off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), off);

46 
	`´_”r
("Body \n");

48 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

50 
ùx
 = &
š¢
->ctx;

51 
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

52 
	`´_”r
("0x%04x idx=%d off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), 
š¢
->
idx
, off);

54 
	`´_”r
("\n");

57 
	`´_”r
("epilogue\n");

58 
ùx
 = &
obp
->
•ogue
;

59  
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

60 
	`´_”r
("0x%4x off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), off);

63 
	`´_”r
("off£ˆğ%d obp->off£t=%d\n", 
off
, 
obp
->
j™ed_Ën
);

64 
	}
}

66 
	$Ùx2_bpf_´og_·ss
(
Ùx2_bpf_´og
 *
obp
, 
u32
 *
exec_mem
)

68 
Ùx2_bpf_š¢
 *
š¢
;

69 
Ùx2_bpf_¬ch_ùx
 *
ùx
;

70 
off£t
 = 0;

71 
ùx
 = &
obp
->
´Şogue
;

73 
	`oxt2_bpf_ı_¬ch_ùx2mem
(
ùx
, 
exec_mem
, &
off£t
);

76 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

77 
	`bud_š¢
(&
š¢
->š¢, &š¢->
ùx
, 
çl£
, (
u64
)
exec_mem
, 
obp
);

78 
	`oxt2_bpf_ı_¬ch_ùx2mem
(&
š¢
->
ùx
, 
exec_mem
, &
off£t
);

81 
ùx
 = &
obp
->
•ogue
;

82 
	`oxt2_bpf_ı_¬ch_ùx2mem
(
ùx
, 
exec_mem
, &
off£t
);

83 
obp
->
j™ed_Ën
 = 
off£t
 * 4;

85 
	`´_”r
("Second…ass\n");

88 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

89 
tmp
;

91 ià(!(
š¢
->
æags
 & 
OTX2_BPF_INSN_FLAG_FIXUP_INSN
)) {

95 
tmp
 = 
š¢
->
ùx
.
off£t
;

96 
	`mem£t
(&
š¢
->
ùx
, 0, (
Ùx2_bpf_¬ch_ùx
));

98 
	`bud_š¢
(&
š¢
->š¢, &š¢->
ùx
, 
Œue
, (
u64
)
exec_mem
, 
obp
);

99 
	`oxt2_bpf_ı_¬ch_ùx2mem
(&
š¢
->
ùx
, 
exec_mem
, &
tmp
);

102 
	}
}

	@otx2_bpf.h

2 #iâdeà
OTX2_BPF_H_


3 
	#OTX2_BPF_H_


	)

5 
	sÙx2_bpf_¬ch_ùx
 {

6 
u32
 
	mbi
[16];

7 
u8
 
	mbpf2bi_út
;

8 
u32
 
	moff£t
;

11 
	sÙx2_bpf_š¢
 {

12 
Ùx2_bpf_¬ch_ùx
 
	mùx
;

13 
Ùx2_bpf_š¢
 *
	mto_jmp
;

14 
li¡_h—d
 
	mli¡
;

15 
bpf_š¢
 
	mš¢
;

16 
u64
 
	mæags
;

17 
	midx
;

20 
	sÙx2_bpf_´og
 {

21 
Ùx2_bpf_¬ch_ùx
 
	m•ogue
;

22 
Ùx2_bpf_¬ch_ùx
 
	m´Şogue
;

23 
Ùx2_bpf_š¢
 *
	mobšs
;

24 
bpf_´og
 *
	mbpf_´og
;

25 
li¡_h—d
 
	mlh—d
;

26 
mu‹x
 
	mmu‹x
;

27 
	mj™ed_Ën
;

28 
boŞ
 
	mj™ed
;

31 
bud_´Şogue
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
bpf_´og
 *
´og
);

32 
bud_•ogue
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
bpf_´og
 *
´og
);

33 
bud_š¢
(cÚ¡ 
bpf_š¢
 *
š¢
, 
Ùx2_bpf_¬ch_ùx
 *
ùx
,

34 
boŞ
 
exŒa_·ss
, 
u64
 
img_addr
, 
Ùx2_bpf_´og
 *
p
);

	@otx2_bpf_arch_insn.c

8 
	#´_fmt
(
fmt
è"bpf_j™: " 
	)
fmt

10 
	~<lšux/bpf.h
>

11 
	~<lšux/f‹r.h
>

12 
	~<lšux/´štk.h
>

13 
	~<lšux/¦ab.h
>

15 
	~<asm/by‹Üd”.h
>

16 
	~<asm/ÿcheæush.h
>

17 
	~<asm/debug-mÚ™Üs.h
>

18 
	~<asm/£t_memÜy.h
>

20 
	~"bpf_j™.h
"

21 
	~"Ùx2_xdp.h
"

22 
	~"Ùx2_xdp_debug.h
"

24 
	#TMP_REG_1
 (
MAX_BPF_JIT_REG
 + 0)

	)

25 
	#TMP_REG_2
 (
MAX_BPF_JIT_REG
 + 1)

	)

26 
	#TCALL_CNT
 (
MAX_BPF_JIT_REG
 + 2)

	)

27 
	#TMP_REG_3
 (
MAX_BPF_JIT_REG
 + 3)

	)

30 cÚ¡ 
	gbpf2a64
[] = {

32 [
BPF_REG_0
] = 
A64_R
(7),

34 [
BPF_REG_1
] = 
A64_R
(0),

35 [
BPF_REG_2
] = 
A64_R
(1),

36 [
BPF_REG_3
] = 
A64_R
(2),

37 [
BPF_REG_4
] = 
A64_R
(3),

38 [
BPF_REG_5
] = 
A64_R
(4),

40 [
BPF_REG_6
] = 
A64_R
(19),

41 [
BPF_REG_7
] = 
A64_R
(20),

42 [
BPF_REG_8
] = 
A64_R
(21),

43 [
BPF_REG_9
] = 
A64_R
(22),

45 [
BPF_REG_FP
] = 
A64_R
(25),

47 [
TMP_REG_1
] = 
A64_R
(10),

48 [
TMP_REG_2
] = 
A64_R
(11),

49 [
TMP_REG_3
] = 
A64_R
(12),

51 [
TCALL_CNT
] = 
A64_R
(26),

53 [
BPF_REG_AX
] = 
A64_R
(9),

56 
šlše
 
	$em™
(cÚ¡ 
u32
 
š¢
, 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

58 
ùx
->
bi
[ùx->
bpf2bi_út
] = 
	`ıu_to_Ë32
(
š¢
);

59 
ùx
->
bpf2bi_út
++;

60 
	}
}

62 
šlše
 
	$em™_a64_mov_i
(cÚ¡ 
is64
, cÚ¡ 
»g
,

63 cÚ¡ 
s32
 
v®
, 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

65 
u16
 
hi
 = 
v®
 >> 16;

66 
u16
 
lo
 = 
v®
 & 0xffff;

68 ià(
hi
 & 0x8000) {

69 ià(
hi
 == 0xffff) {

70 
	`em™
(
	`A64_MOVN
(
is64
, 
»g
, (
u16
)~
lo
, 0), 
ùx
);

72 
	`em™
(
	`A64_MOVN
(
is64
, 
»g
, (
u16
)~
hi
, 16), 
ùx
);

73 ià(
lo
 != 0xffff)

74 
	`em™
(
	`A64_MOVK
(
is64
, 
»g
, 
lo
, 0), 
ùx
);

77 
	`em™
(
	`A64_MOVZ
(
is64
, 
»g
, 
lo
, 0), 
ùx
);

78 ià(
hi
)

79 
	`em™
(
	`A64_MOVK
(
is64
, 
»g
, 
hi
, 16), 
ùx
);

81 
	}
}

83 
	$i64_i16_blocks
(cÚ¡ 
u64
 
v®
, 
boŞ
 
šv”£
)

85  (((
v®
 >> 0è& 0xffffè!ğ(
šv”£
 ? 0xffff : 0x0000)) +

86 (((
v®
 >> 16è& 0xffffè!ğ(
šv”£
 ? 0xffff : 0x0000)) +

87 (((
v®
 >> 32è& 0xffffè!ğ(
šv”£
 ? 0xffff : 0x0000)) +

88 (((
v®
 >> 48è& 0xffffè!ğ(
šv”£
 ? 0xffff : 0x0000));

89 
	}
}

91 
šlše
 
	$em™_a64_mov_i64
(cÚ¡ 
»g
, cÚ¡ 
u64
 
v®
,

92 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

94 
u64
 
Äm_tmp
 = 
v®
, 
»v_tmp
 = ~val;

95 
boŞ
 
šv”£
;

96 
shiá
;

98 ià(!(
Äm_tmp
 >> 32))

99  
	`em™_a64_mov_i
(0, 
»g
, (
u32
)
v®
, 
ùx
);

101 
šv”£
 = 
	`i64_i16_blocks
(
Äm_tmp
, 
Œue
è< i64_i16_blocksÒrm_tmp, 
çl£
);

102 
shiá
 = 
	`max
(
	`round_down
((
šv”£
 ? (
	`æs64
(
»v_tmp
) - 1) :

103 (
	`æs64
(
Äm_tmp
) - 1)), 16), 0);

104 ià(
šv”£
)

105 
	`em™
(
	`A64_MOVN
(1, 
»g
, (
»v_tmp
 >> 
shiá
è& 0xffff, shiá), 
ùx
);

107 
	`em™
(
	`A64_MOVZ
(1, 
»g
, (
Äm_tmp
 >> 
shiá
è& 0xffff, shiá), 
ùx
);

108 
shiá
 -= 16;

109 
shiá
 >= 0) {

110 ià(((
Äm_tmp
 >> 
shiá
è& 0xffffè!ğ(
šv”£
 ? 0xffff : 0x0000))

111 
	`em™
(
	`A64_MOVK
(1, 
»g
, (
Äm_tmp
 >> 
shiá
è& 0xffff, shiá), 
ùx
);

112 
shiá
 -= 16;

114 
	}
}

121 
šlše
 
	$em™_addr_mov_i64
(cÚ¡ 
»g
, cÚ¡ 
u64
 
v®
,

122 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

124 
u64
 
tmp
 = 
v®
;

125 
shiá
 = 0;

127 
	`em™
(
	`A64_MOVN
(1, 
»g
, ~
tmp
 & 0xffff, 
shiá
), 
ùx
);

128 
shiá
 < 32) {

129 
tmp
 >>= 16;

130 
shiá
 += 16;

131 
	`em™
(
	`A64_MOVK
(1, 
»g
, 
tmp
 & 0xffff, 
shiá
), 
ùx
);

133 
	}
}

137 
šlše
 
	$bpf2a64_off£t
(
bpf_š¢
, 
off
,

138 cÚ¡ 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

141 
bpf_š¢
++;

147  
ùx
->
off£t
[
bpf_š¢
 + 
off
] - (ctx->offset[bpf_insn] - 1);

148 
	}
}

150 
	$j™_fl_hŞe
(*
¬—
, 
size
)

152 
__Ë32
 *
±r
;

154 
±r
 = 
¬—
; 
size
 >ğ(
u32
); size -= (u32))

155 *
±r
++ = 
	`ıu_to_Ë32
(
AARCH64_BREAK_FAULT
);

156 
	}
}

159 
šlše
 
	$•ogue_off£t
(
Ùx2_bpf_´og
 *
p
, cÚ¡ 
Ùx2_bpf_¬ch_ùx
 *
ùx
)

161 
to
 = 
p
->
•ogue
.
off£t
;

162 
äom
 = 
ùx
->
off£t
;

164  
to
 - 
äom
;

165 
	}
}

168 
	#STACK_ALIGN
(
sz
è(((szè+ 15è& ~15)

	)

171 
	#PROLOGUE_OFFSET
 7

	)

173 
	$bud_´Şogue
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
bpf_´og
 *
´og
)

175 cÚ¡ 
u8
 
r6
 = 
bpf2a64
[
BPF_REG_6
];

176 cÚ¡ 
u8
 
r7
 = 
bpf2a64
[
BPF_REG_7
];

177 cÚ¡ 
u8
 
r8
 = 
bpf2a64
[
BPF_REG_8
];

178 cÚ¡ 
u8
 
r9
 = 
bpf2a64
[
BPF_REG_9
];

179 cÚ¡ 
u8
 
å
 = 
bpf2a64
[
BPF_REG_FP
];

180 cÚ¡ 
u8
 
tcc
 = 
bpf2a64
[
TCALL_CNT
];

181 
¡ack_size
;

183 cÚ¡ 
idx0
 = 
ùx
->
idx
;

184 
cur_off£t
;

211 
	`em™
(
	`A64_PUSH
(
A64_FP
, 
A64_LR
, 
A64_SP
), 
ùx
);

212 
	`em™
(
	`A64_MOV
(1, 
A64_FP
, 
A64_SP
), 
ùx
);

215 
	`em™
(
	`A64_PUSH
(
r6
, 
r7
, 
A64_SP
), 
ùx
);

216 
	`em™
(
	`A64_PUSH
(
r8
, 
r9
, 
A64_SP
), 
ùx
);

217 
	`em™
(
	`A64_PUSH
(
å
, 
tcc
, 
A64_SP
), 
ùx
);

220 
	`em™
(
	`A64_MOV
(1, 
å
, 
A64_SP
), 
ùx
);

225 
	`em™
(
	`A64_MOVZ
(1, 
tcc
, 0, 0), 
ùx
);

228 
cur_off£t
 = 
ùx
->
idx
 - 
idx0
;

229 ià(
cur_off£t
 !ğ
PROLOGUE_OFFSET
) {

230 
	`´_”r_Úû
("PROLOGUE_OFFSET = %d,ƒxpected %d!\n",

231 
cur_off£t
, 
PROLOGUE_OFFSET
);

237 
¡ack_size
 = 
	`STACK_ALIGN
(
´og
->
aux
->
¡ack_d•th
);

240 
	`em™
(
	`A64_SUB_I
(1, 
A64_SP
, A64_SP, 
¡ack_size
), 
ùx
);

242 
	}
}

245 
	gout_off£t
 = -1;

246 
	$em™_bpf__ÿÎ
(
Ùx2_bpf_¬ch_ùx
 *
ùx
)

249 cÚ¡ 
u8
 
r2
 = 
bpf2a64
[
BPF_REG_2
];

250 cÚ¡ 
u8
 
r3
 = 
bpf2a64
[
BPF_REG_3
];

252 cÚ¡ 
u8
 
tmp
 = 
bpf2a64
[
TMP_REG_1
];

253 cÚ¡ 
u8
 
´g
 = 
bpf2a64
[
TMP_REG_2
];

254 cÚ¡ 
u8
 
tcc
 = 
bpf2a64
[
TCALL_CNT
];

255 cÚ¡ 
idx0
 = 
ùx
->
idx
;

256 
	#cur_off£t
 (
ùx
->
idx
 - 
idx0
)

	)

257 
	#jmp_off£t
 (
out_off£t
 - (
cur_off£t
))

	)

258 
size_t
 
off
;

263 
off
 = 
	`off£tof
(
bpf_¬¿y
, 
m­
.
max_’Œ›s
);

264 
	`em™_a64_mov_i64
(
tmp
, 
off
, 
ùx
);

265 
	`em™
(
	`A64_LDR32
(
tmp
, 
r2
,mp), 
ùx
);

266 
	`em™
(
	`A64_MOV
(0, 
r3
,„3), 
ùx
);

267 
	`em™
(
	`A64_CMP
(0, 
r3
, 
tmp
), 
ùx
);

268 
	`em™
(
	`A64_B_
(
A64_COND_CS
, 
jmp_off£t
), 
ùx
);

274 
	`em™_a64_mov_i64
(
tmp
, 
MAX_TAIL_CALL_CNT
, 
ùx
);

275 
	`em™
(
	`A64_CMP
(1, 
tcc
, 
tmp
), 
ùx
);

276 
	`em™
(
	`A64_B_
(
A64_COND_HI
, 
jmp_off£t
), 
ùx
);

277 
	`em™
(
	`A64_ADD_I
(1, 
tcc
,cc, 1), 
ùx
);

283 
off
 = 
	`off£tof
(
bpf_¬¿y
, 
±rs
);

284 
	`em™_a64_mov_i64
(
tmp
, 
off
, 
ùx
);

285 
	`em™
(
	`A64_ADD
(1, 
tmp
, 
r2
,mp), 
ùx
);

286 
	`em™
(
	`A64_LSL
(1, 
´g
, 
r3
, 3), 
ùx
);

287 
	`em™
(
	`A64_LDR64
(
´g
, 
tmp
,…rg), 
ùx
);

288 
	`em™
(
	`A64_CBZ
(1, 
´g
, 
jmp_off£t
), 
ùx
);

291 
off
 = 
	`off£tof
(
bpf_´og
, 
bpf_func
);

292 
	`em™_a64_mov_i64
(
tmp
, 
off
, 
ùx
);

293 
	`em™
(
	`A64_LDR64
(
tmp
, 
´g
,mp), 
ùx
);

294 
	`em™
(
	`A64_ADD_I
(1, 
tmp
,mp, (
u32
è* 
PROLOGUE_OFFSET
), 
ùx
);

295 
	`em™
(
	`A64_ADD_I
(1, 
A64_SP
, A64_SP, 
ùx
->
¡ack_size
), ctx);

296 
	`em™
(
	`A64_BR
(
tmp
), 
ùx
);

299 ià(
out_off£t
 == -1)

300 
out_off£t
 = 
cur_off£t
;

301 ià(
cur_off£t
 !ğ
out_off£t
) {

302 
	`´_”r_Úû
("tail_call out_offset = %d,ƒxpected %d!\n",

303 
cur_off£t
, 
out_off£t
);

307 #undeà
cur_off£t


308 #undeà
jmp_off£t


309 
	}
}

313 
	$bud_•ogue
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
bpf_´og
 *
´og
)

316 cÚ¡ 
u8
 
r0
 = 
bpf2a64
[
BPF_REG_0
];

317 cÚ¡ 
u8
 
r6
 = 
bpf2a64
[
BPF_REG_6
];

318 cÚ¡ 
u8
 
r7
 = 
bpf2a64
[
BPF_REG_7
];

319 cÚ¡ 
u8
 
r8
 = 
bpf2a64
[
BPF_REG_8
];

320 cÚ¡ 
u8
 
r9
 = 
bpf2a64
[
BPF_REG_9
];

321 cÚ¡ 
u8
 
å
 = 
bpf2a64
[
BPF_REG_FP
];

322 
¡ack_size
 = 
	`STACK_ALIGN
(
´og
->
aux
->
¡ack_d•th
);

325 
	`em™
(
	`A64_ADD_I
(1, 
A64_SP
, A64_SP, 
¡ack_size
), 
ùx
);

328 
	`em™
(
	`A64_POP
(
å
, 
	`A64_R
(26), 
A64_SP
), 
ùx
);

331 
	`em™
(
	`A64_POP
(
r8
, 
r9
, 
A64_SP
), 
ùx
);

332 
	`em™
(
	`A64_POP
(
r6
, 
r7
, 
A64_SP
), 
ùx
);

335 
	`em™
(
	`A64_POP
(
A64_FP
, 
A64_LR
, 
A64_SP
), 
ùx
);

338 
	`em™
(
	`A64_MOV
(1, 
	`A64_R
(0), 
r0
), 
ùx
);

340 
	`em™
(
	`A64_RET
(
A64_LR
), 
ùx
);

341 
	}
}

349 
	$bud_š¢
(cÚ¡ 
bpf_š¢
 *
š¢
, 
Ùx2_bpf_¬ch_ùx
 *
ùx
,

350 
boŞ
 
exŒa_·ss
, 
u64
 
lßd_addr
, 
Ùx2_bpf_´og
 *
p
)

352 cÚ¡ 
u8
 
code
 = 
š¢
->code;

353 cÚ¡ 
u8
 
d¡
 = 
bpf2a64
[
š¢
->
d¡_»g
];

354 cÚ¡ 
u8
 
¤c
 = 
bpf2a64
[
š¢
->
¤c_»g
];

355 cÚ¡ 
u8
 
tmp
 = 
bpf2a64
[
TMP_REG_1
];

356 cÚ¡ 
u8
 
tmp2
 = 
bpf2a64
[
TMP_REG_2
];

357 cÚ¡ 
u8
 
tmp3
 = 
bpf2a64
[
TMP_REG_3
];

358 cÚ¡ 
s16
 
off
 = 
š¢
->off;

359 cÚ¡ 
s32
 
imm
 = 
š¢
->imm;

360 
Ùx2_bpf_š¢
 *
oš¢
 = (Ùx2_bpf_š¢ *)
ùx
;

362 cÚ¡ 
i
 = 
oš¢
->
idx
;

364 cÚ¡ 
boŞ
 
is64
 = 
	`BPF_CLASS
(
code
è=ğ
BPF_ALU64
 ||

365 
	`BPF_CLASS
(
code
è=ğ
BPF_JMP
;

366 cÚ¡ 
boŞ
 
isdw
 = 
	`BPF_SIZE
(
code
è=ğ
BPF_DW
;

367 
u8
 
jmp_cÚd
, 
»g
;

368 
s32
 
jmp_off£t
;

370 
	#check_imm
(
b™s
, 
imm
) do { \

371 ià((((
imm
è> 0è&& ((immè>> (
b™s
))) || \

372 (((
imm
è< 0è&& (~(immè>> (
b™s
)))) { \

373 
	`´_šfo
("[%2d] imm=%d(0x%x) out of„ange\n", \

374 
i
, 
imm
, imm); \

375  -
EINVAL
; \

377 } 0)

	)

378 
	#check_imm19
(
imm
è
	`check_imm
(19, imm)

	)

379 
	#check_imm26
(
imm
è
	`check_imm
(26, imm)

	)

381 
code
) {

383 
BPF_ALU
 | 
BPF_MOV
 | 
BPF_X
:

384 
BPF_ALU64
 | 
BPF_MOV
 | 
BPF_X
:

385 
	`em™
(
	`A64_MOV
(
is64
, 
d¡
, 
¤c
), 
ùx
);

388 
BPF_ALU
 | 
BPF_ADD
 | 
BPF_X
:

389 
BPF_ALU64
 | 
BPF_ADD
 | 
BPF_X
:

390 
	`em™
(
	`A64_ADD
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

392 
BPF_ALU
 | 
BPF_SUB
 | 
BPF_X
:

393 
BPF_ALU64
 | 
BPF_SUB
 | 
BPF_X
:

394 
	`em™
(
	`A64_SUB
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

396 
BPF_ALU
 | 
BPF_AND
 | 
BPF_X
:

397 
BPF_ALU64
 | 
BPF_AND
 | 
BPF_X
:

398 
	`em™
(
	`A64_AND
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

400 
BPF_ALU
 | 
BPF_OR
 | 
BPF_X
:

401 
BPF_ALU64
 | 
BPF_OR
 | 
BPF_X
:

402 
	`em™
(
	`A64_ORR
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

404 
BPF_ALU
 | 
BPF_XOR
 | 
BPF_X
:

405 
BPF_ALU64
 | 
BPF_XOR
 | 
BPF_X
:

406 
	`em™
(
	`A64_EOR
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

408 
BPF_ALU
 | 
BPF_MUL
 | 
BPF_X
:

409 
BPF_ALU64
 | 
BPF_MUL
 | 
BPF_X
:

410 
	`em™
(
	`A64_MUL
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

412 
BPF_ALU
 | 
BPF_DIV
 | 
BPF_X
:

413 
BPF_ALU64
 | 
BPF_DIV
 | 
BPF_X
:

414 
BPF_ALU
 | 
BPF_MOD
 | 
BPF_X
:

415 
BPF_ALU64
 | 
BPF_MOD
 | 
BPF_X
:

416 
	`BPF_OP
(
code
)) {

417 
BPF_DIV
:

418 
	`em™
(
	`A64_UDIV
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

420 
BPF_MOD
:

421 
	`em™
(
	`A64_UDIV
(
is64
, 
tmp
, 
d¡
, 
¤c
), 
ùx
);

422 
	`em™
(
	`A64_MSUB
(
is64
, 
d¡
, d¡, 
tmp
, 
¤c
), 
ùx
);

426 
BPF_ALU
 | 
BPF_LSH
 | 
BPF_X
:

427 
BPF_ALU64
 | 
BPF_LSH
 | 
BPF_X
:

428 
	`em™
(
	`A64_LSLV
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

430 
BPF_ALU
 | 
BPF_RSH
 | 
BPF_X
:

431 
BPF_ALU64
 | 
BPF_RSH
 | 
BPF_X
:

432 
	`em™
(
	`A64_LSRV
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

434 
BPF_ALU
 | 
BPF_ARSH
 | 
BPF_X
:

435 
BPF_ALU64
 | 
BPF_ARSH
 | 
BPF_X
:

436 
	`em™
(
	`A64_ASRV
(
is64
, 
d¡
, d¡, 
¤c
), 
ùx
);

439 
BPF_ALU
 | 
BPF_NEG
:

440 
BPF_ALU64
 | 
BPF_NEG
:

441 
	`em™
(
	`A64_NEG
(
is64
, 
d¡
, d¡), 
ùx
);

444 
BPF_ALU
 | 
BPF_END
 | 
BPF_FROM_LE
:

445 
BPF_ALU
 | 
BPF_END
 | 
BPF_FROM_BE
:

446 #ifdeà
CONFIG_CPU_BIG_ENDIAN


447 ià(
	`BPF_SRC
(
code
è=ğ
BPF_FROM_BE
)

448 
em™_bsw­_uxt
;

450 ià(
	`BPF_SRC
(
code
è=ğ
BPF_FROM_LE
)

451 
em™_bsw­_uxt
;

453 
imm
) {

455 
	`em™
(
	`A64_REV16
(
is64
, 
d¡
, d¡), 
ùx
);

457 
	`em™
(
	`A64_UXTH
(
is64
, 
d¡
, d¡), 
ùx
);

460 
	`em™
(
	`A64_REV32
(
is64
, 
d¡
, d¡), 
ùx
);

464 
	`em™
(
	`A64_REV64
(
d¡
, d¡), 
ùx
);

468 
em™_bsw­_uxt
:

469 
imm
) {

472 
	`em™
(
	`A64_UXTH
(
is64
, 
d¡
, d¡), 
ùx
);

476 
	`em™
(
	`A64_UXTW
(
is64
, 
d¡
, d¡), 
ùx
);

484 
BPF_ALU
 | 
BPF_MOV
 | 
BPF_K
:

485 
BPF_ALU64
 | 
BPF_MOV
 | 
BPF_K
:

486 
	`em™_a64_mov_i
(
is64
, 
d¡
, 
imm
, 
ùx
);

489 
BPF_ALU
 | 
BPF_ADD
 | 
BPF_K
:

490 
BPF_ALU64
 | 
BPF_ADD
 | 
BPF_K
:

491 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

492 
	`em™
(
	`A64_ADD
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

494 
BPF_ALU
 | 
BPF_SUB
 | 
BPF_K
:

495 
BPF_ALU64
 | 
BPF_SUB
 | 
BPF_K
:

496 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

497 
	`em™
(
	`A64_SUB
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

499 
BPF_ALU
 | 
BPF_AND
 | 
BPF_K
:

500 
BPF_ALU64
 | 
BPF_AND
 | 
BPF_K
:

501 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

502 
	`em™
(
	`A64_AND
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

504 
BPF_ALU
 | 
BPF_OR
 | 
BPF_K
:

505 
BPF_ALU64
 | 
BPF_OR
 | 
BPF_K
:

506 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

508 
BPF_ALU
 | 
BPF_XOR
 | 
BPF_K
:

509 
BPF_ALU64
 | 
BPF_XOR
 | 
BPF_K
:

510 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

511 
	`em™
(
	`A64_EOR
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

513 
BPF_ALU
 | 
BPF_MUL
 | 
BPF_K
:

514 
BPF_ALU64
 | 
BPF_MUL
 | 
BPF_K
:

515 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

516 
	`em™
(
	`A64_MUL
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

518 
BPF_ALU
 | 
BPF_DIV
 | 
BPF_K
:

519 
BPF_ALU64
 | 
BPF_DIV
 | 
BPF_K
:

520 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

521 
	`em™
(
	`A64_UDIV
(
is64
, 
d¡
, d¡, 
tmp
), 
ùx
);

523 
BPF_ALU
 | 
BPF_MOD
 | 
BPF_K
:

524 
BPF_ALU64
 | 
BPF_MOD
 | 
BPF_K
:

525 
	`em™_a64_mov_i
(
is64
, 
tmp2
, 
imm
, 
ùx
);

526 
	`em™
(
	`A64_UDIV
(
is64
, 
tmp
, 
d¡
, 
tmp2
), 
ùx
);

527 
	`em™
(
	`A64_MSUB
(
is64
, 
d¡
, d¡, 
tmp
, 
tmp2
), 
ùx
);

529 
BPF_ALU
 | 
BPF_LSH
 | 
BPF_K
:

530 
BPF_ALU64
 | 
BPF_LSH
 | 
BPF_K
:

531 
	`em™
(
	`A64_LSL
(
is64
, 
d¡
, d¡, 
imm
), 
ùx
);

533 
BPF_ALU
 | 
BPF_RSH
 | 
BPF_K
:

534 
BPF_ALU64
 | 
BPF_RSH
 | 
BPF_K
:

535 
	`em™
(
	`A64_LSR
(
is64
, 
d¡
, d¡, 
imm
), 
ùx
);

537 
BPF_ALU
 | 
BPF_ARSH
 | 
BPF_K
:

538 
BPF_ALU64
 | 
BPF_ARSH
 | 
BPF_K
:

539 
	`em™
(
	`A64_ASR
(
is64
, 
d¡
, d¡, 
imm
), 
ùx
);

543 
BPF_JMP
 | 
BPF_JA
:

545 
jmp_off£t
 = 
off
;

546 
	`check_imm26
(
jmp_off£t
);

547 
	`em™
(
	`A64_B
(
jmp_off£t
), 
ùx
);

551 
BPF_JMP
 | 
BPF_JEQ
 | 
BPF_X
:

552 
BPF_JMP
 | 
BPF_JGT
 | 
BPF_X
:

553 
BPF_JMP
 | 
BPF_JLT
 | 
BPF_X
:

554 
BPF_JMP
 | 
BPF_JGE
 | 
BPF_X
:

555 
BPF_JMP
 | 
BPF_JLE
 | 
BPF_X
:

556 
BPF_JMP
 | 
BPF_JNE
 | 
BPF_X
:

557 
BPF_JMP
 | 
BPF_JSGT
 | 
BPF_X
:

558 
BPF_JMP
 | 
BPF_JSLT
 | 
BPF_X
:

559 
BPF_JMP
 | 
BPF_JSGE
 | 
BPF_X
:

560 
BPF_JMP
 | 
BPF_JSLE
 | 
BPF_X
:

561 
BPF_JMP32
 | 
BPF_JEQ
 | 
BPF_X
:

562 
BPF_JMP32
 | 
BPF_JGT
 | 
BPF_X
:

563 
BPF_JMP32
 | 
BPF_JLT
 | 
BPF_X
:

564 
BPF_JMP32
 | 
BPF_JGE
 | 
BPF_X
:

565 
BPF_JMP32
 | 
BPF_JLE
 | 
BPF_X
:

566 
BPF_JMP32
 | 
BPF_JNE
 | 
BPF_X
:

567 
BPF_JMP32
 | 
BPF_JSGT
 | 
BPF_X
:

568 
BPF_JMP32
 | 
BPF_JSLT
 | 
BPF_X
:

569 
BPF_JMP32
 | 
BPF_JSGE
 | 
BPF_X
:

570 
BPF_JMP32
 | 
BPF_JSLE
 | 
BPF_X
:

571 
	`em™
(
	`A64_CMP
(
is64
, 
d¡
, 
¤c
), 
ùx
);

572 
em™_cÚd_jmp
:

573 
jmp_off£t
 = 
off
;

574 
	`check_imm19
(
jmp_off£t
);

575 
	`BPF_OP
(
code
)) {

576 
BPF_JEQ
:

577 
jmp_cÚd
 = 
A64_COND_EQ
;

579 
BPF_JGT
:

580 
jmp_cÚd
 = 
A64_COND_HI
;

582 
BPF_JLT
:

583 
jmp_cÚd
 = 
A64_COND_CC
;

585 
BPF_JGE
:

586 
jmp_cÚd
 = 
A64_COND_CS
;

588 
BPF_JLE
:

589 
jmp_cÚd
 = 
A64_COND_LS
;

591 
BPF_JSET
:

592 
BPF_JNE
:

593 
jmp_cÚd
 = 
A64_COND_NE
;

595 
BPF_JSGT
:

596 
jmp_cÚd
 = 
A64_COND_GT
;

598 
BPF_JSLT
:

599 
jmp_cÚd
 = 
A64_COND_LT
;

601 
BPF_JSGE
:

602 
jmp_cÚd
 = 
A64_COND_GE
;

604 
BPF_JSLE
:

605 
jmp_cÚd
 = 
A64_COND_LE
;

608  -
EFAULT
;

610 
	`em™
(
	`A64_B_
(
jmp_cÚd
, 
jmp_off£t
), 
ùx
);

612 
BPF_JMP
 | 
BPF_JSET
 | 
BPF_X
:

613 
BPF_JMP32
 | 
BPF_JSET
 | 
BPF_X
:

614 
	`em™
(
	`A64_TST
(
is64
, 
d¡
, 
¤c
), 
ùx
);

615 
em™_cÚd_jmp
;

617 
BPF_JMP
 | 
BPF_JEQ
 | 
BPF_K
:

618 
BPF_JMP
 | 
BPF_JGT
 | 
BPF_K
:

619 
BPF_JMP
 | 
BPF_JLT
 | 
BPF_K
:

620 
BPF_JMP
 | 
BPF_JGE
 | 
BPF_K
:

621 
BPF_JMP
 | 
BPF_JLE
 | 
BPF_K
:

622 
BPF_JMP
 | 
BPF_JNE
 | 
BPF_K
:

623 
BPF_JMP
 | 
BPF_JSGT
 | 
BPF_K
:

624 
BPF_JMP
 | 
BPF_JSLT
 | 
BPF_K
:

625 
BPF_JMP
 | 
BPF_JSGE
 | 
BPF_K
:

626 
BPF_JMP
 | 
BPF_JSLE
 | 
BPF_K
:

627 
BPF_JMP32
 | 
BPF_JEQ
 | 
BPF_K
:

628 
BPF_JMP32
 | 
BPF_JGT
 | 
BPF_K
:

629 
BPF_JMP32
 | 
BPF_JLT
 | 
BPF_K
:

630 
BPF_JMP32
 | 
BPF_JGE
 | 
BPF_K
:

631 
BPF_JMP32
 | 
BPF_JLE
 | 
BPF_K
:

632 
BPF_JMP32
 | 
BPF_JNE
 | 
BPF_K
:

633 
BPF_JMP32
 | 
BPF_JSGT
 | 
BPF_K
:

634 
BPF_JMP32
 | 
BPF_JSLT
 | 
BPF_K
:

635 
BPF_JMP32
 | 
BPF_JSGE
 | 
BPF_K
:

636 
BPF_JMP32
 | 
BPF_JSLE
 | 
BPF_K
:

637 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

638 
	`em™
(
	`A64_CMP
(
is64
, 
d¡
, 
tmp
), 
ùx
);

639 
em™_cÚd_jmp
;

640 
BPF_JMP
 | 
BPF_JSET
 | 
BPF_K
:

641 
BPF_JMP32
 | 
BPF_JSET
 | 
BPF_K
:

642 
	`em™_a64_mov_i
(
is64
, 
tmp
, 
imm
, 
ùx
);

643 
	`em™
(
	`A64_TST
(
is64
, 
d¡
, 
tmp
), 
ùx
);

644 
em™_cÚd_jmp
;

647 
BPF_JMP
 | 
BPF_CALL
:

650 cÚ¡ 
u8
 
r0
 = 
bpf2a64
[
BPF_REG_0
];

651 
u64
 
func_addr
 = 0 ;

654 ià(
oš¢
->
to_jmp
) {

655 
	`´_”r
("oš¢->to_jm°exi¡ fÜ oš¢->idx=%d\n", 
oš¢
->
idx
);

658 
func_addr
 = 
š¢
->
imm
;

661 
	`em™_addr_mov_i64
(
tmp
, 
func_addr
, 
ùx
);

662 
	`em™
(
	`A64_BLR
(
tmp
), 
ùx
);

663 
	`em™
(
	`A64_MOV
(1, 
r0
, 
	`A64_R
(0)), 
ùx
);

667 
BPF_JMP
 | 
BPF_TAIL_CALL
:

669 ià(
	`em™_bpf__ÿÎ
(
ùx
))

670  -
EFAULT
;

674 
BPF_JMP
 | 
BPF_EXIT
:

677 ià(
i
 =ğ
p
->
bpf_´og
->
Ën
 - 1) {

682 
	`em™
(
	`A64_MOV
(1, 
	`A64_R
(0), 
bpf2a64
[
BPF_REG_0
]), 
ùx
);

683 
	`em™
(
	`A64_RET
(
A64_LR
), 
ùx
);

686 
jmp_off£t
 = 
	`•ogue_off£t
(
p
, 
ùx
);

687 
	`´_”r
("jmp offset for i=%d offset=%d\n",

688 
i
, 
jmp_off£t
);

689 
	`check_imm26
(
jmp_off£t
);

690 
	`em™
(
	`A64_B
(
jmp_off£t
), 
ùx
);

695 
BPF_LD
 | 
BPF_IMM
 | 
BPF_DW
:

697 cÚ¡ 
bpf_š¢
 
š¢1
 = 
š¢
[1];

698 
u64
 
imm64
;

700 
imm64
 = (
u64
)
š¢1
.
imm
 << 32 | (
u32
)imm;

701 
	`em™_a64_mov_i64
(
d¡
, 
imm64
, 
ùx
);

707 
BPF_LDX
 | 
BPF_MEM
 | 
BPF_W
:

708 
BPF_LDX
 | 
BPF_MEM
 | 
BPF_H
:

709 
BPF_LDX
 | 
BPF_MEM
 | 
BPF_B
:

710 
BPF_LDX
 | 
BPF_MEM
 | 
BPF_DW
:

711 
	`em™_a64_mov_i
(1, 
tmp
, 
off
, 
ùx
);

712 
	`BPF_SIZE
(
code
)) {

713 
BPF_W
:

714 
	`em™
(
	`A64_LDR32
(
d¡
, 
¤c
, 
tmp
), 
ùx
);

716 
BPF_H
:

717 
	`em™
(
	`A64_LDRH
(
d¡
, 
¤c
, 
tmp
), 
ùx
);

719 
BPF_B
:

720 
	`em™
(
	`A64_LDRB
(
d¡
, 
¤c
, 
tmp
), 
ùx
);

722 
BPF_DW
:

723 
	`em™
(
	`A64_LDR64
(
d¡
, 
¤c
, 
tmp
), 
ùx
);

729 
BPF_ST
 | 
BPF_NOSPEC
:

742 
BPF_ST
 | 
BPF_MEM
 | 
BPF_W
:

743 
BPF_ST
 | 
BPF_MEM
 | 
BPF_H
:

744 
BPF_ST
 | 
BPF_MEM
 | 
BPF_B
:

745 
BPF_ST
 | 
BPF_MEM
 | 
BPF_DW
:

747 
	`em™_a64_mov_i
(1, 
tmp2
, 
off
, 
ùx
);

748 
	`em™_a64_mov_i
(1, 
tmp
, 
imm
, 
ùx
);

749 
	`BPF_SIZE
(
code
)) {

750 
BPF_W
:

751 
	`em™
(
	`A64_STR32
(
tmp
, 
d¡
, 
tmp2
), 
ùx
);

753 
BPF_H
:

754 
	`em™
(
	`A64_STRH
(
tmp
, 
d¡
, 
tmp2
), 
ùx
);

756 
BPF_B
:

757 
	`em™
(
	`A64_STRB
(
tmp
, 
d¡
, 
tmp2
), 
ùx
);

759 
BPF_DW
:

760 
	`em™
(
	`A64_STR64
(
tmp
, 
d¡
, 
tmp2
), 
ùx
);

766 
BPF_STX
 | 
BPF_MEM
 | 
BPF_W
:

767 
BPF_STX
 | 
BPF_MEM
 | 
BPF_H
:

768 
BPF_STX
 | 
BPF_MEM
 | 
BPF_B
:

769 
BPF_STX
 | 
BPF_MEM
 | 
BPF_DW
:

770 
	`em™_a64_mov_i
(1, 
tmp
, 
off
, 
ùx
);

771 
	`BPF_SIZE
(
code
)) {

772 
BPF_W
:

773 
	`em™
(
	`A64_STR32
(
¤c
, 
d¡
, 
tmp
), 
ùx
);

775 
BPF_H
:

776 
	`em™
(
	`A64_STRH
(
¤c
, 
d¡
, 
tmp
), 
ùx
);

778 
BPF_B
:

779 
	`em™
(
	`A64_STRB
(
¤c
, 
d¡
, 
tmp
), 
ùx
);

781 
BPF_DW
:

782 
	`em™
(
	`A64_STR64
(
¤c
, 
d¡
, 
tmp
), 
ùx
);

788 
BPF_STX
 | 
BPF_XADD
 | 
BPF_W
:

790 
BPF_STX
 | 
BPF_XADD
 | 
BPF_DW
:

791 ià(!
off
) {

792 
»g
 = 
d¡
;

794 
	`em™_a64_mov_i
(1, 
tmp
, 
off
, 
ùx
);

795 
	`em™
(
	`A64_ADD
(1, 
tmp
,mp, 
d¡
), 
ùx
);

796 
»g
 = 
tmp
;

798 ià(
	`ıus_have_ÿp
(
ARM64_HAS_LSE_ATOMICS
)) {

799 
	`em™
(
	`A64_STADD
(
isdw
, 
»g
, 
¤c
), 
ùx
);

801 
	`em™
(
	`A64_LDXR
(
isdw
, 
tmp2
, 
»g
), 
ùx
);

802 
	`em™
(
	`A64_ADD
(
isdw
, 
tmp2
,mp2, 
¤c
), 
ùx
);

803 
	`em™
(
	`A64_STXR
(
isdw
, 
tmp2
, 
»g
, 
tmp3
), 
ùx
);

804 
jmp_off£t
 = -3;

805 
	`check_imm19
(
jmp_off£t
);

806 
	`em™
(
	`A64_CBNZ
(0, 
tmp3
, 
jmp_off£t
), 
ùx
);

811 
	`´_”r_Úû
("unknowÀİcod%02x\n", 
code
);

812  -
EINVAL
;

816 
	}
}

820 
	$bud_body
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
boŞ
 
exŒa_·ss
)

822 cÚ¡ 
bpf_´og
 *
´og
 = 
ùx
->prog;

823 
i
;

834 
i
 = 0; i < 
´og
->
Ën
; i++) {

835 cÚ¡ 
bpf_š¢
 *
š¢
 = &
´og
->
š¢si
[
i
];

836 
»t
;

838 ià(
ùx
->
image
 =ğ
NULL
)

839 
ùx
->
off£t
[
i
] = ctx->
idx
;

840 
»t
 = 
	`bud_š¢
(
š¢
, 
ùx
, 
exŒa_·ss
);

841 ià(
»t
 > 0) {

842 
i
++;

843 ià(
ùx
->
image
 =ğ
NULL
)

844 
ùx
->
off£t
[
i
] = ctx->
idx
;

847 ià(
»t
)

848  
»t
;

855 ià(
ùx
->
image
 =ğ
NULL
)

856 
ùx
->
off£t
[
i
] = ctx->
idx
;

859 
	}
}

865 
	$v®id©e_code
(
Ùx2_bpf_¬ch_ùx
 *
ùx
)

867 
i
;

869 
i
 = 0; i < 
ùx
->
idx
; i++) {

870 
u32
 
a64_š¢
 = 
	`Ë32_to_ıu
(
ùx
->
image
[
i
]);

872 ià(
a64_š¢
 =ğ
AARCH64_BREAK_FAULT
)

877 
	}
}

881 
šlše
 
	$bpf_æush_iÿche
(*
¡¬t
, *
’d
)

883 
	`æush_iÿche_¿nge
(()
¡¬t
, ()
’d
);

884 
	}
}

	@otx2_common.c

8 
	~<lšux/š‹¼u±.h
>

9 
	~<lšux/pci.h
>

10 
	~<lšux/‘htoŞ.h
>

11 
	~<Ãt/tso.h
>

12 
	~<lšux/b™f›ld.h
>

14 
	~"Ùx2_»g.h
"

15 
	~"Ùx2_commÚ.h
"

16 
	~"Ùx2_¡ruù.h
"

17 
	~"ú10k.h
"

19 
	$Ùx2_nix_rq_İ_¡©s
(
queue_¡©s
 *
¡©s
,

20 
Ùx2_nic
 *
pfvf
, 
qidx
)

22 
u64
 
šü
 = (u64)
qidx
 << 32;

23 
u64
 *
±r
;

25 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_RQ_OP_OCTS
);

26 
¡©s
->
by‹s
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

28 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_RQ_OP_PKTS
);

29 
¡©s
->
pkts
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

30 
	}
}

32 
	$Ùx2_nix_sq_İ_¡©s
(
queue_¡©s
 *
¡©s
,

33 
Ùx2_nic
 *
pfvf
, 
qidx
)

35 
u64
 
šü
 = (u64)
qidx
 << 32;

36 
u64
 *
±r
;

38 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_SQ_OP_OCTS
);

39 
¡©s
->
by‹s
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

41 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_SQ_OP_PKTS
);

42 
¡©s
->
pkts
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

43 
	}
}

45 
	$Ùx2_upd©e_lmac_¡©s
(
Ùx2_nic
 *
pfvf
)

47 
msg_»q
 *
»q
;

49 ià(!
	`Ãtif_ruÂšg
(
pfvf
->
Ãtdev
))

52 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

53 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_¡©s
(&
pfvf
->
mbox
);

54 ià(!
»q
) {

55 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

59 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

60 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

61 
	}
}

63 
	$Ùx2_upd©e_lmac_ãc_¡©s
(
Ùx2_nic
 *
pfvf
)

65 
msg_»q
 *
»q
;

67 ià(!
	`Ãtif_ruÂšg
(
pfvf
->
Ãtdev
))

69 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

70 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_ãc_¡©s
(&
pfvf
->
mbox
);

71 ià(
»q
)

72 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

73 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

74 
	}
}

76 
	$Ùx2_upd©e_rq_¡©s
(
Ùx2_nic
 *
pfvf
, 
qidx
)

78 
Ùx2_rcv_queue
 *
rq
 = &
pfvf
->
q£t
.rq[
qidx
];

80 ià(!
pfvf
->
q£t
.
rq
)

83 
	`Ùx2_nix_rq_İ_¡©s
(&
rq
->
¡©s
, 
pfvf
, 
qidx
);

85 
	}
}

87 
	$Ùx2_upd©e_sq_¡©s
(
Ùx2_nic
 *
pfvf
, 
qidx
)

89 
Ùx2_¢d_queue
 *
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

91 ià(!
pfvf
->
q£t
.
sq
)

94 ià(
qidx
 >ğ
pfvf
->
hw
.
tÙ_tx_queues
) {

95 ià(!
	`‹¡_b™
(
qidx
 - 
pfvf
->
hw
.
tÙ_tx_queues
,…fvf->
qos
.
qos_sq_bm­
))

99 
	`Ùx2_nix_sq_İ_¡©s
(&
sq
->
¡©s
, 
pfvf
, 
qidx
);

101 
	}
}

103 
	$Ùx2_g‘_dev_¡©s
(
Ùx2_nic
 *
pfvf
)

105 
Ùx2_dev_¡©s
 *
dev_¡©s
 = &
pfvf
->
hw
.dev_stats;

107 
dev_¡©s
->
rx_by‹s
 = 
	`OTX2_GET_RX_STATS
(
RX_OCTS
);

108 
dev_¡©s
->
rx_drİs
 = 
	`OTX2_GET_RX_STATS
(
RX_DROP
);

109 
dev_¡©s
->
rx_bÿ¡_äames
 = 
	`OTX2_GET_RX_STATS
(
RX_BCAST
);

110 
dev_¡©s
->
rx_mÿ¡_äames
 = 
	`OTX2_GET_RX_STATS
(
RX_MCAST
);

111 
dev_¡©s
->
rx_uÿ¡_äames
 = 
	`OTX2_GET_RX_STATS
(
RX_UCAST
);

112 
dev_¡©s
->
rx_äames
 = dev_¡©s->
rx_bÿ¡_äames
 +

113 
dev_¡©s
->
rx_mÿ¡_äames
 +

114 
dev_¡©s
->
rx_uÿ¡_äames
;

116 
dev_¡©s
->
tx_by‹s
 = 
	`OTX2_GET_TX_STATS
(
TX_OCTS
);

117 
dev_¡©s
->
tx_drİs
 = 
	`OTX2_GET_TX_STATS
(
TX_DROP
);

118 
dev_¡©s
->
tx_bÿ¡_äames
 = 
	`OTX2_GET_TX_STATS
(
TX_BCAST
);

119 
dev_¡©s
->
tx_mÿ¡_äames
 = 
	`OTX2_GET_TX_STATS
(
TX_MCAST
);

120 
dev_¡©s
->
tx_uÿ¡_äames
 = 
	`OTX2_GET_TX_STATS
(
TX_UCAST
);

121 
dev_¡©s
->
tx_äames
 = dev_¡©s->
tx_bÿ¡_äames
 +

122 
dev_¡©s
->
tx_mÿ¡_äames
 +

123 
dev_¡©s
->
tx_uÿ¡_äames
;

124 
	}
}

126 
	$Ùx2_g‘_¡©s64
(
Ãt_deviû
 *
Ãtdev
,

127 
¹Æ_lšk_¡©s64
 *
¡©s
)

129 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

130 
Ùx2_dev_¡©s
 *
dev_¡©s
;

132 
	`Ùx2_g‘_dev_¡©s
(
pfvf
);

134 
dev_¡©s
 = &
pfvf
->
hw
.dev_stats;

135 
¡©s
->
rx_by‹s
 = 
dev_¡©s
->rx_bytes;

136 
¡©s
->
rx_·ck‘s
 = 
dev_¡©s
->
rx_äames
;

137 
¡©s
->
rx_drİ³d
 = 
dev_¡©s
->
rx_drİs
;

138 
¡©s
->
muÉiÿ¡
 = 
dev_¡©s
->
rx_mÿ¡_äames
;

140 
¡©s
->
tx_by‹s
 = 
dev_¡©s
->tx_bytes;

141 
¡©s
->
tx_·ck‘s
 = 
dev_¡©s
->
tx_äames
;

142 
¡©s
->
tx_drİ³d
 = 
dev_¡©s
->
tx_drİs
;

143 
	}
}

144 
EXPORT_SYMBOL
(
Ùx2_g‘_¡©s64
);

147 
	$Ùx2_hw_£t_mac_addr
(
Ùx2_nic
 *
pfvf
, 
u8
 *
mac
)

149 
nix_£t_mac_addr
 *
»q
;

150 
”r
;

152 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

153 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_£t_mac_addr
(&
pfvf
->
mbox
);

154 ià(!
»q
) {

155 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

156  -
ENOMEM
;

159 
	`‘h”_addr_cİy
(
»q
->
mac_addr
, 
mac
);

161 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

162 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

163  
”r
;

164 
	}
}

166 
	$Ùx2_hw_g‘_mac_addr
(
Ùx2_nic
 *
pfvf
,

167 
Ãt_deviû
 *
Ãtdev
)

169 
nix_g‘_mac_addr_r¥
 *
r¥
;

170 
mbox_msghdr
 *
msghdr
;

171 
msg_»q
 *
»q
;

172 
”r
;

174 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

175 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_g‘_mac_addr
(&
pfvf
->
mbox
);

176 ià(!
»q
) {

177 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

178  -
ENOMEM
;

181 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

182 ià(
”r
) {

183 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

184  
”r
;

187 
msghdr
 = 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

188 ià(
	`IS_ERR
(
msghdr
)) {

189 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

190  
	`PTR_ERR
(
msghdr
);

192 
r¥
 = (
nix_g‘_mac_addr_r¥
 *)
msghdr
;

193 
	`‘h”_addr_cİy
(
Ãtdev
->
dev_addr
, 
r¥
->
mac_addr
);

194 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

197 
	}
}

199 
	$Ùx2_£t_mac_add»ss
(
Ãt_deviû
 *
Ãtdev
, *
p
)

201 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

202 
sockaddr
 *
addr
 = 
p
;

204 ià(!
	`is_v®id_‘h”_addr
(
addr
->
§_d©a
))

205  -
EADDRNOTAVAIL
;

207 ià(!
	`Ùx2_hw_£t_mac_addr
(
pfvf
, 
addr
->
§_d©a
)) {

208 
	`memıy
(
Ãtdev
->
dev_addr
, 
addr
->
§_d©a
,‚‘dev->
addr_Ën
);

210 ià(
	`Ãtif_ruÂšg
(
Ãtdev
) &&

211 
pfvf
->
æags
 & 
OTX2_FLAG_RX_VLAN_SUPPORT
)

212 
	`Ùx2_š¡®l_rxvÏn_ofæßd_æow
(
pfvf
);

214 ià(
pfvf
->
æags
 & 
OTX2_FLAG_DMACFLTR_SUPPORT
)

215 
	`Ùx2_dmacæt_upd©e_pfmac_æow
(
pfvf
);

217  -
EPERM
;

221 
	}
}

222 
EXPORT_SYMBOL
(
Ùx2_£t_mac_add»ss
);

224 
	$Ùx2_hw_£t_mtu
(
Ùx2_nic
 *
pfvf
, 
mtu
)

226 
nix_äs_cfg
 *
»q
;

227 
u16
 
maxËn
;

228 
”r
;

230 
maxËn
 = 
	`Ùx2_g‘_max_mtu
(
pfvf
è+ 
OTX2_ETH_HLEN
 + 
OTX2_HW_TIMESTAMP_LEN
;

232 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

233 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_£t_hw_äs
(&
pfvf
->
mbox
);

234 ià(!
»q
) {

235 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

236  -
ENOMEM
;

240 
»q
->
maxËn
 = 
pfvf
->
Ãtdev
->
mtu
 + 
OTX2_ETH_HLEN
 +…fvf->
addl_mtu
 +

241 
OTX2_HW_TIMESTAMP_LEN
 + 
pfvf
->
xŒa_hdr
;

243 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
))

244 
»q
->
maxËn
 = maxlen;

246 ià(
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
))

247 
»q
->
sdp_lšk
 = 
Œue
;

249 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

251 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

252  
”r
;

253 
	}
}

255 
	$Ùx2_cÚfig_·u£_äm
(
Ùx2_nic
 *
pfvf
)

257 
cgx_·u£_äm_cfg
 *
»q
;

258 
”r
;

260 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev))

263 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

264 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_cfg_·u£_äm
(&
pfvf
->
mbox
);

265 ià(!
»q
) {

266 
”r
 = -
ENOMEM
;

267 
uÆock
;

270 
»q
->
rx_·u£
 = !!(
pfvf
->
æags
 & 
OTX2_FLAG_RX_PAUSE_ENABLED
);

271 
»q
->
tx_·u£
 = !!(
pfvf
->
æags
 & 
OTX2_FLAG_TX_PAUSE_ENABLED
);

272 
»q
->
£t
 = 1;

274 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

275 
uÆock
:

276 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

277  
”r
;

278 
	}
}

279 
EXPORT_SYMBOL
(
Ùx2_cÚfig_·u£_äm
);

281 
	$Ùx2_cÚfig_£rdes_lšk_¡©e
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’
)

283 
cgx_£t_lšk_¡©e_msg
 *
»q
;

284 
”r
;

286 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

287 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_£t_lšk_¡©e
(&
pfvf
->
mbox
);

288 ià(!
»q
) {

289 
”r
 = -
ENOMEM
;

290 
uÆock
;

293 
»q
->
’abË
 = !!
’
;

294 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

295 
uÆock
:

296 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

297  
”r
;

298 
	}
}

299 
EXPORT_SYMBOL
(
Ùx2_cÚfig_£rdes_lšk_¡©e
);

301 
	$Ùx2_£t_æowkey_cfg
(
Ùx2_nic
 *
pfvf
)

303 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

304 
nix_rss_æowkey_cfg_r¥
 *
r¥
;

305 
nix_rss_æowkey_cfg
 *
»q
;

306 
”r
;

308 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

309 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_rss_æowkey_cfg
(&
pfvf
->
mbox
);

310 ià(!
»q
) {

311 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

312  -
ENOMEM
;

314 
»q
->
mÿm_šdex
 = -1;

315 
»q
->
æowkey_cfg
 = 
rss
->flowkey_cfg;

316 
»q
->
group
 = 
DEFAULT_RSS_CONTEXT_GROUP
;

318 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

319 ià(
”r
)

320 
ç
;

322 
r¥
 = (
nix_rss_æowkey_cfg_r¥
 *)

323 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

324 ià(
	`IS_ERR
(
r¥
)) {

325 
”r
 = 
	`PTR_ERR
(
r¥
);

326 
ç
;

329 
pfvf
->
hw
.
æowkey_®g_idx
 = 
r¥
->
®g_idx
;

330 
ç
:

331 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

332  
”r
;

333 
	}
}

335 
	$Ùx2_£t_rss_bË
(
Ùx2_nic
 *
pfvf
, 
ùx_id
)

337 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

338 cÚ¡ 
šdex
 = 
rss
->
rss_size
 * 
ùx_id
;

339 
mbox
 *mbox = &
pfvf
->mbox;

340 
Ùx2_rss_ùx
 *
rss_ùx
;

341 
nix_aq_’q_»q
 *
aq
;

342 
idx
, 
”r
;

344 
	`mu‹x_lock
(&
mbox
->
lock
);

345 
rss_ùx
 = 
rss
->rss_ùx[
ùx_id
];

347 
idx
 = 0; idx < 
rss
->
rss_size
; idx++) {

348 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(
mbox
);

349 ià(!
aq
) {

353 
”r
 = 
	`Ùx2_sync_mbox_msg
(
mbox
);

354 ià(
”r
) {

355 
	`mu‹x_uÆock
(&
mbox
->
lock
);

356  
”r
;

358 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(
mbox
);

359 ià(!
aq
) {

360 
	`mu‹x_uÆock
(&
mbox
->
lock
);

361  -
ENOMEM
;

365 
aq
->
rss
.
rq
 = 
rss_ùx
->
šd_tbl
[
idx
];

368 
aq
->
qidx
 = 
šdex
 + 
idx
;

369 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_RSS
;

370 
aq
->
İ
 = 
NIX_AQ_INSTOP_INIT
;

372 
”r
 = 
	`Ùx2_sync_mbox_msg
(
mbox
);

373 
	`mu‹x_uÆock
(&
mbox
->
lock
);

374  
”r
;

375 
	}
}

377 
	$Ùx2_£t_rss_key
(
Ùx2_nic
 *
pfvf
)

379 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

380 
u64
 *
key
 = (u64 *)&
rss
->key[4];

381 
idx
;

391 
	`Ùx2_wr™e64
(
pfvf
, 
	`NIX_LF_RX_SECRETX
(5),

392 (
u64
)(*((
u32
 *)&
rss
->
key
)) << 32);

393 
idx
 = (
rss
->
key
è/ (
u64
);

394 
idx
 > 0) {

395 
idx
--;

396 
	`Ùx2_wr™e64
(
pfvf
, 
	`NIX_LF_RX_SECRETX
(
idx
), *
key
++);

398 
	}
}

400 
	$Ùx2_rss_š™
(
Ùx2_nic
 *
pfvf
)

402 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

403 
Ùx2_rss_ùx
 *
rss_ùx
;

404 
idx
, 
»t
 = 0;

406 
rss
->
rss_size
 = (*rss->
rss_ùx
[
DEFAULT_RSS_CONTEXT_GROUP
]);

409 ià(!
rss
->
’abË
)

410 
	`Ãtdev_rss_key_fl
(
rss
->
key
, (rss->key));

411 
	`Ùx2_£t_rss_key
(
pfvf
);

413 ià(!
	`Ãtif_is_rxfh_cÚfigu»d
(
pfvf
->
Ãtdev
)) {

415 
rss
->
rss_ùx
[
DEFAULT_RSS_CONTEXT_GROUP
] = 
	`kz®loc
Ôss->
rss_size
,

416 
GFP_KERNEL
);

417 ià(!
rss
->
rss_ùx
[
DEFAULT_RSS_CONTEXT_GROUP
])

418  -
ENOMEM
;

420 
rss_ùx
 = 
rss
->rss_ùx[
DEFAULT_RSS_CONTEXT_GROUP
];

421 
idx
 = 0; idx < 
rss
->
rss_size
; idx++)

422 
rss_ùx
->
šd_tbl
[
idx
] =

423 
	`‘htoŞ_rxfh_šdœ_deçuÉ
(
idx
,

424 
pfvf
->
hw
.
rx_queues
);

426 
»t
 = 
	`Ùx2_£t_rss_bË
(
pfvf
, 
DEFAULT_RSS_CONTEXT_GROUP
);

427 ià(
»t
)

428  
»t
;

431 
rss
->
æowkey_cfg
 =„ss->
’abË
 ?„ss->flowkey_cfg :

432 
NIX_FLOW_KEY_TYPE_IPV4
 | 
NIX_FLOW_KEY_TYPE_IPV6
 |

433 
NIX_FLOW_KEY_TYPE_TCP
 | 
NIX_FLOW_KEY_TYPE_UDP
 |

434 
NIX_FLOW_KEY_TYPE_SCTP
 | 
NIX_FLOW_KEY_TYPE_VLAN
 |

435 
NIX_FLOW_KEY_TYPE_IPV4_PROTO
;

437 
»t
 = 
	`Ùx2_£t_æowkey_cfg
(
pfvf
);

438 ià(
»t
)

439  
»t
;

441 
rss
->
’abË
 = 
Œue
;

443 
	}
}

446 
	$Ùx2_£tup_udp_£gm’tiÚ
(
nix_lso_fÜm©_cfg
 *
lso
, 
boŞ
 
v4
)

448 
nix_lso_fÜm©
 *
f›ld
;

450 
f›ld
 = (
nix_lso_fÜm©
 *)&
lso
->
f›lds
[0];

451 
lso
->
f›ld_mask
 = 
	`GENMASK
(18, 0);

454 
f›ld
->
Ïy”
 = 
NIX_TXLAYER_OL3
;

456 
f›ld
->
off£t
 = 
v4
 ? 2 : 4;

457 
f›ld
->
sizem1
 = 1;

458 
f›ld
->
®g
 = 
NIX_LSOALG_ADD_PAYLEN
;

459 
f›ld
++;

462 ià(
v4
) {

464 
f›ld
->
Ïy”
 = 
NIX_TXLAYER_OL3
;

465 
f›ld
->
off£t
 = 4;

466 
f›ld
->
sizem1
 = 1;

467 
f›ld
->
®g
 = 
NIX_LSOALG_ADD_SEGNUM
;

468 
f›ld
++;

472 
f›ld
->
Ïy”
 = 
NIX_TXLAYER_OL4
;

473 
f›ld
->
off£t
 = 4;

474 
f›ld
->
sizem1
 = 1;

475 
f›ld
->
®g
 = 
NIX_LSOALG_ADD_PAYLEN
;

476 
	}
}

479 
	$Ùx2_£tup_£gm’tiÚ
(
Ùx2_nic
 *
pfvf
)

481 
nix_lso_fÜm©_cfg_r¥
 *
r¥
;

482 
nix_lso_fÜm©_cfg
 *
lso
;

483 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

484 
”r
;

486 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

489 
lso
 = 
	`Ùx2_mbox_®loc_msg_nix_lso_fÜm©_cfg
(&
pfvf
->
mbox
);

490 ià(!
lso
)

491 
ç
;

494 
	`Ùx2_£tup_udp_£gm’tiÚ
(
lso
, 
Œue
);

496 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

497 ià(
”r
)

498 
ç
;

500 
r¥
 = (
nix_lso_fÜm©_cfg_r¥
 *)

501 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
lso
->
hdr
);

502 ià(
	`IS_ERR
(
r¥
))

503 
ç
;

505 
hw
->
lso_udpv4_idx
 = 
r¥
->
lso_fÜm©_idx
;

508 
lso
 = 
	`Ùx2_mbox_®loc_msg_nix_lso_fÜm©_cfg
(&
pfvf
->
mbox
);

509 ià(!
lso
)

510 
ç
;

513 
	`Ùx2_£tup_udp_£gm’tiÚ
(
lso
, 
çl£
);

515 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

516 ià(
”r
)

517 
ç
;

519 
r¥
 = (
nix_lso_fÜm©_cfg_r¥
 *)

520 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
lso
->
hdr
);

521 ià(
	`IS_ERR
(
r¥
))

522 
ç
;

524 
hw
->
lso_udpv6_idx
 = 
r¥
->
lso_fÜm©_idx
;

525 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

527 
ç
:

528 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

529 
	`Ãtdev_šfo
(
pfvf
->
Ãtdev
,

531 
pfvf
->
Ãtdev
->
hw_ã©u»s
 &ğ~
NETIF_F_GSO_UDP_L4
;

532 
	}
}

534 
	$Ùx2_cÚfig_œq_cßËscšg
(
Ùx2_nic
 *
pfvf
, 
qidx
)

542 
	`Ùx2_wr™e64
(
pfvf
, 
	`NIX_LF_CINTX_WAIT
(
qidx
),

543 ((
u64
)(
pfvf
->
hw
.
cq_time_wa™
 * 10) << 48) |

544 ((
u64
)
pfvf
->
hw
.
cq_qcouÁ_wa™
 << 32) |

545 (
pfvf
->
hw
.
cq_ecouÁ_wa™
 - 1));

546 
	}
}

548 
	$__Ùx2_®loc_rbuf
(
Ùx2_nic
 *
pfvf
, 
Ùx2_poŞ
 *
poŞ
,

549 
dma_addr_t
 *
dma
)

551 
u8
 *
buf
;

553 
buf
 = 
	`Çpi_®loc_äag_®ign
(
poŞ
->
rbsize
, 
OTX2_ALIGN
);

554 ià(
	`uÆik–y
(!
buf
))

555  -
ENOMEM
;

557 *
dma
 = 
	`dma_m­_sšgË_©Œs
(
pfvf
->
dev
, 
buf
, 
poŞ
->
rbsize
,

558 
DMA_FROM_DEVICE
, 
DMA_ATTR_SKIP_CPU_SYNC
);

559 ià(
	`uÆik–y
(
	`dma_m­pšg_”rÜ
(
pfvf
->
dev
, *
dma
))) {

560 
	`·ge_äag_ä“
(
buf
);

561  -
ENOMEM
;

565 
	}
}

567 
	$Ùx2_®loc_rbuf
(
Ùx2_nic
 *
pfvf
, 
Ùx2_poŞ
 *
poŞ
,

568 
dma_addr_t
 *
dma
)

570 
»t
;

571 
	`loÿl_bh_di§bË
();

572 
»t
 = 
	`__Ùx2_®loc_rbuf
(
pfvf
, 
poŞ
, 
dma
);

573 
	`loÿl_bh_’abË
();

574  
»t
;

575 
	}
}

577 
	$Ùx2_®loc_bufãr
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
,

578 
dma_addr_t
 *
dma
)

580 ià(
	`uÆik–y
(
	`__Ùx2_®loc_rbuf
(
pfvf
, 
cq
->
rbpoŞ
, 
dma
))) {

581 
»fl_wÜk
 *
wÜk
;

582 
d–ayed_wÜk
 *
dwÜk
;

584 
wÜk
 = &
pfvf
->
»fl_wrk
[
cq
->
cq_idx
];

585 
dwÜk
 = &
wÜk
->
poŞ_»fl_wÜk
;

587 ià(!
cq
->
»fl_sk_sched
) {

588 
cq
->
»fl_sk_sched
 = 
Œue
;

589 
	`scheduË_d–ayed_wÜk
(
dwÜk
,

590 
	`m£cs_to_jiff›s
(100));

592  -
ENOMEM
;

595 
	}
}

597 
	$Ùx2_tx_timeout
(
Ãt_deviû
 *
Ãtdev
)

599 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

601 
	`scheduË_wÜk
(&
pfvf
->
»£t_sk
);

602 
	}
}

603 
EXPORT_SYMBOL
(
Ùx2_tx_timeout
);

605 
	$Ùx2_g‘_mac_äom_af
(
Ãt_deviû
 *
Ãtdev
)

607 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

608 
”r
;

610 
”r
 = 
	`Ùx2_hw_g‘_mac_addr
(
pfvf
, 
Ãtdev
);

611 ià(
”r
)

612 
	`dev_w¬n
(
pfvf
->
dev
, "Failedo„ead mac from hardware\n");

615 ià(!
	`is_v®id_‘h”_addr
(
Ãtdev
->
dev_addr
))

616 
	`‘h_hw_addr_¿ndom
(
Ãtdev
);

617 
	}
}

618 
EXPORT_SYMBOL
(
Ùx2_g‘_mac_äom_af
);

620 
	$Ùx2_txschq_cÚfig
(
Ùx2_nic
 *
pfvf
, 
lvl
, 
´io
, 
boŞ
 
txschq_fÜ_pfc
)

622 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

623 
nix_txschq_cÚfig
 *
»q
;

624 
u16
 
schq
, 
·»Á
;

625 
u64
 
dw¼_v®
;

627 
dw¼_v®
 = 
	`mtu_to_dw¼_weight
(
pfvf
,…fvf->
tx_max_pk’
);

629 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txschq_cfg
(&
pfvf
->
mbox
);

630 ià(!
»q
)

631  -
ENOMEM
;

633 
»q
->
lvl
 =†vl;

634 
»q
->
num_»gs
 = 1;

636 #ifdeà
CONFIG_DCB


637 ià(
txschq_fÜ_pfc
)

638 
schq
 = 
pfvf
->
pfc_schq_li¡
[
lvl
][
´io
];

641 
schq
 = 
hw
->
txschq_li¡
[
lvl
][
´io
];

644 ià(
lvl
 =ğ
NIX_TXSCH_LVL_SMQ
) {

645 
»q
->
»g
[0] = 
	`NIX_AF_SMQX_CFG
(
schq
);

646 
»q
->
»gv®
[0] = ((
u64
)
pfvf
->
tx_max_pk’
 << 8è| 
OTX2_MIN_MTU
;

647 
»q
->
»gv®
[0] |= (0x20ULL << 51) | (0x80ULL << 39) |

650 ià(!
	`is_dev_Ùx2
(
pfvf
->
pdev
))

651 
»q
->
»gv®
[0] |ğ
	`FIELD_PREP
(
	`GENMASK_ULL
(58, 57),

652 (
u64
)
hw
->
smq_lšk_ty³
);

653 
»q
->
num_»gs
++;

655 #ifdeà
CONFIG_DCB


656 ià(
txschq_fÜ_pfc
)

657 
·»Á
 = 
pfvf
->
pfc_schq_li¡
[
NIX_TXSCH_LVL_TL4
][
´io
];

660 
·»Á
 = 
hw
->
txschq_li¡
[
NIX_TXSCH_LVL_TL4
][
´io
];

662 
»q
->
»g
[1] = 
	`NIX_AF_MDQX_PARENT
(
schq
);

663 
»q
->
»gv®
[1] = 
·»Á
 << 16;

664 
»q
->
num_»gs
++;

666 
»q
->
»g
[2] = 
	`NIX_AF_MDQX_SCHEDULE
(
schq
);

667 
»q
->
»gv®
[2] = 
dw¼_v®
;

668 } ià(
lvl
 =ğ
NIX_TXSCH_LVL_TL4
) {

669 #ifdeà
CONFIG_DCB


670 ià(
txschq_fÜ_pfc
)

671 
·»Á
 = 
pfvf
->
pfc_schq_li¡
[
NIX_TXSCH_LVL_TL3
][
´io
];

674 
·»Á
 = 
hw
->
txschq_li¡
[
NIX_TXSCH_LVL_TL3
][
´io
];

676 
»q
->
»g
[0] = 
	`NIX_AF_TL4X_PARENT
(
schq
);

677 
»q
->
»gv®
[0] = 
·»Á
 << 16;

678 
»q
->
num_»gs
++;

679 
»q
->
»g
[1] = 
	`NIX_AF_TL4X_SCHEDULE
(
schq
);

680 
»q
->
»gv®
[1] = 
dw¼_v®
;

681 ià(
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
)) {

682 
»q
->
num_»gs
++;

683 
»q
->
»g
[2] = 
	`NIX_AF_TL4X_SDP_LINK_CFG
(
schq
);

684 
»q
->
»gv®
[2] = 
	`BIT_ULL
(12);

686 } ià(
lvl
 =ğ
NIX_TXSCH_LVL_TL3
) {

687 #ifdeà
CONFIG_DCB


688 ià(
txschq_fÜ_pfc
)

689 
·»Á
 = 
pfvf
->
pfc_schq_li¡
[
NIX_TXSCH_LVL_TL2
][
´io
];

692 
·»Á
 = 
hw
->
txschq_li¡
[
NIX_TXSCH_LVL_TL2
][
´io
];

694 
»q
->
»g
[0] = 
	`NIX_AF_TL3X_PARENT
(
schq
);

695 
»q
->
»gv®
[0] = 
·»Á
 << 16;

696 
»q
->
num_»gs
++;

697 
»q
->
»g
[1] = 
	`NIX_AF_TL3X_SCHEDULE
(
schq
);

698 
»q
->
»gv®
[1] = 
dw¼_v®
;

699 ià(
lvl
 =ğ
hw
->
txschq_lšk_cfg_lvl
 && !
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
)) {

700 
»q
->
num_»gs
++;

701 
»q
->
»g
[2] = 
	`NIX_AF_TL3_TL2X_LINKX_CFG
(
schq
, 
hw
->
tx_lšk
);

705 
»q
->
»gv®
[2] = 
	`BIT_ULL
(13è| BIT_ULL(12è| 
´io
;

707 } ià(
lvl
 =ğ
NIX_TXSCH_LVL_TL2
) {

708 #ifdeà
CONFIG_DCB


709 ià(
txschq_fÜ_pfc
)

710 
·»Á
 = 
pfvf
->
pfc_schq_li¡
[
NIX_TXSCH_LVL_TL1
][
´io
];

713 
·»Á
 = 
hw
->
txschq_li¡
[
NIX_TXSCH_LVL_TL1
][
´io
];

715 
»q
->
»g
[0] = 
	`NIX_AF_TL2X_PARENT
(
schq
);

716 
»q
->
»gv®
[0] = 
·»Á
 << 16;

718 
»q
->
num_»gs
++;

719 
»q
->
»g
[1] = 
	`NIX_AF_TL2X_SCHEDULE
(
schq
);

720 
»q
->
»gv®
[1] = 
hw
->
txschq_aggr_lvl_¼_´io
 << 24 | 
dw¼_v®
;

722 ià(
lvl
 =ğ
hw
->
txschq_lšk_cfg_lvl
 && !
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
)) {

723 
»q
->
num_»gs
++;

724 
»q
->
»g
[2] = 
	`NIX_AF_TL3_TL2X_LINKX_CFG
(
schq
, 
hw
->
tx_lšk
);

728 
»q
->
»gv®
[2] = 
	`BIT_ULL
(13è| BIT_ULL(12è| 
´io
;

731 } ià(
lvl
 =ğ
NIX_TXSCH_LVL_TL1
) {

740 
»q
->
»g
[0] = 
	`NIX_AF_TL1X_SCHEDULE
(
schq
);

741 
»q
->
»gv®
[0] = 
TXSCH_TL1_DFLT_RR_QTM
;

743 
»q
->
num_»gs
++;

744 
»q
->
»g
[1] = 
	`NIX_AF_TL1X_TOPOLOGY
(
schq
);

745 
»q
->
»gv®
[1] = 
hw
->
txschq_aggr_lvl_¼_´io
 << 1;

747 
»q
->
num_»gs
++;

748 
»q
->
»g
[2] = 
	`NIX_AF_TL1X_CIR
(
schq
);

749 
»q
->
»gv®
[2] = 0;

752  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

753 
	}
}

755 #ifdeà
CONFIG_DCB


756 
	$Ùx2_pfc_txschq_cÚfig
(
Ùx2_nic
 *
pfvf
)

758 
u8
 
pfc_’
, 
pfc_b™_£t
;

759 
´io
, 
lvl
, 
”r
;

761 
pfc_’
 = 
pfvf
->pfc_en;

762 
´io
 = 0;…riØ< 
NIX_PF_PFC_PRIO_MAX
;…rio++) {

763 
pfc_b™_£t
 = 
pfc_’
 & (1 << 
´io
);

768 ià(!
pfc_b™_£t
 || !
pfvf
->
pfc_®loc_¡©us
[
´io
])

772 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

773 
”r
 = 
	`Ùx2_txschq_cÚfig
(
pfvf
, 
lvl
, 
´io
, 
Œue
);

774 ià(
”r
) {

775 
	`dev_”r
(
pfvf
->
dev
,

777 
__func__
, 
lvl
, 
´io
);

778  
”r
;

784 
	}
}

786 
	$Ùx2_pfc_txschq_®loc_Úe
(
Ùx2_nic
 *
pfvf
, 
u8
 
´io
)

788 
nix_txsch_®loc_»q
 *
»q
;

789 
nix_txsch_®loc_r¥
 *
r¥
;

790 
lvl
, 
rc
;

793 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txsch_®loc
(&
pfvf
->
mbox
);

794 ià(!
»q
)

795  -
ENOMEM
;

801 
lvl
 = 0;†vÈ< 
pfvf
->
hw
.
txschq_lšk_cfg_lvl
;†vl++)

802 
»q
->
schq
[
lvl
] = 1;

804 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

805 ià(
rc
)

806  
rc
;

808 
r¥
 = (
nix_txsch_®loc_r¥
 *)

809 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

810 ià(
	`IS_ERR
(
r¥
))

811  
	`PTR_ERR
(
r¥
);

814 
lvl
 = 0;†vÈ< 
pfvf
->
hw
.
txschq_lšk_cfg_lvl
;†vl++) {

815 ià(!
r¥
->
schq
[
lvl
])

816  -
ENOSPC
;

818 
pfvf
->
pfc_schq_li¡
[
lvl
][
´io
] = 
r¥
->
schq_li¡
[lvl][0];

824 ; 
lvl
 < 
NIX_TXSCH_LVL_CNT
;†vl++)

825 
pfvf
->
pfc_schq_li¡
[
lvl
][
´io
] =…fvf->
hw
.
txschq_li¡
[lvl][0];

827 
pfvf
->
pfc_®loc_¡©us
[
´io
] = 
Œue
;

829 
	}
}

831 
	$Ùx2_pfc_txschq_®loc
(
Ùx2_nic
 *
pfvf
)

833 
u8
 
pfc_’
 = 
pfvf
->pfc_en;

834 
u8
 
pfc_b™_£t
;

835 
”r
, 
´io
;

837 
´io
 = 0;…riØ< 
NIX_PF_PFC_PRIO_MAX
;…rio++) {

838 
pfc_b™_£t
 = 
pfc_’
 & (1 << 
´io
);

840 ià(!
pfc_b™_£t
 || 
pfvf
->
pfc_®loc_¡©us
[
´io
])

844 
”r
 = 
	`Ùx2_pfc_txschq_®loc_Úe
(
pfvf
, 
´io
);

845 ià(
”r
) {

846 
	`dev_”r
(
pfvf
->
dev
, "% çedØ®loÿ‹ PFC TX scheduËrs\n", 
__func__
);

847  
”r
;

852 
	}
}

854 
	$Ùx2_pfc_txschq_¡İ_Úe
(
Ùx2_nic
 *
pfvf
, 
u8
 
´io
)

856 
lvl
;

859 
lvl
 = 0;†vÈ< 
pfvf
->
hw
.
txschq_lšk_cfg_lvl
;†vl++) {

860 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
lvl
,

861 
pfvf
->
pfc_schq_li¡
[
lvl
][
´io
]);

864 
pfvf
->
pfc_®loc_¡©us
[
´io
] = 
çl£
;

866 
	}
}

868 
	$Ùx2_pfc_upd©e_sq_smq_m­pšg
(
Ùx2_nic
 *
pfvf
, 
´io
)

870 
nix_ú10k_aq_’q_»q
 *
ú10k_sq_aq
;

871 
Ãt_deviû
 *
dev
 = 
pfvf
->
Ãtdev
;

872 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
dev
);

873 
nix_aq_’q_»q
 *
sq_aq
;

875 ià(
if_up
) {

876 ià(
pfvf
->
pfc_®loc_¡©us
[
´io
])

877 
	`Ãtif_tx_¡İ_®l_queues
(
pfvf
->
Ãtdev
);

879 
	`Ãtif_tx_¡İ_queue
(
	`Ãtdev_g‘_tx_queue
(
dev
, 
´io
));

882 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
pfvf
->
hw
.
ÿp_æag
)) {

883 
ú10k_sq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_ú10k_aq_’q
(&
pfvf
->
mbox
);

884 ià(!
ú10k_sq_aq
)

885  -
ENOMEM
;

888 
ú10k_sq_aq
->
qidx
 = 
´io
;

889 
ú10k_sq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

890 
ú10k_sq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

893 
ú10k_sq_aq
->
sq
.
’a
 = 1;

894 
ú10k_sq_aq
->
sq_mask
.
’a
 = 1;

895 
ú10k_sq_aq
->
sq_mask
.
smq
 = 
	`GENMASK
(9, 0);

896 
ú10k_sq_aq
->
sq
.
smq
 = 
	`Ùx2_g‘_smq_idx
(
pfvf
, 
´io
);

898 
sq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

899 ià(!
sq_aq
)

900  -
ENOMEM
;

903 
sq_aq
->
qidx
 = 
´io
;

904 
sq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

905 
sq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

908 
sq_aq
->
sq
.
’a
 = 1;

909 
sq_aq
->
sq_mask
.
’a
 = 1;

910 
sq_aq
->
sq_mask
.
smq
 = 
	`GENMASK
(8, 0);

911 
sq_aq
->
sq
.
smq
 = 
	`Ùx2_g‘_smq_idx
(
pfvf
, 
´io
);

914 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

916 ià(
if_up
) {

917 ià(
pfvf
->
pfc_®loc_¡©us
[
´io
])

918 
	`Ãtif_tx_¡¬t_®l_queues
(
pfvf
->
Ãtdev
);

920 
	`Ãtif_tx_¡¬t_queue
(
	`Ãtdev_g‘_tx_queue
(
dev
, 
´io
));

924 
	}
}

926 
	$Ùx2_pfc_txschq_upd©e
(
Ùx2_nic
 *
pfvf
)

928 
u8
 
pfc_’
 = 
pfvf
->pfc_’, 
pfc_b™_£t
;

929 
mbox
 *mbox = &
pfvf
->mbox;

930 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
pfvf
->
Ãtdev
);

931 
”r
, 
´io
;

933 
	`mu‹x_lock
(&
mbox
->
lock
);

934 
´io
 = 0;…riØ< 
NIX_PF_PFC_PRIO_MAX
;…rio++) {

935 
pfc_b™_£t
 = 
pfc_’
 & (1 << 
´io
);

938 ià(!
pfc_b™_£t
 && 
pfvf
->
pfc_®loc_¡©us
[
´io
]) {

939 
	`mu‹x_uÆock
(&
mbox
->
lock
);

940 ià(
if_up
)

941 
	`Ãtif_tx_¡İ_®l_queues
(
pfvf
->
Ãtdev
);

943 
	`Ùx2_smq_æush
(
pfvf
,…fvf->
pfc_schq_li¡
[
NIX_TXSCH_LVL_SMQ
][
´io
]);

944 ià(
if_up
)

945 
	`Ãtif_tx_¡¬t_®l_queues
(
pfvf
->
Ãtdev
);

948 
”r
 = 
	`Ùx2_pfc_txschq_¡İ_Úe
(
pfvf
, 
´io
);

949 ià(
”r
) {

950 
	`dev_”r
(
pfvf
->
dev
,

952 
__func__
, 
´io
);

953  
”r
;

956 
	`mu‹x_lock
(&
mbox
->
lock
);

957 
upd©e_sq_smq_m­
;

963 ià(!
pfc_b™_£t
 || 
pfvf
->
pfc_®loc_¡©us
[
´io
])

967 
”r
 = 
	`Ùx2_pfc_txschq_®loc_Úe
(
pfvf
, 
´io
);

968 ià(
”r
) {

969 
	`mu‹x_uÆock
(&
mbox
->
lock
);

970 
	`dev_”r
(
pfvf
->
dev
,

972 
__func__
, 
´io
);

973  
”r
;

976 
upd©e_sq_smq_m­
:

977 
”r
 = 
	`Ùx2_pfc_upd©e_sq_smq_m­pšg
(
pfvf
, 
´io
);

978 ià(
”r
) {

979 
	`mu‹x_uÆock
(&
mbox
->
lock
);

980 
	`dev_”r
(
pfvf
->
dev
, "% çed PFC Tx schq sq:%d m­pšg", 
__func__
, 
´io
);

981  
”r
;

985 
”r
 = 
	`Ùx2_pfc_txschq_cÚfig
(
pfvf
);

986 
	`mu‹x_uÆock
(&
mbox
->
lock
);

987 ià(
”r
)

988  
”r
;

991 
	}
}

992 
EXPORT_SYMBOL
(
Ùx2_pfc_txschq_upd©e
);

994 
	$Ùx2_pfc_txschq_¡İ
(
Ùx2_nic
 *
pfvf
)

996 
u8
 
pfc_’
, 
pfc_b™_£t
;

997 
´io
, 
”r
;

999 
pfc_’
 = 
pfvf
->pfc_en;

1000 
´io
 = 0;…riØ< 
NIX_PF_PFC_PRIO_MAX
;…rio++) {

1001 
pfc_b™_£t
 = 
pfc_’
 & (1 << 
´io
);

1002 ià(!
pfc_b™_£t
 || !
pfvf
->
pfc_®loc_¡©us
[
´io
])

1006 
”r
 = 
	`Ùx2_pfc_txschq_¡İ_Úe
(
pfvf
, 
´io
);

1007 ià(
”r
) {

1008 
	`dev_”r
(
pfvf
->
dev
, "% çedØ¡İ PFC TX scheduËrs\n", 
__func__
);

1009  
”r
;

1014 
	}
}

1017 
	$Ùx2_txsch_®loc
(
Ùx2_nic
 *
pfvf
)

1019 
nix_txsch_®loc_»q
 *
»q
;

1020 
nix_txsch_®loc_r¥
 *
r¥
;

1021 
lvl
, 
schq
, 
rc
;

1024 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txsch_®loc
(&
pfvf
->
mbox
);

1025 ià(!
»q
)

1026  -
ENOMEM
;

1029 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++)

1030 
»q
->
schq
[
lvl
] = 1;

1032 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1033 ià(
rc
)

1034  
rc
;

1036 
r¥
 = (
nix_txsch_®loc_r¥
 *)

1037 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

1038 ià(
	`IS_ERR
(
r¥
))

1039  
	`PTR_ERR
(
r¥
);

1042 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++)

1043 
schq
 = 0; schq < 
r¥
->schq[
lvl
]; schq++)

1044 
pfvf
->
hw
.
txschq_li¡
[
lvl
][
schq
] =

1045 
r¥
->
schq_li¡
[
lvl
][
schq
];

1047 
pfvf
->
hw
.
txschq_lšk_cfg_lvl
 = 
r¥
->
lšk_cfg_lvl
;

1048 
pfvf
->
hw
.
txschq_aggr_lvl_¼_´io
 = 
r¥
->
aggr_lvl_¼_´io
;

1051 
	}
}

1053 
	$Ùx2_txschq_ä“_Úe
(
Ùx2_nic
 *
pfvf
, 
u16
 
lvl
, u16 
schq
)

1055 
nix_txsch_ä“_»q
 *
ä“_»q
;

1056 
”r
;

1058 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1060 
ä“_»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txsch_ä“
(&
pfvf
->
mbox
);

1061 ià(!
ä“_»q
) {

1062 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1063 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1068 
ä“_»q
->
schq_lvl
 = 
lvl
;

1069 
ä“_»q
->
schq
 = schq;

1071 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1072 ià(
”r
) {

1073 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1074 "Faed stİxschq %d‡ˆËv– %d\n", 
schq
, 
lvl
);

1077 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1078 
	}
}

1080 
	$Ùx2_txschq_¡İ
(
Ùx2_nic
 *
pfvf
)

1082 
lvl
, 
schq
;

1085 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++)

1086 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
lvl
,

1087 
pfvf
->
hw
.
txschq_li¡
[
lvl
][0]);

1090 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

1091 
schq
 = 0; schq < 
MAX_TXSCHQ_PER_FUNC
; schq++)

1092 
pfvf
->
hw
.
txschq_li¡
[
lvl
][
schq
] = 0;

1096 
	}
}

1098 
	$Ùx2_sqb_æush
(
Ùx2_nic
 *
pfvf
)

1100 
qidx
, 
sqe_
, 
sqe_h—d
;

1101 
Ùx2_¢d_queue
 *
sq
;

1102 
u64
 
šü
, *
±r
, 
v®
;

1104 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_SQ_OP_STATUS
);

1105 
qidx
 = 0; qidx < 
pfvf
->
hw
.
tÙ_tx_queues
 +…fvf->hw.
tc_tx_queues
;

1106 
qidx
++) {

1107 
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

1108 ià(!
sq
->
sqb_±rs
)

1110 
šü
 = (
u64
)
qidx
 << 32;

1111 
v®
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

1112 
sqe_h—d
 = (
v®
 >> 20) & 0x3F;

1113 
sqe_
 = (
v®
 >> 28) & 0x3F;

1114 ià(
sqe_h—d
 !ğ
sqe_
)

1115 
	`u¦“p_¿nge
(50, 60);

1117 
	}
}

1122 
	#RQ_PASS_LVL_CQ
(
skid
, 
qsize
è((((skidè+ 16è* 256è/ (qsize))

	)

1123 
	#RQ_DROP_LVL_CQ
(
skid
, 
qsize
è(((skidè* 256è/ (qsize))

	)

1131 
	#RQ_BP_LVL_AURA
 (255 - ((85 * 256è/ 100)è

	)

1132 
	#RQ_PASS_LVL_AURA
 (255 - ((95 * 256è/ 100)è

	)

1133 
	#RQ_DROP_LVL_AURA
 (255 - ((99 * 256è/ 100)è

	)

1135 
	$Ùx2_rq_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
, u16 
Íb_au¿
)

1137 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1138 
nix_aq_’q_»q
 *
aq
;

1141 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

1142 ià(!
aq
)

1143  -
ENOMEM
;

1145 
aq
->
rq
.
cq
 = 
qidx
;

1146 
aq
->
rq
.
’a
 = 1;

1147 
aq
->
rq
.
pb_ÿchšg
 = 1;

1148 
aq
->
rq
.
Íb_au¿
 =†pb_aura;

1149 
aq
->
rq
.
Íb_sizem1
 = (
	`DMA_BUFFER_LEN
(
pfvf
->
rbsize
) / 8) - 1;

1150 
aq
->
rq
.
xqe_imm_size
 = 0;

1151 
aq
->
rq
.
æow_gw
 = 32;

1152 
aq
->
rq
.
qšt_idx
 = 0;

1153 
aq
->
rq
.
Íb_drİ_’a
 = 1;

1154 
aq
->
rq
.
xqe_drİ_’a
 = 1;

1155 
aq
->
rq
.
xqe_·ss
 = 
	`RQ_PASS_LVL_CQ
(
pfvf
->
hw
.
rq_skid
, 
q£t
->
rqe_út
);

1156 
aq
->
rq
.
xqe_drİ
 = 
	`RQ_DROP_LVL_CQ
(
pfvf
->
hw
.
rq_skid
, 
q£t
->
rqe_út
);

1157 
aq
->
rq
.
Íb_au¿_·ss
 = 
RQ_PASS_LVL_AURA
;

1158 
aq
->
rq
.
Íb_au¿_drİ
 = 
RQ_DROP_LVL_AURA
;

1161 
aq
->
qidx
 = qidx;

1162 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_RQ
;

1163 
aq
->
İ
 = 
NIX_AQ_INSTOP_INIT
;

1165  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1166 
	}
}

1168 
	$Ùx2_sq_aq_š™
(*
dev
, 
u16
 
qidx
, 
u8
 
chª_off£t
, u16 
sqb_au¿
)

1170 
Ùx2_nic
 *
pfvf
 = 
dev
;

1171 
Ùx2_¢d_queue
 *
sq
;

1172 
nix_aq_’q_»q
 *
aq
;

1174 
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

1175 
sq
->
lmt_addr
 = (
__fÜû
 
u64
 *)(
pfvf
->
»g_ba£
 + 
	`LMT_LF_LMTLINEX
(
qidx
));

1177 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

1178 ià(!
aq
)

1179  -
ENOMEM
;

1181 
aq
->
sq
.
cq
 = 
pfvf
->
hw
.
rx_queues
 + 
qidx
;

1182 
aq
->
sq
.
max_sqe_size
 = 
NIX_MAXSQESZ_W16
;

1183 
aq
->
sq
.
cq_’a
 = 1;

1184 
aq
->
sq
.
’a
 = 1;

1185 
aq
->
sq
.
smq
 = 
	`Ùx2_g‘_smq_idx
(
pfvf
, 
qidx
);

1186 
aq
->
sq
.
smq_¼_quªtum
 = 
	`mtu_to_dw¼_weight
(
pfvf
,…fvf->
tx_max_pk’
);

1187 
aq
->
sq
.
deçuÉ_chª
 = 
pfvf
->
hw
.
tx_chª_ba£
 + 
chª_off£t
;

1188 
aq
->
sq
.
sqe_¡y³
 = 
NIX_STYPE_STF
;

1189 
aq
->
sq
.
sqb_au¿
 = sqb_aura;

1190 
aq
->
sq
.
sq_št_’a
 = 
NIX_SQINT_BITS
;

1191 
aq
->
sq
.
qšt_idx
 = 0;

1195 
aq
->
sq
.
cq_lim™
 = ((
SEND_CQ_SKID
 * 256è/ (
pfvf
->
q£t
.
sqe_út
));

1198 
aq
->
qidx
 = qidx;

1199 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

1200 
aq
->
İ
 = 
NIX_AQ_INSTOP_INIT
;

1202  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1203 
	}
}

1205 
	$Ùx2_sq_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
, u16 
sqb_au¿
)

1207 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1208 
Ùx2_¢d_queue
 *
sq
;

1209 
Ùx2_poŞ
 *
poŞ
;

1210 
u8
 
chª_off£t
;

1211 
”r
;

1213 
poŞ
 = &
pfvf
->
q£t
.poŞ[
sqb_au¿
];

1214 
sq
 = &
q£t
->sq[
qidx
];

1215 
sq
->
sqe_size
 = 
NIX_SQESZ_W16
 ? 64 : 128;

1216 
sq
->
sqe_út
 = 
q£t
->sqe_cnt;

1218 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
sq
->
sqe
, 1, sq->
sqe_size
);

1219 ià(
”r
)

1220  
”r
;

1222 ià(
qidx
 < 
pfvf
->
hw
.
tx_queues
) {

1223 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
sq
->
tso_hdrs
, 
q£t
->
sqe_út
,

1224 
TSO_HEADER_SIZE
);

1225 ià(
”r
)

1226  
”r
;

1229 
sq
->
sqe_ba£
 = sq->
sqe
->
ba£
;

1230 
sq
->
sg
 = 
	`kÿÎoc
(
q£t
->
sqe_út
, (
sg_li¡
), 
GFP_ATOMIC
);

1231 ià(!
sq
->
sg
)

1232  -
ENOMEM
;

1234 ià(
pfvf
->
±p
 && 
qidx
 <…fvf->
hw
.
tx_queues
) {

1235 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
sq
->
time¡amps
, 
q£t
->
sqe_út
,

1236 (*
sq
->
time¡amps
));

1237 ià(
”r
)

1238  
”r
;

1241 
sq
->
h—d
 = 0;

1242 
sq
->
cÚs_h—d
 = 0;

1243 
sq
->
sqe_³r_sqb
 = (
pfvf
->
hw
.
sqb_size
 / sq->
sqe_size
) - 1;

1244 
sq
->
num_sqbs
 = (
q£t
->
sqe_út
 + sq->
sqe_³r_sqb
) / sq->sqe_per_sqb;

1246 
sq
->
sqe_th»sh
 = ((sq->
num_sqbs
 * sq->
sqe_³r_sqb
) * 10) / 100;

1247 
sq
->
au¿_id
 = 
sqb_au¿
;

1248 
sq
->
au¿_fc_addr
 = 
poŞ
->
fc_addr
->
ba£
;

1249 
sq
->
io_addr
 = (
__fÜû
 
u64
)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
	`NIX_LF_OP_SENDX
(0));

1251 
sq
->
¡©s
.
by‹s
 = 0;

1252 
sq
->
¡©s
.
pkts
 = 0;

1254 
chª_off£t
 = 
qidx
 % 
pfvf
->
hw
.
tx_chª_út
;

1255  
pfvf
->
hw_İs
->
	`sq_aq_š™
Õfvf, 
qidx
, 
chª_off£t
, 
sqb_au¿
);

1256 
	}
}

1258 
	$Ùx2_cq_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
)

1260 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1261 
”r
, 
poŞ_id
, 
nÚ_xdp_queues
;

1262 
nix_aq_’q_»q
 *
aq
;

1263 
Ùx2_cq_queue
 *
cq
;

1265 
cq
 = &
q£t
->cq[
qidx
];

1266 
cq
->
cq_idx
 = 
qidx
;

1267 
nÚ_xdp_queues
 = 
pfvf
->
hw
.
rx_queues
 +…fvf->hw.
tx_queues
;

1268 ià(
qidx
 < 
pfvf
->
hw
.
rx_queues
) {

1269 
cq
->
cq_ty³
 = 
CQ_RX
;

1270 
cq
->
cšt_idx
 = 
qidx
;

1271 
cq
->
cqe_út
 = 
q£t
->
rqe_út
;

1272 } ià(
qidx
 < 
nÚ_xdp_queues
) {

1273 
cq
->
cq_ty³
 = 
CQ_TX
;

1274 
cq
->
cšt_idx
 = 
qidx
 - 
pfvf
->
hw
.
rx_queues
;

1275 
cq
->
cqe_út
 = 
q£t
->
sqe_út
;

1277 ià(
pfvf
->
hw
.
xdp_queues
 &&

1278 
qidx
 < 
nÚ_xdp_queues
 + 
pfvf
->
hw
.
xdp_queues
) {

1279 
cq
->
cq_ty³
 = 
CQ_XDP
;

1280 
cq
->
cšt_idx
 = 
qidx
 - 
nÚ_xdp_queues
;

1281 
cq
->
cqe_út
 = 
q£t
->
sqe_út
;

1283 
cq
->
cq_ty³
 = 
CQ_QOS
;

1284 
cq
->
cšt_idx
 = 
qidx
 - 
nÚ_xdp_queues
 -

1285 
pfvf
->
hw
.
xdp_queues
;

1286 
cq
->
cqe_út
 = 
q£t
->
sqe_út
;

1289 
cq
->
cqe_size
 = 
pfvf
->
q£t
.
xqe_size
;

1292 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
cq
->
cqe
, cq->
cqe_út
, cq->
cqe_size
);

1293 ià(
”r
)

1294  
”r
;

1297 
cq
->
cqe_ba£
 = cq->
cqe
->
ba£
;

1301 
poŞ_id
 = ((
cq
->
cq_ty³
 =ğ
CQ_RX
) &&

1302 (
pfvf
->
hw
.
rqpoŞ_út
 !ğpfvf->hw.
rx_queues
)è? 0 : 
qidx
;

1303 
cq
->
rbpoŞ
 = &
q£t
->
poŞ
[
poŞ_id
];

1304 
cq
->
»fl_sk_sched
 = 
çl£
;

1305 
cq
->
³nd_cqe
 = 0;

1308 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

1309 ià(!
aq
)

1310  -
ENOMEM
;

1312 
aq
->
cq
.
’a
 = 1;

1313 
aq
->
cq
.
qsize
 = 
	`Q_SIZE
(cq->
cqe_út
, 4);

1314 
aq
->
cq
.
ÿchšg
 = 1;

1315 
aq
->
cq
.
ba£
 = cq->
cqe
->
iova
;

1316 
aq
->
cq
.
cšt_idx
 = cq->cint_idx;

1317 
aq
->
cq
.
cq_”r_št_’a
 = 
NIX_CQERRINT_BITS
;

1318 
aq
->
cq
.
qšt_idx
 = 0;

1319 
aq
->
cq
.
avg_Ëv–
 = 255;

1321 ià(
qidx
 < 
pfvf
->
hw
.
rx_queues
) {

1322 
aq
->
cq
.
drİ
 = 
	`RQ_DROP_LVL_CQ
(
pfvf
->
hw
.
rq_skid
, cq->
cqe_út
);

1323 
aq
->
cq
.
drİ_’a
 = 1;

1325 ià(!
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
)) {

1327 
aq
->
cq
.
bp_’a
 = 1;

1328 #ifdeà
CONFIG_DCB


1329 
aq
->
cq
.
bpid
 = 
pfvf
->bpid[pfvf->
queue_to_pfc_m­
[
qidx
]];

1331 
aq
->
cq
.
bpid
 = 
pfvf
->bpid[0];

1335 
aq
->
cq
.
bp
 = 
	`RQ_PASS_LVL_CQ
(
pfvf
->
hw
.
rq_skid
,

1336 
q£t
->
rqe_út
);

1341 
aq
->
qidx
 = qidx;

1342 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_CQ
;

1343 
aq
->
İ
 = 
NIX_AQ_INSTOP_INIT
;

1345  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1346 
	}
}

1348 
	$Ùx2_poŞ_»fl_sk
(
wÜk_¡ruù
 *
wÜk
)

1350 
Ùx2_cq_queue
 *
cq
;

1351 
Ùx2_poŞ
 *
rbpoŞ
;

1352 
»fl_wÜk
 *
wrk
;

1353 
qidx
, 
ä“_±rs
 = 0;

1354 
Ùx2_nic
 *
pfvf
;

1355 
dma_addr_t
 
buåŒ
;

1357 
wrk
 = 
	`cÚš”_of
(
wÜk
, 
»fl_wÜk
, 
poŞ_»fl_wÜk
.work);

1358 
pfvf
 = 
wrk
->
pf
;

1359 
qidx
 = 
wrk
 - 
pfvf
->
»fl_wrk
;

1360 
cq
 = &
pfvf
->
q£t
.cq[
qidx
];

1361 
rbpoŞ
 = 
cq
->rbpool;

1362 
ä“_±rs
 = 
cq
->
poŞ_±rs
;

1364 
	`g‘_ıu
();

1365 
cq
->
poŞ_±rs
) {

1366 ià(
	`Ùx2_®loc_rbuf
(
pfvf
, 
rbpoŞ
, &
buåŒ
)) {

1370 ià(!((
ä“_±rs
 - 
cq
->
poŞ_±rs
) > free_ptrs / 2)) {

1371 
d–ayed_wÜk
 *
dwÜk
;

1373 
dwÜk
 = &
wrk
->
poŞ_»fl_wÜk
;

1374 
	`scheduË_d–ayed_wÜk
(
dwÜk
,

1375 
	`m£cs_to_jiff›s
(100));

1377 
cq
->
»fl_sk_sched
 = 
çl£
;

1381 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
qidx
, 
buåŒ
 + 
OTX2_HEAD_ROOM
);

1382 
cq
->
poŞ_±rs
--;

1384 
	`put_ıu
();

1385 
cq
->
»fl_sk_sched
 = 
çl£
;

1386 
	}
}

1388 
	$Ùx2_cÚfig_nix_queues
(
Ùx2_nic
 *
pfvf
)

1390 
qidx
, 
”r
;

1393 
qidx
 = 0; qidx < 
pfvf
->
hw
.
rx_queues
; qidx++) {

1394 
u16
 
Íb_au¿
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_RQ
, 
qidx
);

1396 
”r
 = 
	`Ùx2_rq_š™
(
pfvf
, 
qidx
, 
Íb_au¿
);

1397 ià(
”r
)

1398  
”r
;

1402 
qidx
 = 0; qidx < 
pfvf
->
hw
.
tÙ_tx_queues
; qidx++) {

1403 
u16
 
sqb_au¿
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
qidx
);

1405 
”r
 = 
	`Ùx2_sq_š™
(
pfvf
, 
qidx
, 
sqb_au¿
);

1406 ià(
”r
)

1407  
”r
;

1411 
qidx
 = 0; qidx < 
pfvf
->
q£t
.
cq_út
; qidx++) {

1412 
”r
 = 
	`Ùx2_cq_š™
(
pfvf
, 
qidx
);

1413 ià(
”r
)

1414  
”r
;

1417 
pfvf
->
cq_İ_addr
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
Õfvf, 
NIX_LF_CQ_OP_STATUS
);

1420 
pfvf
->
»fl_wrk
 = 
	`devm_kÿÎoc
Õfvf->
dev
,…fvf->
q£t
.
cq_út
,

1421 (
»fl_wÜk
), 
GFP_KERNEL
);

1422 ià(!
pfvf
->
»fl_wrk
)

1423  -
ENOMEM
;

1425 
qidx
 = 0; qidx < 
pfvf
->
q£t
.
cq_út
; qidx++) {

1426 
pfvf
->
»fl_wrk
[
qidx
].
pf
 =…fvf;

1427 
	`INIT_DELAYED_WORK
(&
pfvf
->
»fl_wrk
[
qidx
].
poŞ_»fl_wÜk
,

1428 
Ùx2_poŞ_»fl_sk
);

1431 
	}
}

1433 
	$Ùx2_cÚfig_nix
(
Ùx2_nic
 *
pfvf
)

1435 
nix_lf_®loc_»q
 *
nixlf
;

1436 
nix_lf_®loc_r¥
 *
r¥
;

1437 
”r
;

1439 
pfvf
->
q£t
.
xqe_size
 =…fvf->
hw
.xqe_size;

1442 
nixlf
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_®loc
(&
pfvf
->
mbox
);

1443 ià(!
nixlf
)

1444  -
ENOMEM
;

1447 
nixlf
->
rq_út
 = 
pfvf
->
hw
.
rx_queues
;

1448 
nixlf
->
sq_út
 = 
pfvf
->
hw
.
tÙ_tx_queues
 +…fvf->hw.
tc_tx_queues
;

1449 
nixlf
->
cq_út
 = 
pfvf
->
q£t
.cq_cnt;

1450 
nixlf
->
rss_sz
 = 
MAX_RSS_INDIR_TBL_SIZE
;

1451 
nixlf
->
rss_g½s
 = 
MAX_RSS_GROUPS
;

1452 
nixlf
->
xqe_sz
 = 
pfvf
->
hw
.
xqe_size
 =ğ128 ? 
NIX_XQESZ_W16
 : 
NIX_XQESZ_W64
;

1457 
nixlf
->
Åa_func
 = 
RVU_DEFAULT_PF_FUNC
;

1461 
nixlf
->
rx_cfg
 = 
	`BIT_ULL
(33) | BIT_ULL(35) | BIT_ULL(37);

1463 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1464 ià(
”r
)

1465  
”r
;

1467 
r¥
 = (
nix_lf_®loc_r¥
 *)
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0,

1468 &
nixlf
->
hdr
);

1469 ià(
	`IS_ERR
(
r¥
))

1470  
	`PTR_ERR
(
r¥
);

1472 ià(
r¥
->
qšts
 < 1)

1473  -
ENXIO
;

1475  
r¥
->
hdr
.
rc
;

1476 
	}
}

1478 
	$Ùx2_sq_ä“_sqbs
(
Ùx2_nic
 *
pfvf
)

1480 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1481 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

1482 
Ùx2_¢d_queue
 *
sq
;

1483 
sqb
, 
qidx
;

1484 
u64
 
iova
, 
·
;

1486 
qidx
 = 0; qidx < 
hw
->
tÙ_tx_queues
 + hw->
tc_tx_queues
; qidx++) {

1487 
sq
 = &
q£t
->sq[
qidx
];

1488 ià(!
sq
->
sqb_±rs
)

1490 
sqb
 = 0; sqb < 
sq
->
sqb_couÁ
; sqb++) {

1491 ià(!
sq
->
sqb_±rs
[
sqb
])

1493 
iova
 = 
sq
->
sqb_±rs
[
sqb
];

1494 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

1495 
	`dma_unm­_·ge_©Œs
(
pfvf
->
dev
, 
iova
, 
hw
->
sqb_size
,

1496 
DMA_FROM_DEVICE
,

1497 
DMA_ATTR_SKIP_CPU_SYNC
);

1498 ià(
	`·ge_»f_couÁ
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
))))

1499 
	`put_·ge
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
)));

1501 
sq
->
sqb_couÁ
 = 0;

1503 
	}
}

1505 
	$Ùx2_ä“_au¿_±r
(
Ùx2_nic
 *
pfvf
, 
ty³
)

1507 
poŞ_id
, 
poŞ_¡¬t
 = 0, 
poŞ_’d
 = 0, 
size
 = 0;

1508 
u64
 
iova
, 
·
;

1510 ià(
ty³
 =ğ
AURA_NIX_SQ
) {

1511 
poŞ_¡¬t
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
ty³
, 0);

1512 
poŞ_’d
 = 
poŞ_¡¬t
 + 
pfvf
->
hw
.
sqpoŞ_út
;

1513 
size
 = 
pfvf
->
hw
.
sqb_size
;

1515 ià(
ty³
 =ğ
AURA_NIX_RQ
) {

1516 
poŞ_¡¬t
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
ty³
, 0);

1517 
poŞ_’d
 = 
pfvf
->
hw
.
rqpoŞ_út
;

1518 
size
 = 
pfvf
->
rbsize
;

1522 
poŞ_id
 = 
poŞ_¡¬t
;…oŞ_id < 
poŞ_’d
;…ool_id++) {

1523 
iova
 = 
	`Ùx2_au¿_®loıŒ
(
pfvf
, 
poŞ_id
);

1524 
iova
) {

1525 ià(
ty³
 =ğ
AURA_NIX_RQ
)

1526 
iova
 -ğ
OTX2_HEAD_ROOM
;

1528 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

1529 
	`dma_unm­_·ge_©Œs
(
pfvf
->
dev
, 
iova
, 
size
,

1530 
DMA_FROM_DEVICE
,

1531 
DMA_ATTR_SKIP_CPU_SYNC
);

1532 ià(
	`·ge_»f_couÁ
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
))))

1533 
	`put_·ge
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
)));

1534 
iova
 = 
	`Ùx2_au¿_®loıŒ
(
pfvf
, 
poŞ_id
);

1537 
	}
}

1539 
	$Ùx2_au¿_poŞ_ä“
(
Ùx2_nic
 *
pfvf
)

1541 
Ùx2_poŞ
 *
poŞ
;

1542 
poŞ_id
;

1544 ià(!
pfvf
->
q£t
.
poŞ
)

1547 
poŞ_id
 = 0;…oŞ_id < 
pfvf
->
hw
.
poŞ_út
;…ool_id++) {

1548 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

1549 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
¡ack
);

1550 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
fc_addr
);

1552 
	`devm_kä“
(
pfvf
->
dev
,…fvf->
q£t
.
poŞ
);

1553 
pfvf
->
q£t
.
poŞ
 = 
NULL
;

1554 
	}
}

1556 
	$Ùx2_au¿_š™
(
Ùx2_nic
 *
pfvf
, 
au¿_id
,

1557 
poŞ_id
, 
num±rs
)

1559 
Åa_aq_’q_»q
 *
aq
;

1560 
Ùx2_poŞ
 *
poŞ
;

1561 
”r
;

1563 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

1568 ià(!
poŞ
->
fc_addr
) {

1569 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
poŞ
->
fc_addr
, 1, 
OTX2_ALIGN
);

1570 ià(
”r
)

1571  
”r
;

1575 
aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

1576 ià(!
aq
) {

1578 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1579 ià(
”r
)

1580  
”r
;

1581 
aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

1582 ià(!
aq
)

1583  -
ENOMEM
;

1586 
aq
->
au¿_id
 =‡ura_id;

1588 
aq
->
au¿
.
poŞ_addr
 = 
poŞ_id
;

1589 
aq
->
au¿
.
poŞ_ÿchšg
 = 1;

1590 
aq
->
au¿
.
shiá
 = 
	`og2
(
num±rs
) - 8;

1591 
aq
->
au¿
.
couÁ
 = 
num±rs
;

1592 
aq
->
au¿
.
lim™
 = 
num±rs
;

1593 
aq
->
au¿
.
avg_Ëv–
 = 255;

1594 
aq
->
au¿
.
’a
 = 1;

1595 
aq
->
au¿
.
fc_’a
 = 1;

1596 
aq
->
au¿
.
fc_addr
 = 
poŞ
->fc_addr->
iova
;

1597 
aq
->
au¿
.
fc_hy¡_b™s
 = 0;

1600 ià(
au¿_id
 < 
pfvf
->
hw
.
rqpoŞ_út
 && !
	`is_Ùx2_lbkvf
Õfvf->
pdev
)) {

1601 
aq
->
au¿
.
bp_’a
 = 0;

1616 ià(
pfvf
->
nix_blkaddr
 =ğ
BLKADDR_NIX1
)

1617 
aq
->
au¿
.
bp_’a
 = 1;

1618 #ifdeà
CONFIG_DCB


1619 
aq
->
au¿
.
nix0_bpid
 = 
pfvf
->
bpid
[pfvf->
queue_to_pfc_m­
[
au¿_id
]];

1621 
aq
->
au¿
.
nix0_bpid
 = 
pfvf
->
bpid
[0];

1625 
aq
->
au¿
.
bp
 = 
RQ_BP_LVL_AURA
;

1629 
aq
->
ùy³
 = 
NPA_AQ_CTYPE_AURA
;

1630 
aq
->
İ
 = 
NPA_AQ_INSTOP_INIT
;

1633 
	}
}

1635 
	$Ùx2_poŞ_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
poŞ_id
,

1636 
¡ack_·ges
, 
num±rs
, 
buf_size
)

1638 
Åa_aq_’q_»q
 *
aq
;

1639 
Ùx2_poŞ
 *
poŞ
;

1640 
”r
;

1642 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

1644 
”r
 = 
	`qmem_®loc
(
pfvf
->
dev
, &
poŞ
->
¡ack
,

1645 
¡ack_·ges
, 
pfvf
->
hw
.
¡ack_pg_by‹s
);

1646 ià(
”r
)

1647  
”r
;

1649 
poŞ
->
rbsize
 = 
buf_size
;

1652 
aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

1653 ià(!
aq
) {

1655 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1656 ià(
”r
) {

1657 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
¡ack
);

1658  
”r
;

1660 
aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

1661 ià(!
aq
) {

1662 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
¡ack
);

1663  -
ENOMEM
;

1667 
aq
->
au¿_id
 = 
poŞ_id
;

1668 
aq
->
poŞ
.
¡ack_ba£
 =…oŞ->
¡ack
->
iova
;

1669 
aq
->
poŞ
.
¡ack_ÿchšg
 = 1;

1670 
aq
->
poŞ
.
’a
 = 1;

1671 
aq
->
poŞ
.
buf_size
 = buf_size / 128;

1672 
aq
->
poŞ
.
¡ack_max_·ges
 = 
¡ack_·ges
;

1673 
aq
->
poŞ
.
shiá
 = 
	`og2
(
num±rs
) - 8;

1674 
aq
->
poŞ
.
±r_¡¬t
 = 0;

1675 
aq
->
poŞ
.
±r_’d
 = ~0ULL;

1678 
aq
->
ùy³
 = 
NPA_AQ_CTYPE_POOL
;

1679 
aq
->
İ
 = 
NPA_AQ_INSTOP_INIT
;

1682 
	}
}

1684 
	$Ùx2_sq_au¿_poŞ_š™
(
Ùx2_nic
 *
pfvf
)

1686 
qidx
, 
poŞ_id
, 
¡ack_·ges
, 
num_sqbs
;

1687 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1688 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

1689 
Ùx2_¢d_queue
 *
sq
;

1690 
Ùx2_poŞ
 *
poŞ
;

1691 
dma_addr_t
 
buåŒ
;

1692 
”r
, 
±r
;

1699 
num_sqbs
 = (
hw
->
sqb_size
 / 128) - 1;

1700 
num_sqbs
 = (
q£t
->
sqe_út
 +‚um_sqbs) /‚um_sqbs;

1703 
¡ack_·ges
 =

1704 (
num_sqbs
 + 
hw
->
¡ack_pg_±rs
 - 1) / hw->stack_pg_ptrs;

1706 
qidx
 = 0; qidx < 
hw
->
tÙ_tx_queues
; qidx++) {

1707 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
qidx
);

1709 
”r
 = 
	`Ùx2_au¿_š™
(
pfvf
, 
poŞ_id
,…oŞ_id, 
num_sqbs
);

1710 ià(
”r
)

1711 
ç
;

1714 
”r
 = 
	`Ùx2_poŞ_š™
(
pfvf
, 
poŞ_id
, 
¡ack_·ges
,

1715 
num_sqbs
, 
hw
->
sqb_size
);

1716 ià(
”r
)

1717 
ç
;

1721 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1722 ià(
”r
)

1723 
ç
;

1725 
	`g‘_ıu
();

1727 
qidx
 = 0; qidx < 
hw
->
tÙ_tx_queues
; qidx++) {

1728 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
qidx
);

1729 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

1731 
sq
 = &
q£t
->sq[
qidx
];

1732 
sq
->
sqb_couÁ
 = 0;

1733 
sq
->
sqb_±rs
 = 
	`kÿÎoc
(
num_sqbs
, (*sq->sqb_±rs), 
GFP_ATOMIC
);

1734 ià(!
sq
->
sqb_±rs
) {

1735 
”r
 = -
ENOMEM
;

1736 
”r_mem
;

1739 
±r
 = 0;…Œ < 
num_sqbs
;…tr++) {

1740 
”r
 = 
	`Ùx2_®loc_rbuf
(
pfvf
, 
poŞ
, &
buåŒ
);

1741 ià(
”r
)

1742 
”r_mem
;

1743 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
poŞ_id
, 
buåŒ
);

1744 
sq
->
sqb_±rs
[sq->
sqb_couÁ
++] = (
u64
)
buåŒ
;

1748 
”r_mem
:

1749 
	`put_ıu
();

1750  
”r
 ? -
ENOMEM
 : 0;

1752 
ç
:

1753 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

1754 
	`Ùx2_au¿_poŞ_ä“
(
pfvf
);

1755  
”r
;

1756 
	}
}

1758 
	$Ùx2_rq_au¿_poŞ_š™
(
Ùx2_nic
 *
pfvf
)

1760 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

1761 
¡ack_·ges
, 
poŞ_id
, 
rq
;

1762 
Ùx2_poŞ
 *
poŞ
;

1763 
”r
, 
±r
, 
num_±rs
;

1764 
dma_addr_t
 
buåŒ
;

1766 
num_±rs
 = 
pfvf
->
q£t
.
rqe_út
;

1768 
¡ack_·ges
 =

1769 (
num_±rs
 + 
hw
->
¡ack_pg_±rs
 - 1) / hw->stack_pg_ptrs;

1771 
rq
 = 0;„q < 
hw
->
rx_queues
;„q++) {

1772 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_RQ
, 
rq
);

1774 
”r
 = 
	`Ùx2_au¿_š™
(
pfvf
, 
poŞ_id
,…oŞ_id, 
num_±rs
);

1775 ià(
”r
)

1776 
ç
;

1778 
poŞ_id
 = 0;…oŞ_id < 
hw
->
rqpoŞ_út
;…ool_id++) {

1779 
”r
 = 
	`Ùx2_poŞ_š™
(
pfvf
, 
poŞ_id
, 
¡ack_·ges
,

1780 
num_±rs
, 
pfvf
->
rbsize
);

1781 ià(
”r
)

1782 
ç
;

1786 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1787 ià(
”r
)

1788 
ç
;

1790 
	`g‘_ıu
();

1792 
poŞ_id
 = 0;…oŞ_id < 
hw
->
rqpoŞ_út
;…ool_id++) {

1793 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

1794 
±r
 = 0;…Œ < 
num_±rs
;…tr++) {

1795 
”r
 = 
	`Ùx2_®loc_rbuf
(
pfvf
, 
poŞ
, &
buåŒ
);

1796 ià(
”r
)

1797 
”r_mem
;

1798 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
poŞ_id
,

1799 
buåŒ
 + 
OTX2_HEAD_ROOM
);

1802 
”r_mem
:

1803 
	`put_ıu
();

1804  
”r
 ? -
ENOMEM
 : 0;

1805 
ç
:

1806 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

1807 
	`Ùx2_au¿_poŞ_ä“
(
pfvf
);

1808  
”r
;

1809 
	}
}

1811 
	$Ùx2_cÚfig_Åa
(
Ùx2_nic
 *
pfvf
)

1813 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

1814 
Åa_lf_®loc_»q
 *
Å®f
;

1815 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

1816 
au¿_út
;

1822 ià(!
hw
->
poŞ_út
)

1823  -
EINVAL
;

1825 
q£t
->
poŞ
 = 
	`devm_kz®loc
(
pfvf
->
dev
, (
Ùx2_poŞ
) *

1826 
hw
->
poŞ_út
, 
GFP_KERNEL
);

1827 ià(!
q£t
->
poŞ
)

1828  -
ENOMEM
;

1831 
Å®f
 = 
	`Ùx2_mbox_®loc_msg_Åa_lf_®loc
(&
pfvf
->
mbox
);

1832 ià(!
Å®f
)

1833  -
ENOMEM
;

1836 
Å®f
->
Ä_poŞs
 = 
hw
->
poŞ_út
;

1837 
au¿_út
 = 
	`og2
(
	`roundup_pow_of_two
(
hw
->
poŞ_út
));

1838 
Å®f
->
au¿_sz
 = (
au¿_út
 >ğ
	`og2
(128)) ? (aura_cnt - 6) : 1;

1840  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1841 
	}
}

1843 
	$Ùx2_d‘ach_»sourûs
(
mbox
 *mbox)

1845 
r¤c_d‘ach
 *
d‘ach
;

1847 
	`mu‹x_lock
(&
mbox
->
lock
);

1848 
d‘ach
 = 
	`Ùx2_mbox_®loc_msg_d‘ach_»sourûs
(
mbox
);

1849 ià(!
d‘ach
) {

1850 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1851  -
ENOMEM
;

1855 
d‘ach
->
·¹Ÿl
 = 
çl£
;

1858 
	`Ùx2_mbox_msg_£nd
(&
mbox
->mbox, 0);

1859 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1861 
	}
}

1862 
EXPORT_SYMBOL
(
Ùx2_d‘ach_»sourûs
);

1864 
	$Ùx2_©ch_Åa_nix
(
Ùx2_nic
 *
pfvf
)

1866 
r¤c_©ch
 *
©ch
;

1867 
msg_»q
 *
msix
;

1868 
”r
;

1870 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1872 
©ch
 = 
	`Ùx2_mbox_®loc_msg_©ch_»sourûs
(&
pfvf
->
mbox
);

1873 ià(!
©ch
) {

1874 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1875  -
ENOMEM
;

1878 
©ch
->
Å®f
 = 
Œue
;

1879 
©ch
->
nixlf
 = 
Œue
;

1882 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1883 ià(
”r
) {

1884 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1885  
”r
;

1888 
pfvf
->
nix_blkaddr
 = 
BLKADDR_NIX0
;

1893 ià(
	`Ùx2_»ad64
(
pfvf
, 
	`RVU_PF_BLOCK_ADDRX_DISC
(
BLKADDR_NIX1
)) & 0x1FFULL)

1894 
pfvf
->
nix_blkaddr
 = 
BLKADDR_NIX1
;

1897 
msix
 = 
	`Ùx2_mbox_®loc_msg_msix_off£t
(&
pfvf
->
mbox
);

1898 ià(!
msix
) {

1899 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1900  -
ENOMEM
;

1903 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1904 ià(
”r
) {

1905 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1906  
”r
;

1908 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1910 ià(
pfvf
->
hw
.
Åa_msixoff
 =ğ
MSIX_VECTOR_INVALID
 ||

1911 
pfvf
->
hw
.
nix_msixoff
 =ğ
MSIX_VECTOR_INVALID
) {

1912 
	`dev_”r
(
pfvf
->
dev
,

1914  -
EINVAL
;

1918 
	}
}

1919 
EXPORT_SYMBOL
(
Ùx2_©ch_Åa_nix
);

1921 
	$Ùx2_ùx_di§bË
(
mbox
 *mbox, 
ty³
, 
boŞ
 
Åa
)

1923 
hwùx_di§bË_»q
 *
»q
;

1925 
	`mu‹x_lock
(&
mbox
->
lock
);

1927 ià(
Åa
)

1928 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åa_hwùx_di§bË
(
mbox
);

1930 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_hwùx_di§bË
(
mbox
);

1932 ià(!
»q
) {

1933 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1937 
»q
->
ùy³
 = 
ty³
;

1939 ià(
	`Ùx2_sync_mbox_msg
(
mbox
))

1940 
	`dev_”r
(
mbox
->
pfvf
->
dev
, "%s failedo disable context\n",

1941 
__func__
);

1943 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1944 
	}
}

1946 
	$Ùx2_nix_cÚfig_bp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
)

1948 
nix_bp_cfg_»q
 *
»q
;

1950 ià(
’abË
)

1951 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_bp_’abË
(&
pfvf
->
mbox
);

1953 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_bp_di§bË
(&
pfvf
->
mbox
);

1955 ià(!
»q
)

1956  -
ENOMEM
;

1958 
»q
->
chª_ba£
 = 0;

1959 #ifdeà
CONFIG_DCB


1960 
»q
->
chª_út
 = 
pfvf
->
pfc_’
 ? 
IEEE_8021QAZ_MAX_TCS
 :…fvf->
hw
.
rx_chª_út
;

1961 
»q
->
bpid_³r_chª
 = 
pfvf
->
pfc_’
 ? 1 : 0;

1963 
»q
->
chª_út
 = 
pfvf
->
hw
.
rx_chª_út
;

1964 
»q
->
bpid_³r_chª
 = 0;

1967  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1968 
	}
}

1969 
EXPORT_SYMBOL
(
Ùx2_nix_cÚfig_bp
);

1972 
	$mbox_hªdËr_cgx_¡©s
(
Ùx2_nic
 *
pfvf
,

1973 
cgx_¡©s_r¥
 *
r¥
)

1975 
id
;

1977 
id
 = 0; id < 
CGX_RX_STATS_COUNT
; id++)

1978 
pfvf
->
hw
.
cgx_rx_¡©s
[
id
] = 
r¥
->
rx_¡©s
[id];

1979 
id
 = 0; id < 
CGX_TX_STATS_COUNT
; id++)

1980 
pfvf
->
hw
.
cgx_tx_¡©s
[
id
] = 
r¥
->
tx_¡©s
[id];

1981 
	}
}

1983 
	$mbox_hªdËr_cgx_ãc_¡©s
(
Ùx2_nic
 *
pfvf
,

1984 
cgx_ãc_¡©s_r¥
 *
r¥
)

1986 
pfvf
->
hw
.
cgx_ãc_cÜr_blks
 +ğ
r¥
->
ãc_cÜr_blks
;

1987 
pfvf
->
hw
.
cgx_ãc_uncÜr_blks
 +ğ
r¥
->
ãc_uncÜr_blks
;

1988 
	}
}

1990 
	$mbox_hªdËr_Åa_lf_®loc
(
Ùx2_nic
 *
pfvf
,

1991 
Åa_lf_®loc_r¥
 *
r¥
)

1993 
pfvf
->
hw
.
¡ack_pg_±rs
 = 
r¥
->stack_pg_ptrs;

1994 
pfvf
->
hw
.
¡ack_pg_by‹s
 = 
r¥
->stack_pg_bytes;

1995 
	}
}

1996 
EXPORT_SYMBOL
(
mbox_hªdËr_Åa_lf_®loc
);

1998 
	$mbox_hªdËr_nix_lf_®loc
(
Ùx2_nic
 *
pfvf
,

1999 
nix_lf_®loc_r¥
 *
r¥
)

2001 
pfvf
->
hw
.
sqb_size
 = 
r¥
->sqb_size;

2002 
pfvf
->
hw
.
rx_chª_ba£
 = 
r¥
->rx_chan_base;

2003 
pfvf
->
hw
.
tx_chª_ba£
 = 
r¥
->tx_chan_base;

2004 
pfvf
->
hw
.
rx_chª_út
 = 
r¥
->rx_chan_cnt;

2005 
pfvf
->
hw
.
tx_chª_út
 = 
r¥
->tx_chan_cnt;

2006 
pfvf
->
hw
.
lso_tsov4_idx
 = 
r¥
->lso_tsov4_idx;

2007 
pfvf
->
hw
.
lso_tsov6_idx
 = 
r¥
->lso_tsov6_idx;

2008 
pfvf
->
hw
.
cgx_lšks
 = 
r¥
->cgx_links;

2009 
pfvf
->
hw
.
lbk_lšks
 = 
r¥
->lbk_links;

2010 
pfvf
->
hw
.
tx_lšk
 = 
r¥
->tx_link;

2011 
	}
}

2012 
EXPORT_SYMBOL
(
mbox_hªdËr_nix_lf_®loc
);

2014 
	$mbox_hªdËr_msix_off£t
(
Ùx2_nic
 *
pfvf
,

2015 
msix_off£t_r¥
 *
r¥
)

2017 
pfvf
->
hw
.
Åa_msixoff
 = 
r¥
->npa_msixoff;

2018 
pfvf
->
hw
.
nix_msixoff
 = 
r¥
->nix_msixoff;

2019 
	}
}

2020 
EXPORT_SYMBOL
(
mbox_hªdËr_msix_off£t
);

2022 
	$mbox_hªdËr_nix_bp_’abË
(
Ùx2_nic
 *
pfvf
,

2023 
nix_bp_cfg_r¥
 *
r¥
)

2025 
chª
, 
chª_id
;

2027 
chª
 = 0; chª < 
r¥
->
chª_út
; chan++) {

2028 
chª_id
 = ((
r¥
->
chª_bpid
[
chª
] >> 10) & 0x7F);

2029 
pfvf
->
bpid
[
chª_id
] = 
r¥
->
chª_bpid
[
chª
] & 0x3FF;

2031 
	}
}

2032 
EXPORT_SYMBOL
(
mbox_hªdËr_nix_bp_’abË
);

2034 
	$Ùx2_ä“_cšts
(
Ùx2_nic
 *
pfvf
, 
n
)

2036 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

2037 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

2038 
œq
, 
qidx
;

2040 
qidx
 = 0, 
œq
 = 
hw
->
nix_msixoff
 + 
NIX_LF_CINT_VEC_START
;

2041 
qidx
 < 
n
;

2042 
qidx
++, 
œq
++) {

2043 
veùÜ
 = 
	`pci_œq_veùÜ
(
pfvf
->
pdev
, 
œq
);

2045 
	`œq_£t_affš™y_hšt
(
veùÜ
, 
NULL
);

2046 
	`ä“_ıumask_v¬
(
hw
->
affš™y_mask
[
œq
]);

2047 
	`ä“_œq
(
veùÜ
, &
q£t
->
Çpi
[
qidx
]);

2049 
	}
}

2051 
	$Ùx2_£t_cšts_affš™y
(
Ùx2_nic
 *
pfvf
)

2053 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

2054 
vec
, 
ıu
, 
œq
, 
cšt
;

2056 
vec
 = 
hw
->
nix_msixoff
 + 
NIX_LF_CINT_VEC_START
;

2057 
ıu
 = 
	`ıumask_fœ¡
(
ıu_Úlše_mask
);

2060 
cšt
 = 0; cšˆ< 
pfvf
->
hw
.
cšt_út
; cšt++, 
vec
++) {

2061 ià(!
	`®loc_ıumask_v¬
(&
hw
->
affš™y_mask
[
vec
], 
GFP_KERNEL
))

2064 
	`ıumask_£t_ıu
(
ıu
, 
hw
->
affš™y_mask
[
vec
]);

2066 
œq
 = 
	`pci_œq_veùÜ
(
pfvf
->
pdev
, 
vec
);

2067 
	`œq_£t_affš™y_hšt
(
œq
, 
hw
->
affš™y_mask
[
vec
]);

2069 
ıu
 = 
	`ıumask_Ãxt
(ıu, 
ıu_Úlše_mask
);

2070 ià(
	`uÆik–y
(
ıu
 >ğ
Ä_ıu_ids
))

2071 
ıu
 = 0;

2073 
	}
}

2075 
u32
 
	$g‘_dw¼_mtu
(
Ùx2_nic
 *
pfvf
, 
nix_hw_šfo
 *
hw
)

2077 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
)) {

2078 
pfvf
->
hw
.
smq_lšk_ty³
 = 
SMQ_LINK_TYPE_LBK
;

2079  
hw
->
lbk_dw¼_mtu
;

2082 ià(
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
)) {

2083 
pfvf
->
hw
.
smq_lšk_ty³
 = 
SMQ_LINK_TYPE_SDP
;

2084  
hw
->
sdp_dw¼_mtu
;

2087 
pfvf
->
hw
.
smq_lšk_ty³
 = 
SMQ_LINK_TYPE_RPM
;

2088  
hw
->
½m_dw¼_mtu
;

2089 
	}
}

2091 
u16
 
	$Ùx2_g‘_max_mtu
(
Ùx2_nic
 *
pfvf
)

2093 
nix_hw_šfo
 *
r¥
;

2094 
msg_»q
 *
»q
;

2095 
u16
 
max_mtu
;

2096 
rc
;

2098 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

2100 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_g‘_hw_šfo
(&
pfvf
->
mbox
);

2101 ià(!
»q
) {

2102 
rc
 = -
ENOMEM
;

2103 
out
;

2106 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

2107 ià(!
rc
) {

2108 
r¥
 = (
nix_hw_šfo
 *)

2109 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

2117 
max_mtu
 = 
r¥
->max_mtu - 8 - 
OTX2_ETH_HLEN
;

2120 
pfvf
->
hw
.
dw¼_mtu
 = 
	`g‘_dw¼_mtu
Õfvf, 
r¥
);

2121 ià(!
pfvf
->
hw
.
dw¼_mtu
)

2122 
pfvf
->
hw
.
dw¼_mtu
 = 1;

2125 
out
:

2126 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2127 ià(
rc
) {

2128 
	`dev_w¬n
(
pfvf
->
dev
,

2130 
max_mtu
 = 1500;

2132  
max_mtu
;

2133 
	}
}

2134 
EXPORT_SYMBOL
(
Ùx2_g‘_max_mtu
);

2136 
	$Ùx2_hªdË_Áu¶e_tc_ã©u»s
(
Ãt_deviû
 *
Ãtdev
, 
Ãtdev_ã©u»s_t
 
ã©u»s
)

2138 
Ãtdev_ã©u»s_t
 
chªged
 = 
ã©u»s
 ^ 
Ãtdev
->features;

2139 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2140 
boŞ
 
Áu¶e
 = !!(
ã©u»s
 & 
NETIF_F_NTUPLE
);

2141 
boŞ
 
tc
 = !!(
ã©u»s
 & 
NETIF_F_HW_TC
);

2143 ià((
chªged
 & 
NETIF_F_NTUPLE
è&& !
Áu¶e
)

2144 
	`Ùx2_de¡roy_Áu¶e_æows
(
pfvf
);

2146 ià((
chªged
 & 
NETIF_F_NTUPLE
è&& 
Áu¶e
) {

2147 ià(!
pfvf
->
æow_cfg
->
max_æows
) {

2148 
	`Ãtdev_”r
(
Ãtdev
,

2150  -
EINVAL
;

2154 ià((
chªged
 & 
NETIF_F_HW_TC
è&& 
tc
) {

2155 ià(!
pfvf
->
æow_cfg
->
max_æows
) {

2156 
	`Ãtdev_”r
(
Ãtdev
,

2158  -
EINVAL
;

2162 ià((
chªged
 & 
NETIF_F_HW_TC
è&& !
tc
 &&

2163 
pfvf
->
æow_cfg
 &&…fvf->æow_cfg->
Ä_æows
) {

2164 
	`Ãtdev_”r
(
Ãtdev
, "Can't disable TC hardware offload while flows‡re‡ctive\n");

2165  -
EBUSY
;

2168 ià((
chªged
 & 
NETIF_F_NTUPLE
è&& 
Áu¶e
 &&

2169 (
Ãtdev
->
ã©u»s
 & 
NETIF_F_HW_TC
è&& !(
chªged
 & NETIF_F_HW_TC)) {

2170 
	`Ãtdev_”r
(
Ãtdev
,

2172  -
EINVAL
;

2175 ià((
chªged
 & 
NETIF_F_HW_TC
è&& 
tc
 &&

2176 (
Ãtdev
->
ã©u»s
 & 
NETIF_F_NTUPLE
è&& !(
chªged
 & NETIF_F_NTUPLE)) {

2177 
	`Ãtdev_”r
(
Ãtdev
,

2179  -
EINVAL
;

2183 
	}
}

2184 
EXPORT_SYMBOL
(
Ùx2_hªdË_Áu¶e_tc_ã©u»s
);

2186 
	$Ùx2_smq_æush
(
Ùx2_nic
 *
pfvf
, 
smq
)

2188 
nix_txschq_cÚfig
 *
»q
;

2189 
rc
;

2191 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

2193 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txschq_cfg
(&
pfvf
->
mbox
);

2194 ià(!
»q
) {

2195 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2196  -
ENOMEM
;

2199 
»q
->
lvl
 = 
NIX_TXSCH_LVL_SMQ
;

2200 
»q
->
»g
[0] = 
	`NIX_AF_SMQX_CFG
(
smq
);

2201 
»q
->
»gv®
[0] |ğ
	`BIT_ULL
(49);

2202 
»q
->
num_»gs
++;

2204 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

2205 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2206  
rc
;

2207 
	}
}

2209 
	#M
(
_Çme
, 
_id
, 
_â_Çme
, 
_»q_ty³
, 
_r¥_ty³
) \

2210 
__w—k
 \

2211 
Ùx2_mbox_up_hªdËr_
 ## 
	`_â_Çme
(
Ùx2_nic
 *
pfvf
, \

2212 
_»q_ty³
 *
»q
, \

2213 
_r¥_ty³
 *
r¥
) \

2218 
	`EXPORT_SYMBOL
(
Ùx2_mbox_up_hªdËr_
 ## 
_â_Çme
);

	)

2219 
	gMBOX_UP_CGX_MESSAGES


2220 #undeà
M


	@otx2_common.h

8 #iâdeà
OTX2_COMMON_H


9 
	#OTX2_COMMON_H


	)

11 
	~<lšux/pci.h
>

12 
	~<lšux/±p_şock_k”Ãl.h
>

13 
	~<lšux/timecouÁ”.h
>

14 
	~<lšux/soc/m¬v–l/oùeÚtx2/asm.h
>

15 
	~<lšux/iommu.h
>

16 
	~<Ãt/pkt_şs.h
>

17 
	~<Ãt/devlšk.h
>

18 
	~<lšux/time64.h
>

19 
	~<lšux/dim.h
>

21 
	~<mbox.h
>

22 
	~<Åc.h
>

23 
	~"Ùx2_»g.h
"

24 
	~"Ùx2_txrx.h
"

25 
	~"Ùx2_devlšk.h
"

26 
	~<rvu_Œaû.h
>

27 
	~"qos.h
"

30 
	#PCI_DEVID_OCTEONTX2_RVU_PF
 0xA063

	)

31 
	#PCI_DEVID_OCTEONTX2_RVU_VF
 0xA064

	)

32 
	#PCI_DEVID_OCTEONTX2_SDP_VF
 0xA0F7

	)

33 
	#PCI_DEVID_OCTEONTX2_RVU_AFVF
 0xA0F8

	)

35 
	#PCI_SUBSYS_DEVID_96XX_RVU_PFVF
 0xB200

	)

38 
	#PCI_CFG_REG_BAR_NUM
 2

	)

39 
	#PCI_MBOX_BAR_NUM
 4

	)

41 
	#NAME_SIZE
 32

	)

44 
	#NIX_PF_PFC_PRIO_MAX
 8

	)

46 
	e¬ua_m­³d_qty³s
 {

47 
	mAURA_NIX_RQ
,

48 
	mAURA_NIX_SQ
,

52 
	#NIX_LF_QINT_VEC_START
 0x00

	)

53 
	#NIX_LF_CINT_VEC_START
 0x40

	)

54 
	#NIX_LF_GINT_VEC
 0x80

	)

55 
	#NIX_LF_ERR_VEC
 0x81

	)

56 
	#NIX_LF_POISON_VEC
 0x82

	)

59 
	#SEND_CQ_SKID
 2000

	)

61 
	#OTX2_GET_RX_STATS
(
»g
) \

62 
	`Ùx2_»ad64
(
pfvf
, 
	`NIX_LF_RX_STATX
(
»g
))

	)

63 
	#OTX2_GET_TX_STATS
(
»g
) \

64 
	`Ùx2_»ad64
(
pfvf
, 
	`NIX_LF_TX_STATX
(
»g
))

	)

66 
	sÙx2_lmt_šfo
 {

67 
u64
 
	mlmt_addr
;

68 
u16
 
	mlmt_id
;

71 
	sÙx2_rss_ùx
 {

72 
u8
 
	mšd_tbl
[
MAX_RSS_INDIR_TBL_SIZE
];

75 
	sÙx2_rss_šfo
 {

76 
u8
 
	m’abË
;

77 
u32
 
	mæowkey_cfg
;

78 
u16
 
	mrss_size
;

79 
	#RSS_HASH_KEY_SIZE
 44

	)

80 
u8
 
	mkey
[
RSS_HASH_KEY_SIZE
];

81 
Ùx2_rss_ùx
 *
	mrss_ùx
[
MAX_RSS_GROUPS
];

85 
	eÙx2_”¾vl
 {

86 
	mNPC_ERRLVL_RE
,

87 
	mNPC_ERRLVL_LID_LA
,

88 
	mNPC_ERRLVL_LID_LB
,

89 
	mNPC_ERRLVL_LID_LC
,

90 
	mNPC_ERRLVL_LID_LD
,

91 
	mNPC_ERRLVL_LID_LE
,

92 
	mNPC_ERRLVL_LID_LF
,

93 
	mNPC_ERRLVL_LID_LG
,

94 
	mNPC_ERRLVL_LID_LH
,

95 
	mNPC_ERRLVL_NIX
 = 0x0F,

98 
	eÙx2_”rcodes_»
 {

100 
	mERRCODE_FCS
 = 0x7,

101 
	mERRCODE_FCS_RCV
 = 0x8,

102 
	mERRCODE_UNDERSIZE
 = 0x10,

103 
	mERRCODE_OVERSIZE
 = 0x11,

104 
	mERRCODE_OL2_LEN_MISMATCH
 = 0x12,

106 
	mERRCODE_OL3_LEN
 = 0x10,

107 
	mERRCODE_OL4_LEN
 = 0x11,

108 
	mERRCODE_OL4_CSUM
 = 0x12,

109 
	mERRCODE_IL3_LEN
 = 0x20,

110 
	mERRCODE_IL4_LEN
 = 0x21,

111 
	mERRCODE_IL4_CSUM
 = 0x22,

115 
	enix_¡©_lf_tx
 {

116 
	mTX_UCAST
 = 0x0,

117 
	mTX_BCAST
 = 0x1,

118 
	mTX_MCAST
 = 0x2,

119 
	mTX_DROP
 = 0x3,

120 
	mTX_OCTS
 = 0x4,

121 
	mTX_STATS_ENUM_LAST
,

125 
	enix_¡©_lf_rx
 {

126 
	mRX_OCTS
 = 0x0,

127 
	mRX_UCAST
 = 0x1,

128 
	mRX_BCAST
 = 0x2,

129 
	mRX_MCAST
 = 0x3,

130 
	mRX_DROP
 = 0x4,

131 
	mRX_DROP_OCTS
 = 0x5,

132 
	mRX_FCS
 = 0x6,

133 
	mRX_ERR
 = 0x7,

134 
	mRX_DRP_BCAST
 = 0x8,

135 
	mRX_DRP_MCAST
 = 0x9,

136 
	mRX_DRP_L3BCAST
 = 0xa,

137 
	mRX_DRP_L3MCAST
 = 0xb,

138 
	mRX_STATS_ENUM_LAST
,

141 
	sÙx2_dev_¡©s
 {

142 
u64
 
	mrx_by‹s
;

143 
u64
 
	mrx_äames
;

144 
u64
 
	mrx_uÿ¡_äames
;

145 
u64
 
	mrx_bÿ¡_äames
;

146 
u64
 
	mrx_mÿ¡_äames
;

147 
u64
 
	mrx_drİs
;

149 
u64
 
	mtx_by‹s
;

150 
u64
 
	mtx_äames
;

151 
u64
 
	mtx_uÿ¡_äames
;

152 
u64
 
	mtx_bÿ¡_äames
;

153 
u64
 
	mtx_mÿ¡_äames
;

154 
u64
 
	mtx_drİs
;

158 
	sÙx2_drv_¡©s
 {

159 
©omic_t
 
	mrx_fcs_”rs
;

160 
©omic_t
 
	mrx_ov”size_”rs
;

161 
©omic_t
 
	mrx_und”size_”rs
;

162 
©omic_t
 
	mrx_csum_”rs
;

163 
©omic_t
 
	mrx_Ën_”rs
;

164 
©omic_t
 
	mrx_Ùh”_”rs
;

167 
	smbox
 {

168 
Ùx2_mbox
 
	mmbox
;

169 
wÜk_¡ruù
 
	mmbox_wrk
;

170 
Ùx2_mbox
 
	mmbox_up
;

171 
wÜk_¡ruù
 
	mmbox_up_wrk
;

172 
Ùx2_nic
 *
	mpfvf
;

173 *
	mbbuf_ba£
;

174 
mu‹x
 
	mlock
;

175 
	mnum_msgs
;

176 
	mup_num_msgs
;

179 
	sÙx2_hw
 {

180 
pci_dev
 *
	mpdev
;

181 
Ùx2_rss_šfo
 
	mrss_šfo
;

182 
u16
 
	mrx_queues
;

183 
u16
 
	mtx_queues
;

184 
u16
 
	mxdp_queues
;

185 
u16
 
	mtc_tx_queues
;

186 
u16
 
	mtÙ_tx_queues
;

187 
u16
 
	mmax_queues
;

188 
u16
 
	mpoŞ_út
;

189 
u16
 
	mrqpoŞ_út
;

190 
u16
 
	msqpoŞ_út
;

191 
u16
 
	mxqe_size
;

193 
	#OTX2_DEFAULT_RBUF_LEN
 2048

	)

194 
u16
 
	mrbuf_fixed_size
;

197 
u32
 
	m¡ack_pg_±rs
;

198 
u32
 
	m¡ack_pg_by‹s
;

199 
u16
 
	msqb_size
;

202 
u8
 
	mtxschq_lšk_cfg_lvl
;

203 
u8
 
	mtxschq_aggr_lvl_¼_´io
;

204 
u16
 
	mtxschq_li¡
[
NIX_TXSCH_LVL_CNT
][
MAX_TXSCHQ_PER_FUNC
];

205 
u16
 
	mm©ch®l_Şiûr
;

206 
u32
 
	mdw¼_mtu
;

207 
u8
 
	msmq_lšk_ty³
;

210 
u16
 
	mrx_chª_ba£
;

211 
u16
 
	mtx_chª_ba£
;

212 
u8
 
	mrx_chª_út
;

213 
u8
 
	mtx_chª_út
;

214 
u16
 
	mcq_qcouÁ_wa™
;

215 
u16
 
	mcq_ecouÁ_wa™
;

216 
u16
 
	mrq_skid
;

217 
u8
 
	mcq_time_wa™
;

220 
u8
 
	mlso_tsov4_idx
;

221 
u8
 
	mlso_tsov6_idx
;

222 
u8
 
	mlso_udpv4_idx
;

223 
u8
 
	mlso_udpv6_idx
;

226 
u8
 
	mæowkey_®g_idx
;

229 
u8
 
	mcšt_út
;

230 
u16
 
	mÅa_msixoff
;

231 
u16
 
	mnix_msixoff
;

232 *
	mœq_Çme
;

233 
ıumask_v¬_t
 *
	maffš™y_mask
;

236 
Ùx2_dev_¡©s
 
	mdev_¡©s
;

237 
Ùx2_drv_¡©s
 
	mdrv_¡©s
;

238 
u64
 
	mcgx_rx_¡©s
[
CGX_RX_STATS_COUNT
];

239 
u64
 
	mcgx_tx_¡©s
[
CGX_TX_STATS_COUNT
];

240 
u64
 
	mcgx_ãc_cÜr_blks
;

241 
u64
 
	mcgx_ãc_uncÜr_blks
;

242 
u8
 
	mcgx_lšks
;

243 
u8
 
	mlbk_lšks
;

244 
u8
 
	mtx_lšk
;

245 
	#HW_TSO
 0

	)

246 
	#CN10K_MBOX
 1

	)

247 
	#CN10K_LMTST
 2

	)

248 
	#CN10K_RPM
 3

	)

249 
	#CN10K_PTP_ONESTEP
 4

	)

250 
	#QOS_CIR_PIR_SUPPORT
 5

	)

251 
	mÿp_æag
;

253 
	#LMT_LINE_SIZE
 128

	)

254 
	#LMT_BURST_SIZE
 32

	)

255 
u64
 *
	mlmt_ba£
;

256 
Ùx2_lmt_šfo
 
__³rıu
 *
	mlmt_šfo
;

259 
	svfvÏn
 {

260 
u16
 
	mvÏn
;

261 
u16
 
	m´Ùo
;

262 
u8
 
	mqos
;

265 
	evå”m
 {

266 
	mOTX2_RESET_VF_PERM
,

267 
	mOTX2_TRUSTED_VF
,

270 
	sÙx2_vf_cÚfig
 {

271 
Ùx2_nic
 *
	mpf
;

272 
d–ayed_wÜk
 
	mlšk_ev’t_wÜk
;

273 
d–ayed_wÜk
 
	m±p_šfo_wÜk
;

274 
boŞ
 
	mštf_down
;

275 
u8
 
	mmac
[
ETH_ALEN
];

276 
u16
 
	mvÏn
;

277 
	mtx_vg_idx
;

278 
vfvÏn
 
	mruË
;

279 
boŞ
 
	mŒu¡ed
;

282 
	sær_wÜk
 {

283 
wÜk_¡ruù
 
	mwÜk
;

284 
Ùx2_nic
 *
	mpf
;

287 
	s»fl_wÜk
 {

288 
d–ayed_wÜk
 
	mpoŞ_»fl_wÜk
;

289 
Ùx2_nic
 *
	mpf
;

293 
	s±pv2_t¡amp
 {

294 
u16
 
	m£cÚds_msb
;

295 
u32
 
	m£cÚds_lsb
;

296 
u32
 
	mÇno£cÚds
;

297 } 
	g__·cked
;

299 
	sÙx2_±p
 {

300 
±p_şock_šfo
 
	m±p_šfo
;

301 
±p_şock
 *
	m±p_şock
;

302 
Ùx2_nic
 *
	mnic
;

304 
cyşecouÁ”
 
	mcyşe_couÁ”
;

305 
timecouÁ”
 
	mtime_couÁ”
;

307 
d–ayed_wÜk
 
	mex‰s_wÜk
;

308 
u64
 
	mÏ¡_ex‰s
;

309 
u64
 
	mth»sh
;

311 
±p_pš_desc
 
	mex‰s_cÚfig
;

312 
boŞ
 
	m±p_’
;

313 
u64
 (*
cÚv”t_rx_±p_t¡mp
)(u64 
	mtime¡amp
);

314 
u64
 (*
cÚv”t_tx_±p_t¡mp
)(u64 
	mtime¡amp
);

315 
d–ayed_wÜk
 
	msynù¡amp_wÜk
;

316 
u64
 
	mt¡amp
;

317 
u32
 
	mba£_ns
;

320 
	sÙx2_mac_bË
 {

321 
u8
 
	maddr
[
ETH_ALEN
];

322 
u16
 
	mmÿm_’Œy
;

323 
boŞ
 
	mšu£
;

326 
	sÙx2_æow_cÚfig
 {

327 
u16
 *
	mæow_’t
;

328 
u16
 *
	mdef_’t
;

329 
u16
 
	mÄ_æows
;

330 
	#OTX2_DEFAULT_FLOWCOUNT
 16

	)

331 
	#OTX2_MAX_UNICAST_FLOWS
 8

	)

332 
	#OTX2_MAX_VLAN_FLOWS
 1

	)

333 
	#OTX2_MAX_TC_FLOWS
 
OTX2_DEFAULT_FLOWCOUNT


	)

334 
	#OTX2_MCAM_COUNT
 (
OTX2_DEFAULT_FLOWCOUNT
 + \

335 
OTX2_MAX_UNICAST_FLOWS
 + \

336 
OTX2_MAX_VLAN_FLOWS
)

	)

337 
u16
 
	muniÿ¡_off£t
;

338 
u16
 
	mrx_vÏn_off£t
;

339 
u16
 
	mvf_vÏn_off£t
;

340 
	#OTX2_PER_VF_VLAN_FLOWS
 2

	)

341 
	#OTX2_VF_VLAN_RX_INDEX
 0

	)

342 
	#OTX2_VF_VLAN_TX_INDEX
 1

	)

343 
u16
 
	mmax_æows
;

344 
u8
 
	mdmacæt_max_æows
;

345 
u32
 *
	mbm­_to_dmacšdex
;

346 *
	mdmacæt_bm­
;

347 
li¡_h—d
 
	mæow_li¡
;

350 
	sÙx2_tc_šfo
 {

352 
rhashbË
 
	mæow_bË
;

353 
rhashbË_·¿ms
 
	mæow_ht_·¿ms
;

354 *
	mtc_’Œ›s_b™m­
;

357 
	sdev_hw_İs
 {

358 (*
	msq_aq_š™
)(*
	mdev
, 
u16
 
	mqidx
, 
u8
 
	mchª_off£t
, u16 
	msqb_au¿
);

359 (*
	msqe_æush
)(*
	mdev
, 
Ùx2_¢d_queue
 *
	msq
,

360 
	msize
, 
	mqidx
);

361 (*
	m»fl_poŞ_±rs
)(*
	mdev
, 
Ùx2_cq_queue
 *
	mcq
);

362 (*
	mau¿_ä“±r
)(*
	mdev
, 
	mau¿
, 
u64
 
	mbuf
);

365 
	sÙx2_nic
 {

366 
__iomem
 *
	m»g_ba£
;

367 
Ãt_deviû
 *
	mÃtdev
;

368 
dev_hw_İs
 *
	mhw_İs
;

369 *
	miommu_domaš
;

370 
u16
 
	miommu_domaš_ty³
;

371 
u16
 
	mxŒa_hdr
;

372 
u16
 
	mtx_max_pk’
;

373 
u16
 
	mrbsize
;

375 
	#OTX2_FLAG_RX_TSTAMP_ENABLED
 
	`BIT_ULL
(0)

	)

376 
	#OTX2_FLAG_TX_TSTAMP_ENABLED
 
	`BIT_ULL
(1)

	)

377 
	#OTX2_FLAG_INTF_DOWN
 
	`BIT_ULL
(2)

	)

378 
	#OTX2_FLAG_MCAM_ENTRIES_ALLOC
 
	`BIT_ULL
(3)

	)

379 
	#OTX2_FLAG_NTUPLE_SUPPORT
 
	`BIT_ULL
(4)

	)

380 
	#OTX2_FLAG_UCAST_FLTR_SUPPORT
 
	`BIT_ULL
(5)

	)

381 
	#OTX2_FLAG_RX_VLAN_SUPPORT
 
	`BIT_ULL
(6)

	)

382 
	#OTX2_FLAG_VF_VLAN_SUPPORT
 
	`BIT_ULL
(7)

	)

383 
	#OTX2_FLAG_PF_SHUTDOWN
 
	`BIT_ULL
(8)

	)

384 
	#OTX2_FLAG_RX_PAUSE_ENABLED
 
	`BIT_ULL
(9)

	)

385 
	#OTX2_FLAG_TX_PAUSE_ENABLED
 
	`BIT_ULL
(10)

	)

386 
	#OTX2_FLAG_TC_FLOWER_SUPPORT
 
	`BIT_ULL
(11)

	)

387 
	#OTX2_FLAG_TC_MATCHALL_EGRESS_ENABLED
 
	`BIT_ULL
(12)

	)

388 
	#OTX2_FLAG_TC_MATCHALL_INGRESS_ENABLED
 
	`BIT_ULL
(13)

	)

389 
	#OTX2_FLAG_DMACFLTR_SUPPORT
 
	`BIT_ULL
(14)

	)

390 
	#OTX2_FLAG_PTP_ONESTEP_SYNC
 
	`BIT_ULL
(15)

	)

391 
	#OTX2_FLAG_ADPTV_INT_COAL_ENABLED
 
	`BIT_ULL
(16)

	)

392 
u64
 
	mæags
;

393 
u64
 *
	mcq_İ_addr
;

395 
bpf_´og
 *
	mxdp_´og
;

396 
Ùx2_q£t
 
	mq£t
;

397 
Ùx2_hw
 
	mhw
;

398 
pci_dev
 *
	mpdev
;

399 
deviû
 *
	mdev
;

402 
mbox
 
	mmbox
;

403 
mbox
 *
	mmbox_pfvf
;

404 
wÜkqueue_¡ruù
 *
	mmbox_wq
;

405 
wÜkqueue_¡ruù
 *
	mmbox_pfvf_wq
;

407 
u8
 
	mtÙ®_vfs
;

408 
u16
 
	mpcifunc
;

409 
u16
 
	mbpid
[
NIX_MAX_BPID_CHAN
];

410 
Ùx2_±p
 *
	m±p
;

411 
Ùx2_vf_cÚfig
 *
	mvf_cÚfigs
;

412 
cgx_lšk_u£r_šfo
 
	mlšfo
;

415 
Ùx2_æow_cÚfig
 *
	mæow_cfg
;

416 
Ùx2_mac_bË
 *
	mmac_bË
;

417 
Ùx2_tc_šfo
 
	mtc_šfo
;

419 
u64
 
	m»£t_couÁ
;

420 
wÜk_¡ruù
 
	m»£t_sk
;

421 
wÜkqueue_¡ruù
 *
	mær_wq
;

422 
ær_wÜk
 *
	mær_wrk
;

423 
»fl_wÜk
 *
	m»fl_wrk
;

424 
wÜkqueue_¡ruù
 *
	mÙx2_wq
;

425 
wÜk_¡ruù
 
	mrx_mode_wÜk
;

428 
u32
 
	mmsg_’abË
;

430 
	#OTX2_PRIV_FLAG_PAM4
 
	`BIT
(0)

	)

431 
	#OTX2_PRIV_FLAG_EDSA_HDR
 
	`BIT
(1)

	)

432 
	#OTX2_PRIV_FLAG_HIGIG2_HDR
 
	`BIT
(2)

	)

433 
	#OTX2_PRIV_FLAG_FDSA_HDR
 
	`BIT
(3)

	)

434 
	#OTX2_INTF_MOD_MASK
 
	`GENMASK
(3, 1)

	)

435 
	#OTX2_PRIV_FLAG_DEF_MODE
 
	`BIT
(4)

	)

436 
	#OTX2_IS_EDSA_ENABLED
(
æags
) ((flags) & \

437 
OTX2_PRIV_FLAG_EDSA_HDR
)

	)

438 
	#OTX2_IS_HIGIG2_ENABLED
(
æags
) ((flags) & \

439 
OTX2_PRIV_FLAG_HIGIG2_HDR
)

	)

440 
	#OTX2_IS_DEF_MODE_ENABLED
(
æags
) ((flags) & \

441 
OTX2_PRIV_FLAG_DEF_MODE
)

	)

442 
	#OTX2_IS_INTFMOD_SET
(
æags
è
	`hweight32
((æagsè& 
OTX2_INTF_MOD_MASK
)

	)

444 
u32
 
	m‘htoŞ_æags
;

449 
	#OTX2_EDSA_HDR_LEN
 16

	)

450 
	#OTX2_HIGIG2_HDR_LEN
 16

	)

451 
	#OTX2_HW_TIMESTAMP_LEN
 8

	)

452 
	#OTX2_FDSA_HDR_LEN
 4

	)

453 
u32
 
	maddl_mtu
;

455 
	mnix_blkaddr
;

456 
qmem
 *
	mdync_lmt
;

457 
u16
 
	mtÙ_lmt_lšes
;

458 
u16
 
	mÅa_lmt_lšes
;

459 
u32
 
	mnix_lmt_size
;

460 
	mrq_bm­
;

463 
Ùx2_devlšk
 *
	mdl
;

464 #ifdeà
CONFIG_DCB


466 
u8
 
	mpfc_’
;

467 
u8
 *
	mqueue_to_pfc_m­
;

468 
u16
 
	mpfc_schq_li¡
[
NIX_TXSCH_LVL_CNT
][
NIX_PF_PFC_PRIO_MAX
];

469 
boŞ
 
	mpfc_®loc_¡©us
[
NIX_PF_PFC_PRIO_MAX
];

472 
Ùx2_qos
 
	mqos
;

475 
u32
 
	mÇpi_ev’ts
;

477 #ifdeà
CONFIG_HAVE_EBPF_JIT


479 
xdp_©chm’t_šfo
 
	m©ch_šfo
;

480 
bpf_ofæßd_dev
 *
	mbpf_dev
;

481 
li¡_h—d
 
	mlm­s
;

482 
boŞ
 
	mÅc_cÚfigu»d
;

483 } 
	mxdp_hw
;

488 
šlše
 
boŞ
 
	$is_Ùx2_lbkvf
(
pci_dev
 *
pdev
)

490  
pdev
->
deviû
 =ğ
PCI_DEVID_OCTEONTX2_RVU_AFVF
;

491 
	}
}

493 
šlše
 
boŞ
 
	$is_Ùx2_sdpvf
(
pci_dev
 *
pdev
)

495  
pdev
->
deviû
 =ğ
PCI_DEVID_OCTEONTX2_SDP_VF
;

496 
	}
}

498 
šlše
 
boŞ
 
	$is_96xx_A0
(
pci_dev
 *
pdev
)

500  (
pdev
->
»visiÚ
 == 0x00);

501 
	}
}

503 
šlše
 
boŞ
 
	$is_96xx_B0
(
pci_dev
 *
pdev
)

505  (
pdev
->
»visiÚ
 == 0x01) &&

506 (
pdev
->
subsy¡em_deviû
 =ğ
PCI_SUBSYS_DEVID_96XX_RVU_PFVF
);

507 
	}
}

509 
šlše
 
boŞ
 
	$is_95xx_A0
(
pci_dev
 *
pdev
)

511  (
pdev
->
»visiÚ
 == 0x10) || (pdev->revision == 0x11);

512 
	}
}

518 
	#PCI_REVISION_ID_96XX
 0x00

	)

519 
	#PCI_REVISION_ID_95XX
 0x10

	)

520 
	#PCI_REVISION_ID_95XXN
 0x20

	)

521 
	#PCI_REVISION_ID_98XX
 0x30

	)

522 
	#PCI_REVISION_ID_95XXMM
 0x40

	)

523 
	#PCI_REVISION_ID_95XXO
 0xE0

	)

525 
šlše
 
boŞ
 
	$is_dev_Ùx2
(
pci_dev
 *
pdev
)

527 
u8
 
midr
 = 
pdev
->
»visiÚ
 & 0xF0;

529  (
midr
 =ğ
PCI_REVISION_ID_96XX
 || mid¸=ğ
PCI_REVISION_ID_95XX
 ||

530 
midr
 =ğ
PCI_REVISION_ID_95XXN
 || mid¸=ğ
PCI_REVISION_ID_98XX
 ||

531 
midr
 =ğ
PCI_REVISION_ID_95XXMM
 || mid¸=ğ
PCI_REVISION_ID_95XXO
);

532 
	}
}

534 
šlše
 
	$Ùx2_£tup_dev_hw_£‰šgs
(
Ùx2_nic
 *
pfvf
)

536 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

538 
pfvf
->
hw
.
cq_time_wa™
 = 
CQ_TIMER_THRESH_DEFAULT
;

539 
pfvf
->
hw
.
cq_ecouÁ_wa™
 = 
CQ_CQE_THRESH_DEFAULT
;

540 
pfvf
->
hw
.
cq_qcouÁ_wa™
 = 
CQ_QCOUNT_DEFAULT
;

542 
	`__£t_b™
(
HW_TSO
, &
hw
->
ÿp_æag
);

544 ià(
	`is_96xx_A0
(
pfvf
->
pdev
è|| 
	`is_95xx_A0
(pfvf->pdev)) {

545 
	`__ş—r_b™
(
HW_TSO
, &
hw
->
ÿp_æag
);

549 
pfvf
->
hw
.
rq_skid
 = 600;

550 
pfvf
->
q£t
.
rqe_út
 = 
	`Q_COUNT
(
Q_SIZE_1K
);

552 ià(
	`is_96xx_A0
(
pfvf
->
pdev
)) {

553 
pfvf
->
hw
.
cq_qcouÁ_wa™
 = 0x0;

559 
pfvf
->
Ãtdev
->
w©chdog_timeo
 = 10000 * 
HZ
;

561 ià(
	`is_96xx_B0
(
pfvf
->
pdev
))

562 
	`__ş—r_b™
(
HW_TSO
, &
hw
->
ÿp_æag
);

564 ià(!
	`is_dev_Ùx2
(
pfvf
->
pdev
)) {

565 
	`__£t_b™
(
CN10K_MBOX
, &
hw
->
ÿp_æag
);

566 
	`__£t_b™
(
CN10K_LMTST
, &
hw
->
ÿp_æag
);

567 
	`__£t_b™
(
CN10K_RPM
, &
hw
->
ÿp_æag
);

568 
	`__£t_b™
(
CN10K_PTP_ONESTEP
, &
hw
->
ÿp_æag
);

569 
	`__£t_b™
(
QOS_CIR_PIR_SUPPORT
, &
hw
->
ÿp_æag
);

571 
	}
}

574 
šlše
 
__iomem
 *
	$Ùx2_g‘_»gaddr
(
Ùx2_nic
 *
nic
, 
u64
 
off£t
)

576 
u64
 
blkaddr
;

578 (
off£t
 >> 
RVU_FUNC_BLKADDR_SHIFT
è& 
RVU_FUNC_BLKADDR_MASK
) {

579 
BLKTYPE_NIX
:

580 
blkaddr
 = 
nic
->
nix_blkaddr
;

582 
BLKTYPE_NPA
:

583 
blkaddr
 = 
BLKADDR_NPA
;

586 
blkaddr
 = 
BLKADDR_RVUM
;

590 
off£t
 &ğ~(
RVU_FUNC_BLKADDR_MASK
 << 
RVU_FUNC_BLKADDR_SHIFT
);

591 
off£t
 |ğ(
blkaddr
 << 
RVU_FUNC_BLKADDR_SHIFT
);

593  
nic
->
»g_ba£
 + 
off£t
;

594 
	}
}

596 
šlše
 
	$Ùx2_wr™e64
(
Ùx2_nic
 *
nic
, 
u64
 
off£t
, u64 
v®
)

598 
__iomem
 *
addr
 = 
	`Ùx2_g‘_»gaddr
(
nic
, 
off£t
);

600 
	`wr™eq
(
v®
, 
addr
);

601 
	}
}

603 
šlše
 
u64
 
	$Ùx2_»ad64
(
Ùx2_nic
 *
nic
, 
u64
 
off£t
)

605 
__iomem
 *
addr
 = 
	`Ùx2_g‘_»gaddr
(
nic
, 
off£t
);

607  
	`»adq
(
addr
);

608 
	}
}

611 
šlše
 
	$Ùx2_mbox_bbuf_š™
(
mbox
 *mbox, 
pci_dev
 *
pdev
)

613 
Ùx2_mbox
 *otx2_mbox;

614 
Ùx2_mbox_dev
 *
mdev
;

616 
mbox
->
bbuf_ba£
 = 
	`devm_km®loc
(&
pdev
->
dev
, 
MBOX_SIZE
, 
GFP_KERNEL
);

617 ià(!
mbox
->
bbuf_ba£
)

618  -
ENOMEM
;

624 
Ùx2_mbox
 = &
mbox
->mbox;

625 
mdev
 = &
Ùx2_mbox
->
dev
[0];

626 
mdev
->
mba£
 = 
mbox
->
bbuf_ba£
;

628 
Ùx2_mbox
 = &
mbox
->
mbox_up
;

629 
mdev
 = &
Ùx2_mbox
->
dev
[0];

630 
mdev
->
mba£
 = 
mbox
->
bbuf_ba£
;

632 
	}
}

634 
šlše
 
	$Ùx2_sync_mbox_bbuf
(
Ùx2_mbox
 *
mbox
, 
devid
)

636 
u16
 
msgs_off£t
 = 
	`ALIGN
((
mbox_hdr
), 
MBOX_MSG_ALIGN
);

637 *
hw_mba£
 = 
mbox
->
hwba£
 + (
devid
 * 
MBOX_SIZE
);

638 
Ùx2_mbox_dev
 *
mdev
 = &
mbox
->
dev
[
devid
];

639 
mbox_hdr
 *
hdr
;

640 
u64
 
msg_size
;

642 ià(
mdev
->
mba£
 =ğ
hw_mba£
)

645 
hdr
 = 
hw_mba£
 + 
mbox
->
rx_¡¬t
;

646 
msg_size
 = 
hdr
->msg_size;

648 ià(
msg_size
 > 
mbox
->
rx_size
 - 
msgs_off£t
)

649 
msg_size
 = 
mbox
->
rx_size
 - 
msgs_off£t
;

652 
	`memıy
(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
,

653 
hw_mba£
 + 
mbox
->
rx_¡¬t
, 
msg_size
 + 
msgs_off£t
);

654 
	}
}

659 #ià
defšed
(
CONFIG_ARM64
)

660 
šlše
 
	$Ùx2_wr™e128
(
u64
 
lo
, u64 
hi
, 
__iomem
 *
addr
)

662 
__asm__
 volatile("stp %x[x0], %x[x1], [%x[p1],#0]!"

663 ::[
x0
]"r"(
lo
), [
x1
]"r"(
hi
), [
p1
]"r"(
addr
));

664 
	}
}

666 
šlše
 
u64
 
	$Ùx2_©omic64_add
(
u64
 
šü
, u64 *
±r
)

668 
u64
 
»suÉ
;

670 
__asm__
 volatile(".cpu generic+lse\n"

672 : [
r
]"ô"(
»suÉ
), "+m"(*
±r
)

673 : [
i
]"r"(
šü
), [
b
]"r"(
±r
)

675  
»suÉ
;

676 
	}
}

679 
	#Ùx2_wr™e128
(
lo
, 
hi
, 
addr
è
	`wr™eq
((hiè| (lo),‡ddr)

	)

680 
	#Ùx2_©omic64_add
(
šü
, 
±r
è({ *±¸+ğšü; })

	)

683 
šlše
 
	$__ú10k_au¿_ä“±r
(
Ùx2_nic
 *
pfvf
, 
u64
 
au¿
,

684 
u64
 *
±rs
, u64 
num_±rs
)

686 
Ùx2_lmt_šfo
 *
lmt_šfo
;

687 
u64
 
size
 = 0, 
couÁ_eÙ
 = 0;

688 
u64
 
r_addr
, 
v®
 = 0;

690 
lmt_šfo
 = 
	`³r_ıu_±r
(
pfvf
->
hw
.lmt_šfo, 
	`smp_´oûssÜ_id
());

691 
r_addr
 = (
__fÜû
 
u64
)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NPA_LF_AURA_BATCH_FREE0
);

693 
v®
 = (
lmt_šfo
->
lmt_id
 & 0x7FFè| 
	`BIT_ULL
(63);

695 
couÁ_eÙ
 = (
num_±rs
 % 2) ? 0ULL : 1ULL;

697 
±rs
[0] = (
couÁ_eÙ
 << 32è| (
au¿
 & 0xFFFFF);

703 ià(
num_±rs
 > 2) {

704 
size
 = ((
u64
è* 
num_±rs
) / 16;

705 ià(!
couÁ_eÙ
)

706 
size
++;

707 
r_addr
 |ğ((
size
 - 1) & 0x7) << 4;

709 
	`dma_wmb
();

710 
	`memıy
((
u64
 *)
lmt_šfo
->
lmt_addr
, 
±rs
, (u64è* 
num_±rs
);

712 
	`ú10k_lmt_æush
(
v®
, 
r_addr
);

713 
	}
}

715 
šlše
 
	$ú10k_au¿_ä“±r
(*
dev
, 
au¿
, 
u64
 
buf
)

717 
Ùx2_nic
 *
pfvf
 = 
dev
;

718 
u64
 
±rs
[2] = {0};

720 
±rs
[1] = 
buf
;

722 
	`__ú10k_au¿_ä“±r
(
pfvf
, 
au¿
, 
±rs
, 2);

723 
	}
}

725 
šlše
 
u64
 
	$Ùx2_au¿_®loıŒ
(
Ùx2_nic
 *
pfvf
, 
au¿
)

727 
u64
 *
±r
 = (u64 *)
	`Ùx2_g‘_»gaddr
(
pfvf
,

728 
	`NPA_LF_AURA_OP_ALLOCX
(0));

729 
u64
 
šü
 = (u64)
au¿
 | 
	`BIT_ULL
(63);

731  
	`Ùx2_©omic64_add
(
šü
, 
±r
);

732 
	}
}

735 
šlše
 
	$Ùx2_au¿_ä“±r
(*
dev
, 
au¿
, 
u64
 
buf
)

737 
Ùx2_nic
 *
pfvf
 = 
dev
;

738 
__iomem
 *
addr
 = 
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NPA_LF_AURA_OP_FREE0
);

740 
	`Ùx2_wr™e128
(
buf
, (
u64
)
au¿
 | 
	`BIT_ULL
(63), 
addr
);

741 
	}
}

743 
šlše
 
	$Ùx2_g‘_poŞ_idx
(
Ùx2_nic
 *
pfvf
, 
ty³
, 
idx
)

745 ià(
ty³
 =ğ
AURA_NIX_SQ
)

746  
pfvf
->
hw
.
rqpoŞ_út
 + 
idx
;

749  
idx
;

750 
	}
}

753 
šlše
 
	$Ùx2_sync_mbox_msg
(
mbox
 *mbox)

755 
”r
;

757 ià(!
	`Ùx2_mbox_nÚem±y
(&
mbox
->mbox, 0))

759 
	`Ùx2_mbox_msg_£nd
(&
mbox
->mbox, 0);

760 
”r
 = 
	`Ùx2_mbox_wa™_fÜ_r¥
(&
mbox
->mbox, 0);

761 ià(
”r
)

762  
”r
;

764  
	`Ùx2_mbox_check_r¥_msgs
(&
mbox
->mbox, 0);

765 
	}
}

767 
šlše
 
	$Ùx2_sync_mbox_up_msg
(
mbox
 *mbox, 
devid
)

769 
”r
;

771 ià(!
	`Ùx2_mbox_nÚem±y
(&
mbox
->
mbox_up
, 
devid
))

773 
	`Ùx2_mbox_msg_£nd
(&
mbox
->
mbox_up
, 
devid
);

774 
”r
 = 
	`Ùx2_mbox_wa™_fÜ_r¥
(&
mbox
->
mbox_up
, 
devid
);

775 ià(
”r
)

776  
”r
;

778  
	`Ùx2_mbox_check_r¥_msgs
(&
mbox
->
mbox_up
, 
devid
);

779 
	}
}

784 
šlše
 
	$Ùx2_sync_mbox_msg_busy_pŞl
(
mbox
 *mbox)

786 
”r
;

788 ià(!
	`Ùx2_mbox_nÚem±y
(&
mbox
->mbox, 0))

790 
	`Ùx2_mbox_msg_£nd
(&
mbox
->mbox, 0);

791 
”r
 = 
	`Ùx2_mbox_busy_pŞl_fÜ_r¥
(&
mbox
->mbox, 0);

792 ià(
”r
)

793  
”r
;

795  
	`Ùx2_mbox_check_r¥_msgs
(&
mbox
->mbox, 0);

796 
	}
}

798 
	#M
(
_Çme
, 
_id
, 
_â_Çme
, 
_»q_ty³
, 
_r¥_ty³
) \

799 
_»q_ty³
 
__maybe_unu£d
 \

800 *
Ùx2_mbox_®loc_msg_
 ## 
	`_â_Çme
(
mbox
 *mbox) \

802 
_»q_ty³
 *
»q
; \

804 
»q
 = (
_»q_ty³
 *)
	`Ùx2_mbox_®loc_msg_r¥
( \

805 &
mbox
->mbox, 0, (
_»q_ty³
), \

806 (
_r¥_ty³
)); \

807 ià(!
»q
) \

808  
NULL
; \

809 
»q
->
hdr
.
sig
 = 
OTX2_MBOX_REQ_SIG
; \

810 
»q
->
hdr
.
id
 = 
_id
; \

811 
	`Œaû_Ùx2_msg_®loc
(
mbox
->mbox.
pdev
, 
_id
, (*
»q
)); \

812  
»q
; \

813 }

	)

815 
	gMBOX_MESSAGES


816 #undeà
M


818 
	#M
(
_Çme
, 
_id
, 
_â_Çme
, 
_»q_ty³
, 
_r¥_ty³
) \

820 
Ùx2_mbox_up_hªdËr_
 ## 
	`_â_Çme
(
Ùx2_nic
 *
pfvf
, \

821 
_»q_ty³
 *
»q
, \

822 
_r¥_ty³
 *
r¥
); \

823 

	)

824 
	gMBOX_UP_CGX_MESSAGES


825 #undeà
M


828 
	#OTX2_TX_TIMEOUT
 (100 * 
HZ
)

	)

830 
	#RVU_PFVF_PF_SHIFT
 10

	)

831 
	#RVU_PFVF_PF_MASK
 0x3F

	)

832 
	#RVU_PFVF_FUNC_SHIFT
 0

	)

833 
	#RVU_PFVF_FUNC_MASK
 0x3FF

	)

835 
šlše
 
boŞ
 
	$is_Ùx2_vf
(
u16
 
pcifunc
)

837  !!(
pcifunc
 & 
RVU_PFVF_FUNC_MASK
);

838 
	}
}

840 
šlše
 
	$rvu_g‘_pf
(
u16
 
pcifunc
)

842  (
pcifunc
 >> 
RVU_PFVF_PF_SHIFT
è& 
RVU_PFVF_PF_MASK
;

843 
	}
}

845 
šlše
 
dma_addr_t
 
	$Ùx2_dma_m­_·ge
(
Ùx2_nic
 *
pfvf
,

846 
·ge
 *page,

847 
size_t
 
off£t
, size_ˆ
size
,

848 
dma_d©a_dœeùiÚ
 
dœ
)

850 
dma_addr_t
 
iova
;

852 ià(
pfvf
->
iommu_domaš_ty³
 =ğ
IOMMU_DOMAIN_IDENTITY
)

853  
	`·ge_to_phys
(
·ge
è+ 
off£t
;

855 
iova
 = 
	`dma_m­_·ge_©Œs
(
pfvf
->
dev
, 
·ge
,

856 
off£t
, 
size
, 
dœ
, 
DMA_ATTR_SKIP_CPU_SYNC
);

857 ià(
	`uÆik–y
(
	`dma_m­pšg_”rÜ
(
pfvf
->
dev
, 
iova
)))

858  (
dma_addr_t
)
NULL
;

859  
iova
;

860 
	}
}

862 
šlše
 
	$Ùx2_dma_unm­_·ge
(
Ùx2_nic
 *
pfvf
,

863 
dma_addr_t
 
addr
, 
size_t
 
size
,

864 
dma_d©a_dœeùiÚ
 
dœ
)

866 ià(
pfvf
->
iommu_domaš_ty³
 =ğ
IOMMU_DOMAIN_IDENTITY
)

869 
	`dma_unm­_·ge_©Œs
(
pfvf
->
dev
, 
addr
, 
size
,

870 
dœ
, 
DMA_ATTR_SKIP_CPU_SYNC
);

871 
	}
}

873 
šlše
 
u16
 
	$Ùx2_g‘_smq_idx
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
)

875 
u16
 
smq
;

877 #ifdeà
CONFIG_DCB


878 ià(
qidx
 < 
NIX_PF_PFC_PRIO_MAX
 && 
pfvf
->
pfc_®loc_¡©us
[qidx])

879  
pfvf
->
pfc_schq_li¡
[
NIX_TXSCH_LVL_SMQ
][
qidx
];

882 ià(
qidx
 >ğ
pfvf
->
hw
.
tÙ_tx_queues
)

883 
smq
 = 
pfvf
->
qos
.
qid_to_sqm­
[
qidx
 -…fvf->
hw
.
tÙ_tx_queues
];

885 
smq
 = 
pfvf
->
hw
.
txschq_li¡
[
NIX_TXSCH_LVL_SMQ
][0];

887  
smq
;

888 
	}
}

891 
Ùx2_ä“_cšts
(
Ùx2_nic
 *
pfvf
, 
n
);

892 
Ùx2_£t_cšts_affš™y
(
Ùx2_nic
 *
pfvf
);

893 
Ùx2_£t_mac_add»ss
(
Ãt_deviû
 *
Ãtdev
, *
p
);

894 
Ùx2_hw_£t_mtu
(
Ùx2_nic
 *
pfvf
, 
mtu
);

895 
Ùx2_tx_timeout
(
Ãt_deviû
 *
Ãtdev
);

896 
Ùx2_g‘_mac_äom_af
(
Ãt_deviû
 *
Ãtdev
);

897 
Ùx2_cÚfig_œq_cßËscšg
(
Ùx2_nic
 *
pfvf
, 
qidx
);

898 
Ùx2_cÚfig_·u£_äm
(
Ùx2_nic
 *
pfvf
);

899 
Ùx2_£tup_£gm’tiÚ
(
Ùx2_nic
 *
pfvf
);

900 
Ùx2_cÚfig_£rdes_lšk_¡©e
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’
);

903 
Ùx2_©ch_Åa_nix
(
Ùx2_nic
 *
pfvf
);

904 
Ùx2_d‘ach_»sourûs
(
mbox
 *mbox);

905 
Ùx2_cÚfig_Åa
(
Ùx2_nic
 *
pfvf
);

906 
Ùx2_sq_au¿_poŞ_š™
(
Ùx2_nic
 *
pfvf
);

907 
Ùx2_rq_au¿_poŞ_š™
(
Ùx2_nic
 *
pfvf
);

908 
Ùx2_au¿_poŞ_ä“
(
Ùx2_nic
 *
pfvf
);

909 
Ùx2_ä“_au¿_±r
(
Ùx2_nic
 *
pfvf
, 
ty³
);

910 
Ùx2_sq_ä“_sqbs
(
Ùx2_nic
 *
pfvf
);

911 
Ùx2_cÚfig_nix
(
Ùx2_nic
 *
pfvf
);

912 
Ùx2_cÚfig_nix_queues
(
Ùx2_nic
 *
pfvf
);

913 
Ùx2_txschq_cÚfig
(
Ùx2_nic
 *
pfvf
, 
lvl
, 
´io
, 
boŞ
 
pfc_’
);

914 
Ùx2_txsch_®loc
(
Ùx2_nic
 *
pfvf
);

915 
Ùx2_txschq_¡İ
(
Ùx2_nic
 *
pfvf
);

916 #ifdeà
CONFIG_DCB


917 
Ùx2_pfc_txschq_cÚfig
(
Ùx2_nic
 *
pfvf
);

918 
Ùx2_pfc_txschq_®loc
(
Ùx2_nic
 *
pfvf
);

919 
Ùx2_pfc_txschq_upd©e
(
Ùx2_nic
 *
pfvf
);

920 
Ùx2_pfc_txschq_¡İ
(
Ùx2_nic
 *
pfvf
);

922 
Ùx2_sqb_æush
(
Ùx2_nic
 *
pfvf
);

923 
__Ùx2_®loc_rbuf
(
Ùx2_nic
 *
pfvf
, 
Ùx2_poŞ
 *
poŞ
,

924 
dma_addr_t
 *
dma
);

925 
Ùx2_rxtx_’abË
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
);

926 
Ùx2_ùx_di§bË
(
mbox
 *mbox, 
ty³
, 
boŞ
 
Åa
);

927 
Ùx2_nix_cÚfig_bp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
);

928 
Ùx2_ş—nup_rx_cqes
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
);

929 
Ùx2_sq_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
, u16 
sqb_au¿
);

930 
Ùx2_ş—nup_tx_cqes
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
);

931 
Ùx2_sq_aq_š™
(*
dev
, 
u16
 
qidx
, 
u8
 
chª_off£t
, u16 
sqb_au¿
);

932 
ú10k_sq_aq_š™
(*
dev
, 
u16
 
qidx
, 
u8
 
chª_off£t
, u16 
sqb_au¿
);

933 
Ùx2_®loc_bufãr
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
,

934 
dma_addr_t
 *
dma
);

935 
Ùx2_poŞ_š™
(
Ùx2_nic
 *
pfvf
, 
u16
 
poŞ_id
,

936 
¡ack_·ges
, 
num±rs
, 
buf_size
);

937 
Ùx2_au¿_š™
(
Ùx2_nic
 *
pfvf
, 
au¿_id
,

938 
poŞ_id
, 
num±rs
);

939 
Ùx2_txschq_ä“_Úe
(
Ùx2_nic
 *
pfvf
, 
u16
 
lvl
, u16 
schq
);

940 
Ùx2_ä“_³ndšg_sqe
(
Ùx2_nic
 *
pfvf
);

943 
Ùx2_rss_š™
(
Ùx2_nic
 *
pfvf
);

944 
Ùx2_£t_æowkey_cfg
(
Ùx2_nic
 *
pfvf
);

945 
Ùx2_£t_rss_key
(
Ùx2_nic
 *
pfvf
);

946 
Ùx2_£t_rss_bË
(
Ùx2_nic
 *
pfvf
, 
ùx_id
);

949 
mbox_hªdËr_msix_off£t
(
Ùx2_nic
 *
pfvf
,

950 
msix_off£t_r¥
 *
r¥
);

951 
mbox_hªdËr_Åa_lf_®loc
(
Ùx2_nic
 *
pfvf
,

952 
Åa_lf_®loc_r¥
 *
r¥
);

953 
mbox_hªdËr_nix_lf_®loc
(
Ùx2_nic
 *
pfvf
,

954 
nix_lf_®loc_r¥
 *
r¥
);

955 
mbox_hªdËr_nix_txsch_®loc
(
Ùx2_nic
 *
pf
,

956 
nix_txsch_®loc_r¥
 *
r¥
);

957 
mbox_hªdËr_cgx_¡©s
(
Ùx2_nic
 *
pfvf
,

958 
cgx_¡©s_r¥
 *
r¥
);

959 
mbox_hªdËr_cgx_ãc_¡©s
(
Ùx2_nic
 *
pfvf
,

960 
cgx_ãc_¡©s_r¥
 *
r¥
);

961 
Ùx2_£t_ãc_¡©s_couÁ
(
Ùx2_nic
 *
pfvf
);

962 
mbox_hªdËr_nix_bp_’abË
(
Ùx2_nic
 *
pfvf
,

963 
nix_bp_cfg_r¥
 *
r¥
);

966 
Ùx2_g‘_dev_¡©s
(
Ùx2_nic
 *
pfvf
);

967 
Ùx2_g‘_¡©s64
(
Ãt_deviû
 *
Ãtdev
,

968 
¹Æ_lšk_¡©s64
 *
¡©s
);

969 
Ùx2_upd©e_lmac_¡©s
(
Ùx2_nic
 *
pfvf
);

970 
Ùx2_upd©e_lmac_ãc_¡©s
(
Ùx2_nic
 *
pfvf
);

971 
Ùx2_upd©e_rq_¡©s
(
Ùx2_nic
 *
pfvf
, 
qidx
);

972 
Ùx2_upd©e_sq_¡©s
(
Ùx2_nic
 *
pfvf
, 
qidx
);

973 
Ùx2_£t_‘htoŞ_İs
(
Ãt_deviû
 *
Ãtdev
);

974 
Ùx2vf_£t_‘htoŞ_İs
(
Ãt_deviû
 *
Ãtdev
);

976 
Ùx2_İ’
(
Ãt_deviû
 *
Ãtdev
);

977 
Ùx2_¡İ
(
Ãt_deviû
 *
Ãtdev
);

978 
Ùx2_£t_»®_num_queues
(
Ãt_deviû
 *
Ãtdev
,

979 
tx_queues
, 
rx_queues
);

980 
Ùx2_£t_Åc_·r£_mode
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
unbšd
);

981 
Ùx2_ioùl
(
Ãt_deviû
 *
Ãtdev
, 
iäeq
 *
»q
, 
cmd
);

982 
Ùx2_cÚfig_hwt¡amp
(
Ãt_deviû
 *
Ãtdev
, 
iäeq
 *
iä
);

985 
Ùx2_mÿm_æow_š™
(
Ùx2_nic
 *
pf
);

986 
Ùx2vf_mÿm_æow_š™
(
Ùx2_nic
 *
pfvf
);

987 
Ùx2_®loc_mÿm_’Œ›s
(
Ùx2_nic
 *
pfvf
, 
u16
 
couÁ
);

988 
Ùx2_mÿm_æow_d–
(
Ùx2_nic
 *
pf
);

989 
Ùx2_de¡roy_Áu¶e_æows
(
Ùx2_nic
 *
pf
);

990 
Ùx2_de¡roy_mÿm_æows
(
Ùx2_nic
 *
pfvf
);

991 
Ùx2_g‘_æow
(
Ùx2_nic
 *
pfvf
,

992 
‘htoŞ_rxnfc
 *
nfc
, 
u32
 
loÿtiÚ
);

993 
Ùx2_g‘_®l_æows
(
Ùx2_nic
 *
pfvf
,

994 
‘htoŞ_rxnfc
 *
nfc
, 
u32
 *
ruË_locs
);

995 
Ùx2_add_æow
(
Ùx2_nic
 *
pfvf
,

996 
‘htoŞ_rxnfc
 *
nfc
);

997 
Ùx2_»move_æow
(
Ùx2_nic
 *
pfvf
, 
u32
 
loÿtiÚ
);

998 
Ùx2_g‘_maxæows
(
Ùx2_æow_cÚfig
 *
æow_cfg
);

999 
Ùx2_rss_ùx_æow_d–
(
Ùx2_nic
 *
pfvf
, 
ùx_id
);

1000 
Ùx2_d–_macf‹r
(
Ãt_deviû
 *
Ãtdev
, cÚ¡ 
u8
 *
mac
);

1001 
Ùx2_add_macf‹r
(
Ãt_deviû
 *
Ãtdev
, cÚ¡ 
u8
 *
mac
);

1002 
Ùx2_’abË_rxvÏn
(
Ùx2_nic
 *
pf
, 
boŞ
 
’abË
);

1003 
Ùx2_’abË_vf_vÏn
(
Ùx2_nic
 *
pf
);

1004 
Ùx2_š¡®l_rxvÏn_ofæßd_æow
(
Ùx2_nic
 *
pfvf
);

1005 
Ùx2_do_£t_vf_vÏn
(
Ùx2_nic
 *
pf
, 
vf
, 
u16
 
vÏn
, 
u8
 
qos
,

1006 
u16
 
´Ùo
);

1007 
Ùx2smqvf_´obe
(
Ùx2_nic
 *
vf
);

1008 
Ùx2smqvf_»move
(
Ùx2_nic
 *
vf
);

1010 
boŞ
 
Ùx2_xdp_sq_­³nd_pkt
(
Ùx2_nic
 *
pfvf
, 
u64
 
iova
, 
Ën
, 
u16
 
qidx
);

1011 
u16
 
Ùx2_g‘_max_mtu
(
Ùx2_nic
 *
pfvf
);

1012 
Ùx2_hªdË_Áu¶e_tc_ã©u»s
(
Ãt_deviû
 *
Ãtdev
,

1013 
Ãtdev_ã©u»s_t
 
ã©u»s
);

1014 
Ùx2_smq_æush
(
Ùx2_nic
 *
pfvf
, 
smq
);

1017 
Ùx2_š™_tc
(
Ùx2_nic
 *
nic
);

1018 
Ùx2_shutdown_tc
(
Ùx2_nic
 *
nic
);

1019 
Ùx2_£tup_tc
(
Ãt_deviû
 *
Ãtdev
, 
tc_£tup_ty³
 
ty³
,

1020 *
ty³_d©a
);

1021 
Ùx2_tc_®loc_’t_b™m­
(
Ùx2_nic
 *
nic
);

1023 
Ùx2_dmacæt_g‘_max_út
(
Ùx2_nic
 *
pf
);

1024 
Ùx2_dmacæt_add
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
, 
u32
 
b™_pos
);

1025 
Ùx2_dmacæt_»move
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
, 
u32
 
b™_pos
);

1026 
Ùx2_dmacæt_upd©e
(
Ùx2_nic
 *
pf
, 
u8
 *
mac
, 
u32
 
b™_pos
);

1027 
Ùx2_dmacæt_»š¡®l_æows
(
Ùx2_nic
 *
pf
);

1028 
Ùx2_dmacæt_upd©e_pfmac_æow
(
Ùx2_nic
 *
pfvf
);

1030 #ifdeà
CONFIG_DCB


1032 
Ùx2_upd©e_bpid_š_rqùx
(
Ùx2_nic
 *
pfvf
, 
vÏn_´io
, 
qidx
, 
boŞ
 
pfc_’abË
);

1033 
Ùx2_cÚfig_´iÜ™y_æow_ù¾
(
Ùx2_nic
 *
pfvf
);

1034 
Ùx2_dcbÆ_£t_İs
(
Ãt_deviû
 *
dev
);

1037 
Ùx2_qos_sq_£tup
(
Ùx2_nic
 *
pfvf
, 
qos_txqs
);

1038 
Ùx2_g‘_txq_by_şassid
(
Ùx2_nic
 *
pfvf
, 
u16
 
şassid
);

1039 
u16
 
Ùx2_£Ëù_queue
(
Ãt_deviû
 *
Ãtdev
, 
sk_buff
 *
skb
,

1040 
Ãt_deviû
 *
sb_dev
);

1041 
Ùx2_qos_cÚfig_txschq
(
Ùx2_nic
 *
pfvf
);

1042 
Ùx2_ş—n_qos_queues
(
Ùx2_nic
 *
pfvf
);

1043 
boŞ
 
Ùx2_is_qos_cÚfigu»d
(
Ùx2_nic
 *
pfvf
);

	@otx2_dcbnl.c

8 
	~"Ùx2_commÚ.h
"

10 
	$Ùx2_check_pfc_cÚfig
(
Ùx2_nic
 *
pfvf
)

12 
u8
 
tx_queues
 = 
pfvf
->
hw
.tx_queues, 
´io
;

13 
u8
 
pfc_’
 = 
pfvf
->pfc_en;

15 
´io
 = 0;…riØ< 
NIX_PF_PFC_PRIO_MAX
;…rio++) {

16 ià((
pfc_’
 & (1 << 
´io
)) &&

17 
´io
 > 
tx_queues
 - 1) {

18 
	`dev_w¬n
(
pfvf
->
dev
,

20 
tx_queues
, 
´io
 + 1);

21  -
EINVAL
;

26 
	}
}

28 
	$Ùx2_cÚfig_´iÜ™y_æow_ù¾
(
Ùx2_nic
 *
pfvf
)

30 
cgx_pfc_cfg
 *
»q
;

31 
cgx_pfc_r¥
 *
r¥
;

32 
”r
 = 0;

34 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev))

37 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

38 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_´io_æow_ù¾_cfg
(&
pfvf
->
mbox
);

39 ià(!
»q
) {

40 
”r
 = -
ENOMEM
;

41 
uÆock
;

44 ià(
pfvf
->
pfc_’
) {

45 
»q
->
rx_·u£
 = 
Œue
;

46 
»q
->
tx_·u£
 = 
Œue
;

48 
»q
->
rx_·u£
 = 
çl£
;

49 
»q
->
tx_·u£
 = 
çl£
;

51 
»q
->
pfc_’
 = 
pfvf
->pfc_en;

53 ià(!
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
)) {

54 
r¥
 = (
cgx_pfc_r¥
 *)

55 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

56 ià(
»q
->
rx_·u£
 !ğ
r¥
->rx_·u£ ||„eq->
tx_·u£
 !=„sp->tx_pause) {

57 
	`dev_w¬n
(
pfvf
->
dev
,

59 
”r
 = -
EPERM
;

62 
uÆock
:

63 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

64  
”r
;

65 
	}
}

67 
	$Ùx2_upd©e_bpid_š_rqùx
(
Ùx2_nic
 *
pfvf
, 
vÏn_´io
, 
qidx
,

68 
boŞ
 
pfc_’abË
)

70 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
pfvf
->
Ãtdev
);

71 
Åa_aq_’q_»q
 *
Åa_aq
;

72 
nix_aq_’q_»q
 *
aq
;

73 
”r
 = 0;

75 ià(
pfvf
->
queue_to_pfc_m­
[
qidx
] && 
pfc_’abË
) {

76 
	`dev_w¬n
(
pfvf
->
dev
,

78 
pfvf
->
queue_to_pfc_m­
[
qidx
], qidx);

82 ià(
if_up
) {

83 
	`Ãtif_tx_¡İ_®l_queues
(
pfvf
->
Ãtdev
);

84 
	`Ãtif_ÿ¼›r_off
(
pfvf
->
Ãtdev
);

87 
pfvf
->
queue_to_pfc_m­
[
qidx
] = 
vÏn_´io
;

89 
aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

90 ià(!
aq
) {

91 
”r
 = -
ENOMEM
;

92 
out
;

95 
aq
->
cq
.
bpid
 = 
pfvf
->bpid[
vÏn_´io
];

96 
aq
->
cq_mask
.
bpid
 = 
	`GENMASK
(8, 0);

99 
aq
->
qidx
 = qidx;

100 
aq
->
ùy³
 = 
NIX_AQ_CTYPE_CQ
;

101 
aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

103 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

105 
Åa_aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

106 ià(!
Åa_aq
) {

107 
”r
 = -
ENOMEM
;

108 
out
;

110 
Åa_aq
->
au¿
.
nix0_bpid
 = 
pfvf
->
bpid
[
vÏn_´io
];

111 
Åa_aq
->
au¿_mask
.
nix0_bpid
 = 
	`GENMASK
(8, 0);

114 
Åa_aq
->
au¿_id
 = 
qidx
;

115 
Åa_aq
->
ùy³
 = 
NPA_AQ_CTYPE_AURA
;

116 
Åa_aq
->
İ
 = 
NPA_AQ_INSTOP_WRITE
;

117 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

119 
out
:

120 ià(
if_up
) {

121 
	`Ãtif_ÿ¼›r_Ú
(
pfvf
->
Ãtdev
);

122 
	`Ãtif_tx_¡¬t_®l_queues
(
pfvf
->
Ãtdev
);

125 ià(
”r
)

126 
	`dev_w¬n
(
pfvf
->
dev
,

128 
qidx
, 
”r
);

129 
	}
}

131 
	$Ùx2_dcbÆ_›“_g‘pfc
(
Ãt_deviû
 *
dev
, 
›“_pfc
 *
pfc
)

133 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

135 
pfc
->
pfc_ÿp
 = 
IEEE_8021QAZ_MAX_TCS
;

136 
pfc
->
pfc_’
 = 
pfvf
->pfc_en;

139 
	}
}

141 
	$Ùx2_dcbÆ_›“_£fc
(
Ãt_deviû
 *
dev
, 
›“_pfc
 *
pfc
)

143 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

144 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
dev
);

145 
”r
;

148 
pfvf
->
pfc_’
 = 
pfc
->pfc_en;

150 ià(
pfvf
->
hw
.
tx_queues
 >ğ
NIX_PF_PFC_PRIO_MAX
)

151 
´oûss_pfc
;

156 
”r
 = 
	`Ùx2_check_pfc_cÚfig
(
pfvf
);

157 ià(
”r
)

158  
”r
;

160 
´oûss_pfc
:

161 
”r
 = 
	`Ùx2_cÚfig_´iÜ™y_æow_ù¾
(
pfvf
);

162 ià(
”r
)

163  
”r
;

165 ià(
if_up
) {

166 
	`Ùx2_¡İ
(
dev
);

167 
	`Ùx2_İ’
(
dev
);

171 
	}
}

173 
u8
 
	$Ùx2_dcbÆ_g‘dcbx
(
Ãt_deviû
 
__®ways_unu£d
 *
dev
)

175  
DCB_CAP_DCBX_HOST
 | 
DCB_CAP_DCBX_VER_IEEE
;

176 
	}
}

178 
u8
 
	$Ùx2_dcbÆ_£tdcbx
(
Ãt_deviû
 
__®ways_unu£d
 *
dev
, 
u8
 
mode
)

180  (
mode
 !ğ(
DCB_CAP_DCBX_HOST
 | 
DCB_CAP_DCBX_VER_IEEE
)) ? 1 : 0;

181 
	}
}

183 cÚ¡ 
dcbÆ_¹Æ_İs
 
	gÙx2_dcbÆ_İs
 = {

184 .
›“_g‘pfc
 = 
Ùx2_dcbÆ_›“_g‘pfc
,

185 .
	g›“_£fc
 = 
Ùx2_dcbÆ_›“_£fc
,

186 .
	gg‘dcbx
 = 
Ùx2_dcbÆ_g‘dcbx
,

187 .
	g£tdcbx
 = 
Ùx2_dcbÆ_£tdcbx
,

190 
	$Ùx2_dcbÆ_£t_İs
(
Ãt_deviû
 *
dev
)

192 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

194 
pfvf
->
queue_to_pfc_m­
 = 
	`devm_kz®loc
Õfvf->
dev
,…fvf->
hw
.
rx_queues
,

195 
GFP_KERNEL
);

196 ià(!
pfvf
->
queue_to_pfc_m­
)

197  -
ENOMEM
;

198 
dev
->
dcbÆ_İs
 = &
Ùx2_dcbÆ_İs
;

201 
	}
}

	@otx2_devlink.c

7 
	~"Ùx2_commÚ.h
"

10 
	$Ùx2_dl_mÿm_couÁ_v®id©e
(
devlšk
 *devlšk, 
u32
 
id
,

11 
devlšk_·¿m_v®ue
 
v®
,

12 
Ãšk_ext_ack
 *
exck
)

14 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

15 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

16 
Ùx2_æow_cÚfig
 *
æow_cfg
;

18 ià(!
pfvf
->
æow_cfg
) {

19 
	`NL_SET_ERR_MSG_MOD
(
exck
,

21  -
EINVAL
;

24 
æow_cfg
 = 
pfvf
->flow_cfg;

25 ià(
æow_cfg
 && flow_cfg->
Ä_æows
) {

26 
	`NL_SET_ERR_MSG_MOD
(
exck
,

28  -
EINVAL
;

32 
	}
}

34 
	$Ùx2_dl_mÿm_couÁ_£t
(
devlšk
 *devlšk, 
u32
 
id
,

35 
devlšk_·¿m_g£t_ùx
 *
ùx
)

37 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

38 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

40 ià(!
pfvf
->
æow_cfg
)

43 
	`Ùx2_®loc_mÿm_’Œ›s
(
pfvf
, 
ùx
->
v®
.
vu16
);

44 
	`Ùx2_tc_®loc_’t_b™m­
(
pfvf
);

47 
	}
}

49 
	$Ùx2_dl_mÿm_couÁ_g‘
(
devlšk
 *devlšk, 
u32
 
id
,

50 
devlšk_·¿m_g£t_ùx
 *
ùx
)

52 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

53 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

54 
Ùx2_æow_cÚfig
 *
æow_cfg
;

56 ià(!
pfvf
->
æow_cfg
) {

57 
ùx
->
v®
.
vu16
 = 0;

61 
æow_cfg
 = 
pfvf
->flow_cfg;

62 
ùx
->
v®
.
vu16
 = 
æow_cfg
->
max_æows
;

65 
	}
}

67 
	$Ùx2_dl_rbuf_size_v®id©e
(
devlšk
 *devlšk, 
u32
 
id
,

68 
devlšk_·¿m_v®ue
 
v®
,

69 
Ãšk_ext_ack
 *
exck
)

74 ià(
v®
.
vu16
 < 1536 || val.vu16 > 32768) {

75 
	`NL_SET_ERR_MSG_MOD
(
exck
,

77  -
EINVAL
;

81 
	}
}

83 
	$Ùx2_dl_rbuf_size_£t
(
devlšk
 *devlšk, 
u32
 
id
,

84 
devlšk_·¿m_g£t_ùx
 *
ùx
)

86 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

87 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

88 
Ãt_deviû
 *
Ãtdev
;

89 
”r
 = 0;

90 
boŞ
 
if_up
;

92 
	`¹Æ_lock
();

94 
Ãtdev
 = 
pfvf
->netdev;

95 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

96 ià(
if_up
)

97 
Ãtdev
->
Ãtdev_İs
->
	`ndo_¡İ
(netdev);

99 
pfvf
->
hw
.
rbuf_fixed_size
 = 
ùx
->
v®
.
vu16
;

101 ià(
if_up
)

102 
”r
 = 
Ãtdev
->
Ãtdev_İs
->
	`ndo_İ’
(netdev);

104 
	`¹Æ_uÆock
();

106  
”r
;

107 
	}
}

109 
	$Ùx2_dl_rbuf_size_g‘
(
devlšk
 *devlšk, 
u32
 
id
,

110 
devlšk_·¿m_g£t_ùx
 *
ùx
)

112 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

113 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

115 
ùx
->
v®
.
vu16
 = 
pfvf
->
hw
.
rbuf_fixed_size
;

118 
	}
}

120 
	$Ùx2_dl_cqe_size_v®id©e
(
devlšk
 *devlšk, 
u32
 
id
,

121 
devlšk_·¿m_v®ue
 
v®
,

122 
Ãšk_ext_ack
 *
exck
)

124 ià(
v®
.
vu16
 != 128 && val.vu16 != 512) {

125 
	`NL_SET_ERR_MSG_MOD
(
exck
,

127  -
EINVAL
;

131 
	}
}

133 
	$Ùx2_dl_cqe_size_£t
(
devlšk
 *devlšk, 
u32
 
id
,

134 
devlšk_·¿m_g£t_ùx
 *
ùx
)

136 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

137 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

138 
Ãt_deviû
 *
Ãtdev
;

139 
”r
 = 0;

140 
boŞ
 
if_up
;

142 
	`¹Æ_lock
();

144 
Ãtdev
 = 
pfvf
->netdev;

145 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

146 ià(
if_up
)

147 
Ãtdev
->
Ãtdev_İs
->
	`ndo_¡İ
(netdev);

149 
pfvf
->
hw
.
xqe_size
 = 
ùx
->
v®
.
vu16
;

151 ià(
if_up
)

152 
”r
 = 
Ãtdev
->
Ãtdev_İs
->
	`ndo_İ’
(netdev);

154 
	`¹Æ_uÆock
();

156  
”r
;

157 
	}
}

159 
	$Ùx2_dl_cqe_size_g‘
(
devlšk
 *devlšk, 
u32
 
id
,

160 
devlšk_·¿m_g£t_ùx
 *
ùx
)

162 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

163 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

165 
ùx
->
v®
.
vu16
 = 
pfvf
->
hw
.
xqe_size
;

168 
	}
}

170 
	$Ùx2_dl_£rdes_lšk_£t
(
devlšk
 *devlšk, 
u32
 
id
,

171 
devlšk_·¿m_g£t_ùx
 *
ùx
)

173 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

174 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

176 ià(!
	`is_Ùx2_vf
(
pfvf
->
pcifunc
))

177  
	`Ùx2_cÚfig_£rdes_lšk_¡©e
(
pfvf
, 
ùx
->
v®
.
vboŞ
);

179  -
EOPNOTSUPP
;

180 
	}
}

182 
	$Ùx2_dl_£rdes_lšk_g‘
(
devlšk
 *devlšk, 
u32
 
id
,

183 
devlšk_·¿m_g£t_ùx
 *
ùx
)

185 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

186 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

188 
ùx
->
v®
.
vboŞ
 = (
pfvf
->
lšfo
.
lšk_up
è? 
Œue
 : 
çl£
;

191 
	}
}

193 
	$Ùx2_dl_1_¼_´io_v®id©e
(
devlšk
 *devlšk, 
u32
 
id
,

194 
devlšk_·¿m_v®ue
 
v®
,

195 
Ãšk_ext_ack
 *
exck
)

197 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

198 
Ùx2_nic
 *
pf
 = 
Ùx2_dl
->
pfvf
;

200 ià(
	`is_Ùx2_vf
(
pf
->
pcifunc
)) {

201 
	`NL_SET_ERR_MSG_MOD
(
exck
,

203  -
EOPNOTSUPP
;

206 ià(
	`Ùx2_is_qos_cÚfigu»d
(
pf
)) {

207 
	`NL_SET_ERR_MSG_MOD
(
exck
,

209  -
EOPNOTSUPP
;

212 ià(
	`pci_num_vf
(
pf
->
pdev
)) {

213 
	`NL_SET_ERR_MSG_MOD
(
exck
,

215  -
EOPNOTSUPP
;

218 ià(
v®
.
vu8
 > 7) {

219 
	`NL_SET_ERR_MSG_MOD
(
exck
,

221  -
EINVAL
;

225 
	}
}

227 
	$Ùx2_dl_1_¼_´io_g‘
(
devlšk
 *devlšk, 
u32
 
id
,

228 
devlšk_·¿m_g£t_ùx
 *
ùx
)

230 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

231 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

233 
ùx
->
v®
.
vu8
 = 
pfvf
->
hw
.
txschq_aggr_lvl_¼_´io
;

236 
	}
}

238 
	$Ùx2_dl_1_¼_´io_£t
(
devlšk
 *devlšk, 
u32
 
id
,

239 
devlšk_·¿m_g£t_ùx
 *
ùx
)

241 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

242 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

243 
nix_1_¼_´io_»q
 *
»q
;

244 
boŞ
 
if_up
;

245 
”r
;

247 
if_up
 = 
	`Ãtif_ruÂšg
(
pfvf
->
Ãtdev
);

250 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

252 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_1_¼_´io
(&
pfvf
->
mbox
);

253 ià(!
»q
) {

254 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

255  -
ENOMEM
;

258 
»q
->
1_¼_´io
 = 
ùx
->
v®
.
vu8
;

259 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

260 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

263 ià(!
”r
 && 
if_up
) {

264 
	`Ùx2_¡İ
(
pfvf
->
Ãtdev
);

265 
”r
 = 
	`Ùx2_İ’
(
pfvf
->
Ãtdev
);

266 ià(!
”r
)

267 
pfvf
->
hw
.
txschq_aggr_lvl_¼_´io
 = 
ùx
->
v®
.
vu8
;

270  
”r
;

271 
	}
}

273 
	eÙx2_dl_·¿m_id
 {

274 
	mOTX2_DEVLINK_PARAM_ID_BASE
 = 
DEVLINK_PARAM_GENERIC_ID_MAX
,

275 
	mOTX2_DEVLINK_PARAM_ID_MCAM_COUNT
,

276 
	mOTX2_DEVLINK_PARAM_ID_CQE_SIZE
,

277 
	mOTX2_DEVLINK_PARAM_ID_RBUF_SIZE
,

278 
	mOTX2_DEVLINK_PARAM_ID_SERDES_LINK
,

279 
	mOTX2_DEVLINK_PARAM_ID_TL1_RR_PRIO
,

282 cÚ¡ 
devlšk_·¿m
 
	gÙx2_dl_·¿ms
[] = {

283 
DEVLINK_PARAM_DRIVER
(
OTX2_DEVLINK_PARAM_ID_MCAM_COUNT
,

284 "mÿm_couÁ", 
DEVLINK_PARAM_TYPE_U16
,

285 
BIT
(
DEVLINK_PARAM_CMODE_RUNTIME
),

286 
Ùx2_dl_mÿm_couÁ_g‘
, 
Ùx2_dl_mÿm_couÁ_£t
,

287 
Ùx2_dl_mÿm_couÁ_v®id©e
),

288 
DEVLINK_PARAM_DRIVER
(
OTX2_DEVLINK_PARAM_ID_CQE_SIZE
,

289 "com¶‘iÚ_desütÜ_size", 
DEVLINK_PARAM_TYPE_U16
,

290 
BIT
(
DEVLINK_PARAM_CMODE_RUNTIME
),

291 
Ùx2_dl_cqe_size_g‘
, 
Ùx2_dl_cqe_size_£t
,

292 
Ùx2_dl_cqe_size_v®id©e
),

293 
DEVLINK_PARAM_DRIVER
(
OTX2_DEVLINK_PARAM_ID_RBUF_SIZE
,

294 "»ûive_bufãr_size", 
DEVLINK_PARAM_TYPE_U16
,

295 
BIT
(
DEVLINK_PARAM_CMODE_RUNTIME
),

296 
Ùx2_dl_rbuf_size_g‘
, 
Ùx2_dl_rbuf_size_£t
,

297 
Ùx2_dl_rbuf_size_v®id©e
),

298 
DEVLINK_PARAM_DRIVER
(
OTX2_DEVLINK_PARAM_ID_SERDES_LINK
,

299 "£rdes_lšk", 
DEVLINK_PARAM_TYPE_BOOL
,

300 
BIT
(
DEVLINK_PARAM_CMODE_RUNTIME
),

301 
Ùx2_dl_£rdes_lšk_g‘
, 
Ùx2_dl_£rdes_lšk_£t
,

302 
NULL
),

303 
DEVLINK_PARAM_DRIVER
(
OTX2_DEVLINK_PARAM_ID_TL1_RR_PRIO
,

304 "1_¼_´io", 
DEVLINK_PARAM_TYPE_U8
,

305 
BIT
(
DEVLINK_PARAM_CMODE_RUNTIME
),

306 
Ùx2_dl_1_¼_´io_g‘
, 
Ùx2_dl_1_¼_´io_£t
,

307 
Ùx2_dl_1_¼_´io_v®id©e
),

311 
	$Ùx2_devlšk_šfo_g‘
(
devlšk
 *devlink,

312 
devlšk_šfo_»q
 *
»q
,

313 
Ãšk_ext_ack
 *
exck
)

315 
Ùx2_devlšk
 *
Ùx2_dl
 = 
	`devlšk_´iv
(
devlšk
);

316 
Ùx2_nic
 *
pfvf
 = 
Ùx2_dl
->pfvf;

318 ià(
	`is_Ùx2_vf
(
pfvf
->
pcifunc
))

319  
	`devlšk_šfo_driv”_Çme_put
(
»q
, "rvu_nicvf");

321  
	`devlšk_šfo_driv”_Çme_put
(
»q
, "rvu_nicpf");

322 
	}
}

324 cÚ¡ 
devlšk_İs
 
	gÙx2_devlšk_İs
 = {

325 .
šfo_g‘
 = 
Ùx2_devlšk_šfo_g‘
,

328 
	$Ùx2_»gi¡”_dl
(
Ùx2_nic
 *
pfvf
)

330 
Ùx2_devlšk
 *
Ùx2_dl
;

331 
devlšk
 *
dl
;

332 
”r
;

334 
dl
 = 
	`devlšk_®loc
(&
Ùx2_devlšk_İs
, (
Ùx2_devlšk
));

335 ià(!
dl
) {

336 
	`dev_w¬n
(
pfvf
->
dev
, "devlink_alloc failed\n");

337  -
ENOMEM
;

340 
”r
 = 
	`devlšk_»gi¡”
(
dl
, 
pfvf
->
dev
);

341 ià(
”r
) {

342 
	`dev_”r
(
pfvf
->
dev
, "devlšk„egi¡” faed w™hƒ¼Ü %d\n", 
”r
);

343 
	`devlšk_ä“
(
dl
);

344  
”r
;

347 
Ùx2_dl
 = 
	`devlšk_´iv
(
dl
);

348 
Ùx2_dl
->
dl
 = dl;

349 
Ùx2_dl
->
pfvf
 =…fvf;

350 
pfvf
->
dl
 = 
Ùx2_dl
;

352 
”r
 = 
	`devlšk_·¿ms_»gi¡”
(
dl
, 
Ùx2_dl_·¿ms
,

353 
	`ARRAY_SIZE
(
Ùx2_dl_·¿ms
));

354 ià(
”r
) {

355 
	`dev_”r
(
pfvf
->
dev
,

356 "devlšk…¬am »gi¡” faed w™hƒ¼Ü %d", 
”r
);

357 
”r_dl
;

360 
	`devlšk_·¿ms_publish
(
dl
);

364 
”r_dl
:

365 
	`devlšk_uÄegi¡”
(
dl
);

366 
	`devlšk_ä“
(
dl
);

367  
”r
;

368 
	}
}

370 
	$Ùx2_uÄegi¡”_dl
(
Ùx2_nic
 *
pfvf
)

372 
Ùx2_devlšk
 *
Ùx2_dl
 = 
pfvf
->
dl
;

373 
devlšk
 *
dl
;

375 ià(!
Ùx2_dl
 || !Ùx2_dl->
dl
)

378 
dl
 = 
Ùx2_dl
->dl;

380 
	`devlšk_·¿ms_uÄegi¡”
(
dl
, 
Ùx2_dl_·¿ms
,

381 
	`ARRAY_SIZE
(
Ùx2_dl_·¿ms
));

383 
	`devlšk_uÄegi¡”
(
dl
);

384 
	`devlšk_ä“
(
dl
);

385 
	}
}

	@otx2_devlink.h

8 #iâdef 
OTX2_DEVLINK_H


9 
	#OTX2_DEVLINK_H


	)

11 
	sÙx2_devlšk
 {

12 
devlšk
 *
	mdl
;

13 
Ùx2_nic
 *
	mpfvf
;

17 
Ùx2_»gi¡”_dl
(
Ùx2_nic
 *
pfvf
);

18 
Ùx2_uÄegi¡”_dl
(
Ùx2_nic
 *
pfvf
);

	@otx2_dmac_flt.c

8 
	~"Ùx2_commÚ.h
"

10 
	$Ùx2_dmacæt_do_add
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
,

11 
u32
 *
dmac_šdex
)

13 
cgx_mac_addr_add_»q
 *
»q
;

14 
cgx_mac_addr_add_r¥
 *
r¥
;

15 
”r
;

17 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

19 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_addr_add
(&
pf
->
mbox
);

20 ià(!
»q
) {

21 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

22  -
ENOMEM
;

25 
	`‘h”_addr_cİy
(
»q
->
mac_addr
, 
mac
);

26 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

28 ià(!
”r
) {

29 
r¥
 = (
cgx_mac_addr_add_r¥
 *)

30 
	`Ùx2_mbox_g‘_r¥
(&
pf
->
mbox
.mbox, 0, &
»q
->
hdr
);

31 *
dmac_šdex
 = 
r¥
->
šdex
;

34 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

35  
”r
;

36 
	}
}

38 
	$Ùx2_dmacæt_add_pfmac
(
Ùx2_nic
 *
pf
, 
u32
 *
dmac_šdex
)

40 
cgx_mac_addr_£t_Ü_g‘
 *
»q
;

41 
cgx_mac_addr_£t_Ü_g‘
 *
r¥
;

42 
”r
;

44 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

46 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_addr_£t
(&
pf
->
mbox
);

47 ià(!
»q
) {

48 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

49  -
ENOMEM
;

52 
»q
->
šdex
 = *
dmac_šdex
;

54 
	`‘h”_addr_cİy
(
»q
->
mac_addr
, 
pf
->
Ãtdev
->
dev_addr
);

55 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

57 ià(
”r
)

58 
out
;

60 
r¥
 = (
cgx_mac_addr_£t_Ü_g‘
 *)

61 
	`Ùx2_mbox_g‘_r¥
(&
pf
->
mbox
.mbox, 0, &
»q
->
hdr
);

63 ià(
	`IS_ERR_OR_NULL
(
r¥
)) {

64 
”r
 = -
EINVAL
;

65 
out
;

68 *
dmac_šdex
 = 
r¥
->
šdex
;

69 
out
:

70 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

71  
”r
;

72 
	}
}

74 
	$Ùx2_dmacæt_add
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
, 
u32
 
b™_pos
)

76 
u32
 *
dmacšdex
;

81 
dmacšdex
 = &
pf
->
æow_cfg
->
bm­_to_dmacšdex
[
b™_pos
];

83 ià(
	`‘h”_addr_equ®
(
mac
, 
pf
->
Ãtdev
->
dev_addr
))

84  
	`Ùx2_dmacæt_add_pfmac
(
pf
, 
dmacšdex
);

86  
	`Ùx2_dmacæt_do_add
(
pf
, 
mac
, 
dmacšdex
);

87 
	}
}

89 
	$Ùx2_dmacæt_do_»move
(
Ùx2_nic
 *
pfvf
, cÚ¡ 
u8
 *
mac
,

90 
u32
 
dmac_šdex
)

92 
cgx_mac_addr_d–_»q
 *
»q
;

93 
”r
;

95 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

96 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_addr_d–
(&
pfvf
->
mbox
);

97 ià(!
»q
) {

98 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

99  -
ENOMEM
;

102 
»q
->
šdex
 = 
dmac_šdex
;

104 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

105 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

107  
”r
;

108 
	}
}

110 
	$Ùx2_dmacæt_»move_pfmac
(
Ùx2_nic
 *
pf
, 
u32
 
dmac_šdex
)

112 
cgx_mac_addr_»£t_»q
 *
»q
;

113 
”r
;

115 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

116 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_addr_»£t
(&
pf
->
mbox
);

117 ià(!
»q
) {

118 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

119  -
ENOMEM
;

121 
»q
->
šdex
 = 
dmac_šdex
;

123 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

125 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

126  
”r
;

127 
	}
}

129 
	$Ùx2_dmacæt_»move
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
,

130 
u32
 
b™_pos
)

132 
u32
 
dmacšdex
 = 
pf
->
æow_cfg
->
bm­_to_dmacšdex
[
b™_pos
];

134 ià(
	`‘h”_addr_equ®
(
mac
, 
pf
->
Ãtdev
->
dev_addr
))

135  
	`Ùx2_dmacæt_»move_pfmac
(
pf
, 
dmacšdex
);

137  
	`Ùx2_dmacæt_do_»move
(
pf
, 
mac
, 
dmacšdex
);

138 
	}
}

144 
	$Ùx2_dmacæt_g‘_max_út
(
Ùx2_nic
 *
pf
)

146 
cgx_max_dmac_’Œ›s_g‘_r¥
 *
r¥
;

147 
msg_»q
 *
msg
;

148 
”r
;

150 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

151 
msg
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_max_’Œ›s_g‘
(&
pf
->
mbox
);

153 ià(!
msg
) {

154 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

155  -
ENOMEM
;

158 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

159 ià(
”r
)

160 
out
;

162 
r¥
 = (
cgx_max_dmac_’Œ›s_g‘_r¥
 *)

163 
	`Ùx2_mbox_g‘_r¥
(&
pf
->
mbox
.mbox, 0, &
msg
->
hdr
);

165 ià(
	`IS_ERR_OR_NULL
(
r¥
)) {

166 
”r
 = -
EINVAL
;

167 
out
;

170 
pf
->
æow_cfg
->
dmacæt_max_æows
 = 
r¥
->
max_dmac_f‹rs
;

172 
out
:

173 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

174  
”r
;

175 
	}
}

177 
	$Ùx2_dmacæt_upd©e
(
Ùx2_nic
 *
pf
, 
u8
 *
mac
, 
u32
 
b™_pos
)

179 
cgx_mac_addr_upd©e_»q
 *
»q
;

180 
cgx_mac_addr_upd©e_r¥
 *
r¥
;

181 
rc
;

183 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

185 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_mac_addr_upd©e
(&
pf
->
mbox
);

187 ià(!
»q
) {

188 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

189  -
ENOMEM
;

192 
	`‘h”_addr_cİy
(
»q
->
mac_addr
, 
mac
);

193 
»q
->
šdex
 = 
pf
->
æow_cfg
->
bm­_to_dmacšdex
[
b™_pos
];

197 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

198 ià(
rc
)

199 
out
;

201 
r¥
 = (
cgx_mac_addr_upd©e_r¥
 *)

202 
	`Ùx2_mbox_g‘_r¥
(&
pf
->
mbox
.mbox, 0, &
»q
->
hdr
);

204 
pf
->
æow_cfg
->
bm­_to_dmacšdex
[
b™_pos
] = 
r¥
->
šdex
;

206 
out
:

207 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

208  
rc
;

209 
	}
}

	@otx2_ethtool.c

8 
	~<lšux/pci.h
>

9 
	~<lšux/Ãt_t¡amp.h
>

10 
	~<lšux/‘htoŞ.h
>

11 
	~<lšux/¡ddef.h
>

12 
	~<lšux/‘h”deviû.h
>

13 
	~<lšux/log2.h
>

14 
	~<lšux/lškmode.h
>

16 
	~"Ùx2_commÚ.h
"

17 
	~"Ùx2_±p.h
"

19 
	#DRV_NAME
 "rvu-niıf"

	)

20 
	#DRV_VF_NAME
 "rvu-nicvf"

	)

22 cÚ¡ 
	gÙx2_´iv_æags_¡ršgs
[][
ETH_GSTRING_LEN
] = {

29 
	sÙx2_¡©
 {

30 
	mÇme
[
ETH_GSTRING_LEN
];

31 
	mšdex
;

35 
	#OTX2_DEV_STAT
(
¡©
) { \

36 .
Çme
 = #stat, \

37 .
šdex
 = 
	`off£tof
(
Ùx2_dev_¡©s
, 
¡©
è/ (
u64
), \

38 }

	)

40 
	elšk_mode
 {

41 
	mOTX2_MODE_SUPPORTED
,

42 
	mOTX2_MODE_ADVERTISED


45 cÚ¡ 
Ùx2_¡©
 
	gÙx2_dev_¡©s
[] = {

46 
OTX2_DEV_STAT
(
rx_by‹s
),

47 
OTX2_DEV_STAT
(
rx_äames
),

48 
OTX2_DEV_STAT
(
rx_uÿ¡_äames
),

49 
OTX2_DEV_STAT
(
rx_bÿ¡_äames
),

50 
OTX2_DEV_STAT
(
rx_mÿ¡_äames
),

51 
OTX2_DEV_STAT
(
rx_drİs
),

53 
OTX2_DEV_STAT
(
tx_by‹s
),

54 
OTX2_DEV_STAT
(
tx_äames
),

55 
OTX2_DEV_STAT
(
tx_uÿ¡_äames
),

56 
OTX2_DEV_STAT
(
tx_bÿ¡_äames
),

57 
OTX2_DEV_STAT
(
tx_mÿ¡_äames
),

58 
OTX2_DEV_STAT
(
tx_drİs
),

62 
	#OTX2_DRV_STAT
(
¡©
) { \

63 .
Çme
 = #stat, \

64 .
šdex
 = 
	`off£tof
(
Ùx2_drv_¡©s
, 
¡©
è/ (
©omic_t
), \

65 }

	)

67 cÚ¡ 
Ùx2_¡©
 
	gÙx2_drv_¡©s
[] = {

68 
OTX2_DRV_STAT
(
rx_fcs_”rs
),

69 
OTX2_DRV_STAT
(
rx_ov”size_”rs
),

70 
OTX2_DRV_STAT
(
rx_und”size_”rs
),

71 
OTX2_DRV_STAT
(
rx_csum_”rs
),

72 
OTX2_DRV_STAT
(
rx_Ën_”rs
),

73 
OTX2_DRV_STAT
(
rx_Ùh”_”rs
),

76 cÚ¡ 
Ùx2_¡©
 
	gÙx2_queue_¡©s
[] = {

81 cÚ¡ 
	gÙx2_n_dev_¡©s
 = 
ARRAY_SIZE
(
Ùx2_dev_¡©s
);

82 cÚ¡ 
	gÙx2_n_drv_¡©s
 = 
ARRAY_SIZE
(
Ùx2_drv_¡©s
);

83 cÚ¡ 
	gÙx2_n_queue_¡©s
 = 
ARRAY_SIZE
(
Ùx2_queue_¡©s
);

85 
cgx_fw_d©a
 *
Ùx2_g‘_fwd©a
(
Ùx2_nic
 *
pfvf
);

87 
	$Ùx2_g‘_drvšfo
(
Ãt_deviû
 *
Ãtdev
,

88 
‘htoŞ_drvšfo
 *
šfo
)

90 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

92 
	`¡¾ıy
(
šfo
->
driv”
, 
DRV_NAME
, (info->driver));

93 
	`¡¾ıy
(
šfo
->
bus_šfo
, 
	`pci_Çme
(
pfvf
->
pdev
), (info->bus_info));

94 
	}
}

96 
	$Ùx2_g‘_tÙ®_txq_couÁ
(
Ùx2_nic
 *
pfvf
)

98  
pfvf
->
hw
.
tÙ_tx_queues
 +…fvf->hw.
tc_tx_queues
;

99 
	}
}

101 
	$Ùx2_g‘_q£t_¡ršgs
(
Ùx2_nic
 *
pfvf
, 
u8
 **
d©a
, 
q£t
)

103 
¡¬t_qidx
 = 
q£t
 * 
pfvf
->
hw
.
rx_queues
;

104 
qidx
, 
¡©s
;

106 
qidx
 = 0; qidx < 
pfvf
->
hw
.
rx_queues
; qidx++) {

107 
¡©s
 = 0; st < 
Ùx2_n_queue_¡©s
; stats++) {

108 
	`¥rštf
(*
d©a
, "rxq%d: %s", 
qidx
 + 
¡¬t_qidx
,

109 
Ùx2_queue_¡©s
[
¡©s
].
Çme
);

110 *
d©a
 +ğ
ETH_GSTRING_LEN
;

113 
qidx
 = 0; qidx < 
	`Ùx2_g‘_tÙ®_txq_couÁ
(
pfvf
); qidx++) {

114 
¡©s
 = 0; st < 
Ùx2_n_queue_¡©s
; stats++) {

115 ià(
qidx
 >ğ
pfvf
->
hw
.
tÙ_tx_queues
)

116 
	`¥rštf
(*
d©a
, "txq_qos%d: %s",

117 
qidx
 + 
¡¬t_qidx
 - 
pfvf
->
hw
.
tÙ_tx_queues
,

118 
Ùx2_queue_¡©s
[
¡©s
].
Çme
);

120 
	`¥rštf
(*
d©a
, "txq%d: %s", 
qidx
 + 
¡¬t_qidx
,

121 
Ùx2_queue_¡©s
[
¡©s
].
Çme
);

122 *
d©a
 +ğ
ETH_GSTRING_LEN
;

125 
	}
}

127 
	$Ùx2_g‘_¡ršgs
(
Ãt_deviû
 *
Ãtdev
, 
u32
 
s£t
, 
u8
 *
d©a
)

129 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

130 
¡©s
;

132 ià(
s£t
 =ğ
ETH_SS_PRIV_FLAGS
) {

133 
	`memıy
(
d©a
, 
Ùx2_´iv_æags_¡ršgs
,

134 
	`ARRAY_SIZE
(
Ùx2_´iv_æags_¡ršgs
è* 
ETH_GSTRING_LEN
);

138 ià(
s£t
 !ğ
ETH_SS_STATS
)

141 
¡©s
 = 0; st < 
Ùx2_n_dev_¡©s
; stats++) {

142 
	`memıy
(
d©a
, 
Ùx2_dev_¡©s
[
¡©s
].
Çme
, 
ETH_GSTRING_LEN
);

143 
d©a
 +ğ
ETH_GSTRING_LEN
;

146 
¡©s
 = 0; st < 
Ùx2_n_drv_¡©s
; stats++) {

147 
	`memıy
(
d©a
, 
Ùx2_drv_¡©s
[
¡©s
].
Çme
, 
ETH_GSTRING_LEN
);

148 
d©a
 +ğ
ETH_GSTRING_LEN
;

151 
	`Ùx2_g‘_q£t_¡ršgs
(
pfvf
, &
d©a
, 0);

153 ià(!
	`‹¡_b™
(
CN10K_RPM
, &
pfvf
->
hw
.
ÿp_æag
)) {

154 
¡©s
 = 0; st < 
CGX_RX_STATS_COUNT
; stats++) {

155 
	`¥rštf
(
d©a
, "cgx_rx¡©%d: ", 
¡©s
);

156 
d©a
 +ğ
ETH_GSTRING_LEN
;

159 
¡©s
 = 0; st < 
CGX_TX_STATS_COUNT
; stats++) {

160 
	`¥rštf
(
d©a
, "cgx_tx¡©%d: ", 
¡©s
);

161 
d©a
 +ğ
ETH_GSTRING_LEN
;

165 
	`¡rıy
(
d©a
, "reset_count");

166 
d©a
 +ğ
ETH_GSTRING_LEN
;

167 
	`¥rštf
(
d©a
, "Fec Corrected Errors: ");

168 
d©a
 +ğ
ETH_GSTRING_LEN
;

169 
	`¥rštf
(
d©a
, "Fec Uncorrected Errors: ");

170 
d©a
 +ğ
ETH_GSTRING_LEN
;

171 
	}
}

173 
	$Ùx2_g‘_q£t_¡©s
(
Ùx2_nic
 *
pfvf
,

174 
‘htoŞ_¡©s
 *
¡©s
, 
u64
 **
d©a
)

176 
¡©
, 
qidx
;

178 ià(!
pfvf
)

180 
qidx
 = 0; qidx < 
pfvf
->
hw
.
rx_queues
; qidx++) {

181 ià(!
	`Ùx2_upd©e_rq_¡©s
(
pfvf
, 
qidx
)) {

182 
¡©
 = 0; sˆ< 
Ùx2_n_queue_¡©s
; stat++)

183 *((*
d©a
)++) = 0;

186 
¡©
 = 0; sˆ< 
Ùx2_n_queue_¡©s
; stat++)

187 *((*
d©a
)++èğ((
u64
 *)&
pfvf
->
q£t
.
rq
[
qidx
].
¡©s
)

188 [
Ùx2_queue_¡©s
[
¡©
].
šdex
];

190 
qidx
 = 0; qidx < 
	`Ùx2_g‘_tÙ®_txq_couÁ
(
pfvf
); qidx++) {

191 ià(!
	`Ùx2_upd©e_sq_¡©s
(
pfvf
, 
qidx
)) {

192 
¡©
 = 0; sˆ< 
Ùx2_n_queue_¡©s
; stat++)

193 *((*
d©a
)++) = 0;

197 
¡©
 = 0; sˆ< 
Ùx2_n_queue_¡©s
; stat++)

198 *((*
d©a
)++èğ((
u64
 *)&
pfvf
->
q£t
.
sq
[
qidx
].
¡©s
)

199 [
Ùx2_queue_¡©s
[
¡©
].
šdex
];

201 
	}
}

203 
	$Ùx2_g‘_phy_ãc_¡©s
(
Ùx2_nic
 *
pfvf
)

205 
msg_»q
 *
»q
;

206 
rc
 = -
ENOMEM
;

208 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

209 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_g‘_phy_ãc_¡©s
(&
pfvf
->
mbox
);

210 ià(!
»q
)

211 
’d
;

213 ià(!
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
))

214 
rc
 = 0;

215 
’d
:

216 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

217  
rc
;

218 
	}
}

221 
	$Ùx2_g‘_‘htoŞ_¡©s
(
Ãt_deviû
 *
Ãtdev
,

222 
‘htoŞ_¡©s
 *
¡©s
, 
u64
 *
d©a
)

224 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

225 
u64
 
ãc_cÜr_blks
, 
ãc_uncÜr_blks
;

226 
cgx_fw_d©a
 *
r¥
;

227 
¡©
;

229 
	`Ùx2_g‘_dev_¡©s
(
pfvf
);

230 
¡©
 = 0; sˆ< 
Ùx2_n_dev_¡©s
; stat++)

231 *(
d©a
++èğ((
u64
 *)&
pfvf
->
hw
.
dev_¡©s
)

232 [
Ùx2_dev_¡©s
[
¡©
].
šdex
];

234 
¡©
 = 0; sˆ< 
Ùx2_n_drv_¡©s
; stat++)

235 *(
d©a
++èğ
	`©omic_»ad
(&((
©omic_t
 *)&
pfvf
->
hw
.
drv_¡©s
)

236 [
Ùx2_drv_¡©s
[
¡©
].
šdex
]);

238 
	`Ùx2_g‘_q£t_¡©s
(
pfvf
, 
¡©s
, &
d©a
);

240 ià(!
	`‹¡_b™
(
CN10K_RPM
, &
pfvf
->
hw
.
ÿp_æag
)) {

241 
	`Ùx2_upd©e_lmac_¡©s
(
pfvf
);

242 
¡©
 = 0; sˆ< 
CGX_RX_STATS_COUNT
; stat++)

243 *(
d©a
++èğ
pfvf
->
hw
.
cgx_rx_¡©s
[
¡©
];

244 
¡©
 = 0; sˆ< 
CGX_TX_STATS_COUNT
; stat++)

245 *(
d©a
++èğ
pfvf
->
hw
.
cgx_tx_¡©s
[
¡©
];

248 *(
d©a
++èğ
pfvf
->
»£t_couÁ
;

250 
ãc_cÜr_blks
 = 
pfvf
->
hw
.
cgx_ãc_cÜr_blks
;

251 
ãc_uncÜr_blks
 = 
pfvf
->
hw
.
cgx_ãc_uncÜr_blks
;

253 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

254 ià(!
	`IS_ERR
(
r¥
è&&„¥->
fwd©a
.
phy
.
misc
.
has_ãc_¡©s
 &&

255 !
	`Ùx2_g‘_phy_ãc_¡©s
(
pfvf
)) {

259 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

260 ià(!
	`IS_ERR
(
r¥
)) {

261 
ãc_¡©s_s
 *
p
 = &
r¥
->
fwd©a
.
phy
.
ãc_¡©s
;

263 ià(
pfvf
->
lšfo
.
ãc
 =ğ
OTX2_FEC_BASER
) {

264 
ãc_cÜr_blks
 = 
p
->
brãc_cÜr_blks
;

265 
ãc_uncÜr_blks
 = 
p
->
brãc_uncÜr_blks
;

267 
ãc_cÜr_blks
 = 
p
->
rsãc_cÜr_cws
;

268 
ãc_uncÜr_blks
 = 
p
->
rsãc_uncÜr_cws
;

273 *(
d©a
++èğ
ãc_cÜr_blks
;

274 *(
d©a
++èğ
ãc_uncÜr_blks
;

275 
	}
}

277 
	$Ùx2_g‘_s£t_couÁ
(
Ãt_deviû
 *
Ãtdev
, 
s£t
)

279 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

280 
q¡©s_couÁ
, 
mac_¡©s
 = 0;

282 ià(
s£t
 =ğ
ETH_SS_PRIV_FLAGS
)

283  
	`ARRAY_SIZE
(
Ùx2_´iv_æags_¡ršgs
);

285 ià(
s£t
 !ğ
ETH_SS_STATS
)

286  -
EINVAL
;

288 
q¡©s_couÁ
 = 
Ùx2_n_queue_¡©s
 *

289 (
pfvf
->
hw
.
rx_queues
 +…fvf->hw.
tÙ_tx_queues
 +

290 
pfvf
->
hw
.
tc_tx_queues
);

291 ià(!
	`‹¡_b™
(
CN10K_RPM
, &
pfvf
->
hw
.
ÿp_æag
))

292 
mac_¡©s
 = 
CGX_RX_STATS_COUNT
 + 
CGX_TX_STATS_COUNT
;

293 
	`Ùx2_upd©e_lmac_ãc_¡©s
(
pfvf
);

295  
Ùx2_n_dev_¡©s
 + 
Ùx2_n_drv_¡©s
 + 
q¡©s_couÁ
 +

296 
mac_¡©s
 + 
OTX2_FEC_STATS_CNT
 + 1;

297 
	}
}

300 
	$Ùx2_g‘_chªÃls
(
Ãt_deviû
 *
dev
,

301 
‘htoŞ_chªÃls
 *
chªÃl
)

303 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

305 
	`mem£t
(
chªÃl
, 0, (*channel));

306 
chªÃl
->
max_rx
 = 
pfvf
->
hw
.
max_queues
;

307 
chªÃl
->
max_tx
 = 
pfvf
->
hw
.
max_queues
;

309 
chªÃl
->
rx_couÁ
 = 
pfvf
->
hw
.
rx_queues
;

310 
chªÃl
->
tx_couÁ
 = 
pfvf
->
hw
.
tx_queues
;

311 
	}
}

314 
	$Ùx2_£t_chªÃls
(
Ãt_deviû
 *
dev
,

315 
‘htoŞ_chªÃls
 *
chªÃl
)

317 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

318 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
dev
);

319 
”r
 = 0, 
qos_txqs
;

321 ià(
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
))

322  -
EOPNOTSUPP
;

324 ià(!
chªÃl
->
rx_couÁ
 || !chªÃl->
tx_couÁ
)

325  -
EINVAL
;

326 ià(
chªÃl
->
rx_couÁ
 > 
pfvf
->
hw
.
max_queues
)

327  -
EINVAL
;

328 ià(
chªÃl
->
tx_couÁ
 > 
pfvf
->
hw
.
max_queues
)

329  -
EINVAL
;

331 ià(
	`b™m­_weight
(&
pfvf
->
rq_bm­
,…fvf->
hw
.
rx_queues
) > 1) {

332 
	`Ãtdev_”r
(
dev
,

334  -
EINVAL
;

337 ià(
if_up
)

338 
dev
->
Ãtdev_İs
->
	`ndo_¡İ
(dev);

340 
qos_txqs
 = 
	`b™m­_weight
(
pfvf
->
qos
.
qos_sq_bm­
,

341 
OTX2_QOS_MAX_LEAF_NODES
);

343 
”r
 = 
	`Ùx2_£t_»®_num_queues
(
dev
, 
chªÃl
->
tx_couÁ
 + 
qos_txqs
,

344 
chªÃl
->
rx_couÁ
);

345 ià(
”r
)

346  
”r
;

348 
pfvf
->
hw
.
rx_queues
 = 
chªÃl
->
rx_couÁ
;

349 
pfvf
->
hw
.
tx_queues
 = 
chªÃl
->
tx_couÁ
;

350 ià(
pfvf
->
xdp_´og
)

351 
pfvf
->
hw
.
xdp_queues
 = 
chªÃl
->
rx_couÁ
;

352 
pfvf
->
hw
.
tÙ_tx_queues
 =…fvf->hw.
tx_queues
 +…fvf->hw.
xdp_queues
;

353 
pfvf
->
q£t
.
cq_út
 =…fvf->
hw
.
tx_queues
 +…fvf->hw.
rx_queues
;

355 ià(
if_up
)

356 
”r
 = 
dev
->
Ãtdev_İs
->
	`ndo_İ’
(dev);

358 
	`Ãtdev_šfo
(
dev
, "Setting‚um Tx„ingso %d, Rx„ingso %d success\n",

359 
pfvf
->
hw
.
tx_queues
,…fvf->hw.
rx_queues
);

361  
”r
;

362 
	}
}

364 
	$Ùx2_g‘_·u£·¿m
(
Ãt_deviû
 *
Ãtdev
,

365 
‘htoŞ_·u£·¿m
 *
·u£
)

367 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

368 
cgx_·u£_äm_cfg
 *
»q
, *
r¥
;

370 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev))

373 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

374 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_cfg_·u£_äm
(&
pfvf
->
mbox
);

375 ià(!
»q
) {

376 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

380 ià(!
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
)) {

381 
r¥
 = (
cgx_·u£_äm_cfg
 *)

382 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

383 
·u£
->
rx_·u£
 = 
r¥
->rx_pause;

384 
·u£
->
tx_·u£
 = 
r¥
->tx_pause;

386 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

387 
	}
}

389 
	$Ùx2_£t_·u£·¿m
(
Ãt_deviû
 *
Ãtdev
,

390 
‘htoŞ_·u£·¿m
 *
·u£
)

392 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

394 ià(
·u£
->
autÚeg
)

395  -
EOPNOTSUPP
;

397 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev))

398  -
EOPNOTSUPP
;

400 ià(
·u£
->
rx_·u£
)

401 
pfvf
->
æags
 |ğ
OTX2_FLAG_RX_PAUSE_ENABLED
;

403 
pfvf
->
æags
 &ğ~
OTX2_FLAG_RX_PAUSE_ENABLED
;

405 ià(
·u£
->
tx_·u£
)

406 
pfvf
->
æags
 |ğ
OTX2_FLAG_TX_PAUSE_ENABLED
;

408 
pfvf
->
æags
 &ğ~
OTX2_FLAG_TX_PAUSE_ENABLED
;

410  
	`Ùx2_cÚfig_·u£_äm
(
pfvf
);

411 
	}
}

413 
	$Ùx2_g‘_ršg·¿m
(
Ãt_deviû
 *
Ãtdev
,

414 
‘htoŞ_ršg·¿m
 *
ršg
,

415 
k”Ãl_‘htoŞ_ršg·¿m
 *
k”Ãl_ršg
,

416 
Ãšk_ext_ack
 *
exck
)

418 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

419 
Ùx2_q£t
 *
qs
 = &
pfvf
->
q£t
;

421 
ršg
->
rx_max_³ndšg
 = 
	`Q_COUNT
(
Q_SIZE_MAX
);

422 
ršg
->
rx_³ndšg
 = 
qs
->
rqe_út
 ? qs->rqe_úˆ: 
	`Q_COUNT
(
Q_SIZE_256
);

423 
ršg
->
tx_max_³ndšg
 = 
	`Q_COUNT
(
Q_SIZE_MAX
);

424 
ršg
->
tx_³ndšg
 = 
qs
->
sqe_út
 ? qs->sqe_úˆ: 
	`Q_COUNT
(
Q_SIZE_4K
);

425 
	}
}

427 
	$Ùx2_£t_ršg·¿m
(
Ãt_deviû
 *
Ãtdev
,

428 
‘htoŞ_ršg·¿m
 *
ršg
,

429 
k”Ãl_‘htoŞ_ršg·¿m
 *
k”Ãl_ršg
,

430 
Ãšk_ext_ack
 *
exck
)

432 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

433 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

434 
Ùx2_q£t
 *
qs
 = &
pfvf
->
q£t
;

435 
u32
 
rx_couÁ
, 
tx_couÁ
;

437 ià(
ršg
->
rx_mši_³ndšg
 ||„šg->
rx_jumbo_³ndšg
)

438  -
EINVAL
;

441 
rx_couÁ
 = 
ršg
->
rx_³ndšg
;

445 ià(
rx_couÁ
 < 
pfvf
->
hw
.
rq_skid
)

446 
rx_couÁ
 = 
pfvf
->
hw
.
rq_skid
;

447 
rx_couÁ
 = 
	`Q_COUNT
(
	`Q_SIZE
(rx_count, 3));

453 
tx_couÁ
 = 
	`şamp_t
(
u32
, 
ršg
->
tx_³ndšg
,

454 
	`Q_COUNT
(
Q_SIZE_4K
), Q_COUNT(
Q_SIZE_MAX
));

455 
tx_couÁ
 = 
	`Q_COUNT
(
	`Q_SIZE
(tx_count, 3));

457 ià(
tx_couÁ
 =ğ
qs
->
sqe_út
 && 
rx_couÁ
 =ğqs->
rqe_út
)

460 ià(
if_up
)

461 
Ãtdev
->
Ãtdev_İs
->
	`ndo_¡İ
(netdev);

464 
qs
->
sqe_út
 = 
tx_couÁ
;

465 
qs
->
rqe_út
 = 
rx_couÁ
;

467 ià(
if_up
)

468  
Ãtdev
->
Ãtdev_İs
->
	`ndo_İ’
(netdev);

471 
	}
}

473 
	$Ùx2_g‘_cßËsû
(
Ãt_deviû
 *
Ãtdev
,

474 
‘htoŞ_cßËsû
 *
cmd
)

476 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

477 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

479 
cmd
->
rx_cßËsû_u£cs
 = 
hw
->
cq_time_wa™
;

480 
cmd
->
rx_max_cßËsûd_äames
 = 
hw
->
cq_ecouÁ_wa™
;

481 
cmd
->
tx_cßËsû_u£cs
 = 
hw
->
cq_time_wa™
;

482 
cmd
->
tx_max_cßËsûd_äames
 = 
hw
->
cq_ecouÁ_wa™
;

483 ià((
pfvf
->
æags
 & 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
) ==

484 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
) {

485 
cmd
->
u£_ad­tive_rx_cßËsû
 = 1;

486 
cmd
->
u£_ad­tive_tx_cßËsû
 = 1;

488 
cmd
->
u£_ad­tive_rx_cßËsû
 = 0;

489 
cmd
->
u£_ad­tive_tx_cßËsû
 = 0;

493 
	}
}

495 
	$Ùx2_£t_cßËsû
(
Ãt_deviû
 *
Ãtdev
,

496 
‘htoŞ_cßËsû
 *
ec
)

498 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

499 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

500 
u8
 
´iv_cßËsû_¡©us
;

501 
qidx
;

503 ià(
ec
->
rx_cßËsû_u£cs_œq
 ||ƒc->
rx_max_cßËsûd_äames_œq
 ||

504 
ec
->
tx_cßËsû_u£cs_œq
 ||ƒc->
tx_max_cßËsûd_äames_œq
 ||

505 
ec
->
¡©s_block_cßËsû_u£cs
 ||ƒc->
pkt_¿‹_low
 ||

506 
ec
->
rx_cßËsû_u£cs_low
 ||ƒc->
rx_max_cßËsûd_äames_low
 ||

507 
ec
->
tx_cßËsû_u£cs_low
 ||ƒc->
tx_max_cßËsûd_äames_low
 ||

508 
ec
->
pkt_¿‹_high
 ||ƒc->
rx_cßËsû_u£cs_high
 ||

509 
ec
->
rx_max_cßËsûd_äames_high
 ||ƒc->
tx_cßËsû_u£cs_high
 ||

510 
ec
->
tx_max_cßËsûd_äames_high
 ||ƒc->
¿‹_§m¶e_š‹rv®
)

511  -
EOPNOTSUPP
;

513 ià(!
ec
->
rx_max_cßËsûd_äames
 || !ec->
tx_max_cßËsûd_äames
)

516 ià(
ec
->
u£_ad­tive_rx_cßËsû
 !ğec->
u£_ad­tive_tx_cßËsû
) {

517 
	`Ãtdev_”r
(
Ãtdev
, "adaptive-rx should be same‡s‡daptive-tx");

518  -
EINVAL
;

522 ià((
pfvf
->
æags
 & 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
) ==

523 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
) {

524 
´iv_cßËsû_¡©us
 = 1;

525 ià(!
ec
->
u£_ad­tive_rx_cßËsû
)

526 
pfvf
->
æags
 &ğ~
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
;

528 
´iv_cßËsû_¡©us
 = 0;

529 ià(
ec
->
u£_ad­tive_rx_cßËsû
)

530 
pfvf
->
æags
 |ğ
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
;

536 
ec
->
rx_cßËsû_u£cs
 = 
	`şamp_t
(
u32
,ƒc->rx_coalesce_usecs,

537 1, 
CQ_TIMER_THRESH_MAX
);

538 
ec
->
tx_cßËsû_u£cs
 = 
	`şamp_t
(
u32
,ƒc->tx_coalesce_usecs,

539 1, 
CQ_TIMER_THRESH_MAX
);

544 ià(
hw
->
cq_time_wa™
 =ğ
ec
->
rx_cßËsû_u£cs
)

545 
hw
->
cq_time_wa™
 = 
ec
->
tx_cßËsû_u£cs
;

546 ià(
hw
->
cq_time_wa™
 =ğ
ec
->
tx_cßËsû_u£cs
)

547 
hw
->
cq_time_wa™
 = 
ec
->
rx_cßËsû_u£cs
;

549 
hw
->
cq_time_wa™
 = 
	`mš_t
(
u8
, 
ec
->
rx_cßËsû_u£cs
,

550 
ec
->
tx_cßËsû_u£cs
);

555 
ec
->
rx_max_cßËsûd_äames
 = 
	`şamp_t
(
u32
,ƒc->rx_max_coalesced_frames,

556 1, 
NAPI_POLL_WEIGHT
);

557 
ec
->
tx_max_cßËsûd_äames
 = 
	`şamp_t
(
u32
,ƒc->tx_max_coalesced_frames,

558 1, 
NAPI_POLL_WEIGHT
);

563 ià(
hw
->
cq_ecouÁ_wa™
 =ğ
ec
->
rx_max_cßËsûd_äames
)

564 
hw
->
cq_ecouÁ_wa™
 = 
ec
->
tx_max_cßËsûd_äames
;

565 ià(
hw
->
cq_ecouÁ_wa™
 =ğ
ec
->
tx_max_cßËsûd_äames
)

566 
hw
->
cq_ecouÁ_wa™
 = 
ec
->
rx_max_cßËsûd_äames
;

568 
hw
->
cq_ecouÁ_wa™
 = 
	`mš_t
(
u16
, 
ec
->
rx_max_cßËsûd_äames
,

569 
ec
->
tx_max_cßËsûd_äames
);

575 ià(
´iv_cßËsû_¡©us
 &&

576 ((
pfvf
->
æags
 & 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
) !=

577 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
)) {

578 
hw
->
cq_time_wa™
 = 
CQ_TIMER_THRESH_DEFAULT
;

579 
hw
->
cq_ecouÁ_wa™
 = 
CQ_CQE_THRESH_DEFAULT
;

582 ià(
	`Ãtif_ruÂšg
(
Ãtdev
)) {

583 
qidx
 = 0; qidx < 
pfvf
->
hw
.
cšt_út
; qidx++)

584 
	`Ùx2_cÚfig_œq_cßËscšg
(
pfvf
, 
qidx
);

588 
	}
}

590 
	$Ùx2_g‘_rss_hash_İts
(
Ùx2_nic
 *
pfvf
,

591 
‘htoŞ_rxnfc
 *
nfc
)

593 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

595 ià(!(
rss
->
æowkey_cfg
 &

596 (
NIX_FLOW_KEY_TYPE_IPV4
 | 
NIX_FLOW_KEY_TYPE_IPV6
)))

600 
nfc
->
d©a
 = 
RXH_IP_SRC
 | 
RXH_IP_DST
;

601 ià(
rss
->
æowkey_cfg
 & 
NIX_FLOW_KEY_TYPE_VLAN
)

602 
nfc
->
d©a
 |ğ
RXH_VLAN
;

604 
nfc
->
æow_ty³
) {

605 
TCP_V4_FLOW
:

606 
TCP_V6_FLOW
:

607 ià(
rss
->
æowkey_cfg
 & 
NIX_FLOW_KEY_TYPE_TCP
)

608 
nfc
->
d©a
 |ğ
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

610 
UDP_V4_FLOW
:

611 
UDP_V6_FLOW
:

612 ià(
rss
->
æowkey_cfg
 & 
NIX_FLOW_KEY_TYPE_UDP
)

613 
nfc
->
d©a
 |ğ
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

615 
SCTP_V4_FLOW
:

616 
SCTP_V6_FLOW
:

617 ià(
rss
->
æowkey_cfg
 & 
NIX_FLOW_KEY_TYPE_SCTP
)

618 
nfc
->
d©a
 |ğ
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

620 
AH_ESP_V4_FLOW
:

621 
AH_ESP_V6_FLOW
:

622 ià(
rss
->
æowkey_cfg
 & 
NIX_FLOW_KEY_TYPE_ESP
)

623 
nfc
->
d©a
 |ğ
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

625 
AH_V4_FLOW
:

626 
ESP_V4_FLOW
:

627 
IPV4_FLOW
:

629 
AH_V6_FLOW
:

630 
ESP_V6_FLOW
:

631 
IPV6_FLOW
:

634  -
EINVAL
;

638 
	}
}

640 
	$Ùx2_£t_rss_hash_İts
(
Ùx2_nic
 *
pfvf
,

641 
‘htoŞ_rxnfc
 *
nfc
)

643 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

644 
u32
 
rxh_l4
 = 
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

645 
u32
 
rss_cfg
 = 
rss
->
æowkey_cfg
;

647 ià(!
rss
->
’abË
) {

648 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

650  -
EIO
;

654 ià(!(
nfc
->
d©a
 & 
RXH_IP_SRC
è|| !Òfc->d©¨& 
RXH_IP_DST
))

655  -
EINVAL
;

657 ià(
nfc
->
d©a
 & 
RXH_VLAN
)

658 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_VLAN
;

660 
rss_cfg
 &ğ~
NIX_FLOW_KEY_TYPE_VLAN
;

662 
nfc
->
æow_ty³
) {

663 
TCP_V4_FLOW
:

664 
TCP_V6_FLOW
:

668 
nfc
->
d©a
 & 
rxh_l4
) {

670 
rss_cfg
 &ğ~
NIX_FLOW_KEY_TYPE_TCP
;

672 (
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
):

673 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_TCP
;

676  -
EINVAL
;

679 
UDP_V4_FLOW
:

680 
UDP_V6_FLOW
:

681 
nfc
->
d©a
 & 
rxh_l4
) {

683 
rss_cfg
 &ğ~
NIX_FLOW_KEY_TYPE_UDP
;

685 (
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
):

686 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_UDP
;

689  -
EINVAL
;

692 
SCTP_V4_FLOW
:

693 
SCTP_V6_FLOW
:

694 
nfc
->
d©a
 & 
rxh_l4
) {

696 
rss_cfg
 &ğ~
NIX_FLOW_KEY_TYPE_SCTP
;

698 (
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
):

699 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_SCTP
;

702  -
EINVAL
;

705 
AH_ESP_V4_FLOW
:

706 
AH_ESP_V6_FLOW
:

707 
nfc
->
d©a
 & 
rxh_l4
) {

709 
rss_cfg
 &ğ~(
NIX_FLOW_KEY_TYPE_ESP
 |

710 
NIX_FLOW_KEY_TYPE_AH
);

711 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_VLAN
 |

712 
NIX_FLOW_KEY_TYPE_IPV4_PROTO
;

714 (
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
):

718 ià(
rss_cfg
 & 
NIX_FLOW_KEY_TYPE_VLAN
) {

719 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

721  -
EOPNOTSUPP
;

724 
rss_cfg
 |ğ
NIX_FLOW_KEY_TYPE_ESP
 | 
NIX_FLOW_KEY_TYPE_AH
;

729 
rss_cfg
 &ğ~
NIX_FLOW_KEY_TYPE_IPV4_PROTO
;

732  -
EINVAL
;

735 
IPV4_FLOW
:

736 
IPV6_FLOW
:

737 
rss_cfg
 = 
NIX_FLOW_KEY_TYPE_IPV4
 | 
NIX_FLOW_KEY_TYPE_IPV6
;

740  -
EINVAL
;

743 
rss
->
æowkey_cfg
 = 
rss_cfg
;

744 
	`Ùx2_£t_æowkey_cfg
(
pfvf
);

746 
	}
}

748 
	$Ùx2_g‘_rxnfc
(
Ãt_deviû
 *
dev
,

749 
‘htoŞ_rxnfc
 *
nfc
, 
u32
 *
ruËs
)

751 
boŞ
 
Áu¶e
 = !!(
dev
->
ã©u»s
 & 
NETIF_F_NTUPLE
);

752 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

753 
»t
 = -
EOPNOTSUPP
;

755 
nfc
->
cmd
) {

756 
ETHTOOL_GRXRINGS
:

757 
nfc
->
d©a
 = 
pfvf
->
hw
.
rx_queues
;

758 
»t
 = 0;

760 
ETHTOOL_GRXCLSRLCNT
:

761 ià(
	`Ãtif_ruÂšg
(
dev
è&& 
Áu¶e
) {

762 
nfc
->
ruË_út
 = 
pfvf
->
æow_cfg
->
Ä_æows
;

763 
»t
 = 0;

766 
ETHTOOL_GRXCLSRULE
:

767 ià(
	`Ãtif_ruÂšg
(
dev
è&& 
Áu¶e
)

768 
»t
 = 
	`Ùx2_g‘_æow
(
pfvf
, 
nfc
,‚fc->
fs
.
loÿtiÚ
);

770 
ETHTOOL_GRXCLSRLALL
:

771 ià(
	`Ãtif_ruÂšg
(
dev
è&& 
Áu¶e
)

772 
»t
 = 
	`Ùx2_g‘_®l_æows
(
pfvf
, 
nfc
, 
ruËs
);

774 
ETHTOOL_GRXFH
:

775  
	`Ùx2_g‘_rss_hash_İts
(
pfvf
, 
nfc
);

779  
»t
;

780 
	}
}

782 
	$Ùx2_£t_rxnfc
(
Ãt_deviû
 *
dev
, 
‘htoŞ_rxnfc
 *
nfc
)

784 
boŞ
 
Áu¶e
 = !!(
dev
->
ã©u»s
 & 
NETIF_F_NTUPLE
);

785 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

786 
»t
 = -
EOPNOTSUPP
;

788 
nfc
->
cmd
) {

789 
ETHTOOL_SRXFH
:

790 
»t
 = 
	`Ùx2_£t_rss_hash_İts
(
pfvf
, 
nfc
);

792 
ETHTOOL_SRXCLSRLINS
:

793 ià(
	`Ãtif_ruÂšg
(
dev
è&& 
Áu¶e
)

794 
»t
 = 
	`Ùx2_add_æow
(
pfvf
, 
nfc
);

796 
ETHTOOL_SRXCLSRLDEL
:

797 ià(
	`Ãtif_ruÂšg
(
dev
è&& 
Áu¶e
)

798 
»t
 = 
	`Ùx2_»move_æow
(
pfvf
, 
nfc
->
fs
.
loÿtiÚ
);

804  
»t
;

805 
	}
}

807 
u32
 
	$Ùx2_g‘_rxfh_key_size
(
Ãt_deviû
 *
Ãtdev
)

809 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

810 
Ùx2_rss_šfo
 *
rss
;

812 
rss
 = &
pfvf
->
hw
.
rss_šfo
;

814  (
rss
->
key
);

815 
	}
}

817 
u32
 
	$Ùx2_g‘_rxfh_šdœ_size
(
Ãt_deviû
 *
dev
)

819  
MAX_RSS_INDIR_TBL_SIZE
;

820 
	}
}

822 
	$Ùx2_rss_ùx_d–‘e
(
Ùx2_nic
 *
pfvf
, 
ùx_id
)

824 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

826 
	`Ùx2_rss_ùx_æow_d–
(
pfvf
, 
ùx_id
);

827 
	`kä“
(
rss
->
rss_ùx
[
ùx_id
]);

828 
rss
->
rss_ùx
[
ùx_id
] = 
NULL
;

831 
	}
}

833 
	$Ùx2_rss_ùx_ü—‹
(
Ùx2_nic
 *
pfvf
,

834 
u32
 *
rss_cÚ‹xt
)

836 
Ùx2_rss_šfo
 *
rss
 = &
pfvf
->
hw
.
rss_šfo
;

837 
u8
 
ùx
;

839 
ùx
 = 0; ctx < 
MAX_RSS_GROUPS
; ctx++) {

840 ià(!
rss
->
rss_ùx
[
ùx
])

843 ià(
ùx
 =ğ
MAX_RSS_GROUPS
)

844  -
EINVAL
;

846 
rss
->
rss_ùx
[
ùx
] = 
	`kz®loc
((*rss->rss_ùx[ùx]), 
GFP_KERNEL
);

847 ià(!
rss
->
rss_ùx
[
ùx
])

848  -
ENOMEM
;

849 *
rss_cÚ‹xt
 = 
ùx
;

852 
	}
}

855 
	$Ùx2_£t_rxfh_cÚ‹xt
(
Ãt_deviû
 *
dev
, cÚ¡ 
u32
 *
šdœ
,

856 cÚ¡ 
u8
 *
hkey
, cÚ¡ u8 
hfunc
,

857 
u32
 *
rss_cÚ‹xt
, 
boŞ
 
d–‘e
)

859 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

860 
Ùx2_rss_ùx
 *
rss_ùx
;

861 
Ùx2_rss_šfo
 *
rss
;

862 
»t
, 
idx
;

864 ià(
hfunc
 !ğ
ETH_RSS_HASH_NO_CHANGE
 && hfunø!ğ
ETH_RSS_HASH_TOP
)

865  -
EOPNOTSUPP
;

867 ià(*
rss_cÚ‹xt
 !ğ
ETH_RXFH_CONTEXT_ALLOC
 &&

868 *
rss_cÚ‹xt
 >ğ
MAX_RSS_GROUPS
)

869  -
EINVAL
;

871 
rss
 = &
pfvf
->
hw
.
rss_šfo
;

873 ià(!
rss
->
’abË
) {

874 
	`Ãtdev_”r
(
dev
, "RSS is disabled, cannot change settings\n");

875  -
EIO
;

878 ià(
hkey
) {

879 
	`memıy
(
rss
->
key
, 
hkey
, (rss->key));

880 
	`Ùx2_£t_rss_key
(
pfvf
);

882 ià(
d–‘e
)

883  
	`Ùx2_rss_ùx_d–‘e
(
pfvf
, *
rss_cÚ‹xt
);

885 ià(*
rss_cÚ‹xt
 =ğ
ETH_RXFH_CONTEXT_ALLOC
) {

886 
»t
 = 
	`Ùx2_rss_ùx_ü—‹
(
pfvf
, 
rss_cÚ‹xt
);

887 ià(
»t
)

888  
»t
;

890 ià(
šdœ
) {

891 
rss_ùx
 = 
rss
->rss_ùx[*
rss_cÚ‹xt
];

892 
idx
 = 0; idx < 
rss
->
rss_size
; idx++)

893 
rss_ùx
->
šd_tbl
[
idx
] = 
šdœ
[idx];

895 
	`Ùx2_£t_rss_bË
(
pfvf
, *
rss_cÚ‹xt
);

898 
	}
}

900 
	$Ùx2_g‘_rxfh_cÚ‹xt
(
Ãt_deviû
 *
dev
, 
u32
 *
šdœ
,

901 
u8
 *
hkey
, u8 *
hfunc
, 
u32
 
rss_cÚ‹xt
)

903 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
dev
);

904 
Ùx2_rss_ùx
 *
rss_ùx
;

905 
Ùx2_rss_šfo
 *
rss
;

906 
idx
, 
rx_queues
;

908 
rss
 = &
pfvf
->
hw
.
rss_šfo
;

910 ià(
hfunc
)

911 *
hfunc
 = 
ETH_RSS_HASH_TOP
;

913 ià(!
šdœ
)

916 ià(!
rss
->
’abË
 && 
rss_cÚ‹xt
 =ğ
DEFAULT_RSS_CONTEXT_GROUP
) {

917 
rx_queues
 = 
pfvf
->
hw
.rx_queues;

918 
idx
 = 0; idx < 
MAX_RSS_INDIR_TBL_SIZE
; idx++)

919 
šdœ
[
idx
] = 
	`‘htoŞ_rxfh_šdœ_deçuÉ
(idx, 
rx_queues
);

922 ià(
rss_cÚ‹xt
 >ğ
MAX_RSS_GROUPS
)

923  -
ENOENT
;

925 
rss_ùx
 = 
rss
->rss_ùx[
rss_cÚ‹xt
];

926 ià(!
rss_ùx
)

927  -
ENOENT
;

929 ià(
šdœ
) {

930 
idx
 = 0; idx < 
rss
->
rss_size
; idx++)

931 
šdœ
[
idx
] = 
rss_ùx
->
šd_tbl
[idx];

933 ià(
hkey
)

934 
	`memıy
(
hkey
, 
rss
->
key
, (rss->key));

937 
	}
}

940 
	$Ùx2_g‘_rxfh
(
Ãt_deviû
 *
dev
, 
u32
 *
šdœ
,

941 
u8
 *
hkey
, u8 *
hfunc
)

943  
	`Ùx2_g‘_rxfh_cÚ‹xt
(
dev
, 
šdœ
, 
hkey
, 
hfunc
,

944 
DEFAULT_RSS_CONTEXT_GROUP
);

945 
	}
}

948 
	$Ùx2_£t_rxfh
(
Ãt_deviû
 *
dev
, cÚ¡ 
u32
 *
šdœ
,

949 cÚ¡ 
u8
 *
hkey
, cÚ¡ u8 
hfunc
)

951 
u32
 
rss_cÚ‹xt
 = 
DEFAULT_RSS_CONTEXT_GROUP
;

953  
	`Ùx2_£t_rxfh_cÚ‹xt
(
dev
, 
šdœ
, 
hkey
, 
hfunc
, &
rss_cÚ‹xt
, 0);

954 
	}
}

956 
u32
 
	$Ùx2_g‘_msgËv–
(
Ãt_deviû
 *
Ãtdev
)

958 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

960  
pfvf
->
msg_’abË
;

961 
	}
}

963 
	$Ùx2_£t_msgËv–
(
Ãt_deviû
 *
Ãtdev
, 
u32
 
v®
)

965 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

967 
pfvf
->
msg_’abË
 = 
v®
;

968 
	}
}

970 
u32
 
	$Ùx2_g‘_lšk
(
Ãt_deviû
 *
Ãtdev
)

972 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

975 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev))

977  
pfvf
->
lšfo
.
lšk_up
;

978 
	}
}

980 
	$Ùx2_g‘_ts_šfo
(
Ãt_deviû
 *
Ãtdev
,

981 
‘htoŞ_ts_šfo
 *
šfo
)

983 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

985 ià(!
pfvf
->
±p
)

986  
	`‘htoŞ_İ_g‘_ts_šfo
(
Ãtdev
, 
šfo
);

988 ià(
	`is_Ùx2_sdpvf
(
pfvf
->
pdev
)) {

989 
šfo
->
so_time¡ampšg
 = 
SOF_TIMESTAMPING_TX_SOFTWARE
 |

990 
SOF_TIMESTAMPING_RX_SOFTWARE
 |

991 
SOF_TIMESTAMPING_SOFTWARE
;

995 
šfo
->
so_time¡ampšg
 = 
SOF_TIMESTAMPING_TX_SOFTWARE
 |

996 
SOF_TIMESTAMPING_RX_SOFTWARE
 |

997 
SOF_TIMESTAMPING_SOFTWARE
 |

998 
SOF_TIMESTAMPING_TX_HARDWARE
 |

999 
SOF_TIMESTAMPING_RX_HARDWARE
 |

1000 
SOF_TIMESTAMPING_RAW_HARDWARE
;

1002 
šfo
->
phc_šdex
 = 
	`Ùx2_±p_şock_šdex
(
pfvf
);

1004 
šfo
->
tx_ty³s
 = 
	`BIT
(
HWTSTAMP_TX_OFF
è| BIT(
HWTSTAMP_TX_ON
);

1005 ià(
	`‹¡_b™
(
CN10K_PTP_ONESTEP
, &
pfvf
->
hw
.
ÿp_æag
))

1006 
šfo
->
tx_ty³s
 |ğ
	`BIT
(
HWTSTAMP_TX_ONESTEP_SYNC
);

1008 
šfo
->
rx_f‹rs
 = 
	`BIT
(
HWTSTAMP_FILTER_NONE
) |

1009 
	`BIT
(
HWTSTAMP_FILTER_ALL
);

1012 
	}
}

1014 
cgx_fw_d©a
 *
	$Ùx2_g‘_fwd©a
(
Ùx2_nic
 *
pfvf
)

1016 
cgx_fw_d©a
 *
r¥
 = 
NULL
;

1017 
msg_»q
 *
»q
;

1018 
”r
 = 0;

1020 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1021 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_g‘_aux_lšk_šfo
(&
pfvf
->
mbox
);

1022 ià(!
»q
) {

1023 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1024  
	`ERR_PTR
(-
ENOMEM
);

1027 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1028 ià(!
”r
) {

1029 
r¥
 = (
cgx_fw_d©a
 *)

1030 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

1032 
r¥
 = 
	`ERR_PTR
(
”r
);

1035 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1036  
r¥
;

1037 
	}
}

1039 
	$Ùx2_g‘_ãı¬am
(
Ãt_deviû
 *
Ãtdev
,

1040 
‘htoŞ_ãı¬am
 *
ãı¬am
)

1042 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1043 
cgx_fw_d©a
 *
r¥
;

1044 cÚ¡ 
ãc
[] = {

1045 
ETHTOOL_FEC_OFF
,

1046 
ETHTOOL_FEC_BASER
,

1047 
ETHTOOL_FEC_RS
,

1048 
ETHTOOL_FEC_BASER
 | 
ETHTOOL_FEC_RS


1051 ià(
pfvf
->
lšfo
.
ãc
 < 
	`ARRAY_SIZE
(fec))

1052 
ãı¬am
->
aùive_ãc
 = 
ãc
[
pfvf
->
lšfo
.fec];

1054 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1055 ià(
	`IS_ERR
(
r¥
))

1056  
	`PTR_ERR
(
r¥
);

1058 ià(
r¥
->
fwd©a
.
suµÜ‹d_ãc
 < 
	`ARRAY_SIZE
(
ãc
)) {

1059 ià(!
r¥
->
fwd©a
.
suµÜ‹d_ãc
)

1060 
ãı¬am
->
ãc
 = 
ETHTOOL_FEC_NONE
;

1062 
ãı¬am
->
ãc
 = fec[
r¥
->
fwd©a
.
suµÜ‹d_ãc
];

1065 
	}
}

1067 
	$Ùx2_£t_ãı¬am
(
Ãt_deviû
 *
Ãtdev
,

1068 
‘htoŞ_ãı¬am
 *
ãı¬am
)

1070 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1071 
mbox
 *mbox = &
pfvf
->mbox;

1072 
ãc_mode
 *
»q
, *
r¥
;

1073 
”r
 = 0, 
ãc
 = 0;

1075 
ãı¬am
->
ãc
) {

1077 
ETHTOOL_FEC_OFF
:

1078 
ETHTOOL_FEC_AUTO
:

1079 
ãc
 = 
OTX2_FEC_OFF
;

1081 
ETHTOOL_FEC_RS
:

1082 
ãc
 = 
OTX2_FEC_RS
;

1084 
ETHTOOL_FEC_BASER
:

1085 
ãc
 = 
OTX2_FEC_BASER
;

1088 
	`Ãtdev_w¬n
(
pfvf
->
Ãtdev
, "Unsupported FEC mode: %d",

1089 
ãı¬am
->
ãc
);

1090  -
EINVAL
;

1093 ià(
ãc
 =ğ
pfvf
->
lšfo
.fec)

1096 
	`mu‹x_lock
(&
mbox
->
lock
);

1097 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_£t_ãc_·¿m
(&
pfvf
->
mbox
);

1098 ià(!
»q
) {

1099 
”r
 = -
ENOMEM
;

1100 
’d
;

1102 
»q
->
ãc
 = fec;

1103 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1104 ià(
”r
)

1105 
’d
;

1107 
r¥
 = (
ãc_mode
 *)
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox,

1108 0, &
»q
->
hdr
);

1109 ià(
r¥
->
ãc
 >= 0)

1110 
pfvf
->
lšfo
.
ãc
 = 
r¥
->fec;

1112 
”r
 = 
r¥
->
ãc
;

1113 
’d
:

1114 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1115  
”r
;

1116 
	}
}

1118 
	$Ùx2_g‘_ãc_šfo
(
u64
 
šdex
, 
»q_mode
,

1119 
‘htoŞ_lšk_k£‰šgs
 *
lšk_k£‰šgs
)

1121 
	`__ETHTOOL_DECLARE_LINK_MODE_MASK
(
Ùx2_ãc_modes
) = { 0, };

1123 
šdex
) {

1124 
OTX2_FEC_NONE
:

1125 
	`lškmode_£t_b™
(
ETHTOOL_LINK_MODE_FEC_NONE_BIT
,

1126 
Ùx2_ãc_modes
);

1128 
OTX2_FEC_BASER
:

1129 
	`lškmode_£t_b™
(
ETHTOOL_LINK_MODE_FEC_BASER_BIT
,

1130 
Ùx2_ãc_modes
);

1132 
OTX2_FEC_RS
:

1133 
	`lškmode_£t_b™
(
ETHTOOL_LINK_MODE_FEC_RS_BIT
,

1134 
Ùx2_ãc_modes
);

1136 
OTX2_FEC_BASER
 | 
OTX2_FEC_RS
:

1137 
	`lškmode_£t_b™
(
ETHTOOL_LINK_MODE_FEC_BASER_BIT
,

1138 
Ùx2_ãc_modes
);

1139 
	`lškmode_£t_b™
(
ETHTOOL_LINK_MODE_FEC_RS_BIT
,

1140 
Ùx2_ãc_modes
);

1145 ià(
»q_mode
 =ğ
OTX2_MODE_ADVERTISED
)

1146 
	`lškmode_Ü
(
lšk_k£‰šgs
->
lšk_modes
.
adv”tisšg
,

1147 
lšk_k£‰šgs
->
lšk_modes
.
adv”tisšg
,

1148 
Ùx2_ãc_modes
);

1150 
	`lškmode_Ü
(
lšk_k£‰šgs
->
lšk_modes
.
suµÜ‹d
,

1151 
lšk_k£‰šgs
->
lšk_modes
.
suµÜ‹d
,

1152 
Ùx2_ãc_modes
);

1153 
	}
}

1155 
	$Ùx2_g‘_lšk_mode_šfo
(
u64
 
lšk_mode_bm­
,

1156 
boŞ
 
»q_mode
,

1157 
‘htoŞ_lšk_k£‰šgs


1158 *
lšk_k£‰šgs
)

1160 
	`__ETHTOOL_DECLARE_LINK_MODE_MASK
(
Ùx2_lšk_modes
) = { 0, };

1161 cÚ¡ 
Ùx2_sgmii_ã©u»s
[6] = {

1162 
ETHTOOL_LINK_MODE_10ba£T_H®f_BIT
,

1163 
ETHTOOL_LINK_MODE_10ba£T_FuÎ_BIT
,

1164 
ETHTOOL_LINK_MODE_100ba£T_H®f_BIT
,

1165 
ETHTOOL_LINK_MODE_100ba£T_FuÎ_BIT
,

1166 
ETHTOOL_LINK_MODE_1000ba£T_H®f_BIT
,

1167 
ETHTOOL_LINK_MODE_1000ba£T_FuÎ_BIT
,

1170 cÚ¡ 
cgx_lšk_mode
[38] = {

1172 
ETHTOOL_LINK_MODE_1000ba£X_FuÎ_BIT
,

1173 
ETHTOOL_LINK_MODE_10000ba£T_FuÎ_BIT
,

1174 
ETHTOOL_LINK_MODE_10000ba£SR_FuÎ_BIT
,

1175 
ETHTOOL_LINK_MODE_10000ba£LR_FuÎ_BIT
,

1176 
ETHTOOL_LINK_MODE_10000ba£KR_FuÎ_BIT
,

1177 
ETHTOOL_LINK_MODE_20000ba£MLD2_FuÎ_BIT
,

1178 
ETHTOOL_LINK_MODE_25000ba£SR_FuÎ_BIT
,

1179 
ETHTOOL_LINK_MODE_10000ba£R_FEC_BIT
,

1180 
ETHTOOL_LINK_MODE_20000ba£KR2_FuÎ_BIT
,

1181 
ETHTOOL_LINK_MODE_25000ba£CR_FuÎ_BIT
,

1182 
ETHTOOL_LINK_MODE_25000ba£KR_FuÎ_BIT
,

1183 
ETHTOOL_LINK_MODE_40000ba£SR4_FuÎ_BIT
,

1184 
ETHTOOL_LINK_MODE_40000ba£LR4_FuÎ_BIT
,

1185 
ETHTOOL_LINK_MODE_40000ba£CR4_FuÎ_BIT
,

1186 
ETHTOOL_LINK_MODE_40000ba£KR4_FuÎ_BIT
,

1187 
ETHTOOL_LINK_MODE_10000ba£KX4_FuÎ_BIT
,

1188 
ETHTOOL_LINK_MODE_50000ba£SR2_FuÎ_BIT
,

1189 
ETHTOOL_LINK_MODE_50000ba£DR_FuÎ_BIT
,

1190 
ETHTOOL_LINK_MODE_56000ba£KR4_FuÎ_BIT
,

1191 
ETHTOOL_LINK_MODE_50000ba£CR2_FuÎ_BIT
,

1192 
ETHTOOL_LINK_MODE_50000ba£KR2_FuÎ_BIT
,

1193 
ETHTOOL_LINK_MODE_10000ba£LRM_FuÎ_BIT
,

1194 
ETHTOOL_LINK_MODE_100000ba£SR4_FuÎ_BIT
,

1195 
ETHTOOL_LINK_MODE_100000ba£LR4_ER4_FuÎ_BIT
,

1196 
ETHTOOL_LINK_MODE_100000ba£CR4_FuÎ_BIT
,

1197 
ETHTOOL_LINK_MODE_100000ba£KR4_FuÎ_BIT
,

1198 
ETHTOOL_LINK_MODE_50000ba£SR_FuÎ_BIT
,

1199 
ETHTOOL_LINK_MODE_50000ba£LR_ER_FR_FuÎ_BIT
,

1200 
ETHTOOL_LINK_MODE_50000ba£CR_FuÎ_BIT
,

1201 
ETHTOOL_LINK_MODE_50000ba£KR_FuÎ_BIT
,

1202 
ETHTOOL_LINK_MODE_100000ba£SR2_FuÎ_BIT
,

1203 
ETHTOOL_LINK_MODE_100000ba£LR2_ER2_FR2_FuÎ_BIT
,

1204 
ETHTOOL_LINK_MODE_100000ba£CR2_FuÎ_BIT
,

1205 
ETHTOOL_LINK_MODE_100000ba£KR2_FuÎ_BIT
,

1206 
ETHTOOL_LINK_MODE_1000ba£KX_FuÎ_BIT
,

1207 
ETHTOOL_LINK_MODE_56000ba£CR4_FuÎ_BIT
,

1208 
ETHTOOL_LINK_MODE_56000ba£SR4_FuÎ_BIT


1210 
u8
 
b™
;

1212 
	`fÜ_—ch_£t_b™
(
b™
, (*)&
lšk_mode_bm­
,

1213 
	`ARRAY_SIZE
(
cgx_lšk_mode
)) {

1215 ià(
b™
 == 0)

1216 
	`lškmode_£t_b™_¬¿y
(
Ùx2_sgmii_ã©u»s
,

1217 
	`ARRAY_SIZE
(
Ùx2_sgmii_ã©u»s
),

1218 
Ùx2_lšk_modes
);

1220 
	`lškmode_£t_b™
(
cgx_lšk_mode
[
b™
], 
Ùx2_lšk_modes
);

1223 ià(
»q_mode
 =ğ
OTX2_MODE_ADVERTISED
)

1224 
	`lškmode_Ü
(
lšk_k£‰šgs
->
lšk_modes
.
adv”tisšg
,

1225 
lšk_k£‰šgs
->
lšk_modes
.
adv”tisšg
,

1226 
Ùx2_lšk_modes
);

1228 
	`lškmode_Ü
(
lšk_k£‰šgs
->
lšk_modes
.
suµÜ‹d
,

1229 
lšk_k£‰šgs
->
lšk_modes
.
suµÜ‹d
,

1230 
Ùx2_lšk_modes
);

1231 
	}
}

1233 
	$Ùx2_g‘_moduË_šfo
(
Ãt_deviû
 *
Ãtdev
,

1234 
‘htoŞ_modšfo
 *
modšfo
)

1236 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1237 
cgx_fw_d©a
 *
r¥
;

1239 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1240 ià(
	`IS_ERR
(
r¥
))

1241  
	`PTR_ERR
(
r¥
);

1243 
modšfo
->
ty³
 = 
r¥
->
fwd©a
.
så_“´om
.
sff_id
;

1244 
modšfo
->
“´om_Ën
 = 
SFP_EEPROM_SIZE
;

1246 
	}
}

1248 
	$Ùx2_g‘_moduË_“´om
(
Ãt_deviû
 *
Ãtdev
,

1249 
‘htoŞ_“´om
 *
“
,

1250 
u8
 *
d©a
)

1252 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1253 
cgx_fw_d©a
 *
r¥
;

1255 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1256 ià(
	`IS_ERR
(
r¥
))

1257  
	`PTR_ERR
(
r¥
);

1259 
	`memıy
(
d©a
, &
r¥
->
fwd©a
.
så_“´om
.
buf
, 
“
->
Ën
);

1262 
	}
}

1264 
	$Ùx2_g‘_lšk_k£‰šgs
(
Ãt_deviû
 *
Ãtdev
,

1265 
‘htoŞ_lšk_k£‰šgs
 *
cmd
)

1267 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1268 
cgx_fw_d©a
 *
r¥
 = 
NULL
;

1270 
cmd
->
ba£
.
du¶ex
 = 
pfvf
->
lšfo
.
fuÎ_du¶ex
;

1271 
cmd
->
ba£
.
¥“d
 = 
pfvf
->
lšfo
.speed;

1272 
cmd
->
ba£
.
autÚeg
 = 
pfvf
->
lšfo
.
ª
;

1274 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1275 ià(
	`IS_ERR
(
r¥
))

1276  
	`PTR_ERR
(
r¥
);

1278 ià(
r¥
->
fwd©a
.
suµÜ‹d_ª
)

1279 
	`‘htoŞ_lšk_k£‰šgs_add_lšk_mode
(
cmd
,

1280 
suµÜ‹d
,

1281 
AutÚeg
);

1283 
	`Ùx2_g‘_lšk_mode_šfo
(
r¥
->
fwd©a
.
adv”ti£d_lšk_modes
,

1284 
OTX2_MODE_ADVERTISED
, 
cmd
);

1285 
	`Ùx2_g‘_ãc_šfo
(
r¥
->
fwd©a
.
adv”ti£d_ãc
,

1286 
OTX2_MODE_ADVERTISED
, 
cmd
);

1287 
	`Ùx2_g‘_lšk_mode_šfo
(
r¥
->
fwd©a
.
suµÜ‹d_lšk_modes
,

1288 
OTX2_MODE_SUPPORTED
, 
cmd
);

1289 
	`Ùx2_g‘_ãc_šfo
(
r¥
->
fwd©a
.
suµÜ‹d_ãc
,

1290 
OTX2_MODE_SUPPORTED
, 
cmd
);

1292 
	}
}

1294 
	$Ùx2_g‘_adv”ti£d_mode
(cÚ¡ 
‘htoŞ_lšk_k£‰šgs
 *
cmd
,

1295 
u64
 *
mode
)

1297 
u32
 
b™_pos
;

1302 
b™_pos
 = 
	`fšd_fœ¡_b™
(
cmd
->
lšk_modes
.
adv”tisšg
,

1303 
__ETHTOOL_LINK_MODE_MASK_NBITS
);

1304 ià(
b™_pos
 !ğ
__ETHTOOL_LINK_MODE_MASK_NBITS
)

1305 *
mode
 = 
b™_pos
;

1306 
	}
}

1308 
	#OTX2_OVERWRITE_DEF
 1

	)

1309 
	$Ùx2_£t_lšk_k£‰šgs
(
Ãt_deviû
 *
Ãtdev
,

1310 cÚ¡ 
‘htoŞ_lšk_k£‰šgs
 *
cmd
)

1312 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1313 
‘htoŞ_lšk_k£‰šgs
 
cur_ks
;

1314 
cgx_£t_lšk_mode_»q
 *
»q
;

1315 
mbox
 *mbox = &
pf
->mbox;

1316 
”r
 = 0;

1318 
	`mem£t
(&
cur_ks
, 0, (
‘htoŞ_lšk_k£‰šgs
));

1320 ià(!
	`‘htoŞ_v®id©e_¥“d
(
cmd
->
ba£
.
¥“d
) ||

1321 !
	`‘htoŞ_v®id©e_du¶ex
(
cmd
->
ba£
.
du¶ex
))

1322  -
EINVAL
;

1324 ià(
cmd
->
ba£
.
autÚeg
 !ğ
AUTONEG_ENABLE
 &&

1325 
cmd
->
ba£
.
autÚeg
 !ğ
AUTONEG_DISABLE
)

1326  -
EINVAL
;

1328 
	`Ùx2_g‘_lšk_k£‰šgs
(
Ãtdev
, &
cur_ks
);

1331 ià(!
	`b™m­_sub£t
(
cmd
->
lšk_modes
.
adv”tisšg
,

1332 
cur_ks
.
lšk_modes
.
suµÜ‹d
,

1333 
__ETHTOOL_LINK_MODE_MASK_NBITS
))

1334  -
EINVAL
;

1336 
	`mu‹x_lock
(&
mbox
->
lock
);

1337 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_£t_lšk_mode
(&
pf
->
mbox
);

1338 ià(!
»q
) {

1339 
”r
 = -
ENOMEM
;

1340 
’d
;

1343 ià(
cmd
->
ba£
.
phy_add»ss
 =ğ
OTX2_OVERWRITE_DEF
) {

1344 
»q
->
¬gs
.
¥“d
 = 
cmd
->
ba£
.speed;

1348 
»q
->
¬gs
.
du¶ex
 = 
cmd
->
ba£
.duplex ^ 0x1;

1349 
»q
->
¬gs
.
ª
 = 
cmd
->
ba£
.
autÚeg
;

1351 
»q
->
¬gs
.
¥“d
 = 
SPEED_UNKNOWN
;

1352 
»q
->
¬gs
.
du¶ex
 = 
DUPLEX_UNKNOWN
;

1353 
»q
->
¬gs
.
ª
 = 
AUTONEG_UNKNOWN
;

1356 
	`Ùx2_g‘_adv”ti£d_mode
(
cmd
, &
»q
->
¬gs
.
mode
);

1358 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

1359 
’d
:

1360 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1361  
”r
;

1362 
	}
}

1364 
u32
 
	$Ùx2_g‘_´iv_æags
(
Ãt_deviû
 *
Ãtdev
)

1366 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1367 
cgx_fw_d©a
 *
r¥
;

1369 
r¥
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1371 ià(
	`IS_ERR
(
r¥
)) {

1372 
pfvf
->
‘htoŞ_æags
 &ğ~
OTX2_PRIV_FLAG_PAM4
;

1374 ià(
r¥
->
fwd©a
.
phy
.
misc
.
mod_ty³
)

1375 
pfvf
->
‘htoŞ_æags
 |ğ
OTX2_PRIV_FLAG_PAM4
;

1377 
pfvf
->
‘htoŞ_æags
 &ğ~
OTX2_PRIV_FLAG_PAM4
;

1380  
pfvf
->
‘htoŞ_æags
;

1381 
	}
}

1383 
	$Ùx2_£t_phy_mod_ty³
(
Ãt_deviû
 *
Ãtdev
, 
boŞ
 
’abË
)

1385 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1386 
cgx_phy_mod_ty³
 *
»q
;

1387 
cgx_fw_d©a
 *
fwd
;

1388 
rc
 = -
EAGAIN
;

1390 
fwd
 = 
	`Ùx2_g‘_fwd©a
(
pfvf
);

1391 ià(
	`IS_ERR
(
fwd
))

1392  -
EAGAIN
;

1395 ià(!
fwd
->
fwd©a
.
phy
.
misc
.
ÿn_chªge_mod_ty³
)

1396  -
EOPNOTSUPP
;

1398 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1399 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_£t_phy_mod_ty³
(&
pfvf
->
mbox
);

1400 ià(!
»q
)

1401 
’d
;

1403 
»q
->
mod
 = 
’abË
;

1405 ià(!
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
))

1406 
rc
 = 0;

1407 
’d
:

1408 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1409  
rc
;

1410 
	}
}

1412 
	$Ùx2_£t_Åc_·r£_mode
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
unbšd
)

1414 
Åc_£t_pkšd
 *
»q
;

1415 
u32
 
š‹rçû_mode
 = 0;

1416 
rc
 = -
EAGAIN
;

1418 ià(
	`OTX2_IS_DEF_MODE_ENABLED
(
pfvf
->
‘htoŞ_æags
))

1421 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1422 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_£t_pkšd
(&
pfvf
->
mbox
);

1423 ià(!
»q
)

1424 
’d
;

1426 ià(
unbšd
) {

1427 
»q
->
mode
 = 
OTX2_PRIV_FLAGS_DEFAULT
;

1428 
š‹rçû_mode
 = 
OTX2_PRIV_FLAG_DEF_MODE
;

1429 } ià(
	`OTX2_IS_HIGIG2_ENABLED
(
pfvf
->
‘htoŞ_æags
)) {

1430 
»q
->
mode
 = 
OTX2_PRIV_FLAGS_HIGIG
;

1431 
š‹rçû_mode
 = 
OTX2_PRIV_FLAG_HIGIG2_HDR
;

1432 } ià(
	`OTX2_IS_EDSA_ENABLED
(
pfvf
->
‘htoŞ_æags
)) {

1433 
»q
->
mode
 = 
OTX2_PRIV_FLAGS_EDSA
;

1434 
š‹rçû_mode
 = 
OTX2_PRIV_FLAG_EDSA_HDR
;

1435 } ià(
pfvf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
) {

1436 
»q
->
mode
 = 
OTX2_PRIV_FLAGS_FDSA
;

1437 
š‹rçû_mode
 = 
OTX2_PRIV_FLAG_FDSA_HDR
;

1439 
»q
->
mode
 = 
OTX2_PRIV_FLAGS_DEFAULT
;

1440 
š‹rçû_mode
 = 
OTX2_PRIV_FLAG_DEF_MODE
;

1443 
»q
->
dœ
 = 
PKIND_RX
;

1446 ià(
»q
->
mode
 =ğ
OTX2_PRIV_FLAGS_HIGIG
 ||

1447 
»q
->
mode
 =ğ
OTX2_PRIV_FLAGS_DEFAULT
)

1448 
»q
->
dœ
 |ğ
PKIND_TX
;

1450 ià(!
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
))

1451 
rc
 = 0;

1453 
pfvf
->
‘htoŞ_æags
 &ğ~
š‹rçû_mode
;

1454 
’d
:

1455 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1456  
rc
;

1457 
	}
}

1459 
	$Ùx2_’abË_addl_h—d”
(
Ãt_deviû
 *
Ãtdev
, 
b™pos
,

1460 
u32
 
Ën
, 
boŞ
 
’abË
)

1462 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1463 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

1465 ià(
’abË
) {

1466 
pfvf
->
‘htoŞ_æags
 |ğ
	`BIT
(
b™pos
);

1467 
pfvf
->
‘htoŞ_æags
 &ğ~
OTX2_PRIV_FLAG_DEF_MODE
;

1469 
pfvf
->
‘htoŞ_æags
 &ğ~
	`BIT
(
b™pos
);

1470 
Ën
 = 0;

1473 ià(
if_up
)

1474 
	`Ùx2_¡İ
(
Ãtdev
);

1477 
pfvf
->
addl_mtu
 = 
Ën
;

1482 ià(
	`OTX2_IS_HIGIG2_ENABLED
(
pfvf
->
‘htoŞ_æags
))

1483 
pfvf
->
xŒa_hdr
 = 16;

1485 
pfvf
->
xŒa_hdr
 = 0;

1488 ià(
if_up
) {

1489 
	`Ùx2_İ’
(
Ãtdev
);

1491 ià(!
’abË
)

1492 
pfvf
->
‘htoŞ_æags
 |ğ
OTX2_PRIV_FLAG_DEF_MODE
;

1496 
	}
}

1501 
	$Ùx2_’dis_vfvÏn_ruËs
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
)

1503 
vfvÏn
 *
ruË
;

1504 
vf
;

1506 
vf
 = 0; và< 
	`pci_num_vf
(
pfvf
->
pdev
); vf++) {

1508 ià(
’abË
) {

1509 
	`Ùx2_do_£t_vf_vÏn
(
pfvf
, 
vf
, 0, 0, 0);

1511 
ruË
 = &
pfvf
->
vf_cÚfigs
[
vf
].rule;

1512 
	`Ùx2_do_£t_vf_vÏn
(
pfvf
, 
vf
, 
ruË
->
vÏn
,„uË->
qos
,

1513 
ruË
->
´Ùo
);

1516 
	}
}

1518 
	$Ùx2_£t_´iv_æags
(
Ãt_deviû
 *
Ãtdev
, 
u32
 
Ãw_æags
)

1520 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1521 
boŞ
 
’abË
 = 
çl£
;

1522 
b™Ä
, 
rc
 = 0;

1523 
u32
 
chg_æags
;

1526 
	`Ùx2_g‘_´iv_æags
(
Ãtdev
);

1528 
chg_æags
 = 
Ãw_æags
 ^ 
pfvf
->
‘htoŞ_æags
;

1529 ià(!
chg_æags
)

1533 ià(
	`hweight32
(
chg_æags
) != 1)

1534  -
EINVAL
;

1536 
b™Ä
 = 
	`ffs
(
chg_æags
) - 1;

1537 ià(
Ãw_æags
 & 
	`BIT
(
b™Ä
))

1538 
’abË
 = 
Œue
;

1540 ià((
	`BIT
(
b™Ä
è!ğ
OTX2_PRIV_FLAG_PAM4
è&& (
pfvf
->
æags
 & 
OTX2_FLAG_RX_TSTAMP_ENABLED
)) {

1541 
	`Ãtdev_šfo
(
Ãtdev
, "Can'tƒnable„equested mode when PTP HWimestamping is ON\n");

1542  -
EINVAL
;

1545 
	`BIT
(
b™Ä
)) {

1546 
OTX2_PRIV_FLAG_PAM4
:

1547 
rc
 = 
	`Ùx2_£t_phy_mod_ty³
(
Ãtdev
, 
’abË
);

1549 
OTX2_PRIV_FLAG_EDSA_HDR
:

1551 ià(
’abË
 && 
	`OTX2_IS_INTFMOD_SET
(
pfvf
->
‘htoŞ_æags
)) {

1552 
	`Ãtdev_šfo
(
Ãtdev
,

1554  -
EINVAL
;

1556  
	`Ùx2_’abË_addl_h—d”
(
Ãtdev
, 
b™Ä
,

1557 
OTX2_EDSA_HDR_LEN
, 
’abË
);

1559 
OTX2_PRIV_FLAG_HIGIG2_HDR
:

1560 ià(
	`‹¡_b™
(
CN10K_RPM
, &
pfvf
->
hw
.
ÿp_æag
))

1561  -
EOPNOTSUPP
;

1563 ià(
’abË
 && 
	`OTX2_IS_INTFMOD_SET
(
pfvf
->
‘htoŞ_æags
)) {

1564 
	`Ãtdev_šfo
(
Ãtdev
,

1566  -
EINVAL
;

1568  
	`Ùx2_’abË_addl_h—d”
(
Ãtdev
, 
b™Ä
,

1569 
OTX2_HIGIG2_HDR_LEN
, 
’abË
);

1571 
OTX2_PRIV_FLAG_FDSA_HDR
:

1572 ià(
’abË
 && 
	`OTX2_IS_INTFMOD_SET
(
pfvf
->
‘htoŞ_æags
)) {

1573 
	`Ãtdev_šfo
(
Ãtdev
,

1575  -
EINVAL
;

1577 
	`Ùx2_’abË_addl_h—d”
(
Ãtdev
, 
b™Ä
,

1578 
OTX2_FDSA_HDR_LEN
, 
’abË
);

1579 ià(
’abË
)

1580 
	`Ãtdev_w¬n
(
Ãtdev
,

1582 
	`Ùx2_’dis_vfvÏn_ruËs
(
pfvf
, 
’abË
);

1589 ià(!
rc
) {

1590 ià(
’abË
)

1591 
pfvf
->
‘htoŞ_æags
 |ğ
	`BIT
(
b™Ä
);

1593 
pfvf
->
‘htoŞ_æags
 &ğ~
	`BIT
(
b™Ä
);

1596  
rc
;

1597 
	}
}

1599 
‘htoŞ_İs
 
	gÙx2_‘htoŞ_İs
 = {

1600 .
g‘_lšk
 = 
Ùx2_g‘_lšk
,

1601 .
	gg‘_drvšfo
 = 
Ùx2_g‘_drvšfo
,

1602 .
	gg‘_¡ršgs
 = 
Ùx2_g‘_¡ršgs
,

1603 .
	gg‘_‘htoŞ_¡©s
 = 
Ùx2_g‘_‘htoŞ_¡©s
,

1604 .
	gg‘_s£t_couÁ
 = 
Ùx2_g‘_s£t_couÁ
,

1605 .
	g£t_chªÃls
 = 
Ùx2_£t_chªÃls
,

1606 .
	gg‘_chªÃls
 = 
Ùx2_g‘_chªÃls
,

1607 .
	gg‘_ršg·¿m
 = 
Ùx2_g‘_ršg·¿m
,

1608 .
	g£t_ršg·¿m
 = 
Ùx2_£t_ršg·¿m
,

1609 .
	gg‘_cßËsû
 = 
Ùx2_g‘_cßËsû
,

1610 .
	g£t_cßËsû
 = 
Ùx2_£t_cßËsû
,

1611 .
	gg‘_rxnfc
 = 
Ùx2_g‘_rxnfc
,

1612 .
	g£t_rxnfc
 = 
Ùx2_£t_rxnfc
,

1613 .
	gg‘_rxfh_key_size
 = 
Ùx2_g‘_rxfh_key_size
,

1614 .
	gg‘_rxfh_šdœ_size
 = 
Ùx2_g‘_rxfh_šdœ_size
,

1615 .
	gg‘_rxfh
 = 
Ùx2_g‘_rxfh
,

1616 .
	g£t_rxfh
 = 
Ùx2_£t_rxfh
,

1617 .
	gg‘_rxfh_cÚ‹xt
 = 
Ùx2_g‘_rxfh_cÚ‹xt
,

1618 .
	g£t_rxfh_cÚ‹xt
 = 
Ùx2_£t_rxfh_cÚ‹xt
,

1619 .
	gg‘_ts_šfo
 = 
Ùx2_g‘_ts_šfo
,

1620 .
	gg‘_msgËv–
 = 
Ùx2_g‘_msgËv–
,

1621 .
	g£t_msgËv–
 = 
Ùx2_£t_msgËv–
,

1622 .
	gg‘_lšk_k£‰šgs
 = 
Ùx2_g‘_lšk_k£‰šgs
,

1623 .
	g£t_lšk_k£‰šgs
 = 
Ùx2_£t_lšk_k£‰šgs
,

1624 .
	gg‘_·u£·¿m
 = 
Ùx2_g‘_·u£·¿m
,

1625 .
	g£t_·u£·¿m
 = 
Ùx2_£t_·u£·¿m
,

1626 .
	gg‘_ãı¬am
 = 
Ùx2_g‘_ãı¬am
,

1627 .
	g£t_ãı¬am
 = 
Ùx2_£t_ãı¬am
,

1628 .
	gg‘_moduË_šfo
 = 
Ùx2_g‘_moduË_šfo
,

1629 .
	gg‘_moduË_“´om
 = 
Ùx2_g‘_moduË_“´om
,

1630 .
	gg‘_´iv_æags
 = 
Ùx2_g‘_´iv_æags
,

1631 .
	g£t_´iv_æags
 = 
Ùx2_£t_´iv_æags
,

1634 
	$Ùx2_£t_‘htoŞ_İs
(
Ãt_deviû
 *
Ãtdev
)

1636 
Ãtdev
->
‘htoŞ_İs
 = &
Ùx2_‘htoŞ_İs
;

1637 
	}
}

1640 
	$Ùx2vf_g‘_drvšfo
(
Ãt_deviû
 *
Ãtdev
,

1641 
‘htoŞ_drvšfo
 *
šfo
)

1643 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1645 
	`¡¾ıy
(
šfo
->
driv”
, 
DRV_VF_NAME
, (info->driver));

1646 
	`¡¾ıy
(
šfo
->
bus_šfo
, 
	`pci_Çme
(
vf
->
pdev
), (info->bus_info));

1647 
	}
}

1649 
	$Ùx2vf_g‘_¡ršgs
(
Ãt_deviû
 *
Ãtdev
, 
u32
 
s£t
, 
u8
 *
d©a
)

1651 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1652 
¡©s
;

1654 ià(
s£t
 !ğ
ETH_SS_STATS
)

1657 
¡©s
 = 0; st < 
Ùx2_n_dev_¡©s
; stats++) {

1658 
	`memıy
(
d©a
, 
Ùx2_dev_¡©s
[
¡©s
].
Çme
, 
ETH_GSTRING_LEN
);

1659 
d©a
 +ğ
ETH_GSTRING_LEN
;

1662 
¡©s
 = 0; st < 
Ùx2_n_drv_¡©s
; stats++) {

1663 
	`memıy
(
d©a
, 
Ùx2_drv_¡©s
[
¡©s
].
Çme
, 
ETH_GSTRING_LEN
);

1664 
d©a
 +ğ
ETH_GSTRING_LEN
;

1667 
	`Ùx2_g‘_q£t_¡ršgs
(
vf
, &
d©a
, 0);

1669 
	`¡rıy
(
d©a
, "reset_count");

1670 
d©a
 +ğ
ETH_GSTRING_LEN
;

1671 
	}
}

1673 
	$Ùx2vf_g‘_‘htoŞ_¡©s
(
Ãt_deviû
 *
Ãtdev
,

1674 
‘htoŞ_¡©s
 *
¡©s
, 
u64
 *
d©a
)

1676 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1677 
¡©
;

1679 
	`Ùx2_g‘_dev_¡©s
(
vf
);

1680 
¡©
 = 0; sˆ< 
Ùx2_n_dev_¡©s
; stat++)

1681 *(
d©a
++èğ((
u64
 *)&
vf
->
hw
.
dev_¡©s
)

1682 [
Ùx2_dev_¡©s
[
¡©
].
šdex
];

1684 
¡©
 = 0; sˆ< 
Ùx2_n_drv_¡©s
; stat++)

1685 *(
d©a
++èğ
	`©omic_»ad
(&((
©omic_t
 *)&
vf
->
hw
.
drv_¡©s
)

1686 [
Ùx2_drv_¡©s
[
¡©
].
šdex
]);

1688 
	`Ùx2_g‘_q£t_¡©s
(
vf
, 
¡©s
, &
d©a
);

1689 *(
d©a
++èğ
vf
->
»£t_couÁ
;

1690 
	}
}

1692 
	$Ùx2vf_g‘_s£t_couÁ
(
Ãt_deviû
 *
Ãtdev
, 
s£t
)

1694 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1695 
q¡©s_couÁ
;

1697 ià(
s£t
 !ğ
ETH_SS_STATS
)

1698  -
EINVAL
;

1700 
q¡©s_couÁ
 = 
Ùx2_n_queue_¡©s
 *

1701 (
vf
->
hw
.
rx_queues
 + vf->hw.
tx_queues
 +

1702 
vf
->
hw
.
tc_tx_queues
);

1704  
Ùx2_n_dev_¡©s
 + 
Ùx2_n_drv_¡©s
 + 
q¡©s_couÁ
 + 1;

1705 
	}
}

1707 
	$Ùx2vf_g‘_lšk_k£‰šgs
(
Ãt_deviû
 *
Ãtdev
,

1708 
‘htoŞ_lšk_k£‰šgs
 *
cmd
)

1710 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1712 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(pfvf->pdev)) {

1713 
cmd
->
ba£
.
du¶ex
 = 
DUPLEX_FULL
;

1714 
cmd
->
ba£
.
¥“d
 = 
SPEED_100000
;

1716  
	`Ùx2_g‘_lšk_k£‰šgs
(
Ãtdev
, 
cmd
);

1719 
	}
}

1720 cÚ¡ 
‘htoŞ_İs
 
	gÙx2vf_‘htoŞ_İs
 = {

1721 .
g‘_lšk
 = 
Ùx2_g‘_lšk
,

1722 .
	gg‘_drvšfo
 = 
Ùx2vf_g‘_drvšfo
,

1723 .
	gg‘_¡ršgs
 = 
Ùx2vf_g‘_¡ršgs
,

1724 .
	gg‘_‘htoŞ_¡©s
 = 
Ùx2vf_g‘_‘htoŞ_¡©s
,

1725 .
	gg‘_s£t_couÁ
 = 
Ùx2vf_g‘_s£t_couÁ
,

1726 .
	g£t_chªÃls
 = 
Ùx2_£t_chªÃls
,

1727 .
	gg‘_chªÃls
 = 
Ùx2_g‘_chªÃls
,

1728 .
	gg‘_rxnfc
 = 
Ùx2_g‘_rxnfc
,

1729 .
	g£t_rxnfc
 = 
Ùx2_£t_rxnfc
,

1730 .
	gg‘_rxfh_key_size
 = 
Ùx2_g‘_rxfh_key_size
,

1731 .
	gg‘_rxfh_šdœ_size
 = 
Ùx2_g‘_rxfh_šdœ_size
,

1732 .
	gg‘_rxfh
 = 
Ùx2_g‘_rxfh
,

1733 .
	g£t_rxfh
 = 
Ùx2_£t_rxfh
,

1734 .
	gg‘_rxfh_cÚ‹xt
 = 
Ùx2_g‘_rxfh_cÚ‹xt
,

1735 .
	g£t_rxfh_cÚ‹xt
 = 
Ùx2_£t_rxfh_cÚ‹xt
,

1736 .
	gg‘_ršg·¿m
 = 
Ùx2_g‘_ršg·¿m
,

1737 .
	g£t_ršg·¿m
 = 
Ùx2_£t_ršg·¿m
,

1738 .
	gg‘_cßËsû
 = 
Ùx2_g‘_cßËsû
,

1739 .
	g£t_cßËsû
 = 
Ùx2_£t_cßËsû
,

1740 .
	gg‘_msgËv–
 = 
Ùx2_g‘_msgËv–
,

1741 .
	g£t_msgËv–
 = 
Ùx2_£t_msgËv–
,

1742 .
	gg‘_·u£·¿m
 = 
Ùx2_g‘_·u£·¿m
,

1743 .
	g£t_·u£·¿m
 = 
Ùx2_£t_·u£·¿m
,

1744 .
	gg‘_lšk_k£‰šgs
 = 
Ùx2vf_g‘_lšk_k£‰šgs
,

1745 .
	gg‘_ts_šfo
 = 
Ùx2_g‘_ts_šfo
,

1748 
	$Ùx2vf_£t_‘htoŞ_İs
(
Ãt_deviû
 *
Ãtdev
)

1750 
Ãtdev
->
‘htoŞ_İs
 = &
Ùx2vf_‘htoŞ_İs
;

1751 
	}
}

1752 
EXPORT_SYMBOL
(
Ùx2vf_£t_‘htoŞ_İs
);

	@otx2_flows.c

8 
	~<Ãt/v6.h
>

9 
	~<lšux/sÜt.h
>

11 
	~"Ùx2_commÚ.h
"

13 
	#OTX2_DEFAULT_ACTION
 0x1

	)

14 
	#FDSA_MAX_SPORT
 32

	)

15 
	#FDSA_SPORT_MASK
 0xf8

	)

17 
Ùx2_mÿm_’Œy_š™
(
Ùx2_nic
 *
pfvf
);

19 
	sÙx2_æow
 {

20 
‘htoŞ_rx_æow_¥ec
 
	mæow_¥ec
;

21 
li¡_h—d
 
	mli¡
;

22 
u32
 
	mloÿtiÚ
;

23 
u32
 
	m’Œy
;

24 
boŞ
 
	mis_vf
;

25 
u8
 
	mrss_ùx_id
;

26 
	#DMAC_FILTER_RULE
 
	`BIT
(0)

	)

27 
	#PFC_FLOWCTRL_RULE
 
	`BIT
(1)

	)

28 
u16
 
	mruË_ty³
;

29 
	mvf
;

32 
	edmac_»q
 {

33 
	mDMAC_ADDR_UPDATE
,

34 
	mDMAC_ADDR_DEL


37 
	$Ùx2_ş—r_Áu¶e_æow_šfo
(
Ùx2_nic
 *
pfvf
, 
Ùx2_æow_cÚfig
 *
æow_cfg
)

39 
	`devm_kä“
(
pfvf
->
dev
, 
æow_cfg
->
æow_’t
);

40 
æow_cfg
->
æow_’t
 = 
NULL
;

41 
æow_cfg
->
max_æows
 = 0;

42 
	}
}

44 
	$Ùx2_ä“_Áu¶e_mÿm_’Œ›s
(
Ùx2_nic
 *
pfvf
)

46 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

47 
Åc_mÿm_ä“_’Œy_»q
 *
»q
;

48 
’t
, 
”r
;

50 ià(!
æow_cfg
->
max_æows
)

53 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

54 
’t
 = 0;ƒÁ < 
æow_cfg
->
max_æows
;ƒnt++) {

55 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_ä“_’Œy
(&
pfvf
->
mbox
);

56 ià(!
»q
)

59 
»q
->
’Œy
 = 
æow_cfg
->
æow_’t
[
’t
];

62 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

63 ià(
”r
)

66 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

67 
	`Ùx2_ş—r_Áu¶e_æow_šfo
(
pfvf
, 
æow_cfg
);

69 
	}
}

71 
	$mÿm_’Œy_cmp
(cÚ¡ *
a
, cÚ¡ *
b
)

73  *(
u16
 *)
a
 - *(u16 *)
b
;

74 
	}
}

76 
	$Ùx2_®loc_mÿm_’Œ›s
(
Ùx2_nic
 *
pfvf
, 
u16
 
couÁ
)

78 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

79 
Åc_mÿm_®loc_’Œy_»q
 *
»q
;

80 
Åc_mÿm_®loc_’Œy_r¥
 *
r¥
;

81 
’t
, 
®loÿ‹d
 = 0;

84 
	`Ùx2_ä“_Áu¶e_mÿm_’Œ›s
(
pfvf
);

86 ià(!
couÁ
)

89 
æow_cfg
->
æow_’t
 = 
	`devm_km®loc_¬¿y
(
pfvf
->
dev
, 
couÁ
,

90 (
u16
), 
GFP_KERNEL
);

91 ià(!
æow_cfg
->
æow_’t
) {

92 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

94 
__func__
);

95  -
ENOMEM
;

98 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

103 
®loÿ‹d
 < 
couÁ
) {

104 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_®loc_’Œy
(&
pfvf
->
mbox
);

105 ià(!
»q
)

106 
ex™
;

108 
»q
->
cÚtig
 = 
çl£
;

109 
»q
->
couÁ
 = (couÁ - 
®loÿ‹d
è> 
NPC_MAX_NONCONTIG_ENTRIES
 ?

110 
NPC_MAX_NONCONTIG_ENTRIES
 : 
couÁ
 - 
®loÿ‹d
;

115 ià(!
	`is_Ùx2_vf
(
pfvf
->
pcifunc
)) {

116 
»q
->
´iÜ™y
 = 
NPC_MCAM_HIGHER_PRIO
;

117 
»q
->
»f_’Œy
 = 
æow_cfg
->
def_’t
[0];

121 ià(
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
))

122 
ex™
;

124 
r¥
 = (
Åc_mÿm_®loc_’Œy_r¥
 *)
Ùx2_mbox_g‘_r¥


125 (&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

127 
’t
 = 0;ƒÁ < 
r¥
->
couÁ
;ƒnt++)

128 
æow_cfg
->
æow_’t
[
’t
 + 
®loÿ‹d
] = 
r¥
->
’Œy_li¡
[ent];

130 
®loÿ‹d
 +ğ
r¥
->
couÁ
;

135 ià(
r¥
->
couÁ
 !ğ
»q
->count)

144 ià(
®loÿ‹d
)

145 
	`sÜt
(&
æow_cfg
->
æow_’t
[0], 
®loÿ‹d
,

146 (
æow_cfg
->
æow_’t
[0]), 
mÿm_’Œy_cmp
, 
NULL
);

148 
ex™
:

149 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

151 
æow_cfg
->
max_æows
 = 
®loÿ‹d
;

153 ià(
®loÿ‹d
) {

154 
pfvf
->
æags
 |ğ
OTX2_FLAG_MCAM_ENTRIES_ALLOC
;

155 
pfvf
->
æags
 |ğ
OTX2_FLAG_NTUPLE_SUPPORT
;

158 ià(
®loÿ‹d
 !ğ
couÁ
)

159 
	`Ãtdev_šfo
(
pfvf
->
Ãtdev
,

161 
couÁ
, 
®loÿ‹d
);

162  
®loÿ‹d
;

163 
	}
}

164 
EXPORT_SYMBOL
(
Ùx2_®loc_mÿm_’Œ›s
);

166 
	$Ùx2_mÿm_’Œy_š™
(
Ùx2_nic
 *
pfvf
)

168 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

169 
Åc_mÿm_®loc_’Œy_»q
 *
»q
;

170 
Åc_mÿm_®loc_’Œy_r¥
 *
r¥
;

171 
vf_vÏn_max_æows
;

172 
’t
, 
couÁ
;

174 
vf_vÏn_max_æows
 = 
pfvf
->
tÙ®_vfs
 * 
OTX2_PER_VF_VLAN_FLOWS
;

175 
couÁ
 = 
OTX2_MAX_UNICAST_FLOWS
 +

176 
OTX2_MAX_VLAN_FLOWS
 + 
vf_vÏn_max_æows
;

178 
æow_cfg
->
def_’t
 = 
	`devm_km®loc_¬¿y
(
pfvf
->
dev
, 
couÁ
,

179 (
u16
), 
GFP_KERNEL
);

180 ià(!
æow_cfg
->
def_’t
)

181  -
ENOMEM
;

183 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

185 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_®loc_’Œy
(&
pfvf
->
mbox
);

186 ià(!
»q
) {

187 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

188  -
ENOMEM
;

191 
»q
->
cÚtig
 = 
çl£
;

192 
»q
->
couÁ
 = count;

195 ià(
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
)) {

196 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

197  -
EINVAL
;

200 
r¥
 = (
Åc_mÿm_®loc_’Œy_r¥
 *)
Ùx2_mbox_g‘_r¥


201 (&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

203 ià(
r¥
->
couÁ
 !ğ
»q
->count) {

204 
	`Ãtdev_šfo
(
pfvf
->
Ãtdev
,

206 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

207 
	`devm_kä“
(
pfvf
->
dev
, 
æow_cfg
->
def_’t
);

211 
’t
 = 0;ƒÁ < 
r¥
->
couÁ
;ƒnt++)

212 
æow_cfg
->
def_’t
[
’t
] = 
r¥
->
’Œy_li¡
[ent];

214 
æow_cfg
->
vf_vÏn_off£t
 = 0;

215 
æow_cfg
->
uniÿ¡_off£t
 = 
vf_vÏn_max_æows
;

216 
æow_cfg
->
rx_vÏn_off£t
 = flow_cfg->
uniÿ¡_off£t
 +

217 
OTX2_MAX_UNICAST_FLOWS
;

218 
pfvf
->
æags
 |ğ
OTX2_FLAG_UCAST_FLTR_SUPPORT
;

219 
pfvf
->
æags
 |ğ
OTX2_FLAG_RX_VLAN_SUPPORT
;

220 
pfvf
->
æags
 |ğ
OTX2_FLAG_VF_VLAN_SUPPORT
;

222 
pfvf
->
æags
 |ğ
OTX2_FLAG_MCAM_ENTRIES_ALLOC
;

223 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

226 
couÁ
 = 
	`Ùx2_®loc_mÿm_’Œ›s
(
pfvf
, 
OTX2_DEFAULT_FLOWCOUNT
);

227 ià(
couÁ
 <= 0) {

228 
	`Ùx2_ş—r_Áu¶e_æow_šfo
(
pfvf
, 
æow_cfg
);

232 
pfvf
->
æags
 |ğ
OTX2_FLAG_TC_FLOWER_SUPPORT
;

235 
	}
}

238 
	#OTX2_DMAC_FLTR_BITMAP_SZ
 (4 * 2048 + 32)

	)

240 
	$Ùx2vf_mÿm_æow_š™
(
Ùx2_nic
 *
pfvf
)

242 
Ùx2_æow_cÚfig
 *
æow_cfg
;

244 
pfvf
->
æow_cfg
 = 
	`devm_kz®loc
Õfvf->
dev
,

245 (
Ùx2_æow_cÚfig
),

246 
GFP_KERNEL
);

247 ià(!
pfvf
->
æow_cfg
)

248  -
ENOMEM
;

250 
pfvf
->
æow_cfg
->
dmacæt_bm­
 = 
	`devm_kÿÎoc
Õfvf->
dev
,

251 
	`BITS_TO_LONGS
(
OTX2_DMAC_FLTR_BITMAP_SZ
),

252 (), 
GFP_KERNEL
);

253 ià(!
pfvf
->
æow_cfg
->
dmacæt_bm­
)

254  -
ENOMEM
;

256 
æow_cfg
 = 
pfvf
->flow_cfg;

257 
	`INIT_LIST_HEAD
(&
æow_cfg
->
æow_li¡
);

258 
æow_cfg
->
max_æows
 = 0;

261 
	}
}

262 
EXPORT_SYMBOL
(
Ùx2vf_mÿm_æow_š™
);

264 
	$Ùx2_mÿm_æow_š™
(
Ùx2_nic
 *
pf
)

266 
”r
;

268 
pf
->
æow_cfg
 = 
	`devm_kz®loc
Õf->
dev
, (
Ùx2_æow_cÚfig
),

269 
GFP_KERNEL
);

270 ià(!
pf
->
æow_cfg
)

271  -
ENOMEM
;

273 
pf
->
æow_cfg
->
dmacæt_bm­
 = 
	`devm_kÿÎoc
Õf->
dev
,

274 
	`BITS_TO_LONGS
(
OTX2_DMAC_FLTR_BITMAP_SZ
),

275 (), 
GFP_KERNEL
);

276 ià(!
pf
->
æow_cfg
->
dmacæt_bm­
)

277  -
ENOMEM
;

279 
	`INIT_LIST_HEAD
(&
pf
->
æow_cfg
->
æow_li¡
);

284 
”r
 = 
	`Ùx2_mÿm_’Œy_š™
(
pf
);

285 ià(
”r
)

286  
”r
;

289 ià(!(
pf
->
æags
 & 
OTX2_FLAG_UCAST_FLTR_SUPPORT
))

292 
pf
->
mac_bË
 = 
	`devm_kz®loc
Õf->
dev
, (
Ùx2_mac_bË
)

293 * 
OTX2_MAX_UNICAST_FLOWS
, 
GFP_KERNEL
);

295 ià(!
pf
->
mac_bË
)

296  -
ENOMEM
;

298 
	`Ùx2_dmacæt_g‘_max_út
(
pf
);

301 ià(!
pf
->
æow_cfg
->
dmacæt_max_æows
)

304 
pf
->
æow_cfg
->
bm­_to_dmacšdex
 =

305 
	`devm_kz®loc
(
pf
->
dev
, (
u32
) *

306 
pf
->
æow_cfg
->
dmacæt_max_æows
,

307 
GFP_KERNEL
);

309 ià(!
pf
->
æow_cfg
->
bm­_to_dmacšdex
)

310  -
ENOMEM
;

312 
pf
->
æags
 |ğ
OTX2_FLAG_DMACFLTR_SUPPORT
;

315 
	}
}

317 
	$Ùx2_mÿm_æow_d–
(
Ùx2_nic
 *
pf
)

319 
	`Ùx2_de¡roy_mÿm_æows
(
pf
);

320 
	}
}

321 
EXPORT_SYMBOL
(
Ùx2_mÿm_æow_d–
);

326 
	$Ùx2_do_add_macf‹r
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
)

328 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pf
->flow_cfg;

329 
Åc_š¡®l_æow_»q
 *
»q
;

330 
”r
, 
i
;

332 ià(!(
pf
->
æags
 & 
OTX2_FLAG_UCAST_FLTR_SUPPORT
))

333  -
ENOMEM
;

336 ià(
	`Ãtdev_uc_couÁ
(
pf
->
Ãtdev
è> 
OTX2_MAX_UNICAST_FLOWS
)

337  -
ENOMEM
;

339 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

340 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pf
->
mbox
);

341 ià(!
»q
) {

342 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

343  -
ENOMEM
;

347 
i
 = 0; i < 
OTX2_MAX_UNICAST_FLOWS
; i++) {

348 ià(
pf
->
mac_bË
[
i
].
šu£
)

350 
	`‘h”_addr_cİy
(
pf
->
mac_bË
[
i
].
addr
, 
mac
);

351 
pf
->
mac_bË
[
i
].
šu£
 = 
Œue
;

352 
pf
->
mac_bË
[
i
].
mÿm_’Œy
 =

353 
æow_cfg
->
def_’t
[
i
 + flow_cfg->
uniÿ¡_off£t
];

354 
»q
->
’Œy
 = 
pf
->
mac_bË
[
i
].
mÿm_’Œy
;

358 
	`‘h”_addr_cİy
(
»q
->
·ck‘
.
dmac
, 
mac
);

359 
	`‘h_brßdÿ¡_addr
((
u8
 *)&
»q
->
mask
.
dmac
);

360 
»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_DMAC
);

361 
»q
->
chªÃl
 = 
pf
->
hw
.
rx_chª_ba£
;

362 
»q
->
štf
 = 
NIX_INTF_RX
;

363 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

364 
»q
->
£t_úŒ
 = 1;

366 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

367 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

369  
”r
;

370 
	}
}

372 
	$Ùx2_add_macf‹r
(
Ãt_deviû
 *
Ãtdev
, cÚ¡ 
u8
 *
mac
)

374 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

376 ià(!
	`b™m­_em±y
(
pf
->
æow_cfg
->
dmacæt_bm­
,

377 
pf
->
æow_cfg
->
dmacæt_max_æows
))

378 
	`Ãtdev_w¬n
(
Ãtdev
,

380 
mac
);

382  
	`Ùx2_do_add_macf‹r
(
pf
, 
mac
);

383 
	}
}

385 
boŞ
 
	$Ùx2_g‘_mÿm’Œy_fÜ_mac
(
Ùx2_nic
 *
pf
, cÚ¡ 
u8
 *
mac
,

386 *
mÿm_’Œy
)

388 
i
;

390 
i
 = 0; i < 
OTX2_MAX_UNICAST_FLOWS
; i++) {

391 ià(!
pf
->
mac_bË
[
i
].
šu£
)

394 ià(
	`‘h”_addr_equ®
(
pf
->
mac_bË
[
i
].
addr
, 
mac
)) {

395 *
mÿm_’Œy
 = 
pf
->
mac_bË
[
i
].mcam_entry;

396 
pf
->
mac_bË
[
i
].
šu£
 = 
çl£
;

397  
Œue
;

400  
çl£
;

401 
	}
}

403 
	$Ùx2_d–_macf‹r
(
Ãt_deviû
 *
Ãtdev
, cÚ¡ 
u8
 *
mac
)

405 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

406 
Åc_d–‘e_æow_»q
 *
»q
;

407 
”r
, 
mÿm_’Œy
;

410 ià(!
	`Ùx2_g‘_mÿm’Œy_fÜ_mac
(
pf
, 
mac
, &
mÿm_’Œy
))

413 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

414 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pf
->
mbox
);

415 ià(!
»q
) {

416 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

417  -
ENOMEM
;

419 
»q
->
’Œy
 = 
mÿm_’Œy
;

421 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

422 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

424  
”r
;

425 
	}
}

427 
Ùx2_æow
 *
	$Ùx2_fšd_æow
(
Ùx2_nic
 *
pfvf
, 
u32
 
loÿtiÚ
)

429 
Ùx2_æow
 *
™”
;

431 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
pfvf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

432 ià(
™”
->
loÿtiÚ
 ==†ocation)

433  
™”
;

436  
NULL
;

437 
	}
}

439 
	$Ùx2_add_æow_to_li¡
(
Ùx2_nic
 *
pfvf
, 
Ùx2_æow
 *
æow
)

441 
li¡_h—d
 *
h—d
 = &
pfvf
->
æow_cfg
->
æow_li¡
;

442 
Ùx2_æow
 *
™”
;

444 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
pfvf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

445 ià(
™”
->
loÿtiÚ
 > 
æow
->location)

447 
h—d
 = &
™”
->
li¡
;

450 
	`li¡_add
(&
æow
->
li¡
, 
h—d
);

451 
	}
}

453 
	$Ùx2_g‘_maxæows
(
Ùx2_æow_cÚfig
 *
æow_cfg
)

455 ià(!
æow_cfg
)

458 ià(
æow_cfg
->
Ä_æows
 =ğæow_cfg->
max_æows
 ||

459 !
	`b™m­_em±y
(
æow_cfg
->
dmacæt_bm­
,

460 
æow_cfg
->
dmacæt_max_æows
))

461  
æow_cfg
->
max_æows
 + flow_cfg->
dmacæt_max_æows
;

463  
æow_cfg
->
max_æows
;

464 
	}
}

465 
EXPORT_SYMBOL
(
Ùx2_g‘_maxæows
);

467 
	$Ùx2_g‘_æow
(
Ùx2_nic
 *
pfvf
, 
‘htoŞ_rxnfc
 *
nfc
,

468 
u32
 
loÿtiÚ
)

470 
Ùx2_æow
 *
™”
;

472 ià(
loÿtiÚ
 >ğ
	`Ùx2_g‘_maxæows
(
pfvf
->
æow_cfg
))

473  -
EINVAL
;

475 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
pfvf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

476 ià(
™”
->
loÿtiÚ
 ==†ocation) {

477 
nfc
->
fs
 = 
™”
->
æow_¥ec
;

478 
nfc
->
rss_cÚ‹xt
 = 
™”
->
rss_ùx_id
;

483  -
ENOENT
;

484 
	}
}

486 
	$Ùx2_g‘_®l_æows
(
Ùx2_nic
 *
pfvf
, 
‘htoŞ_rxnfc
 *
nfc
,

487 
u32
 *
ruË_locs
)

489 
u32
 
ruË_út
 = 
nfc
->rule_cnt;

490 
u32
 
loÿtiÚ
 = 0;

491 
idx
 = 0;

492 
”r
 = 0;

494 
nfc
->
d©a
 = 
	`Ùx2_g‘_maxæows
(
pfvf
->
æow_cfg
);

495 (!
”r
 ||ƒ¼ =ğ-
ENOENT
è&& 
idx
 < 
ruË_út
) {

496 
”r
 = 
	`Ùx2_g‘_æow
(
pfvf
, 
nfc
, 
loÿtiÚ
);

497 ià(!
”r
)

498 
ruË_locs
[
idx
++] = 
loÿtiÚ
;

499 
loÿtiÚ
++;

501 
nfc
->
ruË_út
 =„ule_cnt;

503  
”r
;

504 
	}
}

506 
	$Ùx2_´•¬e_fd§_æow_»que¡
(
Åc_š¡®l_æow_»q
 *
»q
,

507 
boŞ
 
is_vÏn
)

509 
æow_msg
 *
pmask
 = &
»q
->
mask
;

510 
æow_msg
 *
pkt
 = &
»q
->
·ck‘
;

513 ià(!
is_vÏn
) {

514 
pkt
->
vÏn_tci
 <<= 3;

515 
pmask
->
vÏn_tci
 = 
	`ıu_to_be16
(
FDSA_SPORT_MASK
);

518 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_FDSA_VAL
);

519 
»q
->
vg0_v®id
 = 
Œue
;

520 
»q
->
vg0_ty³
 = 
NIX_AF_LFX_RX_VTAG_TYPE6
;

521 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

522 
	}
}

524 
	$Ùx2_´•¬e_v4_æow
(
‘htoŞ_rx_æow_¥ec
 *
f¥
,

525 
Åc_š¡®l_æow_»q
 *
»q
,

526 
u32
 
æow_ty³
)

528 
‘htoŞ_u¤4_¥ec
 *
v4_u¤_mask
 = &
f¥
->
m_u
.
u¤_4_¥ec
;

529 
‘htoŞ_u¤4_¥ec
 *
v4_u¤_hdr
 = &
f¥
->
h_u
.
u¤_4_¥ec
;

530 
‘htoŞ_tı4_¥ec
 *
v4_l4_mask
 = &
f¥
->
m_u
.
tı_4_¥ec
;

531 
‘htoŞ_tı4_¥ec
 *
v4_l4_hdr
 = &
f¥
->
h_u
.
tı_4_¥ec
;

532 
‘htoŞ_ah_e¥4_¥ec
 *
ah_e¥_hdr
 = &
f¥
->
h_u
.
ah_4_¥ec
;

533 
‘htoŞ_ah_e¥4_¥ec
 *
ah_e¥_mask
 = &
f¥
->
m_u
.
ah_4_¥ec
;

534 
æow_msg
 *
pmask
 = &
»q
->
mask
;

535 
æow_msg
 *
pkt
 = &
»q
->
·ck‘
;

537 
æow_ty³
) {

538 
IP_USER_FLOW
:

539 ià(
v4_u¤_mask
->
4¤c
) {

540 
	`memıy
(&
pkt
->
4¤c
, &
v4_u¤_hdr
->ip4src,

541 (
pkt
->
4¤c
));

542 
	`memıy
(&
pmask
->
4¤c
, &
v4_u¤_mask
->ip4src,

543 (
pmask
->
4¤c
));

544 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV4
);

546 ià(
v4_u¤_mask
->
4d¡
) {

547 
	`memıy
(&
pkt
->
4d¡
, &
v4_u¤_hdr
->ip4dst,

548 (
pkt
->
4d¡
));

549 
	`memıy
(&
pmask
->
4d¡
, &
v4_u¤_mask
->ip4dst,

550 (
pmask
->
4d¡
));

551 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV4
);

553 ià(
v4_u¤_mask
->
tos
) {

554 
pkt
->
tos
 = 
v4_u¤_hdr
->tos;

555 
pmask
->
tos
 = 
v4_u¤_mask
->tos;

556 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_TOS
);

558 ià(
v4_u¤_mask
->
´Ùo
) {

559 
v4_u¤_hdr
->
´Ùo
) {

560 
IPPROTO_ICMP
:

561 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ICMP
);

563 
IPPROTO_TCP
:

564 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_TCP
);

566 
IPPROTO_UDP
:

567 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_UDP
);

569 
IPPROTO_SCTP
:

570 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_SCTP
);

572 
IPPROTO_AH
:

573 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_AH
);

575 
IPPROTO_ESP
:

576 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ESP
);

579  -
EOPNOTSUPP
;

582 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IP
);

583 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

584 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

586 
TCP_V4_FLOW
:

587 
UDP_V4_FLOW
:

588 
SCTP_V4_FLOW
:

589 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IP
);

590 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

591 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

592 ià(
v4_l4_mask
->
4¤c
) {

593 
	`memıy
(&
pkt
->
4¤c
, &
v4_l4_hdr
->ip4src,

594 (
pkt
->
4¤c
));

595 
	`memıy
(&
pmask
->
4¤c
, &
v4_l4_mask
->ip4src,

596 (
pmask
->
4¤c
));

597 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV4
);

599 ià(
v4_l4_mask
->
4d¡
) {

600 
	`memıy
(&
pkt
->
4d¡
, &
v4_l4_hdr
->ip4dst,

601 (
pkt
->
4d¡
));

602 
	`memıy
(&
pmask
->
4d¡
, &
v4_l4_mask
->ip4dst,

603 (
pmask
->
4d¡
));

604 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV4
);

606 ià(
v4_l4_mask
->
tos
) {

607 
pkt
->
tos
 = 
v4_l4_hdr
->tos;

608 
pmask
->
tos
 = 
v4_l4_mask
->tos;

609 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_TOS
);

611 ià(
v4_l4_mask
->
p¤c
) {

612 
	`memıy
(&
pkt
->
¥Üt
, &
v4_l4_hdr
->
p¤c
,

613 (
pkt
->
¥Üt
));

614 
	`memıy
(&
pmask
->
¥Üt
, &
v4_l4_mask
->
p¤c
,

615 (
pmask
->
¥Üt
));

616 ià(
æow_ty³
 =ğ
UDP_V4_FLOW
)

617 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_UDP
);

618 ià(
æow_ty³
 =ğ
TCP_V4_FLOW
)

619 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_TCP
);

621 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_SCTP
);

623 ià(
v4_l4_mask
->
pd¡
) {

624 
	`memıy
(&
pkt
->
dpÜt
, &
v4_l4_hdr
->
pd¡
,

625 (
pkt
->
dpÜt
));

626 
	`memıy
(&
pmask
->
dpÜt
, &
v4_l4_mask
->
pd¡
,

627 (
pmask
->
dpÜt
));

628 ià(
æow_ty³
 =ğ
UDP_V4_FLOW
)

629 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_UDP
);

630 ià(
æow_ty³
 =ğ
TCP_V4_FLOW
)

631 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_TCP
);

633 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_SCTP
);

635 ià(
æow_ty³
 =ğ
UDP_V4_FLOW
)

636 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_UDP
);

637 ià(
æow_ty³
 =ğ
TCP_V4_FLOW
)

638 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_TCP
);

640 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_SCTP
);

642 
AH_V4_FLOW
:

643 
ESP_V4_FLOW
:

644 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IP
);

645 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

646 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

647 ià(
ah_e¥_mask
->
4¤c
) {

648 
	`memıy
(&
pkt
->
4¤c
, &
ah_e¥_hdr
->ip4src,

649 (
pkt
->
4¤c
));

650 
	`memıy
(&
pmask
->
4¤c
, &
ah_e¥_mask
->ip4src,

651 (
pmask
->
4¤c
));

652 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV4
);

654 ià(
ah_e¥_mask
->
4d¡
) {

655 
	`memıy
(&
pkt
->
4d¡
, &
ah_e¥_hdr
->ip4dst,

656 (
pkt
->
4d¡
));

657 
	`memıy
(&
pmask
->
4d¡
, &
ah_e¥_mask
->ip4dst,

658 (
pmask
->
4d¡
));

659 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV4
);

661 ià(
ah_e¥_mask
->
tos
) {

662 
pkt
->
tos
 = 
ah_e¥_hdr
->tos;

663 
pmask
->
tos
 = 
ah_e¥_mask
->tos;

664 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_TOS
);

668 ià(
ah_e¥_mask
->
¥i
 & 
ah_e¥_hdr
->spi)

669  -
EOPNOTSUPP
;

671 ià(
æow_ty³
 =ğ
AH_V4_FLOW
)

672 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_AH
);

674 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ESP
);

681 
	}
}

683 
	$Ùx2_´•¬e_v6_æow
(
‘htoŞ_rx_æow_¥ec
 *
f¥
,

684 
Åc_š¡®l_æow_»q
 *
»q
,

685 
u32
 
æow_ty³
)

687 
‘htoŞ_u¤6_¥ec
 *
v6_u¤_mask
 = &
f¥
->
m_u
.
u¤_6_¥ec
;

688 
‘htoŞ_u¤6_¥ec
 *
v6_u¤_hdr
 = &
f¥
->
h_u
.
u¤_6_¥ec
;

689 
‘htoŞ_tı6_¥ec
 *
v6_l4_mask
 = &
f¥
->
m_u
.
tı_6_¥ec
;

690 
‘htoŞ_tı6_¥ec
 *
v6_l4_hdr
 = &
f¥
->
h_u
.
tı_6_¥ec
;

691 
‘htoŞ_ah_e¥6_¥ec
 *
ah_e¥_hdr
 = &
f¥
->
h_u
.
ah_6_¥ec
;

692 
‘htoŞ_ah_e¥6_¥ec
 *
ah_e¥_mask
 = &
f¥
->
m_u
.
ah_6_¥ec
;

693 
æow_msg
 *
pmask
 = &
»q
->
mask
;

694 
æow_msg
 *
pkt
 = &
»q
->
·ck‘
;

696 
æow_ty³
) {

697 
IPV6_USER_FLOW
:

698 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
v6_u¤_mask
->
6¤c
)) {

699 
	`memıy
(&
pkt
->
6¤c
, &
v6_u¤_hdr
->ip6src,

700 (
pkt
->
6¤c
));

701 
	`memıy
(&
pmask
->
6¤c
, &
v6_u¤_mask
->ip6src,

702 (
pmask
->
6¤c
));

703 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV6
);

705 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
v6_u¤_mask
->
6d¡
)) {

706 
	`memıy
(&
pkt
->
6d¡
, &
v6_u¤_hdr
->ip6dst,

707 (
pkt
->
6d¡
));

708 
	`memıy
(&
pmask
->
6d¡
, &
v6_u¤_mask
->ip6dst,

709 (
pmask
->
6d¡
));

710 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV6
);

712 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IPV6
);

713 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

714 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

716 
TCP_V6_FLOW
:

717 
UDP_V6_FLOW
:

718 
SCTP_V6_FLOW
:

719 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IPV6
);

720 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

721 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

722 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
v6_l4_mask
->
6¤c
)) {

723 
	`memıy
(&
pkt
->
6¤c
, &
v6_l4_hdr
->ip6src,

724 (
pkt
->
6¤c
));

725 
	`memıy
(&
pmask
->
6¤c
, &
v6_l4_mask
->ip6src,

726 (
pmask
->
6¤c
));

727 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV6
);

729 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
v6_l4_mask
->
6d¡
)) {

730 
	`memıy
(&
pkt
->
6d¡
, &
v6_l4_hdr
->ip6dst,

731 (
pkt
->
6d¡
));

732 
	`memıy
(&
pmask
->
6d¡
, &
v6_l4_mask
->ip6dst,

733 (
pmask
->
6d¡
));

734 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV6
);

736 ià(
v6_l4_mask
->
p¤c
) {

737 
	`memıy
(&
pkt
->
¥Üt
, &
v6_l4_hdr
->
p¤c
,

738 (
pkt
->
¥Üt
));

739 
	`memıy
(&
pmask
->
¥Üt
, &
v6_l4_mask
->
p¤c
,

740 (
pmask
->
¥Üt
));

741 ià(
æow_ty³
 =ğ
UDP_V6_FLOW
)

742 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_UDP
);

743 ià(
æow_ty³
 =ğ
TCP_V6_FLOW
)

744 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_TCP
);

746 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_SCTP
);

748 ià(
v6_l4_mask
->
pd¡
) {

749 
	`memıy
(&
pkt
->
dpÜt
, &
v6_l4_hdr
->
pd¡
,

750 (
pkt
->
dpÜt
));

751 
	`memıy
(&
pmask
->
dpÜt
, &
v6_l4_mask
->
pd¡
,

752 (
pmask
->
dpÜt
));

753 ià(
æow_ty³
 =ğ
UDP_V6_FLOW
)

754 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_UDP
);

755 ià(
æow_ty³
 =ğ
TCP_V6_FLOW
)

756 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_TCP
);

758 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_SCTP
);

760 ià(
æow_ty³
 =ğ
UDP_V6_FLOW
)

761 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_UDP
);

762 ià(
æow_ty³
 =ğ
TCP_V6_FLOW
)

763 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_TCP
);

765 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_SCTP
);

767 
AH_V6_FLOW
:

768 
ESP_V6_FLOW
:

769 
pkt
->
‘y³
 = 
	`ıu_to_be16
(
ETH_P_IPV6
);

770 
pmask
->
‘y³
 = 
	`ıu_to_be16
(0xFFFF);

771 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

772 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
ah_e¥_hdr
->
6¤c
)) {

773 
	`memıy
(&
pkt
->
6¤c
, &
ah_e¥_hdr
->ip6src,

774 (
pkt
->
6¤c
));

775 
	`memıy
(&
pmask
->
6¤c
, &
ah_e¥_mask
->ip6src,

776 (
pmask
->
6¤c
));

777 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV6
);

779 ià(!
	`v6_addr_ªy
((
š6_addr
 *)
ah_e¥_hdr
->
6d¡
)) {

780 
	`memıy
(&
pkt
->
6d¡
, &
ah_e¥_hdr
->ip6dst,

781 (
pkt
->
6d¡
));

782 
	`memıy
(&
pmask
->
6d¡
, &
ah_e¥_mask
->ip6dst,

783 (
pmask
->
6d¡
));

784 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV6
);

788 ià((
ah_e¥_mask
->
¥i
 & 
ah_e¥_hdr
->spi) ||

789 (
ah_e¥_mask
->
tşass
 &‡h_esp_mask->tclass))

790  -
EOPNOTSUPP
;

792 ià(
æow_ty³
 =ğ
AH_V6_FLOW
)

793 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_AH
);

795 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ESP
);

801 
	}
}

803 
	$Ùx2_´•¬e_æow_»que¡
(
‘htoŞ_rx_æow_¥ec
 *
f¥
,

804 
Åc_š¡®l_æow_»q
 *
»q
,

805 
Ùx2_nic
 *
pfvf
)

807 
‘hhdr
 *
‘h_mask
 = &
f¥
->
m_u
.
‘h”_¥ec
;

808 
‘hhdr
 *
‘h_hdr
 = &
f¥
->
h_u
.
‘h”_¥ec
;

809 
æow_msg
 *
pmask
 = &
»q
->
mask
;

810 
æow_msg
 *
pkt
 = &
»q
->
·ck‘
;

811 
u32
 
æow_ty³
;

812 
»t
;

814 
æow_ty³
 = 
f¥
->æow_ty³ & ~(
FLOW_EXT
 | 
FLOW_MAC_EXT
 | 
FLOW_RSS
);

815 
æow_ty³
) {

817 
ETHER_FLOW
:

818 ià(!
	`is_z”o_‘h”_addr
(
‘h_mask
->
h_sourû
)) {

819 
	`‘h”_addr_cİy
(
pkt
->
smac
, 
‘h_hdr
->
h_sourû
);

820 
	`‘h”_addr_cİy
(
pmask
->
smac
, 
‘h_mask
->
h_sourû
);

821 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SMAC
);

823 ià(!
	`is_z”o_‘h”_addr
(
‘h_mask
->
h_de¡
)) {

824 
	`‘h”_addr_cİy
(
pkt
->
dmac
, 
‘h_hdr
->
h_de¡
);

825 
	`‘h”_addr_cİy
(
pmask
->
dmac
, 
‘h_mask
->
h_de¡
);

826 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DMAC
);

828 ià(
‘h_hdr
->
h_´Ùo
) {

829 
	`memıy
(&
pkt
->
‘y³
, &
‘h_hdr
->
h_´Ùo
,

830 (
pkt
->
‘y³
));

831 
	`memıy
(&
pmask
->
‘y³
, &
‘h_mask
->
h_´Ùo
,

832 (
pmask
->
‘y³
));

833 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

836 
IP_USER_FLOW
:

837 
TCP_V4_FLOW
:

838 
UDP_V4_FLOW
:

839 
SCTP_V4_FLOW
:

840 
AH_V4_FLOW
:

841 
ESP_V4_FLOW
:

842 
»t
 = 
	`Ùx2_´•¬e_v4_æow
(
f¥
, 
»q
, 
æow_ty³
);

843 ià(
»t
)

844  
»t
;

846 
IPV6_USER_FLOW
:

847 
TCP_V6_FLOW
:

848 
UDP_V6_FLOW
:

849 
SCTP_V6_FLOW
:

850 
AH_V6_FLOW
:

851 
ESP_V6_FLOW
:

852 
»t
 = 
	`Ùx2_´•¬e_v6_æow
(
f¥
, 
»q
, 
æow_ty³
);

853 ià(
»t
)

854  
»t
;

857  -
EOPNOTSUPP
;

859 ià(
f¥
->
æow_ty³
 & 
FLOW_EXT
) {

860 
sk_u£r_def
 = 
çl£
;

861 
u16
 
vÏn_‘y³
;

863 ià(
f¥
->
m_ext
.
vÏn_‘y³
) {

865 ià(
f¥
->
m_ext
.
vÏn_‘y³
 != 0xFFFF)

866  -
EINVAL
;

868 
vÏn_‘y³
 = 
	`be16_to_ıu
(
f¥
->
h_ext
.vlan_etype);

870 ià(
vÏn_‘y³
 !ğ
ETH_P_8021Q
 &&

871 
vÏn_‘y³
 !ğ
ETH_P_8021AD
)

872  -
EINVAL
;

874 
	`memıy
(&
pkt
->
vÏn_‘y³
, &
f¥
->
h_ext
.vlan_etype,

875 (
pkt
->
vÏn_‘y³
));

876 
	`memıy
(&
pmask
->
vÏn_‘y³
, &
f¥
->
m_ext
.vlan_etype,

877 (
pmask
->
vÏn_‘y³
));

879 ià(
vÏn_‘y³
 =ğ
ETH_P_8021Q
)

880 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_VLAN_ETYPE_CTAG
);

882 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_VLAN_ETYPE_STAG
);

884 ià(
f¥
->
m_ext
.
vÏn_tci
) {

885 
	`memıy
(&
pkt
->
vÏn_tci
, &
f¥
->
h_ext
.vlan_tci,

886 (
pkt
->
vÏn_tci
));

887 
	`memıy
(&
pmask
->
vÏn_tci
, &
f¥
->
m_ext
.vlan_tci,

888 (
pmask
->
vÏn_tci
));

890 ià(
pfvf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
) {

891 
	`Ùx2_´•¬e_fd§_æow_»que¡
(
»q
, 
Œue
);

892 
sk_u£r_def
 = 
Œue
;

894 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_OUTER_VID
);

898 ià(
f¥
->
m_ext
.
d©a
[1] && !
sk_u£r_def
) {

899 ià(
pfvf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
) {

900 ià(
	`be32_to_ıu
(
f¥
->
h_ext
.
d©a
[1]) >=

901 
FDSA_MAX_SPORT
)

902  -
EINVAL
;

904 
	`memıy
(&
pkt
->
vÏn_tci
,

905 (
u8
 *)&
f¥
->
h_ext
.
d©a
[1] + 2,

906 (
pkt
->
vÏn_tci
));

907 
	`Ùx2_´•¬e_fd§_æow_»que¡
(
»q
, 
çl£
);

908 } ià(
f¥
->
h_ext
.
d©a
[1] ==

909 
	`ıu_to_be32
(
OTX2_DEFAULT_ACTION
)) {

913 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

918 ià(
f¥
->
æow_ty³
 & 
FLOW_MAC_EXT
 &&

919 !
	`is_z”o_‘h”_addr
(
f¥
->
m_ext
.
h_de¡
)) {

920 
	`‘h”_addr_cİy
(
pkt
->
dmac
, 
f¥
->
h_ext
.
h_de¡
);

921 
	`‘h”_addr_cİy
(
pmask
->
dmac
, 
f¥
->
m_ext
.
h_de¡
);

922 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DMAC
);

925 ià(!
»q
->
ã©u»s
)

926  -
EOPNOTSUPP
;

929 
	}
}

931 
	$Ùx2_is_æow_ruË_dmacf‹r
(
Ùx2_nic
 *
pfvf
,

932 
‘htoŞ_rx_æow_¥ec
 *
f¥
)

934 
‘hhdr
 *
‘h_mask
 = &
f¥
->
m_u
.
‘h”_¥ec
;

935 
‘hhdr
 *
‘h_hdr
 = &
f¥
->
h_u
.
‘h”_¥ec
;

936 
u64
 
ršg_cook›
 = 
f¥
->ring_cookie;

937 
u32
 
æow_ty³
;

939 ià(!(
pfvf
->
æags
 & 
OTX2_FLAG_DMACFLTR_SUPPORT
))

940  
çl£
;

942 
æow_ty³
 = 
f¥
->æow_ty³ & ~(
FLOW_EXT
 | 
FLOW_MAC_EXT
 | 
FLOW_RSS
);

947 ià(
æow_ty³
 =ğ
ETHER_FLOW
 && 
ršg_cook›
 !ğ
RX_CLS_FLOW_DISC
 &&

948 !
	`‘htoŞ_g‘_æow_¥ec_ršg_vf
(
ršg_cook›
)) {

949 ià(
	`is_z”o_‘h”_addr
(
‘h_mask
->
h_de¡
) &&

950 
	`is_v®id_‘h”_addr
(
‘h_hdr
->
h_de¡
))

951  
Œue
;

954  
çl£
;

955 
	}
}

957 
	$Ùx2_add_æow_msg
(
Ùx2_nic
 *
pfvf
, 
Ùx2_æow
 *
æow
)

959 
u64
 
ršg_cook›
 = 
æow
->
æow_¥ec
.ring_cookie;

960 #ifdeà
CONFIG_DCB


961 
vÏn_´io
, 
qidx
, 
pfc_ruË
 = 0;

963 
Åc_š¡®l_æow_»q
 *
»q
;

964 
”r
, 
vf
 = 0;

966 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

967 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pfvf
->
mbox
);

968 ià(!
»q
) {

969 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

970  -
ENOMEM
;

973 
”r
 = 
	`Ùx2_´•¬e_æow_»que¡
(&
æow
->
æow_¥ec
, 
»q
, 
pfvf
);

974 ià(
”r
) {

976 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

977 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

978  
”r
;

981 
»q
->
’Œy
 = 
æow
->entry;

982 
»q
->
štf
 = 
NIX_INTF_RX
;

983 
»q
->
£t_úŒ
 = 1;

984 
»q
->
chªÃl
 = 
pfvf
->
hw
.
rx_chª_ba£
;

985 ià(
ršg_cook›
 =ğ
RX_CLS_FLOW_DISC
) {

986 
»q
->
İ
 = 
NIX_RX_ACTIONOP_DROP
;

991 ià(
æow
->
æow_¥ec
.
æow_ty³
 & 
FLOW_RSS
) {

992 
»q
->
İ
 = 
NIX_RX_ACTIONOP_RSS
;

993 
»q
->
šdex
 = 
æow
->
rss_ùx_id
;

994 
»q
->
æow_key_®g
 = 
pfvf
->
hw
.
æowkey_®g_idx
;

996 
»q
->
İ
 = 
NIX_RX_ACTIONOP_UCAST
;

997 
»q
->
šdex
 = 
	`‘htoŞ_g‘_æow_¥ec_ršg
(
ršg_cook›
);

999 
vf
 = 
	`‘htoŞ_g‘_æow_¥ec_ršg_vf
(
ršg_cook›
);

1000 ià(
vf
 > 
	`pci_num_vf
(
pfvf
->
pdev
)) {

1001 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1002  -
EINVAL
;

1005 #ifdeà
CONFIG_DCB


1007 ià(!
vf
 && (
»q
->
ã©u»s
 & 
	`BIT_ULL
(
NPC_OUTER_VID
)) &&

1008 
pfvf
->
pfc_’
 && 
»q
->
İ
 !ğ
NIX_RX_ACTIONOP_RSS
) {

1009 
vÏn_´io
 = 
	`Áohs
(
»q
->
·ck‘
.
vÏn_tci
) &

1010 
	`Áohs
(
»q
->
mask
.
vÏn_tci
);

1013 
vÏn_´io
 >>= 13;

1014 
æow
->
ruË_ty³
 |ğ
PFC_FLOWCTRL_RULE
;

1016 ià(
pfvf
->
pfc_’
 & 
	`BIT
(
vÏn_´io
)) {

1017 
pfc_ruË
 = 
Œue
;

1018 
qidx
 = 
»q
->
šdex
;

1025 ià(
vf
) {

1026 
»q
->
vf
 = vf;

1027 
æow
->
is_vf
 = 
Œue
;

1028 
æow
->
vf
 = vf;

1032 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1034 #ifdeà
CONFIG_DCB


1035 ià(!
”r
 && 
pfc_ruË
)

1036 
	`Ùx2_upd©e_bpid_š_rqùx
(
pfvf
, 
vÏn_´io
, 
qidx
, 
Œue
);

1039 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1040  
”r
;

1041 
	}
}

1043 
	$Ùx2_add_æow_w™h_pfmac
(
Ùx2_nic
 *
pfvf
,

1044 
Ùx2_æow
 *
æow
)

1046 
‘hhdr
 *
‘h_hdr
;

1047 
Ùx2_æow
 *
pf_mac
;

1049 
pf_mac
 = 
	`kz®loc
((*pf_mac), 
GFP_KERNEL
);

1050 ià(!
pf_mac
)

1051  -
ENOMEM
;

1053 
pf_mac
->
’Œy
 = 0;

1054 
pf_mac
->
ruË_ty³
 |ğ
DMAC_FILTER_RULE
;

1055 
pf_mac
->
loÿtiÚ
 = 
pfvf
->
æow_cfg
->
max_æows
;

1056 
	`memıy
(&
pf_mac
->
æow_¥ec
, &
æow
->flow_spec,

1057 (
‘htoŞ_rx_æow_¥ec
));

1058 
pf_mac
->
æow_¥ec
.
loÿtiÚ
 =…f_mac->location;

1061 
‘h_hdr
 = &
pf_mac
->
æow_¥ec
.
h_u
.
‘h”_¥ec
;

1062 
	`‘h”_addr_cİy
(
‘h_hdr
->
h_de¡
, 
pfvf
->
Ãtdev
->
dev_addr
);

1065 
	`Ùx2_dmacæt_add
(
pfvf
, 
‘h_hdr
->
h_de¡
, 0);

1067 
	`Ùx2_add_æow_to_li¡
(
pfvf
, 
pf_mac
);

1068 
pfvf
->
æow_cfg
->
Ä_æows
++;

1069 
	`£t_b™
(0, 
pfvf
->
æow_cfg
->
dmacæt_bm­
);

1072 
	}
}

1074 
	$Ùx2_add_æow
(
Ùx2_nic
 *
pfvf
, 
‘htoŞ_rxnfc
 *
nfc
)

1076 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1077 
‘htoŞ_rx_æow_¥ec
 *
f¥
 = &
nfc
->
fs
;

1078 
Ùx2_æow
 *
æow
;

1079 
‘hhdr
 *
‘h_hdr
;

1080 
boŞ
 
Ãw
 = 
çl£
;

1081 
”r
 = 0;

1082 
u32
 
ršg
;

1084 ià(!
æow_cfg
->
max_æows
) {

1085 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1087  -
EINVAL
;

1090 
ršg
 = 
	`‘htoŞ_g‘_æow_¥ec_ršg
(
f¥
->
ršg_cook›
);

1091 ià(!(
pfvf
->
æags
 & 
OTX2_FLAG_NTUPLE_SUPPORT
))

1092  -
ENOMEM
;

1094 ià(
ršg
 >ğ
pfvf
->
hw
.
rx_queues
 && 
f¥
->
ršg_cook›
 !ğ
RX_CLS_FLOW_DISC
)

1095  -
EINVAL
;

1097 ià(
f¥
->
loÿtiÚ
 >ğ
	`Ùx2_g‘_maxæows
(
æow_cfg
))

1098  -
EINVAL
;

1100 
æow
 = 
	`Ùx2_fšd_æow
(
pfvf
, 
f¥
->
loÿtiÚ
);

1101 ià(!
æow
) {

1102 
æow
 = 
	`kz®loc
((*æow), 
GFP_KERNEL
);

1103 ià(!
æow
)

1104  -
ENOMEM
;

1105 
æow
->
loÿtiÚ
 = 
f¥
->location;

1106 
æow
->
’Œy
 = 
æow_cfg
->
æow_’t
[æow->
loÿtiÚ
];

1107 
Ãw
 = 
Œue
;

1110 
æow
->
æow_¥ec
 = *
f¥
;

1112 ià(
f¥
->
æow_ty³
 & 
FLOW_RSS
)

1113 
æow
->
rss_ùx_id
 = 
nfc
->
rss_cÚ‹xt
;

1115 ià(
	`Ùx2_is_æow_ruË_dmacf‹r
(
pfvf
, &
æow
->
æow_¥ec
)) {

1116 
‘h_hdr
 = &
æow
->
æow_¥ec
.
h_u
.
‘h”_¥ec
;

1119 ià(
æow
->
ruË_ty³
 & 
DMAC_FILTER_RULE
)

1120  
	`Ùx2_dmacæt_upd©e
(
pfvf
, 
‘h_hdr
->
h_de¡
,

1121 
æow
->
’Œy
);

1123 ià(
	`b™m­_fuÎ
(
æow_cfg
->
dmacæt_bm­
,

1124 
æow_cfg
->
dmacæt_max_æows
)) {

1125 
	`Ãtdev_w¬n
(
pfvf
->
Ãtdev
,

1127 
æow
->
loÿtiÚ
 +

1128 
æow_cfg
->
dmacæt_max_æows
,

1129 
æow_cfg
->
dmacæt_max_æows
);

1130 
”r
 = -
EINVAL
;

1131 ià(
Ãw
)

1132 
	`kä“
(
æow
);

1133  
”r
;

1137 ià(!
	`‹¡_b™
(0, 
æow_cfg
->
dmacæt_bm­
))

1138 
	`Ùx2_add_æow_w™h_pfmac
(
pfvf
, 
æow
);

1140 
æow
->
ruË_ty³
 |ğ
DMAC_FILTER_RULE
;

1141 
æow
->
’Œy
 = 
	`fšd_fœ¡_z”o_b™
(
æow_cfg
->
dmacæt_bm­
,

1142 
æow_cfg
->
dmacæt_max_æows
);

1143 
f¥
->
loÿtiÚ
 = 
æow_cfg
->
max_æows
 + 
æow
->
’Œy
;

1144 
æow
->
æow_¥ec
.
loÿtiÚ
 = 
f¥
->location;

1145 
æow
->
loÿtiÚ
 = 
f¥
->location;

1147 
	`£t_b™
(
æow
->
’Œy
, 
æow_cfg
->
dmacæt_bm­
);

1148 
	`Ùx2_dmacæt_add
(
pfvf
, 
‘h_hdr
->
h_de¡
, 
æow
->
’Œy
);

1151 ià(
æow
->
loÿtiÚ
 >ğ
pfvf
->
æow_cfg
->
max_æows
) {

1152 
	`Ãtdev_w¬n
(
pfvf
->
Ãtdev
,

1154 
æow
->
loÿtiÚ
,

1155 
æow_cfg
->
max_æows
 - 1);

1156 
”r
 = -
EINVAL
;

1158 
”r
 = 
	`Ùx2_add_æow_msg
(
pfvf
, 
æow
);

1162 ià(
”r
) {

1163 ià(
”r
 =ğ
MBOX_MSG_INVALID
)

1164 
”r
 = -
EINVAL
;

1165 ià(
Ãw
)

1166 
	`kä“
(
æow
);

1167  
”r
;

1171 ià(
Ãw
) {

1172 
	`Ùx2_add_æow_to_li¡
(
pfvf
, 
æow
);

1173 
æow_cfg
->
Ä_æows
++;

1177 
	}
}

1179 
	$Ùx2_»move_æow_msg
(
Ùx2_nic
 *
pfvf
, 
u16
 
’Œy
, 
boŞ
 
®l
)

1181 
Åc_d–‘e_æow_»q
 *
»q
;

1182 
”r
;

1184 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1185 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pfvf
->
mbox
);

1186 ià(!
»q
) {

1187 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1188  -
ENOMEM
;

1191 
»q
->
’Œy
 =ƒntry;

1192 ià(
®l
)

1193 
»q
->
®l
 = 1;

1196 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1197 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1198  
”r
;

1199 
	}
}

1201 
	$Ùx2_upd©e_»m_pfmac
(
Ùx2_nic
 *
pfvf
, 
»q
)

1203 
Ùx2_æow
 *
™”
;

1204 
‘hhdr
 *
‘h_hdr
;

1205 
boŞ
 
found
 = 
çl£
;

1207 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
pfvf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

1208 ià((
™”
->
ruË_ty³
 & 
DMAC_FILTER_RULE
è&& i‹r->
’Œy
 == 0) {

1209 
‘h_hdr
 = &
™”
->
æow_¥ec
.
h_u
.
‘h”_¥ec
;

1210 ià(
»q
 =ğ
DMAC_ADDR_DEL
) {

1211 
	`Ùx2_dmacæt_»move
(
pfvf
, 
‘h_hdr
->
h_de¡
,

1213 
	`ş—r_b™
(0, 
pfvf
->
æow_cfg
->
dmacæt_bm­
);

1214 
found
 = 
Œue
;

1216 
	`‘h”_addr_cİy
(
‘h_hdr
->
h_de¡
,

1217 
pfvf
->
Ãtdev
->
dev_addr
);

1219 
	`Ùx2_dmacæt_upd©e
(
pfvf
, 
‘h_hdr
->
h_de¡
, 0);

1225 ià(
found
) {

1226 
	`li¡_d–
(&
™”
->
li¡
);

1227 
	`kä“
(
™”
);

1228 
pfvf
->
æow_cfg
->
Ä_æows
--;

1230 
	}
}

1232 
	$Ùx2_»move_æow
(
Ùx2_nic
 *
pfvf
, 
u32
 
loÿtiÚ
)

1234 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1235 
Ùx2_æow
 *
æow
;

1236 
”r
;

1238 ià(
loÿtiÚ
 >ğ
	`Ùx2_g‘_maxæows
(
æow_cfg
))

1239  -
EINVAL
;

1241 
æow
 = 
	`Ùx2_fšd_æow
(
pfvf
, 
loÿtiÚ
);

1242 ià(!
æow
)

1243  -
ENOENT
;

1245 ià(
æow
->
ruË_ty³
 & 
DMAC_FILTER_RULE
) {

1246 
‘hhdr
 *
‘h_hdr
 = &
æow
->
æow_¥ec
.
h_u
.
‘h”_¥ec
;

1249 ià(
	`‘h”_addr_equ®
(
pfvf
->
Ãtdev
->
dev_addr
, 
‘h_hdr
->
h_de¡
))

1250  -
EPERM
;

1252 
”r
 = 
	`Ùx2_dmacæt_»move
(
pfvf
, 
‘h_hdr
->
h_de¡
,

1253 
æow
->
’Œy
);

1254 
	`ş—r_b™
(
æow
->
’Œy
, 
æow_cfg
->
dmacæt_bm­
);

1259 ià(
	`b™m­_weight
(
æow_cfg
->
dmacæt_bm­
,

1260 
æow_cfg
->
dmacæt_max_æows
) == 1)

1261 
	`Ùx2_upd©e_»m_pfmac
(
pfvf
, 
DMAC_ADDR_DEL
);

1263 #ifdeà
CONFIG_DCB


1264 ià(
æow
->
ruË_ty³
 & 
PFC_FLOWCTRL_RULE
)

1265 
	`Ùx2_upd©e_bpid_š_rqùx
(
pfvf
, 0,

1266 
æow
->
æow_¥ec
.
ršg_cook›
,

1267 
çl£
);

1270 
”r
 = 
	`Ùx2_»move_æow_msg
(
pfvf
, 
æow
->
’Œy
, 
çl£
);

1273 ià(
”r
)

1274  
”r
;

1276 
	`li¡_d–
(&
æow
->
li¡
);

1277 
	`kä“
(
æow
);

1278 
æow_cfg
->
Ä_æows
--;

1281 
	}
}

1283 
	$Ùx2_rss_ùx_æow_d–
(
Ùx2_nic
 *
pfvf
, 
ùx_id
)

1285 
Ùx2_æow
 *
æow
, *
tmp
;

1286 
”r
;

1288 
	`li¡_fÜ_—ch_’Œy_§ã
(
æow
, 
tmp
, &
pfvf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

1289 ià(
æow
->
rss_ùx_id
 !ğ
ùx_id
)

1291 
”r
 = 
	`Ùx2_»move_æow
(
pfvf
, 
æow
->
loÿtiÚ
);

1292 ià(
”r
)

1293 
	`Ãtdev_w¬n
(
pfvf
->
Ãtdev
,

1295 
æow
->
loÿtiÚ
, 
”r
);

1297 
	}
}

1299 
	$Ùx2_de¡roy_Áu¶e_æows
(
Ùx2_nic
 *
pfvf
)

1301 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1302 
Åc_d–‘e_æow_»q
 *
»q
;

1303 
Ùx2_æow
 *
™”
, *
tmp
;

1304 
”r
;

1306 ià(!(
pfvf
->
æags
 & 
OTX2_FLAG_NTUPLE_SUPPORT
))

1309 ià(!
æow_cfg
->
max_æows
)

1312 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1313 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pfvf
->
mbox
);

1314 ià(!
»q
) {

1315 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1316  -
ENOMEM
;

1319 
»q
->
¡¬t
 = 
æow_cfg
->
æow_’t
[0];

1320 
»q
->
’d
 = 
æow_cfg
->
æow_’t
[æow_cfg->
max_æows
 - 1];

1321 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1322 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1324 
	`li¡_fÜ_—ch_’Œy_§ã
(
™”
, 
tmp
, &
æow_cfg
->
æow_li¡
, 
li¡
) {

1325 
	`li¡_d–
(&
™”
->
li¡
);

1326 
	`kä“
(
™”
);

1327 
æow_cfg
->
Ä_æows
--;

1329  
”r
;

1330 
	}
}

1332 
	$Ùx2_de¡roy_mÿm_æows
(
Ùx2_nic
 *
pfvf
)

1334 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1335 
Åc_mÿm_ä“_’Œy_»q
 *
»q
;

1336 
Ùx2_æow
 *
™”
, *
tmp
;

1337 
”r
;

1339 ià(!(
pfvf
->
æags
 & 
OTX2_FLAG_MCAM_ENTRIES_ALLOC
))

1343 
”r
 = 
	`Ùx2_»move_æow_msg
(
pfvf
, 0, 
Œue
);

1344 ià(
”r
)

1345  
”r
;

1347 
	`li¡_fÜ_—ch_’Œy_§ã
(
™”
, 
tmp
, &
æow_cfg
->
æow_li¡
, 
li¡
) {

1348 
	`li¡_d–
(&
™”
->
li¡
);

1349 
	`kä“
(
™”
);

1350 
æow_cfg
->
Ä_æows
--;

1353 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1354 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_ä“_’Œy
(&
pfvf
->
mbox
);

1355 ià(!
»q
) {

1356 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1357  -
ENOMEM
;

1360 
»q
->
®l
 = 1;

1362 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1363 ià(
”r
) {

1364 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1365  
”r
;

1368 
pfvf
->
æags
 &ğ~
OTX2_FLAG_MCAM_ENTRIES_ALLOC
;

1369 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1372 
	}
}

1374 
	$Ùx2_š¡®l_rxvÏn_ofæßd_æow
(
Ùx2_nic
 *
pfvf
)

1376 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1377 
Åc_š¡®l_æow_»q
 *
»q
;

1378 
”r
;

1380 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1381 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pfvf
->
mbox
);

1382 ià(!
»q
) {

1383 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1384  -
ENOMEM
;

1387 
»q
->
’Œy
 = 
æow_cfg
->
def_’t
[æow_cfg->
rx_vÏn_off£t
];

1388 
»q
->
štf
 = 
NIX_INTF_RX
;

1389 
	`‘h”_addr_cİy
(
»q
->
·ck‘
.
dmac
, 
pfvf
->
Ãtdev
->
dev_addr
);

1390 
	`‘h_brßdÿ¡_addr
((
u8
 *)&
»q
->
mask
.
dmac
);

1391 
»q
->
chªÃl
 = 
pfvf
->
hw
.
rx_chª_ba£
;

1392 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

1393 
»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_OUTER_VID
è| BIT_ULL(
NPC_DMAC
);

1394 
»q
->
vg0_v®id
 = 
Œue
;

1395 
»q
->
vg0_ty³
 = 
NIX_AF_LFX_RX_VTAG_TYPE0
;

1398 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1399 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1400  
”r
;

1401 
	}
}

1403 
	$Ùx2_d–‘e_rxvÏn_ofæßd_æow
(
Ùx2_nic
 *
pfvf
)

1405 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pfvf
->flow_cfg;

1406 
Åc_d–‘e_æow_»q
 *
»q
;

1407 
”r
;

1409 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1410 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pfvf
->
mbox
);

1411 ià(!
»q
) {

1412 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1413  -
ENOMEM
;

1416 
»q
->
’Œy
 = 
æow_cfg
->
def_’t
[æow_cfg->
rx_vÏn_off£t
];

1418 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1419 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1420  
”r
;

1421 
	}
}

1423 
	$Ùx2_’abË_rxvÏn
(
Ùx2_nic
 *
pf
, 
boŞ
 
’abË
)

1425 
nix_vg_cÚfig
 *
»q
;

1426 
mbox_msghdr
 *
r¥_hdr
;

1427 
”r
;

1430 ià(!(
pf
->
æags
 & 
OTX2_FLAG_RX_VLAN_SUPPORT
))

1431  -
ENOMEM
;

1434 ià(
pf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
)

1435 
’abË
 = 
çl£
;

1437 ià(
’abË
) {

1438 
”r
 = 
	`Ùx2_š¡®l_rxvÏn_ofæßd_æow
(
pf
);

1439 ià(
”r
)

1440  
”r
;

1442 
”r
 = 
	`Ùx2_d–‘e_rxvÏn_ofæßd_æow
(
pf
);

1443 ià(
”r
)

1444  
”r
;

1447 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

1448 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_vg_cfg
(&
pf
->
mbox
);

1449 ià(!
»q
) {

1450 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1451  -
ENOMEM
;

1455 
»q
->
vg_size
 = 
VTAGSIZE_T4
;

1456 
»q
->
cfg_ty³
 = 1;

1457 
»q
->
rx
.
vg_ty³
 = 
NIX_AF_LFX_RX_VTAG_TYPE0
;

1458 
»q
->
rx
.
¡r_vg
 = 
’abË
;

1459 
»q
->
rx
.
ÿ±u»_vg
 = 
’abË
;

1461 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

1462 ià(
”r
) {

1463 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1464  
”r
;

1467 
r¥_hdr
 = 
	`Ùx2_mbox_g‘_r¥
(&
pf
->
mbox
.mbox, 0, &
»q
->
hdr
);

1468 ià(
	`IS_ERR
(
r¥_hdr
)) {

1469 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1470  
	`PTR_ERR
(
r¥_hdr
);

1473 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1474  
r¥_hdr
->
rc
;

1475 
	}
}

1477 
	$Ùx2_dmacæt_»š¡®l_æows
(
Ùx2_nic
 *
pf
)

1479 
Ùx2_æow
 *
™”
;

1480 
‘hhdr
 *
‘h_hdr
;

1482 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
pf
->
æow_cfg
->
æow_li¡
, 
li¡
) {

1483 ià(
™”
->
ruË_ty³
 & 
DMAC_FILTER_RULE
) {

1484 
‘h_hdr
 = &
™”
->
æow_¥ec
.
h_u
.
‘h”_¥ec
;

1485 
	`Ùx2_dmacæt_add
(
pf
, 
‘h_hdr
->
h_de¡
,

1486 
™”
->
’Œy
);

1489 
	}
}

1491 
	$Ùx2_dmacæt_upd©e_pfmac_æow
(
Ùx2_nic
 *
pfvf
)

1493 
	`Ùx2_upd©e_»m_pfmac
(
pfvf
, 
DMAC_ADDR_UPDATE
);

1494 
	}
}

	@otx2_map.c

1 
	~<lšux/Ãtdeviû.h
>

2 
	~<lšux/f‹r.h
>

3 
	~"Ùx2_commÚ.h
"

4 
	~"Ùx2_xdp_debug.h
"

5 
	~"Ùx2_m­.h
"

7 
boŞ


8 
	$Ùx2_m­_key_m©ch
(
bpf_m­
 *
m­
, 
Ùx2_m­_’Œy
 *
e
, *
key
)

10  
e
->
key
 && !
	`memcmp
(key,ƒ->key, 
m­
->
key_size
);

11 
	}
}

13 
	$Ùx2_m­_key_fšd
(
bpf_ofæßded_m­
 *
offm­
, *
key
)

15 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

16 
i
;

18 
i
 = 0; i < 
	`ARRAY_SIZE
(
Ùx2
->
’Œy
); i++)

19 ià(
	`Ùx2_m­_key_m©ch
(&
offm­
->
m­
, &
Ùx2
->
’Œy
[
i
], 
key
))

20  
i
;

22  -
ENOENT
;

23 
	}
}

26 
	$Ùx2_m­_®loc_–em
(
bpf_ofæßded_m­
 *
offm­
, 
idx
)

28 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

30 
Ùx2
->
’Œy
[
idx
].
key
 = 
	`km®loc
(
offm­
->
m­
.
key_size
, 
GFP_USER
);

31 ià(!
Ùx2
->
’Œy
[
idx
].
key
)

32  -
ENOMEM
;

33 
Ùx2
->
’Œy
[
idx
].
v®ue
 = 
	`km®loc
(
offm­
->
m­
.
v®ue_size
, 
GFP_USER
);

34 ià(!
Ùx2
->
’Œy
[
idx
].
v®ue
) {

35 
	`kä“
(
Ùx2
->
’Œy
[
idx
].
key
);

36 
Ùx2
->
’Œy
[
idx
].
key
 = 
NULL
;

37  -
ENOMEM
;

41 
	}
}

44 
	$Ùx2_m­_g‘_Ãxt_key
(
bpf_ofæßded_m­
 *
offm­
,

45 *
key
, *
Ãxt_key
)

47 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

48 
idx
 = -
ENOENT
;

50 
	`mu‹x_lock
(&
Ùx2
->
mu‹x
);

52 ià(
key
)

53 
idx
 = 
	`Ùx2_m­_key_fšd
(
offm­
, 
key
);

54 ià(
idx
 =ğ-
ENOENT
)

55 
idx
 = 0;

57 
idx
++;

59 ; 
idx
 < 
	`ARRAY_SIZE
(
Ùx2
->
’Œy
); idx++) {

60 ià(
Ùx2
->
’Œy
[
idx
].
key
) {

61 
	`memıy
(
Ãxt_key
, 
Ùx2
->
’Œy
[
idx
].
key
,

62 
offm­
->
m­
.
key_size
);

67 
	`mu‹x_uÆock
(&
Ùx2
->
mu‹x
);

69 ià(
idx
 =ğ
	`ARRAY_SIZE
(
Ùx2
->
’Œy
))

70  -
ENOENT
;

72 
	}
}

75 
	$Ùx2_m­_lookup_–em
(
bpf_ofæßded_m­
 *
offm­
, *
key
, *
v®ue
)

77 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

78 
idx
;

80 
	`mu‹x_lock
(&
Ùx2
->
mu‹x
);

82 
idx
 = 
	`Ùx2_m­_key_fšd
(
offm­
, 
key
);

83 ià(
idx
 >= 0)

84 
	`memıy
(
v®ue
, 
Ùx2
->
’Œy
[
idx
].v®ue, 
offm­
->
m­
.
v®ue_size
);

86 
	`mu‹x_uÆock
(&
Ùx2
->
mu‹x
);

88  
idx
 < 0 ? idx : 0;

89 
	}
}

92 
	$Ùx2_m­_upd©e_–em
(
bpf_ofæßded_m­
 *
offm­
,

93 *
key
, *
v®ue
, 
u64
 
æags
)

95 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

96 
idx
, 
”r
 = 0;

98 
	`mu‹x_lock
(&
Ùx2
->
mu‹x
);

100 
idx
 = 
	`Ùx2_m­_key_fšd
(
offm­
, 
key
);

101 ià(
idx
 < 0 && 
æags
 =ğ
BPF_EXIST
) {

102 
”r
 = 
idx
;

103 
ex™_uÆock
;

105 ià(
idx
 >ğ0 && 
æags
 =ğ
BPF_NOEXIST
) {

106 
”r
 = -
EEXIST
;

107 
ex™_uÆock
;

110 ià(
idx
 < 0) {

111 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
Ùx2
->
’Œy
); idx++)

112 ià(!
Ùx2
->
’Œy
[
idx
].
key
)

114 ià(
idx
 =ğ
	`ARRAY_SIZE
(
Ùx2
->
’Œy
)) {

115 
”r
 = -
E2BIG
;

116 
ex™_uÆock
;

119 
”r
 = 
	`Ùx2_m­_®loc_–em
(
offm­
, 
idx
);

120 ià(
”r
)

121 
ex™_uÆock
;

124 
	`memıy
(
Ùx2
->
’Œy
[
idx
].
key
, key, 
offm­
->
m­
.
key_size
);

125 
	`memıy
(
Ùx2
->
’Œy
[
idx
].
v®ue
, v®ue, 
offm­
->
m­
.
v®ue_size
);

126 
ex™_uÆock
:

127 
	`mu‹x_uÆock
(&
Ùx2
->
mu‹x
);

129  
”r
;

130 
	}
}

132 
	$Ùx2_m­_d–‘e_–em
(
bpf_ofæßded_m­
 *
offm­
, *
key
)

134 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

135 
idx
;

137 ià(
offm­
->
m­
.
m­_ty³
 =ğ
BPF_MAP_TYPE_ARRAY
)

138  -
EINVAL
;

140 
	`mu‹x_lock
(&
Ùx2
->
mu‹x
);

142 
idx
 = 
	`Ùx2_m­_key_fšd
(
offm­
, 
key
);

143 ià(
idx
 >= 0) {

144 
	`kä“
(
Ùx2
->
’Œy
[
idx
].
key
);

145 
	`kä“
(
Ùx2
->
’Œy
[
idx
].
v®ue
);

146 
	`mem£t
(&
Ùx2
->
’Œy
[
idx
], 0, (otx2->entry[idx]));

149 
	`mu‹x_uÆock
(&
Ùx2
->
mu‹x
);

151  
idx
 < 0 ? idx : 0;

152 
	}
}

154 cÚ¡ 
bpf_m­_dev_İs
 
	gÙx2_bpf_m­_İs
 = {

155 .
m­_g‘_Ãxt_key
 = 
Ùx2_m­_g‘_Ãxt_key
,

156 .
	gm­_lookup_–em
 = 
Ùx2_m­_lookup_–em
,

157 .
	gm­_upd©e_–em
 = 
Ùx2_m­_upd©e_–em
,

158 .
	gm­_d–‘e_–em
 = 
Ùx2_m­_d–‘e_–em
,

162 
	$Ùx2_bpf_m­_®loc
(
Ãt_deviû
 *
Ãtdev
, 
bpf_ofæßded_m­
 *
offm­
)

164 
Ùx2_bpf_bound_m­
 *
Ùx2_m­
;

165 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

166 
i
, 
”r
;

168 ià(
	`WARN_ON
(
offm­
->
m­
.
m­_ty³
 !ğ
BPF_MAP_TYPE_ARRAY
 &&

169 
offm­
->
m­
.
m­_ty³
 !ğ
BPF_MAP_TYPE_HASH
))

170  -
EINVAL
;

171 ià(
offm­
->
m­
.
max_’Œ›s
 > 
OTX2_BPF_MAX_KEYS
)

172  -
ENOMEM
;

173 ià(
offm­
->
m­
.
m­_æags
)

174  -
EINVAL
;

176 
Ùx2_m­
 = 
	`kz®loc
((*Ùx2_m­), 
GFP_USER
);

177 ià(!
Ùx2_m­
)

178  -
ENOMEM
;

180 
offm­
->
dev_´iv
 = 
Ùx2_m­
;

181 
Ùx2_m­
->
m­
 = 
offm­
;

182 
	`mu‹x_š™
(&
Ùx2_m­
->
mu‹x
);

184 
	`INIT_LIST_HEAD
(&
Ùx2_m­
->
l
);

186 ià(
offm­
->
m­
.
m­_ty³
 =ğ
BPF_MAP_TYPE_ARRAY
) {

187 
i
 = 0; i < 
	`ARRAY_SIZE
(
Ùx2_m­
->
’Œy
); i++) {

188 
u32
 *
key
;

190 
”r
 = 
	`Ùx2_m­_®loc_–em
(
offm­
, 
i
);

192 ià(
”r
)

193 
”r_ä“
;

194 
key
 = 
Ùx2_m­
->
’Œy
[
i
].key;

195 *
key
 = 
i
;

196 
	`mem£t
(
Ùx2_m­
->
’Œy
[
i
].
v®ue
, 0, 
offm­
->
m­
.
v®ue_size
);

200 
offm­
->
dev_İs
 = &
Ùx2_bpf_m­_İs
;

201 
	`li¡_add_
(&
Ùx2_m­
->
l
, &
pf
->
xdp_hw
.
lm­s
);

205 
”r_ä“
:

206 --
i
 >= 0) {

207 
	`kä“
(
Ùx2_m­
->
’Œy
[
i
].
key
);

208 
	`kä“
(
Ùx2_m­
->
’Œy
[
i
].
v®ue
);

211 
	`kä“
(
Ùx2_m­
);

212  
”r
;

213 
	}
}

215 
	$Ùx2_bpf_m­_ä“
(
bpf_ofæßded_m­
 *
offm­
)

217 
Ùx2_bpf_bound_m­
 *
Ùx2
 = 
offm­
->
dev_´iv
;

218 
i
;

220 
i
 = 0; i < 
	`ARRAY_SIZE
(
Ùx2
->
’Œy
); i++) {

221 
	`kä“
(
Ùx2
->
’Œy
[
i
].
key
);

222 
	`kä“
(
Ùx2
->
’Œy
[
i
].
v®ue
);

224 
	`li¡_d–_š™
(&
Ùx2
->
l
);

225 
	`mu‹x_de¡roy
(&
Ùx2
->
mu‹x
);

226 
	`kä“
(
Ùx2
);

227 
	}
}

	@otx2_map.h

1 #iâdeà
OTX2_MAP_H


2 
	#OTX2_MAP_H


	)

4 
	#OTX2_BPF_MAX_KEYS
 2

	)

6 
	sÙx2_bpf_bound_m­
 {

7 
bpf_ofæßded_m­
 *
	mm­
;

8 
mu‹x
 
	mmu‹x
;

9 
	sÙx2_m­_’Œy
 {

10 *
	mkey
;

11 *
	mv®ue
;

12 } 
	m’Œy
[
OTX2_BPF_MAX_KEYS
];

13 
li¡_h—d
 
	ml
;

16 
Ùx2_bpf_m­_®loc
(
Ãt_deviû
 *
dev
, 
bpf_ofæßded_m­
 *
offm­
);

17 
Ùx2_bpf_m­_ä“
(
bpf_ofæßded_m­
 *
offm­
);

	@otx2_pf.c

8 
	~<lšux/moduË.h
>

9 
	~<lšux/š‹¼u±.h
>

10 
	~<lšux/pci.h
>

11 
	~<lšux/‘h”deviû.h
>

12 
	~<lšux/of.h
>

13 
	~<lšux/if_vÏn.h
>

14 
	~<lšux/iommu.h
>

15 
	~<Ãt/.h
>

16 
	~<lšux/bpf.h
>

17 
	~<lšux/bpf_Œaû.h
>

18 
	~<lšux/b™f›ld.h
>

20 
	~"Ùx2_»g.h
"

21 
	~"Ùx2_commÚ.h
"

22 
	~"Ùx2_txrx.h
"

23 
	~"Ùx2_¡ruù.h
"

24 
	~"Ùx2_±p.h
"

25 
	~"ú10k.h
"

26 
	~"qos.h
"

27 
	~"Ùx2_xdp.h
"

28 
	~"Ùx2_th»ad.h
"

29 
	~"Ùx2_m­.h
"

30 
	~<rvu_Œaû.h
>

32 
	#DRV_NAME
 "rvu_niıf"

	)

33 
	#DRV_STRING
 "M¬v–ÈRVU NIC PhysiÿÈFunùiÚ Driv”"

	)

36 cÚ¡ 
pci_deviû_id
 
	gÙx2_pf_id_bË
[] = {

37 { 
PCI_DEVICE
(
PCI_VENDOR_ID_CAVIUM
, 
PCI_DEVID_OCTEONTX2_RVU_PF
) },

41 
MODULE_AUTHOR
("Marvell International Ltd.");

42 
MODULE_DESCRIPTION
(
DRV_STRING
);

43 
MODULE_LICENSE
("GPL v2");

44 
MODULE_DEVICE_TABLE
(
pci
, 
Ùx2_pf_id_bË
);

46 
Ùx2_vf_lšk_ev’t_sk
(
wÜk_¡ruù
 *
wÜk
);

47 
Ùx2_vf_±p_šfo_sk
(
wÜk_¡ruù
 *
wÜk
);

48 
Ùx2_do_£t_rx_mode
(
Ùx2_nic
 *
pf
);

51 
	mTYPE_PFAF
,

52 
	mTYPE_PFVF
,

55 
Ùx2_cÚfig_hw_tx_t¡amp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
);

56 
Ùx2_cÚfig_hw_rx_t¡amp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
);

57 
	$Ùx2_chªge_mtu
(
Ãt_deviû
 *
Ãtdev
, 
Ãw_mtu
)

59 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

60 
”r
 = 0;

62 ià(
if_up
)

63 
	`Ùx2_¡İ
(
Ãtdev
);

65 
	`Ãtdev_šfo
(
Ãtdev
, "Changing MTU from %do %d\n",

66 
Ãtdev
->
mtu
, 
Ãw_mtu
);

67 
Ãtdev
->
mtu
 = 
Ãw_mtu
;

69 ià(
if_up
)

70 
”r
 = 
	`Ùx2_İ’
(
Ãtdev
);

72  
”r
;

73 
	}
}

75 
	$Ùx2_di§bË_ær_me_šŒ
(
Ùx2_nic
 *
pf
)

77 
œq
, 
vfs
 = 
pf
->
tÙ®_vfs
;

80 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INT_ENA_W1CX
(0), 
	`INTR_MASK
(
vfs
));

81 
œq
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFME0
);

82 
	`ä“_œq
(
œq
, 
pf
);

85 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1CX
(0), 
	`INTR_MASK
(
vfs
));

86 
œq
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFFLR0
);

87 
	`ä“_œq
(
œq
, 
pf
);

89 ià(
vfs
 <= 64)

92 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INT_ENA_W1CX
(1), 
	`INTR_MASK
(
vfs
 - 64));

93 
œq
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFME1
);

94 
	`ä“_œq
(
œq
, 
pf
);

96 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1CX
(1), 
	`INTR_MASK
(
vfs
 - 64));

97 
œq
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFFLR1
);

98 
	`ä“_œq
(
œq
, 
pf
);

99 
	}
}

101 
	$Ùx2_ær_wq_de¡roy
(
Ùx2_nic
 *
pf
)

103 ià(!
pf
->
ær_wq
)

105 
	`de¡roy_wÜkqueue
(
pf
->
ær_wq
);

106 
pf
->
ær_wq
 = 
NULL
;

107 
	`devm_kä“
(
pf
->
dev
,…f->
ær_wrk
);

108 
	}
}

110 
	$Ùx2_ær_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

112 
ær_wÜk
 *
ærwÜk
 = 
	`cÚš”_of
(
wÜk
, flr_work, work);

113 
Ùx2_nic
 *
pf
 = 
ærwÜk
->pf;

114 
mbox
 *mbox = &
pf
->mbox;

115 
msg_»q
 *
»q
;

116 
vf
, 
»g
 = 0;

118 
vf
 = 
ærwÜk
 - 
pf
->
ær_wrk
;

120 
	`mu‹x_lock
(&
mbox
->
lock
);

121 
»q
 = 
	`Ùx2_mbox_®loc_msg_vf_ær
(
mbox
);

122 ià(!
»q
) {

123 
	`mu‹x_uÆock
(&
mbox
->
lock
);

126 
»q
->
hdr
.
pcifunc
 &ğ
RVU_PFVF_FUNC_MASK
;

127 
»q
->
hdr
.
pcifunc
 |ğ(
vf
 + 1è& 
RVU_PFVF_FUNC_MASK
;

129 ià(!
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
)) {

130 ià(
vf
 >= 64) {

131 
»g
 = 1;

132 
vf
 = vf - 64;

135 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFTRPENDX
(
»g
), 
	`BIT_ULL
(
vf
));

136 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1SX
(
»g
), 
	`BIT_ULL
(
vf
));

139 
	`mu‹x_uÆock
(&
mbox
->
lock
);

140 
	}
}

142 
œq»tuº_t
 
	$Ùx2_pf_ær_šŒ_hªdËr
(
œq
, *
pf_œq
)

144 
Ùx2_nic
 *
pf
 = (Ùx2_niø*)
pf_œq
;

145 
»g
, 
dev
, 
vf
, 
¡¬t_vf
, 
num_»g
 = 1;

146 
u64
 
šŒ
;

148 ià(
pf
->
tÙ®_vfs
 > 64)

149 
num_»g
 = 2;

151 
»g
 = 0;„eg < 
num_»g
;„eg++) {

152 
šŒ
 = 
	`Ùx2_»ad64
(
pf
, 
	`RVU_PF_VFFLR_INTX
(
»g
));

153 ià(!
šŒ
)

155 
¡¬t_vf
 = 64 * 
»g
;

156 
vf
 = 0; vf < 64; vf++) {

157 ià(!(
šŒ
 & 
	`BIT_ULL
(
vf
)))

159 
dev
 = 
vf
 + 
¡¬t_vf
;

160 
	`queue_wÜk
(
pf
->
ær_wq
, &pf->
ær_wrk
[
dev
].
wÜk
);

162 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INTX
(
»g
), 
	`BIT_ULL
(
vf
));

164 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1CX
(
»g
),

165 
	`BIT_ULL
(
vf
));

168  
IRQ_HANDLED
;

169 
	}
}

171 
œq»tuº_t
 
	$Ùx2_pf_me_šŒ_hªdËr
(
œq
, *
pf_œq
)

173 
Ùx2_nic
 *
pf
 = (Ùx2_niø*)
pf_œq
;

174 
vf
, 
»g
, 
num_»g
 = 1;

175 
u64
 
šŒ
;

177 ià(
pf
->
tÙ®_vfs
 > 64)

178 
num_»g
 = 2;

180 
»g
 = 0;„eg < 
num_»g
;„eg++) {

181 
šŒ
 = 
	`Ùx2_»ad64
(
pf
, 
	`RVU_PF_VFME_INTX
(
»g
));

182 ià(!
šŒ
)

184 
vf
 = 0; vf < 64; vf++) {

185 ià(!(
šŒ
 & 
	`BIT_ULL
(
vf
)))

188 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFTRPENDX
(
»g
), 
	`BIT_ULL
(
vf
));

190 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INTX
(
»g
), 
	`BIT_ULL
(
vf
));

193  
IRQ_HANDLED
;

194 
	}
}

196 
	$Ùx2_»gi¡”_ær_me_šŒ
(
Ùx2_nic
 *
pf
, 
numvfs
)

198 
Ùx2_hw
 *
hw
 = &
pf
->hw;

199 *
œq_Çme
;

200 
»t
;

203 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFME0
 * 
NAME_SIZE
];

204 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF%d_ME0", 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

205 
»t
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFME0
),

206 
Ùx2_pf_me_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

207 ià(
»t
) {

208 
	`dev_”r
(
pf
->
dev
,

213 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFFLR0
 * 
NAME_SIZE
];

214 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF%d_FLR0", 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

215 
»t
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFFLR0
),

216 
Ùx2_pf_ær_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

217 ià(
»t
) {

218 
	`dev_”r
(
pf
->
dev
,

220  
»t
;

223 ià(
numvfs
 > 64) {

224 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFME1
 * 
NAME_SIZE
];

225 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF%d_ME1",

226 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

227 
»t
 = 
	`»que¡_œq
(
pci_œq_veùÜ


228 (
pf
->
pdev
, 
RVU_PF_INT_VEC_VFME1
),

229 
Ùx2_pf_me_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

230 ià(
»t
) {

231 
	`dev_”r
(
pf
->
dev
,

234 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFFLR1
 * 
NAME_SIZE
];

235 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF%d_FLR1",

236 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

237 
»t
 = 
	`»que¡_œq
(
pci_œq_veùÜ


238 (
pf
->
pdev
, 
RVU_PF_INT_VEC_VFFLR1
),

239 
Ùx2_pf_ær_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

240 ià(
»t
) {

241 
	`dev_”r
(
pf
->
dev
,

243  
»t
;

248 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INTX
(0), 
	`INTR_MASK
(
numvfs
));

249 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INT_ENA_W1SX
(0), 
	`INTR_MASK
(
numvfs
));

252 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INTX
(0), 
	`INTR_MASK
(
numvfs
));

253 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1SX
(0), 
	`INTR_MASK
(
numvfs
));

255 ià(
numvfs
 > 64) {

256 
numvfs
 -= 64;

258 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INTX
(1), 
	`INTR_MASK
(
numvfs
));

259 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFME_INT_ENA_W1SX
(1),

260 
	`INTR_MASK
(
numvfs
));

262 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INTX
(1), 
	`INTR_MASK
(
numvfs
));

263 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFFLR_INT_ENA_W1SX
(1),

264 
	`INTR_MASK
(
numvfs
));

267 
	}
}

269 
	$Ùx2_pf_ær_š™
(
Ùx2_nic
 *
pf
, 
num_vfs
)

271 
vf
;

273 
pf
->
ær_wq
 = 
	`®loc_wÜkqueue
("otx2_pf_flr_wq",

274 
WQ_UNBOUND
 | 
WQ_HIGHPRI
, 1);

275 ià(!
pf
->
ær_wq
)

276  -
ENOMEM
;

278 
pf
->
ær_wrk
 = 
	`devm_kÿÎoc
Õf->
dev
, 
num_vfs
,

279 (
ær_wÜk
), 
GFP_KERNEL
);

280 ià(!
pf
->
ær_wrk
) {

281 
	`de¡roy_wÜkqueue
(
pf
->
ær_wq
);

282  -
ENOMEM
;

285 
vf
 = 0; và< 
num_vfs
; vf++) {

286 
pf
->
ær_wrk
[
vf
].pf =…f;

287 
	`INIT_WORK
(&
pf
->
ær_wrk
[
vf
].
wÜk
, 
Ùx2_ær_hªdËr
);

291 
	}
}

293 
	$Ùx2_queue_vf_wÜk
(
mbox
 *
mw
, 
wÜkqueue_¡ruù
 *
mbox_wq
,

294 
fœ¡
, 
mdevs
, 
u64
 
šŒ
)

296 
Ùx2_mbox_dev
 *
mdev
;

297 
Ùx2_mbox
 *
mbox
;

298 
mbox_hdr
 *
hdr
;

299 
i
;

301 
i
 = 
fœ¡
; i < 
mdevs
; i++) {

303 ià(!(
šŒ
 & 
	`BIT_ULL
(
i
 - 
fœ¡
)))

306 
mbox
 = &
mw
->mbox;

307 
mdev
 = &
mbox
->
dev
[
i
];

308 
hdr
 = 
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
;

316 ià(
hdr
->
num_msgs
) {

317 
mw
[
i
].
num_msgs
 = 
hdr
->num_msgs;

318 
hdr
->
num_msgs
 = 0;

319 
	`queue_wÜk
(
mbox_wq
, &
mw
[
i
].
mbox_wrk
);

322 
mbox
 = &
mw
->
mbox_up
;

323 
mdev
 = &
mbox
->
dev
[
i
];

324 
hdr
 = 
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
;

325 ià(
hdr
->
num_msgs
) {

326 
mw
[
i
].
up_num_msgs
 = 
hdr
->
num_msgs
;

327 
hdr
->
num_msgs
 = 0;

328 
	`queue_wÜk
(
mbox_wq
, &
mw
[
i
].
mbox_up_wrk
);

331 
	}
}

333 
	$Ùx2_fÜw¬d_msg_pfvf
(
Ùx2_mbox_dev
 *
mdev
,

334 
Ùx2_mbox
 *
pfvf_mbox
, *
bbuf_ba£
,

335 
devid
)

337 
Ùx2_mbox_dev
 *
¤c_mdev
 = 
mdev
;

338 
off£t
;

341 
	`smp_wmb
();

343 
off£t
 = 
pfvf_mbox
->
Œigg”
 | (
devid
 <<…fvf_mbox->
Œ_shiá
);

344 
	`wr™eq
(1, (
__iomem
 *)
pfvf_mbox
->
»g_ba£
 + 
off£t
);

347 
¤c_mdev
->
mba£
 = 
bbuf_ba£
;

348 
	}
}

350 
	$Ùx2_fÜw¬d_vf_mbox_msgs
(
Ùx2_nic
 *
pf
,

351 
Ùx2_mbox
 *
¤c_mbox
,

352 
dœ
, 
vf
, 
num_msgs
)

354 
Ùx2_mbox_dev
 *
¤c_mdev
, *
d¡_mdev
;

355 
mbox_hdr
 *mbox_hdr;

356 
mbox_hdr
 *
»q_hdr
;

357 
mbox
 *
d¡_mbox
;

358 
d¡_size
, 
”r
;

360 ià(
dœ
 =ğ
MBOX_DIR_PFAF
) {

365 
¤c_mdev
 = &
¤c_mbox
->
dev
[
vf
];

366 
mbox_hdr
 = 
¤c_mbox
->
hwba£
 +

367 
¤c_mbox
->
rx_¡¬t
 + (
vf
 * 
MBOX_SIZE
);

369 
d¡_mbox
 = &
pf
->
mbox
;

370 
d¡_size
 = 
d¡_mbox
->
mbox
.
tx_size
 -

371 
	`ALIGN
((*
mbox_hdr
), 
MBOX_MSG_ALIGN
);

373 ià(
mbox_hdr
->
msg_size
 > 
d¡_size
 || !mbox_hdr->msg_size)

374  -
EINVAL
;

376 
d¡_mdev
 = &
d¡_mbox
->
mbox
.
dev
[0];

378 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

379 
d¡_mdev
->
mba£
 = 
¤c_mdev
->mbase;

380 
d¡_mdev
->
msg_size
 = 
mbox_hdr
->msg_size;

381 
d¡_mdev
->
num_msgs
 =‚um_msgs;

382 
”r
 = 
	`Ùx2_sync_mbox_msg
(
d¡_mbox
);

388 ià(
”r
 =ğ-
EIO
) {

389 
	`dev_w¬n
(
pf
->
dev
,

390 "AF‚Ù„e¥ÚdšgØVF%d mes§ges\n", 
vf
);

392 
d¡_mdev
->
mba£
 = 
pf
->
mbox
.
bbuf_ba£
;

393 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

394  
”r
;

400 
»q_hdr
 = (
mbox_hdr
 *)(
d¡_mdev
->
mba£
 +

401 
d¡_mbox
->
mbox
.
rx_¡¬t
);

402 
»q_hdr
->
num_msgs
 =‚um_msgs;

404 
	`Ùx2_fÜw¬d_msg_pfvf
(
d¡_mdev
, &
pf
->
mbox_pfvf
[0].
mbox
,

405 
pf
->
mbox
.
bbuf_ba£
, 
vf
);

406 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

407 } ià(
dœ
 =ğ
MBOX_DIR_PFVF_UP
) {

408 
¤c_mdev
 = &
¤c_mbox
->
dev
[0];

409 
mbox_hdr
 = 
¤c_mbox
->
hwba£
 + src_mbox->
rx_¡¬t
;

410 
»q_hdr
 = (
mbox_hdr
 *)(
¤c_mdev
->
mba£
 +

411 
¤c_mbox
->
rx_¡¬t
);

412 
»q_hdr
->
num_msgs
 =‚um_msgs;

414 
d¡_mbox
 = &
pf
->
mbox_pfvf
[0];

415 
d¡_size
 = 
d¡_mbox
->
mbox_up
.
tx_size
 -

416 
	`ALIGN
((*
mbox_hdr
), 
MBOX_MSG_ALIGN
);

418 ià(
mbox_hdr
->
msg_size
 > 
d¡_size
)

419  -
EINVAL
;

421 
d¡_mdev
 = &
d¡_mbox
->
mbox_up
.
dev
[
vf
];

422 
d¡_mdev
->
mba£
 = 
¤c_mdev
->mbase;

423 
d¡_mdev
->
msg_size
 = 
mbox_hdr
->msg_size;

424 
d¡_mdev
->
num_msgs
 = 
mbox_hdr
->num_msgs;

425 
”r
 = 
	`Ùx2_sync_mbox_up_msg
(
d¡_mbox
, 
vf
);

426 ià(
”r
) {

427 
	`dev_w¬n
(
pf
->
dev
,

428 "VF%d i nÙ„e¥ÚdšgØmabox\n", 
vf
);

429  
”r
;

431 } ià(
dœ
 =ğ
MBOX_DIR_VFPF_UP
) {

432 
»q_hdr
 = (
mbox_hdr
 *)(
¤c_mbox
->
dev
[0].
mba£
 +

433 
¤c_mbox
->
rx_¡¬t
);

434 
»q_hdr
->
num_msgs
 =‚um_msgs;

435 
	`Ùx2_fÜw¬d_msg_pfvf
(&
pf
->
mbox_pfvf
->
mbox_up
.
dev
[
vf
],

436 &
pf
->
mbox
.
mbox_up
,

437 
pf
->
mbox_pfvf
[
vf
].
bbuf_ba£
,

442 
	}
}

444 
	$Ùx2_pfvf_mbox_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

446 
mbox_msghdr
 *
msg
 = 
NULL
;

447 
off£t
, 
vf_idx
, 
id
, 
”r
;

448 
Ùx2_mbox_dev
 *
mdev
;

449 
mbox_hdr
 *
»q_hdr
;

450 
Ùx2_mbox
 *
mbox
;

451 
mbox
 *
vf_mbox
;

452 
Ùx2_nic
 *
pf
;

454 
vf_mbox
 = 
	`cÚš”_of
(
wÜk
, 
mbox
, 
mbox_wrk
);

455 
pf
 = 
vf_mbox
->
pfvf
;

456 
vf_idx
 = 
vf_mbox
 - 
pf
->
mbox_pfvf
;

458 
mbox
 = &
pf
->
mbox_pfvf
[0].mbox;

459 
mdev
 = &
mbox
->
dev
[
vf_idx
];

460 
»q_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

462 
off£t
 = 
	`ALIGN
((*
»q_hdr
), 
MBOX_MSG_ALIGN
);

464 
id
 = 0; id < 
vf_mbox
->
num_msgs
; id++) {

465 
msg
 = (
mbox_msghdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
 +

466 
off£t
);

468 ià(
msg
->
sig
 !ğ
OTX2_MBOX_REQ_SIG
)

469 
šv®_msg
;

472 
msg
->
pcifunc
 &ğ
RVU_PFVF_FUNC_MASK
;

473 
msg
->
pcifunc
 |ğ(
vf_idx
 + 1è& 
RVU_PFVF_FUNC_MASK
;

474 
off£t
 = 
msg
->
Ãxt_msgoff
;

476 
”r
 = 
	`Ùx2_fÜw¬d_vf_mbox_msgs
(
pf
, 
mbox
, 
MBOX_DIR_PFAF
, 
vf_idx
,

477 
vf_mbox
->
num_msgs
);

478 ià(
”r
)

479 
šv®_msg
;

482 
šv®_msg
:

483 
	`Ùx2_»¶y_šv®id_msg
(
mbox
, 
vf_idx
, 0, 
msg
->
id
);

484 
	`Ùx2_mbox_msg_£nd
(
mbox
, 
vf_idx
);

485 
	}
}

487 
	$Ùx2_pfvf_mbox_up_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

489 
mbox
 *
vf_mbox
 = 
	`cÚš”_of
(
wÜk
, mbox, 
mbox_up_wrk
);

490 
Ùx2_nic
 *
pf
 = 
vf_mbox
->
pfvf
;

491 
Ùx2_mbox_dev
 *
mdev
;

492 
off£t
, 
id
, 
vf_idx
 = 0;

493 
mbox_hdr
 *
r¥_hdr
;

494 
mbox_msghdr
 *
msg
;

495 
Ùx2_mbox
 *
mbox
;

497 
vf_idx
 = 
vf_mbox
 - 
pf
->
mbox_pfvf
;

498 
mbox
 = &
pf
->
mbox_pfvf
[0].
mbox_up
;

499 
mdev
 = &
mbox
->
dev
[
vf_idx
];

501 
r¥_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

502 
off£t
 = 
mbox
->
rx_¡¬t
 + 
	`ALIGN
((*
r¥_hdr
), 
MBOX_MSG_ALIGN
);

504 
id
 = 0; id < 
vf_mbox
->
up_num_msgs
; id++) {

505 
msg
 = 
mdev
->
mba£
 + 
off£t
;

507 ià(
msg
->
id
 >ğ
MBOX_MSG_MAX
) {

508 
	`dev_”r
(
pf
->
dev
,

509 "Mbox msg w™h unknowÀID 0x%x\n", 
msg
->
id
);

510 
’d
;

513 ià(
msg
->
sig
 !ğ
OTX2_MBOX_RSP_SIG
) {

514 
	`dev_”r
(
pf
->
dev
,

516 
msg
->
sig
, msg->
id
);

517 
’d
;

520 
msg
->
id
) {

521 
MBOX_MSG_CGX_LINK_EVENT
:

524 ià(
msg
->
rc
)

525 
	`dev_”r
(
pf
->
dev
,

527 
msg
->
rc
, msg->
id
);

531 
’d
:

532 
off£t
 = 
mbox
->
rx_¡¬t
 + 
msg
->
Ãxt_msgoff
;

533 ià(
mdev
->
msgs_acked
 =ğ(
vf_mbox
->
up_num_msgs
 - 1))

534 
	`__Ùx2_mbox_»£t
(
mbox
, 
vf_idx
);

535 
mdev
->
msgs_acked
++;

537 
	}
}

539 
œq»tuº_t
 
	$Ùx2_pfvf_mbox_šŒ_hªdËr
(
œq
, *
pf_œq
)

541 
Ùx2_nic
 *
pf
 = (Ùx2_niø*)(
pf_œq
);

542 
vfs
 = 
pf
->
tÙ®_vfs
;

543 
mbox
 *mbox;

544 
u64
 
šŒ
;

546 
mbox
 = 
pf
->
mbox_pfvf
;

548 ià(
vfs
 > 64) {

549 
šŒ
 = 
	`Ùx2_»ad64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(1));

550 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(1), 
šŒ
);

551 
	`Ùx2_queue_vf_wÜk
(
mbox
, 
pf
->
mbox_pfvf_wq
, 64, 
vfs
, 
šŒ
);

552 
vfs
 -= 64;

555 
šŒ
 = 
	`Ùx2_»ad64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(0));

556 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(0), 
šŒ
);

558 
	`Ùx2_queue_vf_wÜk
(
mbox
, 
pf
->
mbox_pfvf_wq
, 0, 
vfs
, 
šŒ
);

560 
	`Œaû_Ùx2_msg_š‹¼u±
(
mbox
->mbox.
pdev
, "VF(sètØPF", 
šŒ
);

562  
IRQ_HANDLED
;

563 
	}
}

565 
	$Ùx2_pfvf_mbox_š™
(
Ùx2_nic
 *
pf
, 
numvfs
)

567 
__iomem
 *
hwba£
;

568 
mbox
 *mbox;

569 
”r
, 
vf
;

570 
u64
 
ba£
;

572 ià(!
numvfs
)

573  -
EINVAL
;

575 
pf
->
mbox_pfvf
 = 
	`devm_kÿÎoc
(&pf->
pdev
->
dev
, 
numvfs
,

576 (
mbox
), 
GFP_KERNEL
);

577 ià(!
pf
->
mbox_pfvf
)

578  -
ENOMEM
;

580 
pf
->
mbox_pfvf_wq
 = 
	`®loc_wÜkqueue
("otx2_pfvf_mailbox",

581 
WQ_UNBOUND
 | 
WQ_HIGHPRI
 |

582 
WQ_MEM_RECLAIM
, 1);

583 ià(!
pf
->
mbox_pfvf_wq
)

584  -
ENOMEM
;

589 ià(
	`‹¡_b™
(
CN10K_MBOX
, &
pf
->
hw
.
ÿp_æag
))

590 
ba£
 = 
	`pci_»sourû_¡¬t
(
pf
->
pdev
, 
PCI_MBOX_BAR_NUM
) +

591 
MBOX_SIZE
;

593 
ba£
 = 
	`»adq
((
__iomem
 *)((
u64
)
pf
->
»g_ba£
 +

594 
RVU_PF_VF_BAR4_ADDR
));

596 
hwba£
 = 
	`iÜem­_wc
(
ba£
, 
MBOX_SIZE
 * 
pf
->
tÙ®_vfs
);

597 ià(!
hwba£
) {

598 
”r
 = -
ENOMEM
;

599 
ä“_wq
;

602 
mbox
 = &
pf
->
mbox_pfvf
[0];

603 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->mbox, 
hwba£
, 
pf
->
pdev
,…f->
»g_ba£
,

604 
MBOX_DIR_PFVF
, 
numvfs
);

605 ià(
”r
)

606 
ä“_iomem
;

608 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->
mbox_up
, 
hwba£
, 
pf
->
pdev
,…f->
»g_ba£
,

609 
MBOX_DIR_PFVF_UP
, 
numvfs
);

610 ià(
”r
)

611 
ä“_iomem
;

613 
vf
 = 0; và< 
numvfs
; vf++) {

614 
mbox
->
pfvf
 = 
pf
;

615 
	`INIT_WORK
(&
mbox
->
mbox_wrk
, 
Ùx2_pfvf_mbox_hªdËr
);

616 
	`INIT_WORK
(&
mbox
->
mbox_up_wrk
, 
Ùx2_pfvf_mbox_up_hªdËr
);

617 
mbox
++;

622 
ä“_iomem
:

623 ià(
hwba£
)

624 
	`iounm­
(
hwba£
);

625 
ä“_wq
:

626 
	`de¡roy_wÜkqueue
(
pf
->
mbox_pfvf_wq
);

627  
”r
;

628 
	}
}

630 
	$Ùx2_pfvf_mbox_de¡roy
(
Ùx2_nic
 *
pf
)

632 
mbox
 *mbox = &
pf
->
mbox_pfvf
[0];

634 ià(!
mbox
)

637 ià(
pf
->
mbox_pfvf_wq
) {

638 
	`de¡roy_wÜkqueue
(
pf
->
mbox_pfvf_wq
);

639 
pf
->
mbox_pfvf_wq
 = 
NULL
;

642 ià(
mbox
->mbox.
hwba£
)

643 
	`iounm­
(
mbox
->mbox.
hwba£
);

645 
	`Ùx2_mbox_de¡roy
(&
mbox
->mbox);

646 
	}
}

648 
	$Ùx2_’abË_pfvf_mbox_šŒ
(
Ùx2_nic
 *
pf
, 
numvfs
)

651 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(0), ~0ull);

652 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(1), ~0ull);

655 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INT_ENA_W1SX
(0), 
	`INTR_MASK
(
numvfs
));

656 ià(
numvfs
 > 64) {

657 
numvfs
 -= 64;

658 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INT_ENA_W1SX
(1),

659 
	`INTR_MASK
(
numvfs
));

661 
	}
}

663 
	$Ùx2_di§bË_pfvf_mbox_šŒ
(
Ùx2_nic
 *
pf
, 
numvfs
)

665 
veùÜ
;

668 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INT_ENA_W1CX
(0), ~0ull);

669 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INT_ENA_W1CX
(1), ~0ull);

671 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(0), ~0ull);

672 
veùÜ
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFPF_MBOX0
);

673 
	`ä“_œq
(
veùÜ
, 
pf
);

675 ià(
numvfs
 > 64) {

676 
	`Ùx2_wr™e64
(
pf
, 
	`RVU_PF_VFPF_MBOX_INTX
(1), ~0ull);

677 
veùÜ
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFPF_MBOX1
);

678 
	`ä“_œq
(
veùÜ
, 
pf
);

680 
	}
}

682 
	$Ùx2_»gi¡”_pfvf_mbox_šŒ
(
Ùx2_nic
 *
pf
, 
numvfs
)

684 
Ùx2_hw
 *
hw
 = &
pf
->hw;

685 *
œq_Çme
;

686 
”r
;

689 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFPF_MBOX0
 * 
NAME_SIZE
];

690 ià(
pf
->
pcifunc
)

691 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
,

692 "RVUPF%d_VF Mbox0", 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

694 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF_VF Mbox0");

695 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_VFPF_MBOX0
),

696 
Ùx2_pfvf_mbox_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

697 ià(
”r
) {

698 
	`dev_”r
(
pf
->
dev
,

700  
”r
;

703 ià(
numvfs
 > 64) {

705 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_VFPF_MBOX1
 * 
NAME_SIZE
];

706 ià(
pf
->
pcifunc
)

707 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
,

708 "RVUPF%d_VF Mbox1", 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

710 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPF_VF Mbox1");

711 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
,

712 
RVU_PF_INT_VEC_VFPF_MBOX1
),

713 
Ùx2_pfvf_mbox_šŒ_hªdËr
,

714 0, 
œq_Çme
, 
pf
);

715 ià(
”r
) {

716 
	`dev_”r
(
pf
->
dev
,

718  
”r
;

722 
	`Ùx2_’abË_pfvf_mbox_šŒ
(
pf
, 
numvfs
);

725 
	}
}

727 
	$Ùx2_´oûss_pçf_mbox_msg
(
Ùx2_nic
 *
pf
,

728 
mbox_msghdr
 *
msg
)

730 
devid
;

732 ià(
msg
->
id
 >ğ
MBOX_MSG_MAX
) {

733 
	`dev_”r
(
pf
->
dev
,

734 "Mbox msg w™h unknowÀID 0x%x\n", 
msg
->
id
);

738 ià(
msg
->
sig
 !ğ
OTX2_MBOX_RSP_SIG
) {

739 
	`dev_”r
(
pf
->
dev
,

741 
msg
->
sig
, msg->
id
);

746 
devid
 = 
msg
->
pcifunc
 & 
RVU_PFVF_FUNC_MASK
;

747 ià(
devid
) {

748 
Ùx2_vf_cÚfig
 *
cÚfig
 = &
pf
->
vf_cÚfigs
[
devid
 - 1];

749 
d–ayed_wÜk
 *
dwÜk
;

751 
msg
->
id
) {

752 
MBOX_MSG_NIX_LF_START_RX
:

753 
cÚfig
->
štf_down
 = 
çl£
;

754 
dwÜk
 = &
cÚfig
->
lšk_ev’t_wÜk
;

755 
	`scheduË_d–ayed_wÜk
(
dwÜk
, 
	`m£cs_to_jiff›s
(100));

757 
MBOX_MSG_NIX_LF_STOP_RX
:

758 
cÚfig
->
štf_down
 = 
Œue
;

765 
msg
->
id
) {

766 
MBOX_MSG_READY
:

767 
pf
->
pcifunc
 = 
msg
->pcifunc;

769 
MBOX_MSG_MSIX_OFFSET
:

770 
	`mbox_hªdËr_msix_off£t
(
pf
, (
msix_off£t_r¥
 *)
msg
);

772 
MBOX_MSG_NPA_LF_ALLOC
:

773 
	`mbox_hªdËr_Åa_lf_®loc
(
pf
, (
Åa_lf_®loc_r¥
 *)
msg
);

775 
MBOX_MSG_NIX_LF_ALLOC
:

776 
	`mbox_hªdËr_nix_lf_®loc
(
pf
, (
nix_lf_®loc_r¥
 *)
msg
);

778 
MBOX_MSG_NIX_BP_ENABLE
:

779 
	`mbox_hªdËr_nix_bp_’abË
(
pf
, (
nix_bp_cfg_r¥
 *)
msg
);

781 
MBOX_MSG_CGX_STATS
:

782 
	`mbox_hªdËr_cgx_¡©s
(
pf
, (
cgx_¡©s_r¥
 *)
msg
);

784 
MBOX_MSG_CGX_FEC_STATS
:

785 
	`mbox_hªdËr_cgx_ãc_¡©s
(
pf
, (
cgx_ãc_¡©s_r¥
 *)
msg
);

788 ià(
msg
->
rc
)

789 
	`dev_”r
(
pf
->
dev
,

791 
msg
->
rc
, msg->
id
);

794 
	}
}

796 
	$Ùx2_pçf_mbox_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

798 
Ùx2_mbox_dev
 *
mdev
;

799 
mbox_hdr
 *
r¥_hdr
;

800 
mbox_msghdr
 *
msg
;

801 
Ùx2_mbox
 *
mbox
;

802 
mbox
 *
af_mbox
;

803 
Ùx2_nic
 *
pf
;

804 
off£t
, 
id
;

806 
af_mbox
 = 
	`cÚš”_of
(
wÜk
, 
mbox
, 
mbox_wrk
);

807 
mbox
 = &
af_mbox
->mbox;

808 
mdev
 = &
mbox
->
dev
[0];

809 
r¥_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

811 
off£t
 = 
mbox
->
rx_¡¬t
 + 
	`ALIGN
((*
r¥_hdr
), 
MBOX_MSG_ALIGN
);

812 
pf
 = 
af_mbox
->
pfvf
;

814 
id
 = 0; id < 
af_mbox
->
num_msgs
; id++) {

815 
msg
 = (
mbox_msghdr
 *)(
mdev
->
mba£
 + 
off£t
);

816 
	`Ùx2_´oûss_pçf_mbox_msg
(
pf
, 
msg
);

817 
off£t
 = 
mbox
->
rx_¡¬t
 + 
msg
->
Ãxt_msgoff
;

818 ià(
mdev
->
msgs_acked
 =ğ(
af_mbox
->
num_msgs
 - 1))

819 
	`__Ùx2_mbox_»£t
(
mbox
, 0);

820 
mdev
->
msgs_acked
++;

822 
	}
}

824 
	$Ùx2_hªdË_lšk_ev’t
(
Ùx2_nic
 *
pf
)

826 
cgx_lšk_u£r_šfo
 *
lšfo
 = &
pf
->linfo;

827 
Ãt_deviû
 *
Ãtdev
 = 
pf
->netdev;

829 
	`´_šfo
("% NIC Lšk i % %d Mbp % du¶ex\n", 
Ãtdev
->
Çme
,

830 
lšfo
->
lšk_up
 ? "UP" : "DOWN",†šfo->
¥“d
,

831 
lšfo
->
fuÎ_du¶ex
 ? "Full" : "Half");

832 ià(
lšfo
->
lšk_up
) {

833 
	`Ãtif_ÿ¼›r_Ú
(
Ãtdev
);

834 
	`Ãtif_tx_¡¬t_®l_queues
(
Ãtdev
);

836 
	`Ãtif_tx_¡İ_®l_queues
(
Ãtdev
);

837 
	`Ãtif_ÿ¼›r_off
(
Ãtdev
);

839 
	}
}

841 
	$Ùx2_mbox_up_hªdËr_cgx_lšk_ev’t
(
Ùx2_nic
 *
pf
,

842 
cgx_lšk_šfo_msg
 *
msg
,

843 
msg_r¥
 *
r¥
)

845 
i
;

848 
pf
->
lšfo
 = 
msg
->
lšk_šfo
;

851 
i
 = 0; i < 
	`pci_num_vf
(
pf
->
pdev
); i++) {

852 
Ùx2_vf_cÚfig
 *
cÚfig
 = &
pf
->
vf_cÚfigs
[
i
];

853 
d–ayed_wÜk
 *
dwÜk
 = &
cÚfig
->
lšk_ev’t_wÜk
;

855 ià(
cÚfig
->
štf_down
)

858 
	`scheduË_d–ayed_wÜk
(
dwÜk
, 
	`m£cs_to_jiff›s
(100));

862 ià(
pf
->
æags
 & 
OTX2_FLAG_INTF_DOWN
)

865 
	`Ùx2_hªdË_lšk_ev’t
(
pf
);

867 
	}
}

869 
	$Ùx2_mbox_up_hªdËr_cgx_±p_rx_šfo
(
Ùx2_nic
 *
pf
,

870 
cgx_±p_rx_šfo_msg
 *
msg
,

871 
msg_r¥
 *
r¥
)

873 
i
;

875 ià(!
pf
->
±p
)

878 
pf
->
±p
->
±p_’
 = 
msg
->ptp_en;

881 
i
 = 0; i < 
	`pci_num_vf
(
pf
->
pdev
); i++) {

882 
Ùx2_vf_cÚfig
 *
cÚfig
 = &
pf
->
vf_cÚfigs
[
i
];

883 
d–ayed_wÜk
 *
dwÜk
 = &
cÚfig
->
±p_šfo_wÜk
;

885 ià(
cÚfig
->
štf_down
)

888 
	`scheduË_d–ayed_wÜk
(
dwÜk
, 
	`m£cs_to_jiff›s
(100));

891 
	}
}

893 
	$Ùx2_´oûss_mbox_msg_up
(
Ùx2_nic
 *
pf
,

894 
mbox_msghdr
 *
»q
)

897 ià(
»q
->
sig
 !ğ
OTX2_MBOX_REQ_SIG
) {

898 
	`Ùx2_»¶y_šv®id_msg
(&
pf
->
mbox
.
mbox_up
, 0, 0, 
»q
->
id
);

899  -
ENODEV
;

902 
»q
->
id
) {

903 
	#M
(
_Çme
, 
_id
, 
_â_Çme
, 
_»q_ty³
, 
_r¥_ty³
) \

904 
_id
: { \

905 
_r¥_ty³
 *
r¥
; \

906 
”r
; \

908 
r¥
 = (
_r¥_ty³
 *)
	`Ùx2_mbox_®loc_msg
( \

909 &
pf
->
mbox
.
mbox_up
, 0, \

910 (
_r¥_ty³
)); \

911 ià(!
r¥
) \

912  -
ENOMEM
; \

914 
r¥
->
hdr
.
id
 = 
_id
; \

915 
r¥
->
hdr
.
sig
 = 
OTX2_MBOX_RSP_SIG
; \

916 
r¥
->
hdr
.
pcifunc
 = 0; \

917 
r¥
->
hdr
.
rc
 = 0; \

919 
”r
 = 
Ùx2_mbox_up_hªdËr_
 ## 
	`_â_Çme
( \

920 
pf
, (
_»q_ty³
 *)
»q
, 
r¥
); \

921  
”r
; \

922 }

	)

923 
MBOX_UP_CGX_MESSAGES


924 #undeà
M


927 
	`Ùx2_»¶y_šv®id_msg
(&
pf
->
mbox
.
mbox_up
, 0, 0, 
»q
->
id
);

928  -
ENODEV
;

931 
	}
}

933 
	$Ùx2_pçf_mbox_up_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

935 
mbox
 *
af_mbox
 = 
	`cÚš”_of
(
wÜk
, mbox, 
mbox_up_wrk
);

936 
Ùx2_mbox
 *
mbox
 = &
af_mbox
->
mbox_up
;

937 
Ùx2_mbox_dev
 *
mdev
 = &
mbox
->
dev
[0];

938 
Ùx2_nic
 *
pf
 = 
af_mbox
->
pfvf
;

939 
off£t
, 
id
, 
devid
 = 0;

940 
mbox_hdr
 *
r¥_hdr
;

941 
mbox_msghdr
 *
msg
;

943 
r¥_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

945 
off£t
 = 
mbox
->
rx_¡¬t
 + 
	`ALIGN
((*
r¥_hdr
), 
MBOX_MSG_ALIGN
);

947 
id
 = 0; id < 
af_mbox
->
up_num_msgs
; id++) {

948 
msg
 = (
mbox_msghdr
 *)(
mdev
->
mba£
 + 
off£t
);

950 
devid
 = 
msg
->
pcifunc
 & 
RVU_PFVF_FUNC_MASK
;

952 ià(!
devid
)

953 
	`Ùx2_´oûss_mbox_msg_up
(
pf
, 
msg
);

954 
off£t
 = 
mbox
->
rx_¡¬t
 + 
msg
->
Ãxt_msgoff
;

957 ià(
devid
 && 
	`pci_num_vf
(
pf
->
pdev
)) {

958 
	`Ùx2_fÜw¬d_vf_mbox_msgs
(
pf
, &pf->
mbox
.
mbox_up
,

959 
MBOX_DIR_PFVF_UP
, 
devid
 - 1,

960 
af_mbox
->
up_num_msgs
);

964 
	`Ùx2_mbox_msg_£nd
(
mbox
, 0);

965 
	}
}

967 
œq»tuº_t
 
	$Ùx2_pçf_mbox_šŒ_hªdËr
(
œq
, *
pf_œq
)

969 
Ùx2_nic
 *
pf
 = (Ùx2_niø*)
pf_œq
;

970 
mbox
 *
mw
 = &
pf
->mbox;

971 
Ùx2_mbox_dev
 *
mdev
;

972 
Ùx2_mbox
 *
mbox
;

973 
mbox_hdr
 *
hdr
;

976 
	`Ùx2_wr™e64
(
pf
, 
RVU_PF_INT
, 
	`BIT_ULL
(0));

978 
	`Œaû_Ùx2_msg_š‹¼u±
(
pf
->
pdev
, "AFØPF", 
	`BIT_ULL
(0));

980 
mbox
 = &
mw
->
mbox_up
;

981 
mdev
 = &
mbox
->
dev
[0];

982 
	`Ùx2_sync_mbox_bbuf
(
mbox
, 0);

990 
hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

991 ià(
hdr
->
num_msgs
) {

992 
mw
->
up_num_msgs
 = 
hdr
->
num_msgs
;

993 
hdr
->
num_msgs
 = 0;

994 
	`mem£t
(
mbox
->
hwba£
 + mbox->
rx_¡¬t
, 0,

995 
	`ALIGN
((
mbox_hdr
), (
u64
)));

997 
	`queue_wÜk
(
pf
->
mbox_wq
, &
mw
->
mbox_up_wrk
);

1007  
IRQ_HANDLED
;

1010 
mbox
 = &
mw
->mbox;

1011 
mdev
 = &
mbox
->
dev
[0];

1012 
	`Ùx2_sync_mbox_bbuf
(
mbox
, 0);

1014 
hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

1015 ià(
hdr
->
num_msgs
) {

1016 
mw
->
num_msgs
 = 
hdr
->num_msgs;

1017 
hdr
->
num_msgs
 = 0;

1018 
	`mem£t
(
mbox
->
hwba£
 + mbox->
rx_¡¬t
, 0,

1019 
	`ALIGN
((
mbox_hdr
), (
u64
)));

1020 
	`queue_wÜk
(
pf
->
mbox_wq
, &
mw
->
mbox_wrk
);

1023  
IRQ_HANDLED
;

1024 
	}
}

1026 
	$Ùx2_di§bË_mbox_šŒ
(
Ùx2_nic
 *
pf
)

1028 
veùÜ
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_AFPF_MBOX
);

1031 
	`Ùx2_wr™e64
(
pf
, 
RVU_PF_INT_ENA_W1C
, 
	`BIT_ULL
(0));

1032 
	`ä“_œq
(
veùÜ
, 
pf
);

1033 
	}
}

1035 
	$Ùx2_»gi¡”_mbox_šŒ
(
Ùx2_nic
 *
pf
, 
boŞ
 
´obe_af
)

1037 
Ùx2_hw
 *
hw
 = &
pf
->hw;

1038 
msg_»q
 *
»q
;

1039 *
œq_Çme
;

1040 
”r
;

1043 
œq_Çme
 = &
hw
->œq_Çme[
RVU_PF_INT_VEC_AFPF_MBOX
 * 
NAME_SIZE
];

1044 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUPFAF Mbox");

1045 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
RVU_PF_INT_VEC_AFPF_MBOX
),

1046 
Ùx2_pçf_mbox_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

1047 ià(
”r
) {

1048 
	`dev_”r
(
pf
->
dev
,

1050  
”r
;

1056 
	`Ùx2_wr™e64
(
pf
, 
RVU_PF_INT
, 
	`BIT_ULL
(0));

1057 
	`Ùx2_wr™e64
(
pf
, 
RVU_PF_INT_ENA_W1S
, 
	`BIT_ULL
(0));

1059 ià(!
´obe_af
)

1063 
»q
 = 
	`Ùx2_mbox_®loc_msg_»ady
(&
pf
->
mbox
);

1064 ià(!
»q
) {

1065 
	`Ùx2_di§bË_mbox_šŒ
(
pf
);

1066  -
ENOMEM
;

1068 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

1069 ià(
”r
) {

1070 
	`dev_w¬n
(
pf
->
dev
,

1072 
	`Ùx2_di§bË_mbox_šŒ
(
pf
);

1073  -
EPROBE_DEFER
;

1077 
	}
}

1079 
	$Ùx2_pçf_mbox_de¡roy
(
Ùx2_nic
 *
pf
)

1081 
mbox
 *mbox = &
pf
->mbox;

1083 ià(
pf
->
mbox_wq
) {

1084 
	`de¡roy_wÜkqueue
(
pf
->
mbox_wq
);

1085 
pf
->
mbox_wq
 = 
NULL
;

1088 ià(
mbox
->mbox.
hwba£
)

1089 
	`iounm­
((
__iomem
 *)
mbox
->mbox.
hwba£
);

1091 
	`Ùx2_mbox_de¡roy
(&
mbox
->mbox);

1092 
	`Ùx2_mbox_de¡roy
(&
mbox
->
mbox_up
);

1093 
	}
}

1095 
	$Ùx2_pçf_mbox_š™
(
Ùx2_nic
 *
pf
)

1097 
mbox
 *mbox = &
pf
->mbox;

1098 
__iomem
 *
hwba£
;

1099 
”r
;

1101 
mbox
->
pfvf
 = 
pf
;

1102 
pf
->
mbox_wq
 = 
	`®loc_wÜkqueue
("otx2_pfaf_mailbox",

1103 
WQ_UNBOUND
 | 
WQ_HIGHPRI
 |

1104 
WQ_MEM_RECLAIM
, 1);

1105 ià(!
pf
->
mbox_wq
)

1106  -
ENOMEM
;

1112 
hwba£
 = 
	`iÜem­_wc
(
	`pci_»sourû_¡¬t
(
pf
->
pdev
, 
PCI_MBOX_BAR_NUM
),

1113 
MBOX_SIZE
);

1114 ià(!
hwba£
) {

1115 
	`dev_”r
(
pf
->
dev
, "Unableo map PFAF mailbox„egion\n");

1116 
”r
 = -
ENOMEM
;

1117 
ex™
;

1120 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->mbox, 
hwba£
, 
pf
->
pdev
,…f->
»g_ba£
,

1121 
MBOX_DIR_PFAF
, 1);

1122 ià(
”r
)

1123 
ex™
;

1125 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->
mbox_up
, 
hwba£
, 
pf
->
pdev
,…f->
»g_ba£
,

1126 
MBOX_DIR_PFAF_UP
, 1);

1127 ià(
”r
)

1128 
ex™
;

1130 
”r
 = 
	`Ùx2_mbox_bbuf_š™
(
mbox
, 
pf
->
pdev
);

1131 ià(
”r
)

1132 
ex™
;

1134 
	`INIT_WORK
(&
mbox
->
mbox_wrk
, 
Ùx2_pçf_mbox_hªdËr
);

1135 
	`INIT_WORK
(&
mbox
->
mbox_up_wrk
, 
Ùx2_pçf_mbox_up_hªdËr
);

1136 
	`mu‹x_š™
(&
mbox
->
lock
);

1139 
ex™
:

1140 
	`Ùx2_pçf_mbox_de¡roy
(
pf
);

1141  
”r
;

1142 
	}
}

1144 
	$Ùx2_cgx_cÚfig_lškev’ts
(
Ùx2_nic
 *
pf
, 
boŞ
 
’abË
)

1146 
msg_»q
 *
msg
;

1147 
”r
;

1149 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

1150 ià(
’abË
)

1151 
msg
 = 
	`Ùx2_mbox_®loc_msg_cgx_¡¬t_lškev’ts
(&
pf
->
mbox
);

1153 
msg
 = 
	`Ùx2_mbox_®loc_msg_cgx_¡İ_lškev’ts
(&
pf
->
mbox
);

1155 ià(!
msg
) {

1156 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1157  -
ENOMEM
;

1160 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

1161 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1162  
”r
;

1163 
	}
}

1165 
	$Ùx2_cgx_cÚfig_loİback
(
Ùx2_nic
 *
pf
, 
boŞ
 
’abË
)

1167 
msg_»q
 *
msg
;

1168 
”r
;

1170 ià(
’abË
 && !
	`b™m­_em±y
(
pf
->
æow_cfg
->
dmacæt_bm­
,

1171 
pf
->
æow_cfg
->
dmacæt_max_æows
))

1172 
	`Ãtdev_w¬n
(
pf
->
Ãtdev
,

1175 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

1176 ià(
’abË
)

1177 
msg
 = 
	`Ùx2_mbox_®loc_msg_cgx_šbk_’abË
(&
pf
->
mbox
);

1179 
msg
 = 
	`Ùx2_mbox_®loc_msg_cgx_šbk_di§bË
(&
pf
->
mbox
);

1181 ià(!
msg
) {

1182 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1183  -
ENOMEM
;

1186 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

1187 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

1188  
”r
;

1189 
	}
}

1191 
	$Ùx2_£t_»®_num_queues
(
Ãt_deviû
 *
Ãtdev
,

1192 
tx_queues
, 
rx_queues
)

1194 
”r
;

1196 
”r
 = 
	`Ãtif_£t_»®_num_tx_queues
(
Ãtdev
, 
tx_queues
);

1197 ià(
”r
) {

1198 
	`Ãtdev_”r
(
Ãtdev
,

1199 "FaedØ£ˆnØoàTx queues: %d\n", 
tx_queues
);

1200  
”r
;

1203 
”r
 = 
	`Ãtif_£t_»®_num_rx_queues
(
Ãtdev
, 
rx_queues
);

1204 ià(
”r
)

1205 
	`Ãtdev_”r
(
Ãtdev
,

1206 "FaedØ£ˆnØoàRx queues: %d\n", 
rx_queues
);

1207  
”r
;

1208 
	}
}

1209 
EXPORT_SYMBOL
(
Ùx2_£t_»®_num_queues
);

1211 *
	gnix_sqİ”r_e_¡r
[
NIX_SQOPERR_MAX
] = {

1223 *
	gnix_mnq”r_e_¡r
[
NIX_MNQERR_MAX
] = {

1236 *
	gnix_¢d_¡©us_e_¡r
[
NIX_SND_STATUS_MAX
] = {

1264 
œq»tuº_t
 
	$Ùx2_q_šŒ_hªdËr
(
œq
, *
d©a
)

1266 
Ùx2_nic
 *
pf
 = 
d©a
;

1267 
Ùx2_¢d_queue
 *
sq
;

1268 
u64
 
v®
, *
±r
;

1269 
u64
 
qidx
 = 0;

1272 
qidx
 = 0; qidx < 
pf
->
q£t
.
cq_út
; qidx++) {

1273 
±r
 = 
	`Ùx2_g‘_»gaddr
(
pf
, 
NIX_LF_CQ_OP_INT
);

1274 
v®
 = 
	`Ùx2_©omic64_add
((
qidx
 << 44), 
±r
);

1276 
	`Ùx2_wr™e64
(
pf
, 
NIX_LF_CQ_OP_INT
, (
qidx
 << 44) |

1277 (
v®
 & 
NIX_CQERRINT_BITS
));

1278 ià(!(
v®
 & (
NIX_CQERRINT_BITS
 | 
	`BIT_ULL
(42))))

1281 ià(
v®
 & 
	`BIT_ULL
(42)) {

1282 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "CQ%lld:ƒrror„eading NIX_LF_CQ_OP_INT, NIX_LF_ERR_INT 0x%llx\n",

1283 
qidx
, 
	`Ùx2_»ad64
(
pf
, 
NIX_LF_ERR_INT
));

1285 ià(
v®
 & 
	`BIT_ULL
(
NIX_CQERRINT_DOOR_ERR
))

1286 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "CQ%lld: Doorbellƒrror",

1287 
qidx
);

1288 ià(
v®
 & 
	`BIT_ULL
(
NIX_CQERRINT_CQE_FAULT
))

1289 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "CQ%lld: Memory fault on CQE writeo LLC/DRAM",

1290 
qidx
);

1293 
	`scheduË_wÜk
(&
pf
->
»£t_sk
);

1297 
qidx
 = 0; qidx < 
pf
->
hw
.
tÙ_tx_queues
 +…f->hw.
tc_tx_queues
; qidx++) {

1298 
u64
 
sq_İ_”r_dbg
, 
mnq_”r_dbg
, 
¢d_”r_dbg
;

1299 
u8
 
sq_İ_”r_code
, 
mnq_”r_code
, 
¢d_”r_code
;

1301 
sq
 = &
pf
->
q£t
.sq[
qidx
];

1302 ià(!
sq
->
sqb_±rs
)

1310 
±r
 = 
	`Ùx2_g‘_»gaddr
(
pf
, 
NIX_LF_SQ_OP_INT
);

1311 
v®
 = 
	`Ùx2_©omic64_add
((
qidx
 << 44), 
±r
);

1312 
	`Ùx2_wr™e64
(
pf
, 
NIX_LF_SQ_OP_INT
, (
qidx
 << 44) |

1313 (
v®
 & 
NIX_SQINT_BITS
));

1315 ià(
v®
 & 
	`BIT_ULL
(42)) {

1316 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "SQ%lld:ƒrror„eading NIX_LF_SQ_OP_INT, NIX_LF_ERR_INT 0x%llx\n",

1317 
qidx
, 
	`Ùx2_»ad64
(
pf
, 
NIX_LF_ERR_INT
));

1318 
dÚe
;

1321 
sq_İ_”r_dbg
 = 
	`Ùx2_»ad64
(
pf
, 
NIX_LF_SQ_OP_ERR_DBG
);

1322 ià(!(
sq_İ_”r_dbg
 & 
	`BIT
(44)))

1323 
chk_mnq_”r_dbg
;

1325 
sq_İ_”r_code
 = 
	`FIELD_GET
(
	`GENMASK
(7, 0), 
sq_İ_”r_dbg
);

1326 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "SQ%lld: NIX_LF_SQ_OP_ERR_DBG(%llx)ƒrr=%s\n",

1327 
qidx
, 
sq_İ_”r_dbg
, 
nix_sqİ”r_e_¡r
[
sq_İ_”r_code
]);

1329 
	`Ùx2_wr™e64
(
pf
, 
NIX_LF_SQ_OP_ERR_DBG
, 
	`BIT_ULL
(44));

1331 ià(
sq_İ_”r_code
 =ğ
NIX_SQOPERR_SQB_NULL
)

1332 
chk_mnq_”r_dbg
;

1338 
chk_mnq_”r_dbg
:

1339 
mnq_”r_dbg
 = 
	`Ùx2_»ad64
(
pf
, 
NIX_LF_MNQ_ERR_DBG
);

1340 ià(!(
mnq_”r_dbg
 & 
	`BIT
(44)))

1341 
chk_¢d_”r_dbg
;

1343 
mnq_”r_code
 = 
	`FIELD_GET
(
	`GENMASK
(7, 0), 
mnq_”r_dbg
);

1344 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "SQ%lld: NIX_LF_MNQ_ERR_DBG(%llx)ƒrr=%s\n",

1345 
qidx
, 
mnq_”r_dbg
, 
nix_mnq”r_e_¡r
[
mnq_”r_code
]);

1346 
	`Ùx2_wr™e64
(
pf
, 
NIX_LF_MNQ_ERR_DBG
, 
	`BIT_ULL
(44));

1348 
chk_¢d_”r_dbg
:

1350 
¢d_”r_dbg
 = 
	`Ùx2_»ad64
(
pf
, 
NIX_LF_SEND_ERR_DBG
);

1351 ià(
¢d_”r_dbg
 & 
	`BIT
(44)) {

1352 
¢d_”r_code
 = 
	`FIELD_GET
(
	`GENMASK
(7, 0), 
¢d_”r_dbg
);

1353 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "SQ%lld: NIX_LF_SND_ERR_DBG:0x%llxƒrr=%s\n",

1354 
qidx
, 
¢d_”r_dbg
, 
nix_¢d_¡©us_e_¡r
[
¢d_”r_code
]);

1355 
	`Ùx2_wr™e64
(
pf
, 
NIX_LF_SEND_ERR_DBG
, 
	`BIT_ULL
(44));

1358 
dÚe
:

1362 ià(
v®
 & 
	`BIT_ULL
(
NIX_SQINT_SQB_ALLOC_FAIL
))

1363 
	`Ãtdev_”r
(
pf
->
Ãtdev
, "SQ%lld: SQB‡llocation failed",

1364 
qidx
);

1366 
	`scheduË_wÜk
(&
pf
->
»£t_sk
);

1369  
IRQ_HANDLED
;

1370 
	}
}

1372 
œq»tuº_t
 
	$Ùx2_cq_šŒ_hªdËr
(
œq
, *
cq_œq
)

1374 
Ùx2_cq_pŞl
 *
cq_pŞl
 = (Ùx2_cq_pŞÈ*)
cq_œq
;

1375 
Ùx2_nic
 *
pf
 = (Ùx2_niø*)
cq_pŞl
->
dev
;

1376 
qidx
 = 
cq_pŞl
->
cšt_idx
;

1383 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_CINTX_ENA_W1C
(
qidx
), 
	`BIT_ULL
(0));

1386 
pf
->
Çpi_ev’ts
++;

1387 
	`Çpi_scheduË_œqoff
(&
cq_pŞl
->
Çpi
);

1389  
IRQ_HANDLED
;

1390 
	}
}

1392 
	$Ùx2_di§bË_Çpi
(
Ùx2_nic
 *
pf
)

1394 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1395 
Ùx2_cq_pŞl
 *
cq_pŞl
;

1396 
qidx
;

1398 
qidx
 = 0; qidx < 
pf
->
hw
.
cšt_út
; qidx++) {

1399 
cq_pŞl
 = &
q£t
->
Çpi
[
qidx
];

1400 
	`ÿnûl_wÜk_sync
(&
cq_pŞl
->
dim
.
wÜk
);

1401 
	`Çpi_di§bË
(&
cq_pŞl
->
Çpi
);

1402 
	`Ãtif_Çpi_d–
(&
cq_pŞl
->
Çpi
);

1404 
	}
}

1406 
	$Ùx2_ä“_cq_»s
(
Ùx2_nic
 *
pf
)

1408 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1409 
Ùx2_cq_queue
 *
cq
;

1410 
qidx
;

1413 
	`Ùx2_ùx_di§bË
(&
pf
->
mbox
, 
NIX_AQ_CTYPE_CQ
, 
çl£
);

1414 
qidx
 = 0; qidx < 
q£t
->
cq_út
; qidx++) {

1415 
cq
 = &
q£t
->cq[
qidx
];

1416 
	`qmem_ä“
(
pf
->
dev
, 
cq
->
cqe
);

1418 
	}
}

1420 
	$Ùx2_ä“_sq_»s
(
Ùx2_nic
 *
pf
)

1422 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1423 
Ùx2_¢d_queue
 *
sq
;

1424 
qidx
;

1427 
	`Ùx2_ùx_di§bË
(&
pf
->
mbox
, 
NIX_AQ_CTYPE_SQ
, 
çl£
);

1429 
	`Ùx2_sq_ä“_sqbs
(
pf
);

1430 
qidx
 = 0; qidx < 
pf
->
hw
.
tÙ_tx_queues
 +…f->hw.
tc_tx_queues
; qidx++) {

1431 
sq
 = &
q£t
->sq[
qidx
];

1433 ià(!
sq
->
sqe
)

1435 
	`qmem_ä“
(
pf
->
dev
, 
sq
->
sqe
);

1436 
	`qmem_ä“
(
pf
->
dev
, 
sq
->
tso_hdrs
);

1437 
	`kä“
(
sq
->
sg
);

1438 
	`kä“
(
sq
->
sqb_±rs
);

1439 
	`qmem_ä“
(
pf
->
dev
, 
sq
->
time¡amps
);

1441 
	}
}

1443 
	$Ùx2_g‘_rbuf_size
(
Ùx2_nic
 *
pf
, 
mtu
)

1445 
äame_size
;

1446 
tÙ®_size
;

1447 
rbuf_size
;

1449 ià(
pf
->
hw
.
rbuf_fixed_size
)

1450  
	`ALIGN
(
pf
->
hw
.
rbuf_fixed_size
, 
OTX2_ALIGN
) +

1451 
OTX2_HEAD_ROOM
;

1465 
äame_size
 = 
mtu
 + 
OTX2_ETH_HLEN
 + 
OTX2_HW_TIMESTAMP_LEN
 +

1466 
pf
->
addl_mtu
 +…f->
xŒa_hdr
;

1467 
tÙ®_size
 = 
äame_size
 + 
OTX2_HEAD_ROOM
 * 6;

1468 
rbuf_size
 = 
tÙ®_size
 / 6;

1470  
	`ALIGN
(
rbuf_size
, 2048);

1471 
	}
}

1473 
	$Ùx2_š™_hw_»sourûs
(
Ùx2_nic
 *
pf
)

1475 
nix_lf_ä“_»q
 *
ä“_»q
;

1476 
mbox
 *mbox = &
pf
->mbox;

1477 
Ùx2_hw
 *
hw
 = &
pf
->hw;

1478 
msg_»q
 *
»q
;

1479 
”r
 = 0, 
lvl
;

1485 
hw
->
rqpoŞ_út
 = hw->
rx_queues
;

1486 
hw
->
sqpoŞ_út
 = hw->
tÙ_tx_queues
 + hw->
tc_tx_queues
;

1487 
hw
->
poŞ_út
 = hw->
rqpoŞ_út
 + hw->
sqpoŞ_út
;

1490 
pf
->
tx_max_pk’
 =…f->
Ãtdev
->
max_mtu
 + 
OTX2_ETH_HLEN
;

1492 
pf
->
rbsize
 = 
	`Ùx2_g‘_rbuf_size
Õf,…f->
Ãtdev
->
mtu
);

1494 
	`mu‹x_lock
(&
mbox
->
lock
);

1496 
”r
 = 
	`Ùx2_cÚfig_Åa
(
pf
);

1497 ià(
”r
)

1498 
ex™
;

1501 
”r
 = 
	`Ùx2_cÚfig_nix
(
pf
);

1502 ià(
”r
)

1503 
”r_ä“_Åa_lf
;

1506 
	`Ùx2_nix_cÚfig_bp
(
pf
, 
Œue
);

1509 
”r
 = 
	`Ùx2_rq_au¿_poŞ_š™
(
pf
);

1510 ià(
”r
) {

1511 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1512 
”r_ä“_nix_lf
;

1515 
”r
 = 
	`Ùx2_sq_au¿_poŞ_š™
(
pf
);

1516 ià(
”r
) {

1517 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1518 
”r_ä“_rq_±rs
;

1521 
”r
 = 
	`Ùx2_txsch_®loc
(
pf
);

1522 ià(
”r
) {

1523 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1524 
”r_ä“_sq_±rs
;

1527 #ifdeà
CONFIG_DCB


1528 ià(
pf
->
pfc_’
) {

1529 
”r
 = 
	`Ùx2_pfc_txschq_®loc
(
pf
);

1530 ià(
”r
) {

1531 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1532 
”r_ä“_sq_±rs
;

1537 
”r
 = 
	`Ùx2_cÚfig_nix_queues
(
pf
);

1538 ià(
”r
) {

1539 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1540 
”r_ä“_txsch
;

1543 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

1544 
”r
 = 
	`Ùx2_txschq_cÚfig
(
pf
, 
lvl
, 0, 
çl£
);

1545 ià(
”r
) {

1546 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1547 
”r_ä“_nix_queues
;

1551 #ifdeà
CONFIG_DCB


1552 ià(
pf
->
pfc_’
) {

1553 
”r
 = 
	`Ùx2_pfc_txschq_cÚfig
(
pf
);

1554 ià(
”r
) {

1555 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1556 
”r_ä“_nix_queues
;

1561 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1562  
”r
;

1564 
”r_ä“_nix_queues
:

1565 
	`Ùx2_ä“_sq_»s
(
pf
);

1566 
	`Ùx2_ä“_cq_»s
(
pf
);

1567 
	`Ùx2_ùx_di§bË
(
mbox
, 
NIX_AQ_CTYPE_RQ
, 
çl£
);

1568 
”r_ä“_txsch
:

1569 ià(
	`Ùx2_txschq_¡İ
(
pf
))

1570 
	`dev_”r
(
pf
->
dev
, "% çedØ¡İ TX scheduËrs\n", 
__func__
);

1571 
”r_ä“_sq_±rs
:

1572 
	`Ùx2_sq_ä“_sqbs
(
pf
);

1573 
”r_ä“_rq_±rs
:

1574 
	`Ùx2_ä“_au¿_±r
(
pf
, 
AURA_NIX_RQ
);

1575 
	`Ùx2_ùx_di§bË
(
mbox
, 
NPA_AQ_CTYPE_POOL
, 
Œue
);

1576 
	`Ùx2_ùx_di§bË
(
mbox
, 
NPA_AQ_CTYPE_AURA
, 
Œue
);

1577 
	`Ùx2_au¿_poŞ_ä“
(
pf
);

1578 
”r_ä“_nix_lf
:

1579 
	`mu‹x_lock
(&
mbox
->
lock
);

1580 
ä“_»q
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_ä“
(
mbox
);

1581 ià(
ä“_»q
) {

1582 
ä“_»q
->
æags
 = 
NIX_LF_DISABLE_FLOWS
;

1583 ià(
	`Ùx2_sync_mbox_msg
(
mbox
))

1584 
	`dev_”r
(
pf
->
dev
, "% çedØä“‚ixlf\n", 
__func__
);

1586 
”r_ä“_Åa_lf
:

1588 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åa_lf_ä“
(
mbox
);

1589 ià(
»q
) {

1590 ià(
	`Ùx2_sync_mbox_msg
(
mbox
))

1591 
	`dev_”r
(
pf
->
dev
, "% çedØä“‚·lf\n", 
__func__
);

1593 
ex™
:

1594 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1595  
”r
;

1596 
	}
}

1598 
	$Ùx2_ä“_hw_»sourûs
(
Ùx2_nic
 *
pf
)

1600 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1601 
nix_lf_ä“_»q
 *
ä“_»q
;

1602 
mbox
 *mbox = &
pf
->mbox;

1603 
Ùx2_cq_queue
 *
cq
;

1604 
msg_»q
 *
»q
;

1605 
qidx
, 
”r
;

1608 
	`Ùx2_sqb_æush
(
pf
);

1611 
”r
 = 
	`Ùx2_txschq_¡İ
(
pf
);

1612 ià(
”r
)

1613 
	`dev_”r
(
pf
->
dev
, "RVUPF: Failedo stop/free TX schedulers\n");

1615 #ifdeà
CONFIG_DCB


1616 ià(
pf
->
pfc_’
)

1617 
	`Ùx2_pfc_txschq_¡İ
(
pf
);

1620 
	`Ùx2_ş—n_qos_queues
(
pf
);

1622 
	`mu‹x_lock
(&
mbox
->
lock
);

1624 ià(!(
pf
->
pcifunc
 & 
RVU_PFVF_FUNC_MASK
))

1625 
	`Ùx2_nix_cÚfig_bp
(
pf
, 
çl£
);

1626 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1629 
	`Ùx2_ùx_di§bË
(
mbox
, 
NIX_AQ_CTYPE_RQ
, 
çl£
);

1632 
qidx
 = 0; qidx < 
q£t
->
cq_út
; qidx++) {

1633 
cq
 = &
q£t
->cq[
qidx
];

1634 ià(
cq
->
cq_ty³
 =ğ
CQ_RX
)

1635 
	`Ùx2_ş—nup_rx_cqes
(
pf
, 
cq
);

1637 
	`Ùx2_ş—nup_tx_cqes
(
pf
, 
cq
);

1640 
	`Ùx2_ä“_³ndšg_sqe
(
pf
);

1642 
	`Ùx2_ä“_sq_»s
(
pf
);

1645 
	`Ùx2_ä“_au¿_±r
(
pf
, 
AURA_NIX_RQ
);

1647 
	`Ùx2_ä“_cq_»s
(
pf
);

1650 
	`ú10k_ä“_®l_Şiûrs
(
pf
);

1652 
	`mu‹x_lock
(&
mbox
->
lock
);

1654 
ä“_»q
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_ä“
(
mbox
);

1655 ià(
ä“_»q
) {

1656 
ä“_»q
->
æags
 = 
NIX_LF_DISABLE_FLOWS
;

1657 ià(!(
pf
->
æags
 & 
OTX2_FLAG_PF_SHUTDOWN
))

1658 
ä“_»q
->
æags
 |ğ
NIX_LF_DONT_FREE_TX_VTAG
;

1659 ià(
	`Ùx2_sync_mbox_msg
(
mbox
))

1660 
	`dev_”r
(
pf
->
dev
, "% çedØä“‚ixlf\n", 
__func__
);

1662 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1665 
	`Ùx2_ùx_di§bË
(
mbox
, 
NPA_AQ_CTYPE_POOL
, 
Œue
);

1666 
	`Ùx2_ùx_di§bË
(
mbox
, 
NPA_AQ_CTYPE_AURA
, 
Œue
);

1667 
	`Ùx2_au¿_poŞ_ä“
(
pf
);

1669 
	`mu‹x_lock
(&
mbox
->
lock
);

1671 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åa_lf_ä“
(
mbox
);

1672 ià(
»q
) {

1673 ià(
	`Ùx2_sync_mbox_msg
(
mbox
))

1674 
	`dev_”r
(
pf
->
dev
, "% çedØä“‚·lf\n", 
__func__
);

1676 
	`mu‹x_uÆock
(&
mbox
->
lock
);

1677 
	}
}

1679 
	$Ùx2_£t_œq_cßËsû
(
Ùx2_nic
 *
pfvf
)

1681 
cšt
;

1683 
cšt
 = 0; cšˆ< 
pfvf
->
hw
.
cšt_út
; cint++)

1684 
	`Ùx2_cÚfig_œq_cßËscšg
(
pfvf
, 
cšt
);

1685 
	}
}

1687 
	$Ùx2_dim_wÜk
(
wÜk_¡ruù
 *
w
)

1689 
dim_cq_mod”
 
cur_mod”
;

1690 
Ùx2_cq_pŞl
 *
cq_pŞl
;

1691 
Ùx2_nic
 *
pfvf
;

1692 
dim
 *dim;

1694 
dim
 = 
	`cÚš”_of
(
w
, dim, 
wÜk
);

1695 
cur_mod”
 = 
	`Ãt_dim_g‘_rx_mod”©iÚ
(
dim
->
mode
, dim->
´ofe_ix
);

1696 
cq_pŞl
 = 
	`cÚš”_of
(
dim
, 
Ùx2_cq_pŞl
, dim);

1697 
pfvf
 = (
Ùx2_nic
 *)
cq_pŞl
->
dev
;

1698 
pfvf
->
hw
.
cq_time_wa™
 = (
cur_mod”
.
u£c
 > 
CQ_TIMER_THRESH_MAX
) ?

1699 
CQ_TIMER_THRESH_MAX
 : 
cur_mod”
.
u£c
;

1700 
pfvf
->
hw
.
cq_ecouÁ_wa™
 = (
cur_mod”
.
pkts
 > 
NAPI_POLL_WEIGHT
) ?

1701 
NAPI_POLL_WEIGHT
 : 
cur_mod”
.
pkts
;

1702 
	`Ùx2_£t_œq_cßËsû
(
pfvf
);

1703 
dim
->
¡©e
 = 
DIM_START_MEASURE
;

1704 
	}
}

1706 
	$Ùx2_İ’
(
Ãt_deviû
 *
Ãtdev
)

1708 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1709 
Ùx2_cq_pŞl
 *
cq_pŞl
 = 
NULL
;

1710 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1711 
”r
 = 0, 
qidx
, 
vec
;

1712 *
œq_Çme
;

1714 
	`Ãtif_ÿ¼›r_off
(
Ãtdev
);

1719 
pf
->
hw
.
cšt_út
 = 
	`max
Õf->hw.
rx_queues
,…f->hw.
tx_queues
);

1720 
pf
->
hw
.
cšt_út
 = 
	`max_t
(
u8
,…f->hw.cšt_út,…f->hw.
tc_tx_queues
);

1721 
pf
->
q£t
.
cq_út
 =…f->
hw
.
rx_queues
 +…f->hw.
tÙ_tx_queues
 +…f->hw.
tc_tx_queues
;

1723 
q£t
->
Çpi
 = 
	`kÿÎoc
(
pf
->
hw
.
cšt_út
, (*
cq_pŞl
), 
GFP_KERNEL
);

1724 ià(!
q£t
->
Çpi
)

1725  -
ENOMEM
;

1728 
q£t
->
rqe_út
 = q£t->rqe_úˆ? q£t->rqe_úˆ: 
	`Q_COUNT
(
Q_SIZE_256
);

1730 
q£t
->
sqe_út
 = q£t->sqe_úˆ? q£t->sqe_úˆ: 
	`Q_COUNT
(
Q_SIZE_4K
);

1732 
”r
 = -
ENOMEM
;

1733 
q£t
->
cq
 = 
	`kÿÎoc
(
pf
->q£t.
cq_út
,

1734 (
Ùx2_cq_queue
), 
GFP_KERNEL
);

1735 ià(!
q£t
->
cq
)

1736 
”r_ä“_mem
;

1738 
q£t
->
sq
 = 
	`kÿÎoc
(
pf
->
hw
.
tÙ_tx_queues
 +…f->hw.
tc_tx_queues
,

1739 (
Ùx2_¢d_queue
), 
GFP_KERNEL
);

1740 ià(!
q£t
->
sq
)

1741 
”r_ä“_mem
;

1743 
q£t
->
rq
 = 
	`kÿÎoc
(
pf
->
hw
.
rx_queues
,

1744 (
Ùx2_rcv_queue
), 
GFP_KERNEL
);

1745 ià(!
q£t
->
rq
)

1746 
”r_ä“_mem
;

1748 
”r
 = 
	`Ùx2_š™_hw_»sourûs
(
pf
);

1749 ià(
”r
)

1750 
”r_ä“_mem
;

1753 
qidx
 = 0; qidx < 
pf
->
hw
.
cšt_út
; qidx++) {

1754 
cq_pŞl
 = &
q£t
->
Çpi
[
qidx
];

1755 
cq_pŞl
->
cšt_idx
 = 
qidx
;

1761 
cq_pŞl
->
cq_ids
[
CQ_RX
] =

1762 (
qidx
 < 
pf
->
hw
.
rx_queues
è? qidx : 
CINT_INVALID_CQ
;

1763 
cq_pŞl
->
cq_ids
[
CQ_TX
] = (
qidx
 < 
pf
->
hw
.
tx_queues
) ?

1764 
qidx
 + 
pf
->
hw
.
rx_queues
 : 
CINT_INVALID_CQ
;

1765 ià(
pf
->
xdp_´og
)

1766 
cq_pŞl
->
cq_ids
[
CQ_XDP
] = (
qidx
 < 
pf
->
hw
.
xdp_queues
) ?

1767 (
qidx
 + 
pf
->
hw
.
rx_queues
 +

1768 
pf
->
hw
.
tx_queues
) :

1769 
CINT_INVALID_CQ
;

1771 
cq_pŞl
->
cq_ids
[
CQ_XDP
] = 
CINT_INVALID_CQ
;

1773 
cq_pŞl
->
cq_ids
[
CQ_QOS
] = (
qidx
 < 
pf
->
hw
.
tc_tx_queues
) ?

1774 (
qidx
 + 
pf
->
hw
.
rx_queues
 +

1775 
pf
->
hw
.
tÙ_tx_queues
) :

1776 
CINT_INVALID_CQ
;

1778 
cq_pŞl
->
dev
 = (*)
pf
;

1779 
cq_pŞl
->
dim
.
mode
 = 
DIM_CQ_PERIOD_MODE_START_FROM_CQE
;

1780 
	`INIT_WORK
(&
cq_pŞl
->
dim
.
wÜk
, 
Ùx2_dim_wÜk
);

1781 
	`Ãtif_Çpi_add
(
Ãtdev
, &
cq_pŞl
->
Çpi
,

1782 
Ùx2_Çpi_hªdËr
, 
NAPI_POLL_WEIGHT
);

1783 
	`Çpi_’abË
(&
cq_pŞl
->
Çpi
);

1787 
”r
 = 
	`Ùx2_hw_£t_mtu
(
pf
, 
Ãtdev
->
mtu
);

1788 ià(
”r
)

1789 
”r_di§bË_Çpi
;

1792 
	`Ùx2_£tup_£gm’tiÚ
(
pf
);

1795 
”r
 = 
	`Ùx2_rss_š™
(
pf
);

1796 ià(
”r
)

1797 
”r_di§bË_Çpi
;

1800 
vec
 = 
pf
->
hw
.
nix_msixoff
 + 
NIX_LF_QINT_VEC_START
;

1801 
œq_Çme
 = &
pf
->
hw
.œq_Çme[
vec
 * 
NAME_SIZE
];

1803 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "%s-q”r", 
pf
->
Ãtdev
->
Çme
);

1805 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
vec
),

1806 
Ùx2_q_šŒ_hªdËr
, 0, 
œq_Çme
, 
pf
);

1807 ià(
”r
) {

1808 
	`dev_”r
(
pf
->
dev
,

1810 
	`rvu_g‘_pf
(
pf
->
pcifunc
));

1811 
”r_di§bË_Çpi
;

1815 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_QINTX_ENA_W1S
(0), 
	`BIT_ULL
(0));

1818 
vec
 = 
pf
->
hw
.
nix_msixoff
 + 
NIX_LF_CINT_VEC_START
;

1819 
qidx
 = 0; qidx < 
pf
->
hw
.
cšt_út
; qidx++) {

1820 
œq_Çme
 = &
pf
->
hw
.œq_Çme[
vec
 * 
NAME_SIZE
];

1822 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "%s-rxtx-%d", 
pf
->
Ãtdev
->
Çme
,

1823 
qidx
);

1825 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
vec
),

1826 
Ùx2_cq_šŒ_hªdËr
, 0, 
œq_Çme
,

1827 &
q£t
->
Çpi
[
qidx
]);

1828 ià(
”r
) {

1829 
	`dev_”r
(
pf
->
dev
,

1831 
	`rvu_g‘_pf
(
pf
->
pcifunc
), 
qidx
);

1832 
”r_ä“_cšts
;

1834 
vec
++;

1836 
	`Ùx2_cÚfig_œq_cßËscšg
(
pf
, 
qidx
);

1839 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_CINTX_INT
(
qidx
), 
	`BIT_ULL
(0));

1840 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_CINTX_ENA_W1S
(
qidx
), 
	`BIT_ULL
(0));

1843 
	`Ùx2_£t_cšts_affš™y
(
pf
);

1845 ià(
pf
->
æags
 & 
OTX2_FLAG_RX_VLAN_SUPPORT
)

1846 
	`Ùx2_’abË_rxvÏn
(
pf
, 
Œue
);

1849 ià(
pf
->
æags
 & 
OTX2_FLAG_TX_TSTAMP_ENABLED
) {

1850 
pf
->
æags
 &ğ~
OTX2_FLAG_TX_TSTAMP_ENABLED
;

1851 
	`Ùx2_cÚfig_hw_tx_t¡amp
(
pf
, 
Œue
);

1853 ià(
pf
->
æags
 & 
OTX2_FLAG_RX_TSTAMP_ENABLED
) {

1854 
pf
->
æags
 &ğ~
OTX2_FLAG_RX_TSTAMP_ENABLED
;

1855 
	`Ùx2_cÚfig_hw_rx_t¡amp
(
pf
, 
Œue
);

1858 
pf
->
æags
 &ğ~
OTX2_FLAG_INTF_DOWN
;

1860 
	`smp_wmb
();

1863 
	`Ùx2_qos_cÚfig_txschq
(
pf
);

1866 ià(
pf
->
lšfo
.
lšk_up
 && !Õf->
pcifunc
 & 
RVU_PFVF_FUNC_MASK
))

1867 
	`Ùx2_hªdË_lšk_ev’t
(
pf
);

1870 
	`Ùx2_£t_Åc_·r£_mode
(
pf
, 
çl£
);

1873 ià(
pf
->
æags
 & 
OTX2_FLAG_DMACFLTR_SUPPORT
)

1874 
	`Ùx2_dmacæt_»š¡®l_æows
(
pf
);

1876 
”r
 = 
	`Ùx2_rxtx_’abË
(
pf
, 
Œue
);

1882 ià(
”r
 =ğ
EIO
)

1883 
”r_di§bË_rxtx
;

1884 ià(
”r
)

1885 
”r_tx_¡İ_queues
;

1887 
	`Ùx2_do_£t_rx_mode
(
pf
);

1891 
”r_di§bË_rxtx
:

1892 
	`Ùx2_rxtx_’abË
(
pf
, 
çl£
);

1893 
”r_tx_¡İ_queues
:

1894 
	`Ãtif_tx_¡İ_®l_queues
(
Ãtdev
);

1895 
	`Ãtif_ÿ¼›r_off
(
Ãtdev
);

1896 
pf
->
æags
 |ğ
OTX2_FLAG_INTF_DOWN
;

1897 
”r_ä“_cšts
:

1898 
	`Ùx2_ä“_cšts
(
pf
, 
qidx
);

1899 
vec
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
,

1900 
pf
->
hw
.
nix_msixoff
 + 
NIX_LF_QINT_VEC_START
);

1901 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_QINTX_ENA_W1C
(0), 
	`BIT_ULL
(0));

1902 
	`synchrÚize_œq
(
vec
);

1903 
	`ä“_œq
(
vec
, 
pf
);

1904 
”r_di§bË_Çpi
:

1905 
	`Ùx2_di§bË_Çpi
(
pf
);

1906 
	`Ùx2_ä“_hw_»sourûs
(
pf
);

1907 
”r_ä“_mem
:

1908 
	`kä“
(
q£t
->
sq
);

1909 
	`kä“
(
q£t
->
cq
);

1910 
	`kä“
(
q£t
->
rq
);

1911 
	`kä“
(
q£t
->
Çpi
);

1912  
”r
;

1913 
	}
}

1914 
EXPORT_SYMBOL
(
Ùx2_İ’
);

1916 
	$Ùx2_¡İ
(
Ãt_deviû
 *
Ãtdev
)

1918 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1919 
Ùx2_cq_pŞl
 *
cq_pŞl
 = 
NULL
;

1920 
Ùx2_q£t
 *
q£t
 = &
pf
->qset;

1921 
Ùx2_rss_šfo
 *
rss
;

1922 
qidx
, 
vec
, 
wrk
;

1925 ià(
pf
->
æags
 & 
OTX2_FLAG_INTF_DOWN
)

1928 
	`Ãtif_ÿ¼›r_off
(
Ãtdev
);

1929 
	`Ãtif_tx_¡İ_®l_queues
(
Ãtdev
);

1931 
pf
->
æags
 |ğ
OTX2_FLAG_INTF_DOWN
;

1933 
	`smp_wmb
();

1936 
	`Ùx2_rxtx_’abË
(
pf
, 
çl£
);

1939 
rss
 = &
pf
->
hw
.
rss_šfo
;

1940 
rss
->
’abË
 = 
çl£
;

1943 
vec
 = 
	`pci_œq_veùÜ
(
pf
->
pdev
,

1944 
pf
->
hw
.
nix_msixoff
 + 
NIX_LF_QINT_VEC_START
);

1945 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_QINTX_ENA_W1C
(0), 
	`BIT_ULL
(0));

1946 
	`synchrÚize_œq
(
vec
);

1947 
	`ä“_œq
(
vec
, 
pf
);

1950 
vec
 = 
pf
->
hw
.
nix_msixoff
 + 
NIX_LF_CINT_VEC_START
;

1951 
qidx
 = 0; qidx < 
pf
->
hw
.
cšt_út
; qidx++) {

1953 
	`Ùx2_wr™e64
(
pf
, 
	`NIX_LF_CINTX_ENA_W1C
(
qidx
), 
	`BIT_ULL
(0));

1955 
	`synchrÚize_œq
(
	`pci_œq_veùÜ
(
pf
->
pdev
, 
vec
));

1957 
cq_pŞl
 = &
q£t
->
Çpi
[
qidx
];

1958 
	`Çpi_synchrÚize
(&
cq_pŞl
->
Çpi
);

1959 
vec
++;

1962 
	`Ãtif_tx_di§bË
(
Ãtdev
);

1964 
	`Ùx2_ä“_hw_»sourûs
(
pf
);

1965 
	`Ùx2_ä“_cšts
(
pf
,…f->
hw
.
cšt_út
);

1966 
	`Ùx2_di§bË_Çpi
(
pf
);

1968 
qidx
 = 0; qidx < 
Ãtdev
->
num_tx_queues
; qidx++)

1969 
	`Ãtdev_tx_»£t_queue
(
	`Ãtdev_g‘_tx_queue
(
Ãtdev
, 
qidx
));

1971 
wrk
 = 0; wrk < 
pf
->
q£t
.
cq_út
; wrk++)

1972 
	`ÿnûl_d–ayed_wÜk_sync
(&
pf
->
»fl_wrk
[
wrk
].
poŞ_»fl_wÜk
);

1973 
	`devm_kä“
(
pf
->
dev
,…f->
»fl_wrk
);

1975 
	`kä“
(
q£t
->
sq
);

1976 
	`kä“
(
q£t
->
cq
);

1977 
	`kä“
(
q£t
->
rq
);

1978 
	`kä“
(
q£t
->
Çpi
);

1980 
	`mem£t
((*)
q£t
 + 
	`off£tof
(
Ùx2_q£t
, 
sqe_út
), 0,

1981 (*
q£t
è- 
	`off£tof
(
Ùx2_q£t
, 
sqe_út
));

1983 
	}
}

1984 
EXPORT_SYMBOL
(
Ùx2_¡İ
);

1986 
Ãtdev_tx_t
 
	$Ùx2_xm™
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
Ãtdev
)

1988 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1989 
qidx
 = 
	`skb_g‘_queue_m­pšg
(
skb
);

1990 
Ùx2_¢d_queue
 *
sq
;

1991 
Ãtdev_queue
 *
txq
;

1992 
sq_idx
 = 
qidx
;

1997 ià(
qidx
 >ğ
pf
->
hw
.
tx_queues
)

1998 
sq_idx
 = 
qidx
 + 
pf
->
hw
.
xdp_queues
;

2001 ià(
skb
->
Ën
 <ğ
ETH_HLEN
 ||

2002 (!
	`skb_shšfo
(
skb
)->
gso_size
 && skb->
Ën
 > 
pf
->
tx_max_pk’
)) {

2003 
	`dev_kä“_skb
(
skb
);

2004  
NETDEV_TX_OK
;

2007 
sq
 = &
pf
->
q£t
.sq[
sq_idx
];

2008 
txq
 = 
	`Ãtdev_g‘_tx_queue
(
Ãtdev
, 
qidx
);

2010 ià(!
	`Ùx2_sq_­³nd_skb
(
Ãtdev
, 
sq
, 
skb
, 
qidx
)) {

2011 
	`Ãtif_tx_¡İ_queue
(
txq
);

2014 
	`smp_mb
();

2015 ià(((
sq
->
num_sqbs
 - *sq->
au¿_fc_addr
è* sq->
sqe_³r_sqb
)

2016 > 
sq
->
sqe_th»sh
)

2017 
	`Ãtif_tx_wake_queue
(
txq
);

2019  
NETDEV_TX_BUSY
;

2022  
NETDEV_TX_OK
;

2023 
	}
}

2025 
	$Ùx2_qos_£Ëù_htb_queue
(
Ùx2_nic
 *
pf
, 
sk_buff
 *
skb
,

2026 
u16
 
htb_maj_id
)

2028 
u16
 
şassid
;

2030 ià((
	`TC_H_MAJ
(
skb
->
´iÜ™y
è>> 16è=ğ
htb_maj_id
)

2031 
şassid
 = 
	`TC_H_MIN
(
skb
->
´iÜ™y
);

2033 
şassid
 = 
	`READ_ONCE
(
pf
->
qos
.
defşs
);

2035 ià(!
şassid
)

2038  
	`Ùx2_g‘_txq_by_şassid
(
pf
, 
şassid
);

2039 
	}
}

2041 
u16
 
	$Ùx2_£Ëù_queue
(
Ãt_deviû
 *
Ãtdev
, 
sk_buff
 *
skb
,

2042 
Ãt_deviû
 *
sb_dev
)

2044 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2045 
boŞ
 
qos_’abËd
;

2046 #ifdeà
CONFIG_DCB


2047 
u8
 
vÏn_´io
;

2049 
txq
;

2051 
qos_’abËd
 = (
Ãtdev
->
»®_num_tx_queues
 > 
pf
->
hw
.
tx_queues
è? 
Œue
 : 
çl£
;

2052 ià(
	`uÆik–y
(
qos_’abËd
)) {

2053 
u16
 
htb_maj_id
 = 
	`smp_lßd_acquœe
(&
pf
->
qos
.
maj_id
);

2055 ià(
	`uÆik–y
(
htb_maj_id
)) {

2056 
txq
 = 
	`Ùx2_qos_£Ëù_htb_queue
(
pf
, 
skb
, 
htb_maj_id
);

2057 ià(
txq
 > 0)

2058  
txq
;

2059 
´oûss_pfc
;

2063 
´oûss_pfc
:

2064 #ifdeà
CONFIG_DCB


2065 ià(!
skb
->
vÏn_´e£Á
)

2066 
pick_tx
;

2068 
vÏn_´io
 = 
skb
->
vÏn_tci
 >> 13;

2069 ià((
vÏn_´io
 > 
pf
->
hw
.
tx_queues
 - 1) ||

2070 !
pf
->
pfc_®loc_¡©us
[
vÏn_´io
])

2071 
pick_tx
;

2073  
vÏn_´io
;

2075 
pick_tx
:

2077 
txq
 = 
	`Ãtdev_pick_tx
(
Ãtdev
, 
skb
, 
NULL
);

2078 ià(
	`uÆik–y
(
qos_’abËd
))

2079  
txq
 % 
pf
->
hw
.
tx_queues
;

2081  
txq
;

2082 
	}
}

2083 
EXPORT_SYMBOL
(
Ùx2_£Ëù_queue
);

2085 
Ãtdev_ã©u»s_t
 
	$Ùx2_fix_ã©u»s
(
Ãt_deviû
 *
dev
,

2086 
Ãtdev_ã©u»s_t
 
ã©u»s
)

2088 ià(
ã©u»s
 & 
NETIF_F_HW_VLAN_CTAG_RX
)

2089 
ã©u»s
 |ğ
NETIF_F_HW_VLAN_STAG_RX
;

2091 
ã©u»s
 &ğ~
NETIF_F_HW_VLAN_STAG_RX
;

2093  
ã©u»s
;

2094 
	}
}

2096 
	$Ùx2_£t_rx_mode
(
Ãt_deviû
 *
Ãtdev
)

2098 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2100 
	`queue_wÜk
(
pf
->
Ùx2_wq
, &pf->
rx_mode_wÜk
);

2101 
	}
}

2103 
	$Ùx2_do_£t_rx_mode
(
Ùx2_nic
 *
pf
)

2105 
Ãt_deviû
 *
Ãtdev
 = 
pf
->netdev;

2106 
nix_rx_mode
 *
»q
;

2107 
boŞ
 
´omisc
 = 
çl£
;

2109 ià(!(
Ãtdev
->
æags
 & 
IFF_UP
))

2112 ià((
Ãtdev
->
æags
 & 
IFF_PROMISC
) ||

2113 (
	`Ãtdev_uc_couÁ
(
Ãtdev
è> 
OTX2_MAX_UNICAST_FLOWS
)) {

2114 
´omisc
 = 
Œue
;

2118 ià(!
´omisc
 && 
Ãtdev
->
´iv_æags
 & 
IFF_UNICAST_FLT
)

2119 
	`__dev_uc_sync
(
Ãtdev
, 
Ùx2_add_macf‹r
, 
Ùx2_d–_macf‹r
);

2121 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

2122 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_£t_rx_mode
(&
pf
->
mbox
);

2123 ià(!
»q
) {

2124 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

2128 
»q
->
mode
 = 
NIX_RX_MODE_UCAST
;

2130 ià(
´omisc
)

2131 
»q
->
mode
 |ğ
NIX_RX_MODE_PROMISC
;

2132 ià(
Ãtdev
->
æags
 & (
IFF_ALLMULTI
 | 
IFF_MULTICAST
))

2133 
»q
->
mode
 |ğ
NIX_RX_MODE_ALLMULTI
;

2135 
»q
->
mode
 |ğ
NIX_RX_MODE_USE_MCE
;

2137 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2138 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

2139 
	}
}

2141 
	$Ùx2_rx_mode_wrk_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

2143 
Ùx2_nic
 *
pf
 = 
	`cÚš”_of
(
wÜk
, Ùx2_nic, 
rx_mode_wÜk
);

2145 
	`Ùx2_do_£t_rx_mode
(
pf
);

2146 
	}
}

2148 
	$Ùx2_£t_ã©u»s
(
Ãt_deviû
 *
Ãtdev
,

2149 
Ãtdev_ã©u»s_t
 
ã©u»s
)

2151 
Ãtdev_ã©u»s_t
 
chªged
 = 
ã©u»s
 ^ 
Ãtdev
->features;

2152 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2154 ià((
chªged
 & 
NETIF_F_LOOPBACK
è&& 
	`Ãtif_ruÂšg
(
Ãtdev
))

2155  
	`Ùx2_cgx_cÚfig_loİback
(
pf
,

2156 
ã©u»s
 & 
NETIF_F_LOOPBACK
);

2158 ià((
chªged
 & 
NETIF_F_HW_VLAN_CTAG_RX
è&& 
	`Ãtif_ruÂšg
(
Ãtdev
))

2159  
	`Ùx2_’abË_rxvÏn
(
pf
,

2160 
ã©u»s
 & 
NETIF_F_HW_VLAN_CTAG_RX
);

2162  
	`Ùx2_hªdË_Áu¶e_tc_ã©u»s
(
Ãtdev
, 
ã©u»s
);

2163 
	}
}

2165 
	$Ùx2_»£t_sk
(
wÜk_¡ruù
 *
wÜk
)

2167 
Ùx2_nic
 *
pf
 = 
	`cÚš”_of
(
wÜk
, Ùx2_nic, 
»£t_sk
);

2169 ià(!
	`Ãtif_ruÂšg
(
pf
->
Ãtdev
))

2172 
	`¹Æ_lock
();

2173 
	`Ùx2_¡İ
(
pf
->
Ãtdev
);

2174 
pf
->
»£t_couÁ
++;

2175 
	`Ùx2_İ’
(
pf
->
Ãtdev
);

2176 
	`Ãtif_Œªs_upd©e
(
pf
->
Ãtdev
);

2177 
	`¹Æ_uÆock
();

2178 
	}
}

2180 
	$Ùx2_cÚfig_hw_rx_t¡amp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
)

2182 
msg_»q
 *
»q
;

2183 
”r
;

2185 ià(
pfvf
->
æags
 & 
OTX2_FLAG_RX_TSTAMP_ENABLED
 && 
’abË
)

2188 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

2189 ià(
’abË
)

2190 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_±p_rx_’abË
(&
pfvf
->
mbox
);

2192 
»q
 = 
	`Ùx2_mbox_®loc_msg_cgx_±p_rx_di§bË
(&
pfvf
->
mbox
);

2193 ià(!
»q
) {

2194 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2195  -
ENOMEM
;

2198 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

2199 ià(
”r
) {

2200 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2201  
”r
;

2204 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2205 ià(
’abË
)

2206 
pfvf
->
æags
 |ğ
OTX2_FLAG_RX_TSTAMP_ENABLED
;

2208 
pfvf
->
æags
 &ğ~
OTX2_FLAG_RX_TSTAMP_ENABLED
;

2210 
	}
}

2212 
	$Ùx2_cÚfig_hw_tx_t¡amp
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
)

2214 
msg_»q
 *
»q
;

2215 
”r
;

2217 ià(
pfvf
->
æags
 & 
OTX2_FLAG_TX_TSTAMP_ENABLED
 && 
’abË
)

2220 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

2221 ià(
’abË
)

2222 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_±p_tx_’abË
(&
pfvf
->
mbox
);

2224 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_±p_tx_di§bË
(&
pfvf
->
mbox
);

2225 ià(!
»q
) {

2226 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2227  -
ENOMEM
;

2230 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

2231 ià(
”r
) {

2232 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2233  
”r
;

2236 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

2237 ià(
’abË
)

2238 
pfvf
->
æags
 |ğ
OTX2_FLAG_TX_TSTAMP_ENABLED
;

2240 
pfvf
->
æags
 &ğ~
OTX2_FLAG_TX_TSTAMP_ENABLED
;

2242 
	}
}

2244 
	$Ùx2_cÚfig_hwt¡amp
(
Ãt_deviû
 *
Ãtdev
, 
iäeq
 *
iä
)

2246 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2247 
hwt¡amp_cÚfig
 
cÚfig
;

2249 ià(!
pfvf
->
±p
)

2250  -
ENODEV
;

2252 ià(
	`cİy_äom_u£r
(&
cÚfig
, 
iä
->
iä_d©a
, (config)))

2253  -
EFAULT
;

2256 ià(
cÚfig
.
æags
)

2257  -
EINVAL
;

2259 ià(
	`OTX2_IS_INTFMOD_SET
(
pfvf
->
‘htoŞ_æags
)) {

2260 
	`Ãtdev_šfo
(
Ãtdev
, "Can't support PTP HWimestamping when switch features‡reƒnabled\n");

2261  -
EOPNOTSUPP
;

2264 
cÚfig
.
tx_ty³
) {

2265 
HWTSTAMP_TX_OFF
:

2266 ià(
pfvf
->
æags
 & 
OTX2_FLAG_PTP_ONESTEP_SYNC
)

2267 
pfvf
->
æags
 &ğ~
OTX2_FLAG_PTP_ONESTEP_SYNC
;

2269 
	`ÿnûl_d–ayed_wÜk
(&
pfvf
->
±p
->
synù¡amp_wÜk
);

2270 
	`Ùx2_cÚfig_hw_tx_t¡amp
(
pfvf
, 
çl£
);

2272 
HWTSTAMP_TX_ONESTEP_SYNC
:

2273 ià(!
	`‹¡_b™
(
CN10K_PTP_ONESTEP
, &
pfvf
->
hw
.
ÿp_æag
))

2274  -
ERANGE
;

2275 
pfvf
->
æags
 |ğ
OTX2_FLAG_PTP_ONESTEP_SYNC
;

2276 
	`scheduË_d–ayed_wÜk
(&
pfvf
->
±p
->
synù¡amp_wÜk
,

2277 
	`m£cs_to_jiff›s
(500));

2279 
HWTSTAMP_TX_ON
:

2280 
	`Ùx2_cÚfig_hw_tx_t¡amp
(
pfvf
, 
Œue
);

2283  -
ERANGE
;

2286 
cÚfig
.
rx_f‹r
) {

2287 
HWTSTAMP_FILTER_NONE
:

2288 
	`Ùx2_cÚfig_hw_rx_t¡amp
(
pfvf
, 
çl£
);

2290 
HWTSTAMP_FILTER_ALL
:

2291 
HWTSTAMP_FILTER_SOME
:

2292 
HWTSTAMP_FILTER_PTP_V1_L4_EVENT
:

2293 
HWTSTAMP_FILTER_PTP_V1_L4_SYNC
:

2294 
HWTSTAMP_FILTER_PTP_V1_L4_DELAY_REQ
:

2295 
HWTSTAMP_FILTER_PTP_V2_L4_EVENT
:

2296 
HWTSTAMP_FILTER_PTP_V2_L4_SYNC
:

2297 
HWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ
:

2298 
HWTSTAMP_FILTER_PTP_V2_L2_EVENT
:

2299 
HWTSTAMP_FILTER_PTP_V2_L2_SYNC
:

2300 
HWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ
:

2301 
HWTSTAMP_FILTER_PTP_V2_EVENT
:

2302 
HWTSTAMP_FILTER_PTP_V2_SYNC
:

2303 
HWTSTAMP_FILTER_PTP_V2_DELAY_REQ
:

2304 
	`Ùx2_cÚfig_hw_rx_t¡amp
(
pfvf
, 
Œue
);

2305 
cÚfig
.
rx_f‹r
 = 
HWTSTAMP_FILTER_ALL
;

2308  -
ERANGE
;

2311  
	`cİy_to_u£r
(
iä
->
iä_d©a
, &
cÚfig
,

2312 (
cÚfig
)è? -
EFAULT
 : 0;

2314 
	}
}

2315 
EXPORT_SYMBOL
(
Ùx2_cÚfig_hwt¡amp
);

2317 
	$Ùx2_ioùl
(
Ãt_deviû
 *
Ãtdev
, 
iäeq
 *
»q
, 
cmd
)

2319 
cmd
) {

2320 
SIOCSHWTSTAMP
:

2321  
	`Ùx2_cÚfig_hwt¡amp
(
Ãtdev
, 
»q
);

2323  -
EOPNOTSUPP
;

2325 
	}
}

2326 
EXPORT_SYMBOL
(
Ùx2_ioùl
);

2328 
	$Ùx2_do_£t_vf_mac
(
Ùx2_nic
 *
pf
, 
vf
, cÚ¡ 
u8
 *
mac
)

2330 
Åc_š¡®l_æow_»q
 *
»q
;

2331 
”r
;

2333 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

2334 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pf
->
mbox
);

2335 ià(!
»q
) {

2336 
”r
 = -
ENOMEM
;

2337 
out
;

2340 
	`‘h”_addr_cİy
(
»q
->
·ck‘
.
dmac
, 
mac
);

2341 
	`‘h_brßdÿ¡_addr
((
u8
 *)&
»q
->
mask
.
dmac
);

2342 
»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_DMAC
);

2343 
»q
->
chªÃl
 = 
pf
->
hw
.
rx_chª_ba£
;

2344 
»q
->
štf
 = 
NIX_INTF_RX
;

2345 
»q
->
deçuÉ_ruË
 = 1;

2346 
»q
->
­³nd
 = 1;

2347 
»q
->
vf
 = vf + 1;

2348 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

2350 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2351 
out
:

2352 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

2353  
”r
;

2354 
	}
}

2356 
	$Ùx2_£t_vf_mac
(
Ãt_deviû
 *
Ãtdev
, 
vf
, 
u8
 *
mac
)

2358 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2359 
pci_dev
 *
pdev
 = 
pf
->pdev;

2360 
Ùx2_vf_cÚfig
 *
cÚfig
;

2361 
»t
;

2363 ià(!
	`Ãtif_ruÂšg
(
Ãtdev
))

2364  -
EAGAIN
;

2366 ià(
vf
 >ğ
pf
->
tÙ®_vfs
)

2367  -
EINVAL
;

2369 ià(!
	`is_v®id_‘h”_addr
(
mac
))

2370  -
EINVAL
;

2372 
cÚfig
 = &
pf
->
vf_cÚfigs
[
vf
];

2373 
	`‘h”_addr_cİy
(
cÚfig
->
mac
, mac);

2375 
»t
 = 
	`Ùx2_do_£t_vf_mac
(
pf
, 
vf
, 
mac
);

2376 ià(
»t
 == 0)

2377 
	`dev_šfo
(&
pdev
->
dev
,

2380  
»t
;

2381 
	}
}

2383 
	$Ùx2_do_£t_vf_vÏn
(
Ùx2_nic
 *
pf
, 
vf
, 
u16
 
vÏn
, 
u8
 
qos
,

2384 
__be16
 
´Ùo
)

2386 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
pf
->flow_cfg;

2387 
nix_vg_cÚfig_r¥
 *
vg_r¥
;

2388 
Åc_d–‘e_æow_»q
 *
d–_»q
;

2389 
nix_vg_cÚfig
 *
vg_»q
;

2390 
Åc_š¡®l_æow_»q
 *
»q
;

2391 
Ùx2_vf_cÚfig
 *
cÚfig
;

2392 
”r
 = 0;

2393 
u32
 
idx
;

2395 
cÚfig
 = &
pf
->
vf_cÚfigs
[
vf
];

2397 ià(!
vÏn
 && !
cÚfig
->vlan)

2398 
out
;

2400 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

2403 ià(
cÚfig
->
vÏn
) {

2404 
vg_»q
 = 
	`Ùx2_mbox_®loc_msg_nix_vg_cfg
(&
pf
->
mbox
);

2405 ià(!
vg_»q
) {

2406 
”r
 = -
ENOMEM
;

2407 
out
;

2409 
vg_»q
->
cfg_ty³
 = 0;

2410 
vg_»q
->
tx
.
ä“_vg0
 = 1;

2411 
vg_»q
->
tx
.
vg0_idx
 = 
cÚfig
->
tx_vg_idx
;

2413 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2414 ià(
”r
)

2415 
out
;

2418 ià(!
vÏn
 && 
cÚfig
->vlan) {

2420 
d–_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pf
->
mbox
);

2421 ià(!
d–_»q
) {

2422 
”r
 = -
ENOMEM
;

2423 
out
;

2425 
idx
 = ((
vf
 * 
OTX2_PER_VF_VLAN_FLOWS
è+ 
OTX2_VF_VLAN_RX_INDEX
);

2426 
d–_»q
->
’Œy
 =

2427 
æow_cfg
->
def_’t
[æow_cfg->
vf_vÏn_off£t
 + 
idx
];

2428 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2429 ià(
”r
)

2430 
out
;

2433 
d–_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
pf
->
mbox
);

2434 ià(!
d–_»q
) {

2435 
”r
 = -
ENOMEM
;

2436 
out
;

2438 
idx
 = ((
vf
 * 
OTX2_PER_VF_VLAN_FLOWS
è+ 
OTX2_VF_VLAN_TX_INDEX
);

2439 
d–_»q
->
’Œy
 =

2440 
æow_cfg
->
def_’t
[æow_cfg->
vf_vÏn_off£t
 + 
idx
];

2441 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2443 ià(!(
pf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
))

2444 
	`mem£t
(&
cÚfig
->
ruË
, 0, (config->rule));

2445 
out
;

2449 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pf
->
mbox
);

2450 ià(!
»q
) {

2451 
”r
 = -
ENOMEM
;

2452 
out
;

2455 
idx
 = ((
vf
 * 
OTX2_PER_VF_VLAN_FLOWS
è+ 
OTX2_VF_VLAN_RX_INDEX
);

2456 
»q
->
’Œy
 = 
æow_cfg
->
def_’t
[æow_cfg->
vf_vÏn_off£t
 + 
idx
];

2457 
»q
->
·ck‘
.
vÏn_tci
 = 
	`htÚs
(
vÏn
);

2458 
»q
->
mask
.
vÏn_tci
 = 
	`htÚs
(
VLAN_VID_MASK
);

2460 
	`‘h_brßdÿ¡_addr
((
u8
 *)&
»q
->
mask
.
dmac
);

2461 
»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_OUTER_VID
è| BIT_ULL(
NPC_DMAC
);

2462 
»q
->
chªÃl
 = 
pf
->
hw
.
rx_chª_ba£
;

2463 
»q
->
štf
 = 
NIX_INTF_RX
;

2464 
»q
->
vf
 = vf + 1;

2465 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

2466 
»q
->
vg0_v®id
 = 
Œue
;

2467 
»q
->
vg0_ty³
 = 
NIX_AF_LFX_RX_VTAG_TYPE7
;

2468 
»q
->
£t_úŒ
 = 1;

2470 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2471 ià(
”r
)

2472 
out
;

2475 
vg_»q
 = 
	`Ùx2_mbox_®loc_msg_nix_vg_cfg
(&
pf
->
mbox
);

2476 ià(!
vg_»q
) {

2477 
”r
 = -
ENOMEM
;

2478 
out
;

2482 
vg_»q
->
vg_size
 = 
VTAGSIZE_T4
;

2483 
vg_»q
->
cfg_ty³
 = 0;

2484 
vg_»q
->
tx
.
cfg_vg0
 = 1;

2485 
vg_»q
->
tx
.
vg0
 = (((
u64
)
	`Áohs
(
´Ùo
)è<< 16è| 
vÏn
;

2487 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2488 ià(
”r
)

2489 
out
;

2491 
vg_r¥
 = (
nix_vg_cÚfig_r¥
 *)
Ùx2_mbox_g‘_r¥


2492 (&
pf
->
mbox
.mbox, 0, &
vg_»q
->
hdr
);

2493 ià(
	`IS_ERR
(
vg_r¥
)) {

2494 
”r
 = 
	`PTR_ERR
(
vg_r¥
);

2495 
out
;

2497 
cÚfig
->
tx_vg_idx
 = 
vg_r¥
->
vg0_idx
;

2499 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
pf
->
mbox
);

2500 ià(!
»q
) {

2501 
”r
 = -
ENOMEM
;

2502 
out
;

2505 
	`‘h_z”o_addr
((
u8
 *)&
»q
->
mask
.
dmac
);

2506 
idx
 = ((
vf
 * 
OTX2_PER_VF_VLAN_FLOWS
è+ 
OTX2_VF_VLAN_TX_INDEX
);

2507 
»q
->
’Œy
 = 
æow_cfg
->
def_’t
[æow_cfg->
vf_vÏn_off£t
 + 
idx
];

2508 
»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_DMAC
);

2509 
»q
->
chªÃl
 = 
pf
->
hw
.
tx_chª_ba£
;

2510 
»q
->
štf
 = 
NIX_INTF_TX
;

2511 
»q
->
vf
 = vf + 1;

2512 
»q
->
İ
 = 
NIX_TX_ACTIONOP_UCAST_DEFAULT
;

2513 
»q
->
vg0_def
 = 
vg_r¥
->
vg0_idx
;

2514 
»q
->
vg0_İ
 = 
VTAG_INSERT
;

2515 
»q
->
£t_úŒ
 = 1;

2517 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2519 
cÚfig
->
ruË
.
vÏn
 = vlan;

2520 
cÚfig
->
ruË
.
´Ùo
 =…roto;

2521 
cÚfig
->
ruË
.
qos
 = qos;

2522 
out
:

2523 
cÚfig
->
vÏn
 = vlan;

2524 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

2525  
”r
;

2526 
	}
}

2528 
	$Ùx2_£t_vf_vÏn
(
Ãt_deviû
 *
Ãtdev
, 
vf
, 
u16
 
vÏn
, 
u8
 
qos
,

2529 
__be16
 
´Ùo
)

2531 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2532 
pci_dev
 *
pdev
 = 
pf
->pdev;

2534 ià(!
	`Ãtif_ruÂšg
(
Ãtdev
))

2535  -
EAGAIN
;

2537 ià(
vf
 >ğ
	`pci_num_vf
(
pdev
))

2538  -
EINVAL
;

2541 ià(
vÏn
 >ğ
VLAN_N_VID
 || 
qos
)

2542  -
EINVAL
;

2544 ià(
´Ùo
 !ğ
	`htÚs
(
ETH_P_8021Q
))

2545  -
EPROTONOSUPPORT
;

2547 ià(!(
pf
->
æags
 & 
OTX2_FLAG_VF_VLAN_SUPPORT
))

2548  -
EOPNOTSUPP
;

2550 ià(
pf
->
‘htoŞ_æags
 & 
OTX2_PRIV_FLAG_FDSA_HDR
)

2551  -
EOPNOTSUPP
;

2553  
	`Ùx2_do_£t_vf_vÏn
(
pf
, 
vf
, 
vÏn
, 
qos
, 
´Ùo
);

2554 
	}
}

2556 
	$Ùx2_g‘_vf_cÚfig
(
Ãt_deviû
 *
Ãtdev
, 
vf
,

2557 
iæa_vf_šfo
 *
ivi
)

2559 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2560 
pci_dev
 *
pdev
 = 
pf
->pdev;

2561 
Ùx2_vf_cÚfig
 *
cÚfig
;

2563 ià(!
	`Ãtif_ruÂšg
(
Ãtdev
))

2564  -
EAGAIN
;

2566 ià(
vf
 >ğ
	`pci_num_vf
(
pdev
))

2567  -
EINVAL
;

2569 
cÚfig
 = &
pf
->
vf_cÚfigs
[
vf
];

2570 
ivi
->
vf
 = vf;

2571 
	`‘h”_addr_cİy
(
ivi
->
mac
, 
cÚfig
->mac);

2572 
ivi
->
vÏn
 = 
cÚfig
->vlan;

2573 
ivi
->
Œu¡ed
 = 
cÚfig
->trusted;

2576 
	}
}

2578 
	$Ùx2_xdp_xm™_tx
(
Ùx2_nic
 *
pf
, 
xdp_äame
 *
xdpf
,

2579 
qidx
)

2581 
·ge
 *page;

2582 
u64
 
dma_addr
;

2583 
”r
 = 0;

2585 
dma_addr
 = 
	`Ùx2_dma_m­_·ge
(
pf
, 
	`vœt_to_·ge
(
xdpf
->
d©a
),

2586 
	`off£t_š_·ge
(
xdpf
->
d©a
), xdpf->
Ën
,

2587 
DMA_TO_DEVICE
);

2588 ià(
	`dma_m­pšg_”rÜ
(
pf
->
dev
, 
dma_addr
))

2589  -
ENOMEM
;

2591 
”r
 = 
	`Ùx2_xdp_sq_­³nd_pkt
(
pf
, 
dma_addr
, 
xdpf
->
Ën
, 
qidx
);

2592 ià(!
”r
) {

2593 
	`Ùx2_dma_unm­_·ge
(
pf
, 
dma_addr
, 
xdpf
->
Ën
, 
DMA_TO_DEVICE
);

2594 
·ge
 = 
	`vœt_to_·ge
(
xdpf
->
d©a
);

2595 
	`put_·ge
(
·ge
);

2596  -
ENOMEM
;

2599 
	}
}

2601 
	$Ùx2_xdp_xm™
(
Ãt_deviû
 *
Ãtdev
, 
n
,

2602 
xdp_äame
 **
äames
, 
u32
 
æags
)

2604 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2605 
qidx
 = 
	`smp_´oûssÜ_id
();

2606 
Ùx2_¢d_queue
 *
sq
;

2607 
drİs
 = 0, 
i
;

2609 ià(!
	`Ãtif_ruÂšg
(
Ãtdev
))

2610  -
ENETDOWN
;

2612 
qidx
 +ğ
pf
->
hw
.
tx_queues
;

2613 
sq
 = 
pf
->
xdp_´og
 ? &pf->
q£t
.sq[
qidx
] : 
NULL
;

2616 ià(
	`uÆik–y
(!
sq
))

2617  -
ENXIO
;

2619 ià(
	`uÆik–y
(
æags
 & ~
XDP_XMIT_FLAGS_MASK
))

2620  -
EINVAL
;

2622 
i
 = 0; i < 
n
; i++) {

2623 
xdp_äame
 *
xdpf
 = 
äames
[
i
];

2624 
”r
;

2626 
”r
 = 
	`Ùx2_xdp_xm™_tx
(
pf
, 
xdpf
, 
qidx
);

2627 ià(
”r
)

2628 
drİs
++;

2630  
n
 - 
drİs
;

2631 
	}
}

2633 
	$Ùx2_xdp_£tup
(
Ùx2_nic
 *
pf
, 
bpf_´og
 *
´og
)

2635 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
pf
->
Ãtdev
);

2636 
bpf_´og
 *
Şd_´og
;

2637 
”r
 = 0;

2639 ià(
if_up
)

2640 
	`Ùx2_¡İ
(
pf
->
Ãtdev
);

2642 
Şd_´og
 = 
	`xchg
(&
pf
->
xdp_´og
, 
´og
);

2644 ià(
Şd_´og
)

2645 
	`bpf_´og_put
(
Şd_´og
);

2647 ià(
pf
->
xdp_´og
) {

2648 
pf
->
xdp_´og
 = 
	`bpf_´og_add
Õf->xdp_´og,…f->
hw
.
rx_queues
 - 1);

2649 ià(
	`IS_ERR
(
pf
->
xdp_´og
))

2650 
”r
 = 
	`PTR_ERR
(
pf
->
xdp_´og
);

2655 ià(
pf
->
xdp_´og
)

2656 
pf
->
hw
.
xdp_queues
 =…f->hw.
rx_queues
;

2658 
pf
->
hw
.
xdp_queues
 = 0;

2660 
pf
->
hw
.
tÙ_tx_queues
 +ğpf->hw.
xdp_queues
;

2662 ià(
if_up
)

2663 
	`Ùx2_İ’
(
pf
->
Ãtdev
);

2665  
”r
;

2666 
	}
}

2668 
	$Ùx2_xdp
(
Ãt_deviû
 *
Ãtdev
, 
Ãtdev_bpf
 *
xdp
)

2670 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2672 
xdp
->
commªd
) {

2673 
XDP_SETUP_PROG
:

2674  
	`Ùx2_xdp_£tup
(
pf
, 
xdp
->
´og
);

2675 
XDP_QUERY_PROG
:

2676 
xdp
->
´og_id
 = 
pf
->
xdp_´og
 ?…f->xdp_´og->
aux
->
id
 : 0;

2678 
XDP_SETUP_PROG_HW
:

2679  
	`Ùx2_£tup_hw_xdp
(
Ãtdev
, 
xdp
);

2681 
BPF_OFFLOAD_MAP_ALLOC
:

2682  
	`Ùx2_bpf_m­_®loc
(
Ãtdev
, 
xdp
->
offm­
);

2684 
BPF_OFFLOAD_MAP_FREE
:

2685 
	`Ùx2_bpf_m­_ä“
(
xdp
->
offm­
);

2689  -
EINVAL
;

2691 
	}
}

2693 
	$Ùx2_£t_vf_³rmissiÚs
(
Ùx2_nic
 *
pf
, 
vf
,

2694 
»q_³rm
)

2696 
£t_vf_³rm
 *
»q
;

2697 
rc
;

2699 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

2700 
»q
 = 
	`Ùx2_mbox_®loc_msg_£t_vf_³rm
(&
pf
->
mbox
);

2701 ià(!
»q
) {

2702 
rc
 = -
ENOMEM
;

2703 
out
;

2707 ià(
»q_³rm
 =ğ
OTX2_RESET_VF_PERM
) {

2708 
»q
->
æags
 |ğ
RESET_VF_PERM
;

2709 } ià(
»q_³rm
 =ğ
OTX2_TRUSTED_VF
) {

2710 ià(
pf
->
vf_cÚfigs
[
vf
].
Œu¡ed
)

2711 
»q
->
æags
 |ğ
VF_TRUSTED
;

2714 
»q
->
vf
 = vf;

2715 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

2716 
out
:

2717 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

2718  
rc
;

2719 
	}
}

2721 
	$Ùx2_ndo_£t_vf_Œu¡
(
Ãt_deviû
 *
Ãtdev
, 
vf
,

2722 
boŞ
 
’abË
)

2724 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2725 
pci_dev
 *
pdev
 = 
pf
->pdev;

2726 
rc
;

2728 ià(
vf
 >ğ
	`pci_num_vf
(
pdev
))

2729  -
EINVAL
;

2731 ià(
pf
->
vf_cÚfigs
[
vf
].
Œu¡ed
 =ğ
’abË
)

2734 
pf
->
vf_cÚfigs
[
vf
].
Œu¡ed
 = 
’abË
;

2735 
rc
 = 
	`Ùx2_£t_vf_³rmissiÚs
(
pf
, 
vf
, 
OTX2_TRUSTED_VF
);

2737 ià(
rc
)

2738 
pf
->
vf_cÚfigs
[
vf
].
Œu¡ed
 = !
’abË
;

2740 
	`Ãtdev_šfo
(
pf
->
Ãtdev
, "VF %d is %strusted\n",

2741 
vf
, 
’abË
 ? "" : "not ");

2742  
rc
;

2743 
	}
}

2745 cÚ¡ 
Ãt_deviû_İs
 
	gÙx2_Ãtdev_İs
 = {

2746 .
ndo_İ’
 = 
Ùx2_İ’
,

2747 .
	gndo_¡İ
 = 
Ùx2_¡İ
,

2748 .
	gndo_¡¬t_xm™
 = 
Ùx2_xm™
,

2749 .
	gndo_£Ëù_queue
 = 
Ùx2_£Ëù_queue
,

2750 .
	gndo_fix_ã©u»s
 = 
Ùx2_fix_ã©u»s
,

2751 .
	gndo_£t_mac_add»ss
 = 
Ùx2_£t_mac_add»ss
,

2752 .
	gndo_chªge_mtu
 = 
Ùx2_chªge_mtu
,

2753 .
	gndo_£t_rx_mode
 = 
Ùx2_£t_rx_mode
,

2754 .
	gndo_£t_ã©u»s
 = 
Ùx2_£t_ã©u»s
,

2755 .
	gndo_tx_timeout
 = 
Ùx2_tx_timeout
,

2756 .
	gndo_g‘_¡©s64
 = 
Ùx2_g‘_¡©s64
,

2757 .
	gndo_do_ioùl
 = 
Ùx2_ioùl
,

2758 .
	gndo_£t_vf_mac
 = 
Ùx2_£t_vf_mac
,

2759 .
	gndo_£t_vf_vÏn
 = 
Ùx2_£t_vf_vÏn
,

2760 .
	gndo_g‘_vf_cÚfig
 = 
Ùx2_g‘_vf_cÚfig
,

2761 .
	gndo_bpf
 = 
Ùx2_xdp
,

2762 .
	gndo_xdp_xm™
 = 
Ùx2_xdp_xm™
,

2763 .
	gndo_£tup_tc
 = 
Ùx2_£tup_tc
,

2764 .
	gndo_£t_vf_Œu¡
 = 
Ùx2_ndo_£t_vf_Œu¡
,

2767 
	$Ùx2_wq_š™
(
Ùx2_nic
 *
pf
)

2769 
pf
->
Ùx2_wq
 = 
	`ü—‹_sšgËth»ad_wÜkqueue
("otx2_wq");

2770 ià(!
pf
->
Ùx2_wq
)

2771  -
ENOMEM
;

2773 
	`INIT_WORK
(&
pf
->
rx_mode_wÜk
, 
Ùx2_rx_mode_wrk_hªdËr
);

2774 
	`INIT_WORK
(&
pf
->
»£t_sk
, 
Ùx2_»£t_sk
);

2776 
	}
}

2778 
	$Ùx2_check_pf_u§bË
(
Ùx2_nic
 *
nic
)

2780 
u64
 
»v
;

2782 
»v
 = 
	`Ùx2_»ad64
(
nic
, 
	`RVU_PF_BLOCK_ADDRX_DISC
(
BLKADDR_RVUM
));

2783 
»v
 = (rev >> 12) & 0xFF;

2788 ià(!
»v
) {

2789 
	`dev_w¬n
(
nic
->
dev
,

2791  -
EPROBE_DEFER
;

2794 
	}
}

2796 
	$Ùx2_»®loc_msix_veùÜs
(
Ùx2_nic
 *
pf
)

2798 
Ùx2_hw
 *
hw
 = &
pf
->hw;

2799 
num_vec
, 
”r
;

2804 
num_vec
 = 
hw
->
nix_msixoff
;

2805 
num_vec
 +ğ
NIX_LF_CINT_VEC_START
 + 
hw
->
max_queues
;

2807 
	`Ùx2_di§bË_mbox_šŒ
(
pf
);

2808 
	`pci_ä“_œq_veùÜs
(
hw
->
pdev
);

2809 
”r
 = 
	`pci_®loc_œq_veùÜs
(
hw
->
pdev
, 
num_vec
,‚um_vec, 
PCI_IRQ_MSIX
);

2810 ià(
”r
 < 0) {

2811 
	`dev_”r
(
pf
->
dev
, "%s: Failedo„ealloc %d IRQ vectors\n",

2812 
__func__
, 
num_vec
);

2813  
”r
;

2816  
	`Ùx2_»gi¡”_mbox_šŒ
(
pf
, 
çl£
);

2817 
	}
}

2819 
	$Ùx2_¤iov_vfcfg_š™
(
Ùx2_nic
 *
pf
)

2821 
i
;

2823 
pf
->
vf_cÚfigs
 = 
	`devm_kÿÎoc
Õf->
dev
,…f->
tÙ®_vfs
,

2824 (
Ùx2_vf_cÚfig
),

2825 
GFP_KERNEL
);

2826 ià(!
pf
->
vf_cÚfigs
)

2827  -
ENOMEM
;

2829 
i
 = 0; i < 
pf
->
tÙ®_vfs
; i++) {

2830 
pf
->
vf_cÚfigs
[
i
].pf =…f;

2831 
pf
->
vf_cÚfigs
[
i
].
štf_down
 = 
Œue
;

2832 
pf
->
vf_cÚfigs
[
i
].
Œu¡ed
 = 
çl£
;

2833 
	`INIT_DELAYED_WORK
(&
pf
->
vf_cÚfigs
[
i
].
lšk_ev’t_wÜk
,

2834 
Ùx2_vf_lšk_ev’t_sk
);

2835 
	`INIT_DELAYED_WORK
(&
pf
->
vf_cÚfigs
[
i
].
±p_šfo_wÜk
,

2836 
Ùx2_vf_±p_šfo_sk
);

2840 
	}
}

2842 
	$Ùx2_¤iov_vfcfg_ş—nup
(
Ùx2_nic
 *
pf
)

2844 
i
;

2846 ià(!
pf
->
vf_cÚfigs
)

2849 
i
 = 0; i < 
pf
->
tÙ®_vfs
; i++) {

2850 
	`ÿnûl_d–ayed_wÜk_sync
(&
pf
->
vf_cÚfigs
[
i
].
lšk_ev’t_wÜk
);

2851 
	`ÿnûl_d–ayed_wÜk_sync
(&
pf
->
vf_cÚfigs
[
i
].
±p_šfo_wÜk
);

2852 
	`Ùx2_£t_vf_³rmissiÚs
(
pf
, 
i
, 
OTX2_RESET_VF_PERM
);

2854 
	}
}

2856 
	$Ùx2_´obe
(
pci_dev
 *
pdev
, cÚ¡ 
pci_deviû_id
 *
id
)

2858 
deviû
 *
dev
 = &
pdev
->dev;

2859 
”r
, 
qcouÁ
, 
qos_txqs
;

2860 
Ãt_deviû
 *
Ãtdev
;

2861 
Ùx2_nic
 *
pf
;

2862 
Ùx2_hw
 *
hw
;

2863 
num_vec
;

2865 
”r
 = 
	`pcim_’abË_deviû
(
pdev
);

2866 ià(
”r
) {

2867 
	`dev_”r
(
dev
, "Failedoƒnable PCI device\n");

2868  
”r
;

2871 
”r
 = 
	`pci_»que¡_»giÚs
(
pdev
, 
DRV_NAME
);

2872 ià(
”r
) {

2873 
	`dev_”r
(
dev
, "PCI„eque¡„egiÚ çed 0x%x\n", 
”r
);

2874  
”r
;

2877 
”r
 = 
	`dma_£t_mask_ªd_coh”’t
(
dev
, 
	`DMA_BIT_MASK
(48));

2878 ià(
”r
) {

2879 
	`dev_”r
(
dev
, "DMA mask config failed,‡bort\n");

2880 
”r_»Ëa£_»giÚs
;

2883 
	`pci_£t_ma¡”
(
pdev
);

2886 
qcouÁ
 = 
	`mš_t
(, 
	`num_Úlše_ıus
(), 
OTX2_MAX_CQ_CNT
);

2887 
qos_txqs
 = 
	`mš_t
(, 
qcouÁ
, 
OTX2_QOS_MAX_LEAF_NODES
);

2889 
Ãtdev
 = 
	`®loc_‘h”dev_mqs
((*
pf
), 
qcouÁ
 + 
qos_txqs
, qcount);

2890 ià(!
Ãtdev
) {

2891 
”r
 = -
ENOMEM
;

2892 
”r_»Ëa£_»giÚs
;

2895 
	`pci_£t_drvd©a
(
pdev
, 
Ãtdev
);

2896 
	`SET_NETDEV_DEV
(
Ãtdev
, &
pdev
->
dev
);

2897 
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

2898 
pf
->
Ãtdev
 =‚etdev;

2899 
pf
->
pdev
 =…dev;

2900 
pf
->
dev
 = dev;

2901 
pf
->
tÙ®_vfs
 = 
	`pci_¤iov_g‘_tÙ®vfs
(
pdev
);

2902 
pf
->
æags
 |ğ
OTX2_FLAG_INTF_DOWN
;

2903 
	`INIT_LIST_HEAD
(&
pf
->
xdp_hw
.
lm­s
);

2905 
hw
 = &
pf
->hw;

2906 
hw
->
pdev
 =…dev;

2907 
hw
->
rx_queues
 = 
qcouÁ
;

2908 
hw
->
tx_queues
 = 
qcouÁ
;

2909 
hw
->
tÙ_tx_queues
 = 
qcouÁ
;

2910 
hw
->
max_queues
 = 
qcouÁ
;

2911 
hw
->
rbuf_fixed_size
 = 
OTX2_DEFAULT_RBUF_LEN
;

2913 
hw
->
xqe_size
 = 128;

2915 
num_vec
 = 
	`pci_msix_vec_couÁ
(
pdev
);

2916 
hw
->
œq_Çme
 = 
	`devm_km®loc_¬¿y
(&hw->
pdev
->
dev
, 
num_vec
, 
NAME_SIZE
,

2917 
GFP_KERNEL
);

2918 ià(!
hw
->
œq_Çme
) {

2919 
”r
 = -
ENOMEM
;

2920 
”r_ä“_Ãtdev
;

2923 
hw
->
affš™y_mask
 = 
	`devm_kÿÎoc
(&hw->
pdev
->
dev
, 
num_vec
,

2924 (
ıumask_v¬_t
), 
GFP_KERNEL
);

2925 ià(!
hw
->
affš™y_mask
) {

2926 
”r
 = -
ENOMEM
;

2927 
”r_ä“_Ãtdev
;

2931 
pf
->
»g_ba£
 = 
	`pcim_iom­
(
pdev
, 
PCI_CFG_REG_BAR_NUM
, 0);

2932 ià(!
pf
->
»g_ba£
) {

2933 
	`dev_”r
(
dev
, "Unableo map…hysical function CSRs,‡borting\n");

2934 
”r
 = -
ENOMEM
;

2935 
”r_ä“_Ãtdev
;

2938 
”r
 = 
	`Ùx2_check_pf_u§bË
(
pf
);

2939 ià(
”r
)

2940 
”r_ä“_Ãtdev
;

2942 
”r
 = 
	`pci_®loc_œq_veùÜs
(
hw
->
pdev
, 
RVU_PF_INT_VEC_CNT
,

2943 
RVU_PF_INT_VEC_CNT
, 
PCI_IRQ_MSIX
);

2944 ià(
”r
 < 0) {

2945 
	`dev_”r
(
dev
, "%s: Failedo‡lloc %d IRQ vectors\n",

2946 
__func__
, 
num_vec
);

2947 
”r_ä“_Ãtdev
;

2950 
	`Ùx2_£tup_dev_hw_£‰šgs
(
pf
);

2953 
”r
 = 
	`Ùx2_pçf_mbox_š™
(
pf
);

2954 ià(
”r
)

2955 
”r_ä“_œq_veùÜs
;

2958 
”r
 = 
	`Ùx2_»gi¡”_mbox_šŒ
(
pf
, 
Œue
);

2959 ià(
”r
)

2960 
”r_mbox_de¡roy
;

2965 
”r
 = 
	`Ùx2_©ch_Åa_nix
(
pf
);

2966 ià(
”r
)

2967 
”r_di§bË_mbox_šŒ
;

2969 
”r
 = 
	`Ùx2_»®loc_msix_veùÜs
(
pf
);

2970 ià(
”r
)

2971 
”r_mbox_de¡roy
;

2973 
”r
 = 
	`Ùx2_£t_»®_num_queues
(
Ãtdev
, 
hw
->
tx_queues
, hw->
rx_queues
);

2974 ià(
”r
)

2975 
”r_d‘ach_r¤c
;

2977 
”r
 = 
	`ú10k_lmt¡_š™
(
pf
);

2978 ià(
”r
)

2979 
”r_d‘ach_r¤c
;

2982 
	`Ùx2_g‘_mac_äom_af
(
Ãtdev
);

2985 
	`Ùx2_±p_š™
(
pf
);

2998 
pf
->
iommu_domaš
 = 
	`iommu_g‘_domaš_fÜ_dev
(
dev
);

2999 ià(
pf
->
iommu_domaš
)

3000 
pf
->
iommu_domaš_ty³
 =

3001 ((
iommu_domaš
 *)
pf
->iommu_domaš)->
ty³
;

3003 
Ãtdev
->
hw_ã©u»s
 = (
NETIF_F_RXCSUM
 | 
NETIF_F_IP_CSUM
 |

3004 
NETIF_F_IPV6_CSUM
 | 
NETIF_F_RXHASH
 |

3005 
NETIF_F_SG
 | 
NETIF_F_TSO
 | 
NETIF_F_TSO6
 |

3006 
NETIF_F_GSO_UDP_L4
);

3007 
Ãtdev
->
ã©u»s
 |ğÃtdev->
hw_ã©u»s
;

3009 
”r
 = 
	`Ùx2_mÿm_æow_š™
(
pf
);

3010 ià(
”r
)

3011 
”r_±p_de¡roy
;

3013 ià(
pf
->
æags
 & 
OTX2_FLAG_NTUPLE_SUPPORT
)

3014 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_NTUPLE
;

3016 ià(
pf
->
æags
 & 
OTX2_FLAG_UCAST_FLTR_SUPPORT
)

3017 
Ãtdev
->
´iv_æags
 |ğ
IFF_UNICAST_FLT
;

3020 
Ãtdev
->
vÏn_ã©u»s
 |ğÃtdev->
ã©u»s
;

3021 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_HW_VLAN_CTAG_TX
 |

3022 
NETIF_F_HW_VLAN_STAG_TX
;

3023 ià(
pf
->
æags
 & 
OTX2_FLAG_RX_VLAN_SUPPORT
)

3024 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_HW_VLAN_CTAG_RX
 |

3025 
NETIF_F_HW_VLAN_STAG_RX
;

3026 
Ãtdev
->
ã©u»s
 |ğÃtdev->
hw_ã©u»s
;

3029 ià(
pf
->
æags
 & 
OTX2_FLAG_TC_FLOWER_SUPPORT
)

3030 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_HW_TC
;

3032 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_LOOPBACK
 | 
NETIF_F_RXALL
;

3034 
Ãtdev
->
gso_max_£gs
 = 
OTX2_MAX_GSO_SEGS
;

3035 
Ãtdev
->
w©chdog_timeo
 =‚etdev->watchdog_timeo ?

3036 
Ãtdev
->
w©chdog_timeo
 : 
OTX2_TX_TIMEOUT
;

3038 
Ãtdev
->
Ãtdev_İs
 = &
Ùx2_Ãtdev_İs
;

3040 
Ãtdev
->
mš_mtu
 = 
OTX2_MIN_MTU
;

3041 
Ãtdev
->
max_mtu
 = 
	`Ùx2_g‘_max_mtu
(
pf
);

3043 
”r
 = 
	`»gi¡”_Ãtdev
(
Ãtdev
);

3044 ià(
”r
) {

3045 
	`dev_”r
(
dev
, "Failedo„egister‚etdevice\n");

3046 
”r_d–_mÿm_’Œ›s
;

3049 
”r
 = 
	`Ùx2_xdp_ofæßd_dev_»gi¡”
(
Ãtdev
);

3050 ià(
”r
) {

3051 
	`dev_”r
(
dev
, "Failedo„egister offload‚etdevice\n");

3052 
”r_d–_mÿm_’Œ›s
;

3055 
”r
 = 
	`Ùx2_wq_š™
(
pf
);

3056 ià(
”r
)

3057 
”r_uÄeg_Ãtdev
;

3059 
	`Ùx2_£t_‘htoŞ_İs
(
Ãtdev
);

3061 
”r
 = 
	`Ùx2_š™_tc
(
pf
);

3062 ià(
”r
)

3063 
”r_mÿm_æow_d–
;

3065 
”r
 = 
	`Ùx2_»gi¡”_dl
(
pf
);

3066 ià(
”r
)

3067 
”r_mÿm_æow_d–
;

3070 
”r
 = 
	`Ùx2_¤iov_vfcfg_š™
(
pf
);

3071 ià(
”r
)

3072 
”r_pf_¤iov_š™
;

3075 
	`Ùx2_cgx_cÚfig_lškev’ts
(
pf
, 
Œue
);

3078 
pf
->
‘htoŞ_æags
 |ğ
OTX2_PRIV_FLAG_DEF_MODE
;

3080 #ifdeà
CONFIG_DCB


3081 
”r
 = 
	`Ùx2_dcbÆ_£t_İs
(
Ãtdev
);

3082 ià(
”r
)

3083 
”r_pf_¤iov_š™
;

3086 
	`Ùx2_qos_sq_£tup
(
pf
, 
qos_txqs
);

3090 
”r_pf_¤iov_š™
:

3091 
	`Ùx2_shutdown_tc
(
pf
);

3092 
”r_mÿm_æow_d–
:

3093 
	`Ùx2_mÿm_æow_d–
(
pf
);

3094 
”r_uÄeg_Ãtdev
:

3095 
	`uÄegi¡”_Ãtdev
(
Ãtdev
);

3096 
”r_d–_mÿm_’Œ›s
:

3097 
	`Ùx2_mÿm_æow_d–
(
pf
);

3098 
”r_±p_de¡roy
:

3099 
	`Ùx2_±p_de¡roy
(
pf
);

3100 
”r_d‘ach_r¤c
:

3101 ià(
pf
->
hw
.
lmt_šfo
)

3102 
	`ä“_³rıu
(
pf
->
hw
.
lmt_šfo
);

3103 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
pf
->
hw
.
ÿp_æag
))

3104 
	`qmem_ä“
(
pf
->
dev
,…f->
dync_lmt
);

3105 
	`Ùx2_d‘ach_»sourûs
(&
pf
->
mbox
);

3106 
”r_di§bË_mbox_šŒ
:

3107 
	`Ùx2_di§bË_mbox_šŒ
(
pf
);

3108 
”r_mbox_de¡roy
:

3109 
	`Ùx2_pçf_mbox_de¡roy
(
pf
);

3110 
	`Ùx2_pfvf_mbox_de¡roy
(
pf
);

3111 
”r_ä“_œq_veùÜs
:

3112 
	`pci_ä“_œq_veùÜs
(
hw
->
pdev
);

3113 
”r_ä“_Ãtdev
:

3114 
	`pci_£t_drvd©a
(
pdev
, 
NULL
);

3115 
	`ä“_Ãtdev
(
Ãtdev
);

3116 
”r_»Ëa£_»giÚs
:

3117 
	`pci_»Ëa£_»giÚs
(
pdev
);

3118  
”r
;

3119 
	}
}

3121 
	$Ùx2_vf_lšk_ev’t_sk
(
wÜk_¡ruù
 *
wÜk
)

3123 
Ùx2_vf_cÚfig
 *
cÚfig
;

3124 
cgx_lšk_šfo_msg
 *
»q
;

3125 
mbox_msghdr
 *
msghdr
;

3126 
Ùx2_nic
 *
pf
;

3127 
vf_idx
;

3129 
cÚfig
 = 
	`cÚš”_of
(
wÜk
, 
Ùx2_vf_cÚfig
,

3130 
lšk_ev’t_wÜk
.
wÜk
);

3131 
vf_idx
 = 
cÚfig
 - cÚfig->
pf
->
vf_cÚfigs
;

3132 
pf
 = 
cÚfig
->pf;

3134 
msghdr
 = 
	`Ùx2_mbox_®loc_msg_r¥
(&
pf
->
mbox_pfvf
[0].
mbox_up
, 
vf_idx
,

3135 (*
»q
), (
msg_r¥
));

3136 ià(!
msghdr
) {

3137 
	`dev_”r
(
pf
->
dev
, "FaedØü—‹ VF%d†škƒv’t\n", 
vf_idx
);

3141 
»q
 = (
cgx_lšk_šfo_msg
 *)
msghdr
;

3142 
»q
->
hdr
.
id
 = 
MBOX_MSG_CGX_LINK_EVENT
;

3143 
»q
->
hdr
.
sig
 = 
OTX2_MBOX_REQ_SIG
;

3144 
	`memıy
(&
»q
->
lšk_šfo
, &
pf
->
lšfo
, (req->link_info));

3146 
	`Ùx2_sync_mbox_up_msg
(&
pf
->
mbox_pfvf
[0], 
vf_idx
);

3147 
	}
}

3149 
	$Ùx2_vf_±p_šfo_sk
(
wÜk_¡ruù
 *
wÜk
)

3151 
cgx_±p_rx_šfo_msg
 *
»q
;

3152 
Ùx2_vf_cÚfig
 *
cÚfig
;

3153 
mbox_msghdr
 *
msghdr
;

3154 
Ùx2_nic
 *
pf
;

3155 
vf_idx
;

3157 
cÚfig
 = 
	`cÚš”_of
(
wÜk
, 
Ùx2_vf_cÚfig
,

3158 
±p_šfo_wÜk
.
wÜk
);

3159 
vf_idx
 = 
cÚfig
 - cÚfig->
pf
->
vf_cÚfigs
;

3160 
pf
 = 
cÚfig
->pf;

3162 
msghdr
 = 
	`Ùx2_mbox_®loc_msg_r¥
(&
pf
->
mbox_pfvf
[0].
mbox_up
, 
vf_idx
,

3163 (*
»q
), (
msg_r¥
));

3164 ià(!
msghdr
) {

3165 
	`dev_”r
(
pf
->
dev
, "FaedØü—‹ VF%d†škƒv’t\n", 
vf_idx
);

3169 
»q
 = (
cgx_±p_rx_šfo_msg
 *)
msghdr
;

3170 
»q
->
hdr
.
id
 = 
MBOX_MSG_CGX_PTP_RX_INFO
;

3171 
»q
->
hdr
.
sig
 = 
OTX2_MBOX_REQ_SIG
;

3172 
»q
->
±p_’
 = 
pf
->
±p
->ptp_en;

3174 
	`Ùx2_sync_mbox_up_msg
(&
pf
->
mbox_pfvf
[0], 
vf_idx
);

3175 
	}
}

3177 
	$Ùx2_¤iov_’abË
(
pci_dev
 *
pdev
, 
numvfs
)

3179 
Ãt_deviû
 *
Ãtdev
 = 
	`pci_g‘_drvd©a
(
pdev
);

3180 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

3181 
»t
;

3184 
»t
 = 
	`Ùx2_pfvf_mbox_š™
(
pf
, 
numvfs
);

3185 ià(
»t
)

3186  
»t
;

3188 
»t
 = 
	`Ùx2_»gi¡”_pfvf_mbox_šŒ
(
pf
, 
numvfs
);

3189 ià(
»t
)

3190 
ä“_mbox
;

3192 
»t
 = 
	`Ùx2_pf_ær_š™
(
pf
, 
numvfs
);

3193 ià(
»t
)

3194 
ä“_šŒ
;

3196 
»t
 = 
	`Ùx2_»gi¡”_ær_me_šŒ
(
pf
, 
numvfs
);

3197 ià(
»t
)

3198 
ä“_ær
;

3200 
»t
 = 
	`pci_’abË_¤iov
(
pdev
, 
numvfs
);

3201 ià(
»t
)

3202 
ä“_ær_šŒ
;

3204  
numvfs
;

3205 
ä“_ær_šŒ
:

3206 
	`Ùx2_di§bË_ær_me_šŒ
(
pf
);

3207 
ä“_ær
:

3208 
	`Ùx2_ær_wq_de¡roy
(
pf
);

3209 
ä“_šŒ
:

3210 
	`Ùx2_di§bË_pfvf_mbox_šŒ
(
pf
, 
numvfs
);

3211 
ä“_mbox
:

3212 
	`Ùx2_pfvf_mbox_de¡roy
(
pf
);

3213  
»t
;

3214 
	}
}

3216 
	$Ùx2_¤iov_di§bË
(
pci_dev
 *
pdev
)

3218 
Ãt_deviû
 *
Ãtdev
 = 
	`pci_g‘_drvd©a
(
pdev
);

3219 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

3220 
numvfs
 = 
	`pci_num_vf
(
pdev
);

3222 ià(!
numvfs
)

3225 
	`pci_di§bË_¤iov
(
pdev
);

3227 
	`Ùx2_di§bË_ær_me_šŒ
(
pf
);

3228 
	`Ùx2_ær_wq_de¡roy
(
pf
);

3229 
	`Ùx2_di§bË_pfvf_mbox_šŒ
(
pf
, 
numvfs
);

3230 
	`Ùx2_pfvf_mbox_de¡roy
(
pf
);

3233 
	}
}

3235 
	$Ùx2_¤iov_cÚfigu»
(
pci_dev
 *
pdev
, 
numvfs
)

3237 ià(
numvfs
 == 0)

3238  
	`Ùx2_¤iov_di§bË
(
pdev
);

3240  
	`Ùx2_¤iov_’abË
(
pdev
, 
numvfs
);

3241 
	}
}

3243 
	$Ùx2_»move
(
pci_dev
 *
pdev
)

3245 
Ãt_deviû
 *
Ãtdev
 = 
	`pci_g‘_drvd©a
(
pdev
);

3246 
Ùx2_nic
 *
pf
;

3248 ià(!
Ãtdev
)

3251 
pf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

3252 
pf
->
æags
 |ğ
OTX2_FLAG_PF_SHUTDOWN
;

3254 ià(
pf
->
æags
 & 
OTX2_FLAG_TX_TSTAMP_ENABLED
)

3255 
	`Ùx2_cÚfig_hw_tx_t¡amp
(
pf
, 
çl£
);

3256 ià(
pf
->
æags
 & 
OTX2_FLAG_RX_TSTAMP_ENABLED
)

3257 
	`Ùx2_cÚfig_hw_rx_t¡amp
(
pf
, 
çl£
);

3260 ià(
pf
->
æags
 & 
OTX2_FLAG_RX_PAUSE_ENABLED
 ||

3261 (
pf
->
æags
 & 
OTX2_FLAG_TX_PAUSE_ENABLED
)) {

3262 
pf
->
æags
 &ğ~
OTX2_FLAG_RX_PAUSE_ENABLED
;

3263 
pf
->
æags
 &ğ~
OTX2_FLAG_TX_PAUSE_ENABLED
;

3264 
	`Ùx2_cÚfig_·u£_äm
(
pf
);

3267 #ifdeà
CONFIG_DCB


3269 ià(
pf
->
pfc_’
) {

3270 
pf
->
pfc_’
 = 0;

3271 
	`Ùx2_cÚfig_´iÜ™y_æow_ù¾
(
pf
);

3274 
	`Ùx2_£t_Åc_·r£_mode
(
pf
, 
Œue
);

3277 
	`Ùx2_cgx_cÚfig_lškev’ts
(
pf
, 
çl£
);

3279 
	`Ùx2_uÄegi¡”_dl
(
pf
);

3280 
	`Ùx2_xdp_ofæßd_dev_uÄegi¡”
(
Ãtdev
);

3281 
	`uÄegi¡”_Ãtdev
(
Ãtdev
);

3282 
	`Ùx2_¤iov_di§bË
(
pf
->
pdev
);

3283 
	`Ùx2_¤iov_vfcfg_ş—nup
(
pf
);

3284 ià(
pf
->
Ùx2_wq
)

3285 
	`de¡roy_wÜkqueue
(
pf
->
Ùx2_wq
);

3286 
	`Ùx2_±p_de¡roy
(
pf
);

3287 
	`Ùx2_mÿm_æow_d–
(
pf
);

3288 
	`Ùx2_shutdown_tc
(
pf
);

3289 
	`Ùx2_d‘ach_»sourûs
(&
pf
->
mbox
);

3290 ià(
pf
->
hw
.
lmt_šfo
)

3291 
	`ä“_³rıu
(
pf
->
hw
.
lmt_šfo
);

3292 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
pf
->
hw
.
ÿp_æag
))

3293 
	`qmem_ä“
(
pf
->
dev
,…f->
dync_lmt
);

3294 
	`Ùx2_di§bË_mbox_šŒ
(
pf
);

3295 
	`Ùx2_pçf_mbox_de¡roy
(
pf
);

3296 
	`pci_ä“_œq_veùÜs
(
pf
->
pdev
);

3297 
	`pci_£t_drvd©a
(
pdev
, 
NULL
);

3298 
	`ä“_Ãtdev
(
Ãtdev
);

3300 
	`pci_»Ëa£_»giÚs
(
pdev
);

3301 
	}
}

3303 
pci_driv”
 
	gÙx2_pf_driv”
 = {

3304 .
Çme
 = 
DRV_NAME
,

3305 .
	gid_bË
 = 
Ùx2_pf_id_bË
,

3306 .
	g´obe
 = 
Ùx2_´obe
,

3307 .
	gshutdown
 = 
Ùx2_»move
,

3308 .
	g»move
 = 
Ùx2_»move
,

3309 .
	g¤iov_cÚfigu»
 = 
Ùx2_¤iov_cÚfigu»


3312 
__š™
 
	$Ùx2_rvupf_š™_moduË
()

3314 
	`´_šfo
("%s: %s\n", 
DRV_NAME
, 
DRV_STRING
);

3315 
	`Ùx2_th»ad_š™
();

3316 
	`Ùx2_xdp_´oc_ü—‹
();

3318  
	`pci_»gi¡”_driv”
(&
Ùx2_pf_driv”
);

3319 
	}
}

3321 
__ex™
 
	$Ùx2_rvupf_ş—nup_moduË
()

3323 
	`Ùx2_th»ad_ş—nup
();

3324 
	`pci_uÄegi¡”_driv”
(&
Ùx2_pf_driv”
);

3325 
	}
}

3327 
moduË_š™
(
Ùx2_rvupf_š™_moduË
);

3328 
moduË_ex™
(
Ùx2_rvupf_ş—nup_moduË
);

	@otx2_ptp.c

8 
	~<lšux/moduË.h
>

9 
	~"Ùx2_commÚ.h
"

10 
	~"Ùx2_±p.h
"

12 
u64
 
	$Ùx2_±p_g‘_şock
(
Ùx2_±p
 *
±p
)

14 
±p_»q
 *
»q
;

15 
±p_r¥
 *
r¥
;

16 
”r
;

18 ià(!
±p
->
nic
)

21 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
±p
->
nic
->
mbox
);

22 ià(!
»q
)

25 
»q
->
İ
 = 
PTP_OP_GET_CLOCK
;

27 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
±p
->
nic
->
mbox
);

28 ià(
”r
)

31 
r¥
 = (
±p_r¥
 *)
	`Ùx2_mbox_g‘_r¥
(&
±p
->
nic
->
mbox
.mbox, 0,

32 &
»q
->
hdr
);

33 ià(
	`IS_ERR
(
r¥
))

36  
r¥
->
şk
;

37 
	}
}

39 
	$Ùx2_±p_adjfše
(
±p_şock_šfo
 *
±p_šfo
, 
sÿËd_µm
)

41 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
±p_šfo
, otx2_ptp,

42 
±p_šfo
);

43 
±p_»q
 *
»q
;

45 ià(!
±p
->
nic
)

46  -
ENODEV
;

48 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
±p
->
nic
->
mbox
);

49 ià(!
»q
)

50  -
ENOMEM
;

52 
»q
->
İ
 = 
PTP_OP_ADJFINE
;

53 
»q
->
sÿËd_µm
 = scaled_ppm;

55  
	`Ùx2_sync_mbox_msg
(&
±p
->
nic
->
mbox
);

56 
	}
}

58 
	$±p_£t_th»sh
(
Ùx2_±p
 *
±p
, 
u64
 
th»sh
)

60 
±p_»q
 *
»q
;

62 ià(!
±p
->
nic
)

63  -
ENODEV
;

65 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
±p
->
nic
->
mbox
);

66 ià(!
»q
)

67  -
ENOMEM
;

69 
»q
->
İ
 = 
PTP_OP_SET_THRESH
;

70 
»q
->
th»sh
 =hresh;

72  
	`Ùx2_sync_mbox_msg
(&
±p
->
nic
->
mbox
);

73 
	}
}

75 
	$±p_ex‰s_Ú
(
Ùx2_±p
 *
±p
, 
Ú
)

77 
±p_»q
 *
»q
;

79 ià(!
±p
->
nic
)

80  -
ENODEV
;

82 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
±p
->
nic
->
mbox
);

83 ià(!
»q
)

84  -
ENOMEM
;

86 
»q
->
İ
 = 
PTP_OP_EXTTS_ON
;

87 
»q
->
ex‰s_Ú
 = 
Ú
;

89  
	`Ùx2_sync_mbox_msg
(&
±p
->
nic
->
mbox
);

90 
	}
}

92 
u64
 
	$±p_cc_»ad
(cÚ¡ 
cyşecouÁ”
 *
cc
)

94 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
cc
, Ùx2_±p, 
cyşe_couÁ”
);

96  
	`Ùx2_±p_g‘_şock
(
±p
);

97 
	}
}

99 
u64
 
	$±p_t¡mp_»ad
(
Ùx2_±p
 *
±p
)

101 
±p_»q
 *
»q
;

102 
±p_r¥
 *
r¥
;

103 
”r
;

105 ià(!
±p
->
nic
)

108 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
±p
->
nic
->
mbox
);

109 ià(!
»q
)

112 
»q
->
İ
 = 
PTP_OP_GET_TSTMP
;

114 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
±p
->
nic
->
mbox
);

115 ià(
”r
)

118 
r¥
 = (
±p_r¥
 *)
	`Ùx2_mbox_g‘_r¥
(&
±p
->
nic
->
mbox
.mbox, 0,

119 &
»q
->
hdr
);

120 ià(
	`IS_ERR
(
r¥
))

123  
r¥
->
şk
;

124 
	}
}

126 
	$Ùx2_g‘_±pşock
(
Ùx2_±p
 *
±p
, 
u64
 *
t¡amp
)

128 
Ùx2_nic
 *
pfvf
 = 
±p
->
nic
;

130 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

131 *
t¡amp
 = 
	`timecouÁ”_»ad
(&
±p
->
time_couÁ”
);

132 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

133 
	}
}

135 
	$Ùx2_±p_adjtime
(
±p_şock_šfo
 *
±p_šfo
, 
s64
 
d–
)

137 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
±p_šfo
, otx2_ptp,

138 
±p_šfo
);

139 
Ùx2_nic
 *
pfvf
 = 
±p
->
nic
;

141 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

142 
	`timecouÁ”_adjtime
(&
±p
->
time_couÁ”
, 
d–
);

143 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

146 
	}
}

148 
	$Ùx2_±p_g‘time
(
±p_şock_šfo
 *
±p_šfo
,

149 
time¥ec64
 *
ts
)

151 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
±p_šfo
, otx2_ptp,

152 
±p_šfo
);

153 
u64
 
t¡amp
;

155 
	`Ùx2_g‘_±pşock
(
±p
, &
t¡amp
);

156 *
ts
 = 
	`ns_to_time¥ec64
(
t¡amp
);

159 
	}
}

161 
	$Ùx2_±p_£‰ime
(
±p_şock_šfo
 *
±p_šfo
,

162 cÚ¡ 
time¥ec64
 *
ts
)

164 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
±p_šfo
, otx2_ptp,

165 
±p_šfo
);

166 
Ùx2_nic
 *
pfvf
 = 
±p
->
nic
;

167 
u64
 
n£c
;

169 
n£c
 = 
	`time¥ec64_to_ns
(
ts
);

171 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

172 
	`timecouÁ”_š™
(&
±p
->
time_couÁ”
, &±p->
cyşe_couÁ”
, 
n£c
);

173 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

176 
	}
}

178 
	$Ùx2_±p_v”ify_pš
(
±p_şock_šfo
 *
±p
, 
pš
,

179 
±p_pš_funùiÚ
 
func
, 
chª
)

181 
func
) {

182 
PTP_PF_NONE
:

183 
PTP_PF_EXTTS
:

185 
PTP_PF_PEROUT
:

186 
PTP_PF_PHYSYNC
:

190 
	}
}

192 
	$Ùx2_±p_ex‰s_check
(
wÜk_¡ruù
 *
wÜk
)

194 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
wÜk
, otx2_ptp,

195 
ex‰s_wÜk
.
wÜk
);

196 
±p_şock_ev’t
 
ev’t
;

197 
u64
 
t¡mp
, 
Ãw_th»sh
;

199 
	`mu‹x_lock
(&
±p
->
nic
->
mbox
.
lock
);

200 
t¡mp
 = 
	`±p_t¡mp_»ad
(
±p
);

201 
	`mu‹x_uÆock
(&
±p
->
nic
->
mbox
.
lock
);

203 ià(
t¡mp
 !ğ
±p
->
Ï¡_ex‰s
) {

204 
ev’t
.
ty³
 = 
PTP_CLOCK_EXTTS
;

205 
ev’t
.
šdex
 = 0;

206 
ev’t
.
time¡amp
 = 
	`timecouÁ”_cyc2time
(&
±p
->
time_couÁ”
, 
t¡mp
);

207 
	`±p_şock_ev’t
(
±p
->
±p_şock
, &
ev’t
);

208 
Ãw_th»sh
 = 
t¡mp
 % 500000000;

209 ià(
±p
->
th»sh
 !ğ
Ãw_th»sh
) {

210 
	`mu‹x_lock
(&
±p
->
nic
->
mbox
.
lock
);

211 
	`±p_£t_th»sh
(
±p
, 
Ãw_th»sh
);

212 
	`mu‹x_uÆock
(&
±p
->
nic
->
mbox
.
lock
);

213 
±p
->
th»sh
 = 
Ãw_th»sh
;

215 
±p
->
Ï¡_ex‰s
 = 
t¡mp
;

217 
	`scheduË_d–ayed_wÜk
(&
±p
->
ex‰s_wÜk
, 
	`m£cs_to_jiff›s
(200));

218 
	}
}

220 
	$Ùx2_sync_t¡amp
(
wÜk_¡ruù
 *
wÜk
)

222 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
wÜk
, otx2_ptp,

223 
synù¡amp_wÜk
.
wÜk
);

224 
Ùx2_nic
 *
pfvf
 = 
±p
->
nic
;

225 
u64
 
t¡amp
;

227 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

228 
t¡amp
 = 
	`Ùx2_±p_g‘_şock
(
±p
);

229 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

231 
±p
->
t¡amp
 = 
	`timecouÁ”_cyc2time
(&
pfvf
->±p->
time_couÁ”
,stamp);

232 
±p
->
ba£_ns
 = 
t¡amp
 % 
NSEC_PER_SEC
;

234 
	`scheduË_d–ayed_wÜk
(&
±p
->
synù¡amp_wÜk
, 
	`m£cs_to_jiff›s
(250));

235 
	}
}

237 
	$Ùx2_±p_’abË
(
±p_şock_šfo
 *
±p_šfo
,

238 
±p_şock_»que¡
 *
rq
, 
Ú
)

240 
Ùx2_±p
 *
±p
 = 
	`cÚš”_of
(
±p_šfo
, otx2_ptp,

241 
±p_šfo
);

242 
pš
 = -1;

244 ià(!
±p
->
nic
)

245  -
ENODEV
;

247 
rq
->
ty³
) {

248 
PTP_CLK_REQ_EXTTS
:

249 
pš
 = 
	`±p_fšd_pš
(
±p
->
±p_şock
, 
PTP_PF_EXTTS
,

250 
rq
->
ex‰s
.
šdex
);

251 ià(
pš
 < 0)

252  -
EBUSY
;

253 ià(
Ú
) {

254 
	`±p_ex‰s_Ú
(
±p
, 
Ú
);

255 
	`scheduË_d–ayed_wÜk
(&
±p
->
ex‰s_wÜk
, 
	`m£cs_to_jiff›s
(200));

257 
	`±p_ex‰s_Ú
(
±p
, 
Ú
);

258 
	`ÿnûl_d–ayed_wÜk_sync
(&
±p
->
ex‰s_wÜk
);

264  -
EOPNOTSUPP
;

265 
	}
}

267 
	$Ùx2_±p_š™
(
Ùx2_nic
 *
pfvf
)

269 
Ùx2_±p
 *
±p_±r
;

270 
cyşecouÁ”
 *
cc
;

271 
±p_»q
 *
»q
;

272 
”r
;

274 ià(
	`is_Ùx2_lbkvf
(
pfvf
->
pdev
)) {

275 
pfvf
->
±p
 = 
NULL
;

279 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

281 
»q
 = 
	`Ùx2_mbox_®loc_msg_±p_İ
(&
pfvf
->
mbox
);

282 ià(!
»q
) {

283 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

284  -
ENOMEM
;

287 
»q
->
İ
 = 
PTP_OP_GET_CLOCK
;

289 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

290 ià(
”r
) {

291 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

292  
”r
;

294 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

296 
±p_±r
 = 
	`kz®loc
((*±p_±r), 
GFP_KERNEL
);

297 ià(!
±p_±r
) {

298 
”r
 = -
ENOMEM
;

299 
”rÜ
;

302 
±p_±r
->
nic
 = 
pfvf
;

304 
cc
 = &
±p_±r
->
cyşe_couÁ”
;

305 
cc
->
»ad
 = 
±p_cc_»ad
;

306 
cc
->
mask
 = 
	`CYCLECOUNTER_MASK
(64);

307 
cc
->
muÉ
 = 1;

308 
cc
->
shiá
 = 0;

310 
	`timecouÁ”_š™
(&
±p_±r
->
time_couÁ”
, &±p_±r->
cyşe_couÁ”
,

311 
	`ktime_to_ns
(
	`ktime_g‘_»®
()));

313 
	`¢´štf
(
±p_±r
->
ex‰s_cÚfig
.
Çme
, (ptp_ptr->extts_config.name), "TSTAMP");

314 
±p_±r
->
ex‰s_cÚfig
.
šdex
 = 0;

315 
±p_±r
->
ex‰s_cÚfig
.
func
 = 
PTP_PF_NONE
;

317 
±p_±r
->
±p_šfo
 = (
±p_şock_šfo
) {

318 .
owÃr
 = 
THIS_MODULE
,

319 .
Çme
 = "OcteonTX2 PTP",

320 .
max_adj
 = 1000000000ull,

321 .
n_ext_ts
 = 1,

322 .
n_pšs
 = 1,

323 .
µs
 = 0,

324 .
pš_cÚfig
 = &
±p_±r
->
ex‰s_cÚfig
,

325 .
adjfše
 = 
Ùx2_±p_adjfše
,

326 .
adjtime
 = 
Ùx2_±p_adjtime
,

327 .
g‘time64
 = 
Ùx2_±p_g‘time
,

328 .
£‰ime64
 = 
Ùx2_±p_£‰ime
,

329 .
’abË
 = 
Ùx2_±p_’abË
,

330 .
v”ify
 = 
Ùx2_±p_v”ify_pš
,

333 
	`INIT_DELAYED_WORK
(&
±p_±r
->
ex‰s_wÜk
, 
Ùx2_±p_ex‰s_check
);

335 
±p_±r
->
±p_şock
 = 
	`±p_şock_»gi¡”
(&±p_±r->
±p_šfo
, 
pfvf
->
dev
);

336 ià(
	`IS_ERR_OR_NULL
(
±p_±r
->
±p_şock
)) {

337 
”r
 = 
±p_±r
->
±p_şock
 ?

338 
	`PTR_ERR
(
±p_±r
->
±p_şock
è: -
ENODEV
;

339 
	`kä“
(
±p_±r
);

340 
”rÜ
;

343 ià(
	`is_dev_Ùx2
(
pfvf
->
pdev
)) {

344 
±p_±r
->
cÚv”t_rx_±p_t¡mp
 = &
Ùx2_±p_cÚv”t_rx_time¡amp
;

345 
±p_±r
->
cÚv”t_tx_±p_t¡mp
 = &
Ùx2_±p_cÚv”t_tx_time¡amp
;

347 
±p_±r
->
cÚv”t_rx_±p_t¡mp
 = &
ú10k_±p_cÚv”t_time¡amp
;

348 
±p_±r
->
cÚv”t_tx_±p_t¡mp
 = &
ú10k_±p_cÚv”t_time¡amp
;

351 
	`INIT_DELAYED_WORK
(&
±p_±r
->
synù¡amp_wÜk
, 
Ùx2_sync_t¡amp
);

353 
pfvf
->
±p
 = 
±p_±r
;

355 
”rÜ
:

356  
”r
;

357 
	}
}

358 
EXPORT_SYMBOL_GPL
(
Ùx2_±p_š™
);

360 
	$Ùx2_±p_de¡roy
(
Ùx2_nic
 *
pfvf
)

362 
Ùx2_±p
 *
±p
 = 
pfvf
->ptp;

364 ià(!
±p
)

367 
	`ÿnûl_d–ayed_wÜk
(&
pfvf
->
±p
->
synù¡amp_wÜk
);

369 
	`±p_şock_uÄegi¡”
(
±p
->
±p_şock
);

370 
	`kä“
(
±p
);

371 
pfvf
->
±p
 = 
NULL
;

372 
	}
}

373 
EXPORT_SYMBOL_GPL
(
Ùx2_±p_de¡roy
);

375 
	$Ùx2_±p_şock_šdex
(
Ùx2_nic
 *
pfvf
)

377 ià(!
pfvf
->
±p
)

378  -
ENODEV
;

380  
	`±p_şock_šdex
(
pfvf
->
±p
->
±p_şock
);

381 
	}
}

382 
EXPORT_SYMBOL_GPL
(
Ùx2_±p_şock_šdex
);

384 
	$Ùx2_±p_t¡amp2time
(
Ùx2_nic
 *
pfvf
, 
u64
 
t¡amp
, u64 *
t¢s
)

386 ià(!
pfvf
->
±p
)

387  -
ENODEV
;

389 *
t¢s
 = 
	`timecouÁ”_cyc2time
(&
pfvf
->
±p
->
time_couÁ”
, 
t¡amp
);

392 
	}
}

393 
EXPORT_SYMBOL_GPL
(
Ùx2_±p_t¡amp2time
);

395 
MODULE_AUTHOR
("Sunil Goutham <sgoutham@marvell.com>");

396 
MODULE_DESCRIPTION
("Marvell RVU NIC PTP Driver");

397 
MODULE_LICENSE
("GPL v2");

	@otx2_ptp.h

8 #iâdeà
OTX2_PTP_H


9 
	#OTX2_PTP_H


	)

11 
šlše
 
u64
 
	$Ùx2_±p_cÚv”t_rx_time¡amp
(
u64
 
time¡amp
)

13  
	`be64_to_ıu
(*(
__be64
 *)&
time¡amp
);

14 
	}
}

16 
šlše
 
u64
 
	$Ùx2_±p_cÚv”t_tx_time¡amp
(
u64
 
time¡amp
)

18  
time¡amp
;

19 
	}
}

21 
šlše
 
u64
 
	$ú10k_±p_cÚv”t_time¡amp
(
u64
 
time¡amp
)

23  ((
time¡amp
 >> 32è* 
NSEC_PER_SEC
) + (timestamp & 0xFFFFFFFFUL);

24 
	}
}

26 
Ùx2_±p_š™
(
Ùx2_nic
 *
pfvf
);

27 
Ùx2_±p_de¡roy
(
Ùx2_nic
 *
pfvf
);

29 
Ùx2_±p_şock_šdex
(
Ùx2_nic
 *
pfvf
);

30 
Ùx2_±p_t¡amp2time
(
Ùx2_nic
 *
pfvf
, 
u64
 
t¡amp
, u64 *
t¢s
);

	@otx2_reg.h

8 #iâdeà
OTX2_REG_H


9 
	#OTX2_REG_H


	)

11 
	~<rvu_¡ruù.h
>

14 
	#RVU_PF_VFX_PFVF_MBOX0
 (0x00000)

	)

15 
	#RVU_PF_VFX_PFVF_MBOX1
 (0x00008)

	)

16 
	#RVU_PF_VFX_PFVF_MBOXX
(
a
, 
b
è(0x0 | (aè<< 12 | (bè<< 3)

	)

17 
	#RVU_PF_VF_BAR4_ADDR
 (0x10)

	)

18 
	#RVU_PF_BLOCK_ADDRX_DISC
(
a
è(0x200 | (aè<< 3)

	)

19 
	#RVU_PF_VFME_STATUSX
(
a
è(0x800 | (aè<< 3)

	)

20 
	#RVU_PF_VFTRPENDX
(
a
è(0x820 | (aè<< 3)

	)

21 
	#RVU_PF_VFTRPEND_W1SX
(
a
è(0x840 | (aè<< 3)

	)

22 
	#RVU_PF_VFPF_MBOX_INTX
(
a
è(0x880 | (aè<< 3)

	)

23 
	#RVU_PF_VFPF_MBOX_INT_W1SX
(
a
è(0x8A0 | (aè<< 3)

	)

24 
	#RVU_PF_VFPF_MBOX_INT_ENA_W1SX
(
a
è(0x8C0 | (aè<< 3)

	)

25 
	#RVU_PF_VFPF_MBOX_INT_ENA_W1CX
(
a
è(0x8E0 | (aè<< 3)

	)

26 
	#RVU_PF_VFFLR_INTX
(
a
è(0x900 | (aè<< 3)

	)

27 
	#RVU_PF_VFFLR_INT_W1SX
(
a
è(0x920 | (aè<< 3)

	)

28 
	#RVU_PF_VFFLR_INT_ENA_W1SX
(
a
è(0x940 | (aè<< 3)

	)

29 
	#RVU_PF_VFFLR_INT_ENA_W1CX
(
a
è(0x960 | (aè<< 3)

	)

30 
	#RVU_PF_VFME_INTX
(
a
è(0x980 | (aè<< 3)

	)

31 
	#RVU_PF_VFME_INT_W1SX
(
a
è(0x9A0 | (aè<< 3)

	)

32 
	#RVU_PF_VFME_INT_ENA_W1SX
(
a
è(0x9C0 | (aè<< 3)

	)

33 
	#RVU_PF_VFME_INT_ENA_W1CX
(
a
è(0x9E0 | (aè<< 3)

	)

34 
	#RVU_PF_PFAF_MBOX0
 (0xC00)

	)

35 
	#RVU_PF_PFAF_MBOX1
 (0xC08)

	)

36 
	#RVU_PF_PFAF_MBOXX
(
a
è(0xC00 | (aè<< 3)

	)

37 
	#RVU_PF_INT
 (0xc20)

	)

38 
	#RVU_PF_INT_W1S
 (0xc28)

	)

39 
	#RVU_PF_INT_ENA_W1S
 (0xc30)

	)

40 
	#RVU_PF_INT_ENA_W1C
 (0xc38)

	)

41 
	#RVU_PF_MSIX_VECX_ADDR
(
a
è(0x000 | (aè<< 4)

	)

42 
	#RVU_PF_MSIX_VECX_CTL
(
a
è(0x008 | (aè<< 4)

	)

43 
	#RVU_PF_MSIX_PBAX
(
a
è(0xF0000 | (aè<< 3)

	)

44 
	#RVU_PF_VF_MBOX_ADDR
 (0xC40)

	)

45 
	#RVU_PF_LMTLINE_ADDR
 (0xC48)

	)

48 
	#RVU_VF_VFPF_MBOX0
 (0x00000)

	)

49 
	#RVU_VF_VFPF_MBOX1
 (0x00008)

	)

50 
	#RVU_VF_VFPF_MBOXX
(
a
è(0x00 | (aè<< 3)

	)

51 
	#RVU_VF_INT
 (0x20)

	)

52 
	#RVU_VF_INT_W1S
 (0x28)

	)

53 
	#RVU_VF_INT_ENA_W1S
 (0x30)

	)

54 
	#RVU_VF_INT_ENA_W1C
 (0x38)

	)

55 
	#RVU_VF_BLOCK_ADDRX_DISC
(
a
è(0x200 | (aè<< 3)

	)

56 
	#RVU_VF_MSIX_VECX_ADDR
(
a
è(0x000 | (aè<< 4)

	)

57 
	#RVU_VF_MSIX_VECX_CTL
(
a
è(0x008 | (aè<< 4)

	)

58 
	#RVU_VF_MSIX_PBAX
(
a
è(0xF0000 | (aè<< 3)

	)

59 
	#RVU_VF_MBOX_REGION
 (0xC0000)

	)

61 
	#RVU_FUNC_BLKADDR_SHIFT
 20

	)

62 
	#RVU_FUNC_BLKADDR_MASK
 0x1FULL

	)

65 
	#NPA_LFBASE
 (
BLKTYPE_NPA
 << 
RVU_FUNC_BLKADDR_SHIFT
)

	)

66 
	#NPA_LF_AURA_OP_ALLOCX
(
a
è(
NPA_LFBASE
 | 0x10 | (aè<< 3)

	)

67 
	#NPA_LF_AURA_OP_FREE0
 (
NPA_LFBASE
 | 0x20)

	)

68 
	#NPA_LF_AURA_OP_FREE1
 (
NPA_LFBASE
 | 0x28)

	)

69 
	#NPA_LF_AURA_OP_CNT
 (
NPA_LFBASE
 | 0x30)

	)

70 
	#NPA_LF_AURA_OP_LIMIT
 (
NPA_LFBASE
 | 0x50)

	)

71 
	#NPA_LF_AURA_OP_INT
 (
NPA_LFBASE
 | 0x60)

	)

72 
	#NPA_LF_AURA_OP_THRESH
 (
NPA_LFBASE
 | 0x70)

	)

73 
	#NPA_LF_POOL_OP_PC
 (
NPA_LFBASE
 | 0x100)

	)

74 
	#NPA_LF_POOL_OP_AVAILABLE
 (
NPA_LFBASE
 | 0x110)

	)

75 
	#NPA_LF_POOL_OP_PTR_START0
 (
NPA_LFBASE
 | 0x120)

	)

76 
	#NPA_LF_POOL_OP_PTR_START1
 (
NPA_LFBASE
 | 0x128)

	)

77 
	#NPA_LF_POOL_OP_PTR_END0
 (
NPA_LFBASE
 | 0x130)

	)

78 
	#NPA_LF_POOL_OP_PTR_END1
 (
NPA_LFBASE
 | 0x138)

	)

79 
	#NPA_LF_POOL_OP_INT
 (
NPA_LFBASE
 | 0x160)

	)

80 
	#NPA_LF_POOL_OP_THRESH
 (
NPA_LFBASE
 | 0x170)

	)

81 
	#NPA_LF_ERR_INT
 (
NPA_LFBASE
 | 0x200)

	)

82 
	#NPA_LF_ERR_INT_W1S
 (
NPA_LFBASE
 | 0x208)

	)

83 
	#NPA_LF_ERR_INT_ENA_W1C
 (
NPA_LFBASE
 | 0x210)

	)

84 
	#NPA_LF_ERR_INT_ENA_W1S
 (
NPA_LFBASE
 | 0x218)

	)

85 
	#NPA_LF_RAS
 (
NPA_LFBASE
 | 0x220)

	)

86 
	#NPA_LF_RAS_W1S
 (
NPA_LFBASE
 | 0x228)

	)

87 
	#NPA_LF_RAS_ENA_W1C
 (
NPA_LFBASE
 | 0x230)

	)

88 
	#NPA_LF_RAS_ENA_W1S
 (
NPA_LFBASE
 | 0x238)

	)

89 
	#NPA_LF_QINTX_CNT
(
a
è(
NPA_LFBASE
 | 0x300 | (aè<< 12)

	)

90 
	#NPA_LF_QINTX_INT
(
a
è(
NPA_LFBASE
 | 0x310 | (aè<< 12)

	)

91 
	#NPA_LF_QINTX_INT_W1S
(
a
è(
NPA_LFBASE
 | 0x318 | (aè<< 12)

	)

92 
	#NPA_LF_QINTX_ENA_W1S
(
a
è(
NPA_LFBASE
 | 0x320 | (aè<< 12)

	)

93 
	#NPA_LF_QINTX_ENA_W1C
(
a
è(
NPA_LFBASE
 | 0x330 | (aè<< 12)

	)

94 
	#NPA_LF_AURA_BATCH_FREE0
 (
NPA_LFBASE
 | 0x400)

	)

97 
	#NIX_LFBASE
 (
BLKTYPE_NIX
 << 
RVU_FUNC_BLKADDR_SHIFT
)

	)

98 
	#NIX_LF_RX_SECRETX
(
a
è(
NIX_LFBASE
 | 0x0 | (aè<< 3)

	)

99 
	#NIX_LF_CFG
 (
NIX_LFBASE
 | 0x100)

	)

100 
	#NIX_LF_GINT
 (
NIX_LFBASE
 | 0x200)

	)

101 
	#NIX_LF_GINT_W1S
 (
NIX_LFBASE
 | 0x208)

	)

102 
	#NIX_LF_GINT_ENA_W1C
 (
NIX_LFBASE
 | 0x210)

	)

103 
	#NIX_LF_GINT_ENA_W1S
 (
NIX_LFBASE
 | 0x218)

	)

104 
	#NIX_LF_ERR_INT
 (
NIX_LFBASE
 | 0x220)

	)

105 
	#NIX_LF_ERR_INT_W1S
 (
NIX_LFBASE
 | 0x228)

	)

106 
	#NIX_LF_ERR_INT_ENA_W1C
 (
NIX_LFBASE
 | 0x230)

	)

107 
	#NIX_LF_ERR_INT_ENA_W1S
 (
NIX_LFBASE
 | 0x238)

	)

108 
	#NIX_LF_RAS
 (
NIX_LFBASE
 | 0x240)

	)

109 
	#NIX_LF_RAS_W1S
 (
NIX_LFBASE
 | 0x248)

	)

110 
	#NIX_LF_RAS_ENA_W1C
 (
NIX_LFBASE
 | 0x250)

	)

111 
	#NIX_LF_RAS_ENA_W1S
 (
NIX_LFBASE
 | 0x258)

	)

112 
	#NIX_LF_SQ_OP_ERR_DBG
 (
NIX_LFBASE
 | 0x260)

	)

113 
	#NIX_LF_MNQ_ERR_DBG
 (
NIX_LFBASE
 | 0x270)

	)

114 
	#NIX_LF_SEND_ERR_DBG
 (
NIX_LFBASE
 | 0x280)

	)

115 
	#NIX_LF_TX_STATX
(
a
è(
NIX_LFBASE
 | 0x300 | (aè<< 3)

	)

116 
	#NIX_LF_RX_STATX
(
a
è(
NIX_LFBASE
 | 0x400 | (aè<< 3)

	)

117 
	#NIX_LF_OP_SENDX
(
a
è(
NIX_LFBASE
 | 0x800 | (aè<< 3)

	)

118 
	#NIX_LF_RQ_OP_INT
 (
NIX_LFBASE
 | 0x900)

	)

119 
	#NIX_LF_RQ_OP_OCTS
 (
NIX_LFBASE
 | 0x910)

	)

120 
	#NIX_LF_RQ_OP_PKTS
 (
NIX_LFBASE
 | 0x920)

	)

121 
	#NIX_LF_OP_IPSEC_DYNO_CN
 (
NIX_LFBASE
 | 0x980)

	)

122 
	#NIX_LF_SQ_OP_INT
 (
NIX_LFBASE
 | 0xa00)

	)

123 
	#NIX_LF_SQ_OP_OCTS
 (
NIX_LFBASE
 | 0xa10)

	)

124 
	#NIX_LF_SQ_OP_PKTS
 (
NIX_LFBASE
 | 0xa20)

	)

125 
	#NIX_LF_SQ_OP_STATUS
 (
NIX_LFBASE
 | 0xa30)

	)

126 
	#NIX_LF_CQ_OP_INT
 (
NIX_LFBASE
 | 0xb00)

	)

127 
	#NIX_LF_CQ_OP_DOOR
 (
NIX_LFBASE
 | 0xb30)

	)

128 
	#NIX_LF_CQ_OP_STATUS
 (
NIX_LFBASE
 | 0xb40)

	)

129 
	#NIX_LF_QINTX_CNT
(
a
è(
NIX_LFBASE
 | 0xC00 | (aè<< 12)

	)

130 
	#NIX_LF_QINTX_INT
(
a
è(
NIX_LFBASE
 | 0xC10 | (aè<< 12)

	)

131 
	#NIX_LF_QINTX_INT_W1S
(
a
è(
NIX_LFBASE
 | 0xC18 | (aè<< 12)

	)

132 
	#NIX_LF_QINTX_ENA_W1S
(
a
è(
NIX_LFBASE
 | 0xC20 | (aè<< 12)

	)

133 
	#NIX_LF_QINTX_ENA_W1C
(
a
è(
NIX_LFBASE
 | 0xC30 | (aè<< 12)

	)

134 
	#NIX_LF_CINTX_CNT
(
a
è(
NIX_LFBASE
 | 0xD00 | (aè<< 12)

	)

135 
	#NIX_LF_CINTX_WAIT
(
a
è(
NIX_LFBASE
 | 0xD10 | (aè<< 12)

	)

136 
	#NIX_LF_CINTX_INT
(
a
è(
NIX_LFBASE
 | 0xD20 | (aè<< 12)

	)

137 
	#NIX_LF_CINTX_INT_W1S
(
a
è(
NIX_LFBASE
 | 0xD30 | (aè<< 12)

	)

138 
	#NIX_LF_CINTX_ENA_W1S
(
a
è(
NIX_LFBASE
 | 0xD40 | (aè<< 12)

	)

139 
	#NIX_LF_CINTX_ENA_W1C
(
a
è(
NIX_LFBASE
 | 0xD50 | (aè<< 12)

	)

142 
	#NIX_AF_SMQX_CFG
(
a
è(0x700 | (aè<< 16)

	)

143 
	#NIX_AF_TL4X_SDP_LINK_CFG
(
a
è(0xB10 | (aè<< 16)

	)

144 
	#NIX_AF_TL1X_SCHEDULE
(
a
è(0xC00 | (aè<< 16)

	)

145 
	#NIX_AF_TL1X_CIR
(
a
è(0xC20 | (aè<< 16)

	)

146 
	#NIX_AF_TL1X_TOPOLOGY
(
a
è(0xC80 | (aè<< 16)

	)

147 
	#NIX_AF_TL2X_PARENT
(
a
è(0xE88 | (aè<< 16)

	)

148 
	#NIX_AF_TL2X_SCHEDULE
(
a
è(0xE00 | (aè<< 16)

	)

149 
	#NIX_AF_TL2X_TOPOLOGY
(
a
è(0xE80 | (aè<< 16)

	)

150 
	#NIX_AF_TL2X_CIR
(
a
è(0xE20 | (aè<< 16)

	)

151 
	#NIX_AF_TL2X_PIR
(
a
è(0xE30 | (aè<< 16)

	)

152 
	#NIX_AF_TL3X_PARENT
(
a
è(0x1088 | (aè<< 16)

	)

153 
	#NIX_AF_TL3X_SCHEDULE
(
a
è(0x1000 | (aè<< 16)

	)

154 
	#NIX_AF_TL3X_SHAPE
(
a
è(0x1010 | (aè<< 16)

	)

155 
	#NIX_AF_TL3X_CIR
(
a
è(0x1020 | (aè<< 16)

	)

156 
	#NIX_AF_TL3X_PIR
(
a
è(0x1030 | (aè<< 16)

	)

157 
	#NIX_AF_TL3X_TOPOLOGY
(
a
è(0x1080 | (aè<< 16)

	)

158 
	#NIX_AF_TL4X_PARENT
(
a
è(0x1288 | (aè<< 16)

	)

159 
	#NIX_AF_TL4X_SCHEDULE
(
a
è(0x1200 | (aè<< 16)

	)

160 
	#NIX_AF_TL4X_SHAPE
(
a
è(0x1210 | (aè<< 16)

	)

161 
	#NIX_AF_TL4X_CIR
(
a
è(0x1220 | (aè<< 16)

	)

162 
	#NIX_AF_TL4X_PIR
(
a
è(0x1230 | (aè<< 16)

	)

163 
	#NIX_AF_TL4X_TOPOLOGY
(
a
è(0x1280 | (aè<< 16)

	)

164 
	#NIX_AF_MDQX_SCHEDULE
(
a
è(0x1400 | (aè<< 16)

	)

165 
	#NIX_AF_MDQX_SHAPE
(
a
è(0x1410 | (aè<< 16)

	)

166 
	#NIX_AF_MDQX_CIR
(
a
è(0x1420 | (aè<< 16)

	)

167 
	#NIX_AF_MDQX_PIR
(
a
è(0x1430 | (aè<< 16)

	)

168 
	#NIX_AF_MDQX_PARENT
(
a
è(0x1480 | (aè<< 16)

	)

169 
	#NIX_AF_TL3_TL2X_LINKX_CFG
(
a
, 
b
è(0x1700 | (aè<< 16 | (bè<< 3)

	)

172 
	#LMT_LFBASE
 
	`BIT_ULL
(
RVU_FUNC_BLKADDR_SHIFT
)

	)

173 
	#LMT_LF_LMTLINEX
(
a
è(
LMT_LFBASE
 | 0x000 | (aè<< 12)

	)

174 
	#LMT_LF_LMTCANCEL
 (
LMT_LFBASE
 | 0x400)

	)

	@otx2_smqvf.c

8 
	~<lšux/moduË.h
>

9 
	~<lšux/‘h”deviû.h
>

10 
	~<lšux/pci.h
>

12 
	~"Ùx2_commÚ.h
"

13 
	~"Ùx2_»g.h
"

14 
	~"Ùx2_¡ruù.h
"

15 
	~"rvu_fixes.h
"

18 
DEFINE_MUTEX
(
»move_lock
);

20 
	gpkt_d©a
[64] = { 0x00, 0x0f, 0xb7, 0x11, 0xa6, 0x87, 0x02, 0xe0,

29 
sk_buff
 *
	gthe_skb
;

30 
Ùx2_nic
 *
	gthe_smqvf
;

31 
u16
 
	gdrİ_’Œy
 = 0xFFFF;

33 
boŞ
 
	$is_Ùx2_smqvf
(
Ùx2_nic
 *
vf
)

35 ià(
vf
->
pcifunc
 =ğ
RVU_SMQVF_PCIFUNC
 &&

36 (
	`is_96xx_A0
(
vf
->
pdev
è|| 
	`is_95xx_A0
(vf->pdev)))

37  
Œue
;

39  
çl£
;

40 
	}
}

42 
	$__Ùx2_sqe_æush
(
Ùx2_¢d_queue
 *
sq
, 
size
)

44 
u64
 
¡©us
;

47 
	`dma_wmb
();

50 
	`memıy
(
sq
->
lmt_addr
, sq->
sqe_ba£
, 
size
);

51 
¡©us
 = 
	`Ùx2_lmt_æush
(
sq
->
io_addr
);

52 } 
¡©us
 == 0);

54 
sq
->
h—d
++;

55 
sq
->
h—d
 &ğ(sq->
sqe_út
 - 1);

56 
	}
}

58 
	$Ùx2_ùx_upd©e
(
Ùx2_nic
 *
vf
, 
u16
 
qidx
)

60 
nix_aq_’q_»q
 *
sq_aq
, *
rq_aq
, *
cq_aq
;

63 
sq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
vf
->
mbox
);

64 ià(!
sq_aq
)

65  -
ENOMEM
;

67 
sq_aq
->
sq
.
cq_’a
 = 0;

68 
sq_aq
->
sq_mask
.
cq_’a
 = 1;

69 
sq_aq
->
qidx
 = qidx;

70 
sq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

71 
sq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

73 
rq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
vf
->
mbox
);

74 ià(!
rq_aq
)

75  -
ENOMEM
;

77 
rq_aq
->
rq
.
’a
 = 0;

78 
rq_aq
->
rq_mask
.
’a
 = 1;

79 
rq_aq
->
qidx
 = qidx;

80 
rq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_RQ
;

81 
rq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

83 
cq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
vf
->
mbox
);

84 ià(!
cq_aq
)

85  -
ENOMEM
;

87 
cq_aq
->
cq
.
’a
 = 0;

88 
cq_aq
->
cq_mask
.
’a
 = 1;

89 
cq_aq
->
qidx
 = qidx;

90 
cq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_CQ
;

91 
cq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

93  
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
);

94 
	}
}

96 
	$Ùx2smqvf_xm™
()

98 
Ùx2_¢d_queue
 *
sq
;

99 
i
, 
size
;

101 
	`mu‹x_lock
(&
»move_lock
);

103 ià(!
the_smqvf
) {

104 
	`mu‹x_uÆock
(&
»move_lock
);

108 
sq
 = &
the_smqvf
->
q£t
.sq[0];

110 
size
 = (
nix_sqe_hdr_s
è+ (
nix_sqe_sg_s
) +

111 (
nix_sqe_ext_s
è+ (
u64
);

113 
i
 = 0; i < 256; i++)

114 
	`__Ùx2_sqe_æush
(
sq
, 
size
);

116 
	`mu‹x_uÆock
(&
»move_lock
);

117 
	}
}

118 
EXPORT_SYMBOL
(
Ùx2smqvf_xm™
);

120 
	$Ùx2smqvf_š¡®l_æow
(
Ùx2_nic
 *
vf
)

122 
Åc_mÿm_®loc_’Œy_»q
 *
®loc_»q
;

123 
Åc_mÿm_ä“_’Œy_»q
 *
ä“_»q
;

124 
Åc_š¡®l_æow_»q
 *
š¡®l_»q
;

125 
Åc_mÿm_®loc_’Œy_r¥
 *
r¥
;

126 
msg_»q
 *
msg
;

127 
”r
, 
qid
;

128 
size_t
 
size
;

129 *
d©a
;

131 
size
 = 
	`SKB_DATA_ALIGN
(64 + 
OTX2_ALIGN
è+ 
NET_SKB_PAD
 +

132 
	`SKB_DATA_ALIGN
((
skb_sh¬ed_šfo
));

134 
”r
 = -
ENOMEM
;

136 
d©a
 = 
	`kz®loc
(
size
, 
GFP_KERNEL
);

137 ià(!
d©a
)

138  
”r
;

140 
	`memıy
(
d©a
, &
pkt_d©a
, 64);

142 
the_skb
 = 
	`bud_skb
(
d©a
, 0);

143 ià(!
the_skb
) {

144 
”r
 = -
ENODEV
;

145  
”r
;

148 
the_skb
->
Ën
 = 64;

150 
qid
 = 0; qid < 
vf
->
hw
.
tx_queues
; qid++) {

151 
”r
 = 
	`Ùx2_ùx_upd©e
(
vf
, 
qid
);

153 ià(
”r
 && !
qid
)

154 
”r_ä“_mem
;

157 
	`mu‹x_lock
(&
vf
->
mbox
.
lock
);

159 
®loc_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_®loc_’Œy
(&
vf
->
mbox
);

160 ià(!
®loc_»q
) {

161 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

162 
”r_ä“_mem
;

164 
®loc_»q
->
couÁ
 = 1;

165 
®loc_»q
->
cÚtig
 = 
Œue
;

168 ià(
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
)) {

169 
”r
 = -
EINVAL
;

170 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

171 
”r_ä“_mem
;

173 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

175 
r¥
 = (
Åc_mÿm_®loc_’Œy_r¥
 *)
Ùx2_mbox_g‘_r¥


176 (&
vf
->
mbox
.mbox, 0, &
®loc_»q
->
hdr
);

177 
drİ_’Œy
 = 
r¥
->
’Œy
;

179 
	`mu‹x_lock
(&
vf
->
mbox
.
lock
);

182 
š¡®l_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
vf
->
mbox
);

183 ià(!
š¡®l_»q
) {

184 
”r
 = -
ENOMEM
;

185 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

186 
”r_ä“_’Œy
;

189 
	`u64_to_‘h”_addr
(0x0uÎ, 
š¡®l_»q
->
mask
.
dmac
);

190 
š¡®l_»q
->
’Œy
 = 
drİ_’Œy
;

191 
š¡®l_»q
->
ã©u»s
 = 
	`BIT_ULL
(
NPC_DMAC
);

192 
š¡®l_»q
->
štf
 = 
NIX_INTF_TX
;

193 
š¡®l_»q
->
İ
 = 
NIX_TX_ACTIONOP_DROP
;

194 
š¡®l_»q
->
£t_úŒ
 = 1;

196 
msg
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_¡İ_rx
(&
vf
->
mbox
);

197 ià(!
msg
) {

198 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

199 
”r_ä“_’Œy
;

203 ià(
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
)) {

204 
”r
 = -
EINVAL
;

205 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

206 
”r_ä“_’Œy
;

208 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

210 
	`Ùx2_sq_­³nd_skb
(
vf
->
Ãtdev
, &vf->
q£t
.
sq
[0], 
the_skb
, 0);

214 
”r_ä“_’Œy
:

215 
	`mu‹x_lock
(&
vf
->
mbox
.
lock
);

216 
ä“_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_ä“_’Œy
(&
vf
->
mbox
);

217 ià(!
ä“_»q
) {

218 
	`dev_”r
(
vf
->
dev
, "Could‚ot‡llocate msg for freeingƒntry\n");

220 
ä“_»q
->
’Œy
 = 
drİ_’Œy
;

221 
	`WARN_ON
(
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
));

223 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

224 
”r_ä“_mem
:

225 
	`kä“_skb
(
the_skb
);

226 
drİ_’Œy
 = 0xFFFF;

227  
”r
;

228 
	}
}

230 
	$Ùx2smqvf_´obe
(
Ùx2_nic
 *
vf
)

232 
”r
;

234 ià(!
	`is_Ùx2_smqvf
(
vf
))

235  -
EPERM
;

237 
”r
 = 
	`Ùx2_İ’
(
vf
->
Ãtdev
);

238 ià(
”r
)

239  -
EINVAL
;

244 
	`Ùx2_wr™e64
(
vf
, 
	`NIX_LF_QINTX_ENA_W1C
(0), 
	`BIT_ULL
(0));

246 
”r
 = 
	`Ùx2smqvf_š¡®l_æow
(
vf
);

247 ià(
”r
) {

248 
	`Ùx2_¡İ
(
vf
->
Ãtdev
);

249  -
EINVAL
;

252 
the_smqvf
 = 
vf
;

255 
	}
}

257 
	$Ùx2smqvf_»move
(
Ùx2_nic
 *
vf
)

259 
Åc_mÿm_ä“_’Œy_»q
 *
ä“_»q
;

260 
Åc_d–‘e_æow_»q
 *
d–_»q
;

262 ià(!
	`is_Ùx2_smqvf
(
vf
))

263  -
EPERM
;

265 
	`mu‹x_lock
(&
»move_lock
);

266 
	`kä“_skb
(
the_skb
);

267 
the_smqvf
 = 
NULL
;

268 
the_skb
 = 
NULL
;

269 
	`mu‹x_uÆock
(&
»move_lock
);

271 
	`mu‹x_lock
(&
vf
->
mbox
.
lock
);

272 
d–_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
vf
->
mbox
);

273 
ä“_»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_ä“_’Œy
(&
vf
->
mbox
);

274 ià(!
d–_»q
 || !
ä“_»q
) {

275 
	`dev_”r
(
vf
->
dev
, "Could‚ot‡llocate msg for freeingƒntry\n");

277 
d–_»q
->
’Œy
 = 
drİ_’Œy
;

278 
ä“_»q
->
’Œy
 = 
drİ_’Œy
;

279 
	`WARN_ON
(
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
));

281 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

283 
	`Ùx2_¡İ
(
vf
->
Ãtdev
);

284 
drİ_’Œy
 = 0xFFFF;

287 
	}
}

	@otx2_struct.h

8 #iâdeà
OTX2_STRUCT_H


9 
	#OTX2_STRUCT_H


	)

12 
	enix_cqesz_e
 {

13 
	mNIX_XQESZ_W64
 = 0x0,

14 
	mNIX_XQESZ_W16
 = 0x1,

17 
	enix_sqes_e
 {

18 
	mNIX_SQESZ_W16
 = 0x0,

19 
	mNIX_SQESZ_W8
 = 0x1,

22 
	enix_£nd_ldty³
 {

23 
	mNIX_SEND_LDTYPE_LDD
 = 0x0,

24 
	mNIX_SEND_LDTYPE_LDT
 = 0x1,

25 
	mNIX_SEND_LDTYPE_LDWB
 = 0x2,

29 
	enix_£ndl3ty³
 {

30 
	mNIX_SENDL3TYPE_NONE
 = 0x0,

31 
	mNIX_SENDL3TYPE_IP4
 = 0x2,

32 
	mNIX_SENDL3TYPE_IP4_CKSUM
 = 0x3,

33 
	mNIX_SENDL3TYPE_IP6
 = 0x4,

36 
	enix_£ndl4ty³
 {

37 
	mNIX_SENDL4TYPE_NONE
,

38 
	mNIX_SENDL4TYPE_TCP_CKSUM
,

39 
	mNIX_SENDL4TYPE_SCTP_CKSUM
,

40 
	mNIX_SENDL4TYPE_UDP_CKSUM
,

44 
	enix_xqe_ty³
 {

45 
	mNIX_XQE_TYPE_INVALID
 = 0x0,

46 
	mNIX_XQE_TYPE_RX
 = 0x1,

47 
	mNIX_XQE_TYPE_RX_IPSECS
 = 0x2,

48 
	mNIX_XQE_TYPE_RX_IPSECH
 = 0x3,

49 
	mNIX_XQE_TYPE_RX_IPSECD
 = 0x4,

50 
	mNIX_XQE_TYPE_SEND
 = 0x8,

54 
	enix_subdc
 {

55 
	mNIX_SUBDC_NOP
 = 0x0,

56 
	mNIX_SUBDC_EXT
 = 0x1,

57 
	mNIX_SUBDC_CRC
 = 0x2,

58 
	mNIX_SUBDC_IMM
 = 0x3,

59 
	mNIX_SUBDC_SG
 = 0x4,

60 
	mNIX_SUBDC_MEM
 = 0x5,

61 
	mNIX_SUBDC_JUMP
 = 0x6,

62 
	mNIX_SUBDC_WORK
 = 0x7,

63 
	mNIX_SUBDC_SOD
 = 0xf,

67 
	enix_£ndmem®g
 {

68 
	mNIX_SENDMEMALG_E_SET
 = 0x0,

69 
	mNIX_SENDMEMALG_E_SETTSTMP
 = 0x1,

70 
	mNIX_SENDMEMALG_E_SETRSLT
 = 0x2,

71 
	mNIX_SENDMEMALG_E_ADD
 = 0x8,

72 
	mNIX_SENDMEMALG_E_SUB
 = 0x9,

73 
	mNIX_SENDMEMALG_E_ADDLEN
 = 0xa,

74 
	mNIX_SENDMEMALG_E_SUBLEN
 = 0xb,

75 
	mNIX_SENDMEMALG_E_ADDMBUF
 = 0xc,

76 
	mNIX_SENDMEMALG_E_SUBMBUF
 = 0xd,

77 
	mNIX_SENDMEMALG_E_ENUM_LAST
 = 0xe,

81 
	snix_cqe_hdr_s
 {

82 
u64
 
	mæow_g
 : 32;

83 
u64
 
	mq
 : 20;

84 
u64
 
	m»£rved_52_57
 : 6;

85 
u64
 
	mnode
 : 2;

86 
u64
 
	mcqe_ty³
 : 4;

90 
	snix_rx_·r£_s
 {

91 
u64
 
	mchª
 : 12;

92 
u64
 
	mdesc_sizem1
 : 5;

93 
u64
 
	mrsvd_17
 : 1;

94 
u64
 
	mex´ess
 : 1;

95 
u64
 
	mwqwd
 : 1;

96 
u64
 
	m”¾ev
 : 4;

97 
u64
 
	m”rcode
 : 8;

98 
u64
 
	mÏty³
 : 4;

99 
u64
 
	mlbty³
 : 4;

100 
u64
 
	mlùy³
 : 4;

101 
u64
 
	mldty³
 : 4;

102 
u64
 
	mËty³
 : 4;

103 
u64
 
	mláy³
 : 4;

104 
u64
 
	mlgty³
 : 4;

105 
u64
 
	mlhty³
 : 4;

106 
u64
 
	mpkt_Ënm1
 : 16;

107 
u64
 
	ml2m
 : 1;

108 
u64
 
	ml2b
 : 1;

109 
u64
 
	ml3m
 : 1;

110 
u64
 
	ml3b
 : 1;

111 
u64
 
	mvg0_v®id
 : 1;

112 
u64
 
	mvg0_gÚe
 : 1;

113 
u64
 
	mvg1_v®id
 : 1;

114 
u64
 
	mvg1_gÚe
 : 1;

115 
u64
 
	mpkšd
 : 6;

116 
u64
 
	mrsvd_95_94
 : 2;

117 
u64
 
	mvg0_tci
 : 16;

118 
u64
 
	mvg1_tci
 : 16;

119 
u64
 
	mÏæags
 : 8;

120 
u64
 
	mlbæags
 : 8;

121 
u64
 
	mlcæags
 : 8;

122 
u64
 
	mldæags
 : 8;

123 
u64
 
	mËæags
 : 8;

124 
u64
 
	mlfæags
 : 8;

125 
u64
 
	mlgæags
 : 8;

126 
u64
 
	mlhæags
 : 8;

127 
u64
 
	meoh_±r
 : 8;

128 
u64
 
	mwqe_au¿
 : 20;

129 
u64
 
	mpb_au¿
 : 20;

130 
u64
 
	mm©ch_id
 : 16;

131 
u64
 
	mÏ±r
 : 8;

132 
u64
 
	mlb±r
 : 8;

133 
u64
 
	mlıŒ
 : 8;

134 
u64
 
	mld±r
 : 8;

135 
u64
 
	mË±r
 : 8;

136 
u64
 
	mlåŒ
 : 8;

137 
u64
 
	mlg±r
 : 8;

138 
u64
 
	mlh±r
 : 8;

139 
u64
 
	mvg0_±r
 : 8;

140 
u64
 
	mvg1_±r
 : 8;

141 
u64
 
	mæow_key_®g
 : 5;

142 
u64
 
	mrsvd_359_341
 : 19;

143 
u64
 
	mcŞÜ
 : 2;

144 
u64
 
	mrsvd_383_362
 : 22;

145 
u64
 
	mrsvd_447_384
;

149 
	snix_rx_sg_s
 {

150 
u64
 
	m£g_size
 : 16;

151 
u64
 
	m£g2_size
 : 16;

152 
u64
 
	m£g3_size
 : 16;

153 
u64
 
	m£gs
 : 2;

154 
u64
 
	mrsvd_59_50
 : 10;

155 
u64
 
	msubdc
 : 4;

156 
u64
 
	m£g_addr
;

157 
u64
 
	m£g2_addr
;

158 
u64
 
	m£g3_addr
;

161 
	snix_£nd_comp_s
 {

162 
u64
 
	m¡©us
 : 8;

163 
u64
 
	msqe_id
 : 16;

164 
u64
 
	mrsvd_24_63
 : 40;

167 
	snix_cqe_rx_s
 {

168 
nix_cqe_hdr_s
 
	mhdr
;

169 
nix_rx_·r£_s
 
	m·r£
;

170 
nix_rx_sg_s
 
	msg
;

173 
	snix_cqe_tx_s
 {

174 
nix_cqe_hdr_s
 
	mhdr
;

175 
nix_£nd_comp_s
 
	mcomp
;

179 
	snix_sqe_hdr_s
 {

180 
u64
 
	mtÙ®
 : 18;

181 
u64
 
	m»£rved_18
 : 1;

182 
u64
 
	mdf
 : 1;

183 
u64
 
	mau¿
 : 20;

184 
u64
 
	msizem1
 : 3;

185 
u64
 
	m²c
 : 1;

186 
u64
 
	msq
 : 20;

187 
u64
 
	mŞ3±r
 : 8;

188 
u64
 
	mŞ4±r
 : 8;

189 
u64
 
	m3±r
 : 8;

190 
u64
 
	m4±r
 : 8;

191 
u64
 
	mŞ3ty³
 : 4;

192 
u64
 
	mŞ4ty³
 : 4;

193 
u64
 
	m3ty³
 : 4;

194 
u64
 
	m4ty³
 : 4;

195 
u64
 
	msqe_id
 : 16;

199 
	snix_sqe_ext_s
 {

200 
u64
 
	mlso_mps
 : 14;

201 
u64
 
	mlso
 : 1;

202 
u64
 
	mt¡mp
 : 1;

203 
u64
 
	mlso_sb
 : 8;

204 
u64
 
	mlso_fÜm©
 : 5;

205 
u64
 
	mrsvd_31_29
 : 3;

206 
u64
 
	mshp_chg
 : 9;

207 
u64
 
	mshp_dis
 : 1;

208 
u64
 
	mshp_¿
 : 2;

209 
u64
 
	mm¬k±r
 : 8;

210 
u64
 
	mm¬kfÜm
 : 7;

211 
u64
 
	mm¬k_’
 : 1;

212 
u64
 
	msubdc
 : 4;

213 
u64
 
	mvÏn0_šs_±r
 : 8;

214 
u64
 
	mvÏn0_šs_tci
 : 16;

215 
u64
 
	mvÏn1_šs_±r
 : 8;

216 
u64
 
	mvÏn1_šs_tci
 : 16;

217 
u64
 
	mvÏn0_šs_’a
 : 1;

218 
u64
 
	mvÏn1_šs_’a
 : 1;

219 
u64
 
	mš™_cŞÜ
 : 2;

220 
u64
 
	mrsvd_127_116
 : 12;

223 
	snix_sqe_sg_s
 {

224 
u64
 
	m£g1_size
 : 16;

225 
u64
 
	m£g2_size
 : 16;

226 
u64
 
	m£g3_size
 : 16;

227 
u64
 
	m£gs
 : 2;

228 
u64
 
	mrsvd_54_50
 : 5;

229 
u64
 
	mi1
 : 1;

230 
u64
 
	mi2
 : 1;

231 
u64
 
	mi3
 : 1;

232 
u64
 
	mld_ty³
 : 2;

233 
u64
 
	msubdc
 : 4;

237 
	snix_sqe_mem_s
 {

238 
u64
 
	m¡¬t_off£t
 : 8;

239 
u64
 
	mrsvd_11_8
 : 4;

240 
u64
 
	mrsvd_12
 : 1;

241 
u64
 
	mudp_csum_üt
 : 1;

242 
u64
 
	mupd©e64
 : 1;

243 
u64
 
	mrsvd_15_16
 : 1;

244 
u64
 
	mba£_ns
 : 32;

245 
u64
 
	m¡•_ty³
 : 1;

246 
u64
 
	mrsvd_51_49
 : 3;

247 
u64
 
	m³r_lso_£g
 : 1;

248 
u64
 
	mwmem
 : 1;

249 
u64
 
	mdsz
 : 2;

250 
u64
 
	m®g
 : 4;

251 
u64
 
	msubdc
 : 4;

252 
u64
 
	maddr
;

255 
	enix_cq”ršt_e
 {

256 
	mNIX_CQERRINT_DOOR_ERR
 = 0,

257 
	mNIX_CQERRINT_WR_FULL
 = 1,

258 
	mNIX_CQERRINT_CQE_FAULT
 = 2,

261 
	#NIX_CQERRINT_BITS
 (
	`BIT_ULL
(
NIX_CQERRINT_DOOR_ERR
) | \

262 
	`BIT_ULL
(
NIX_CQERRINT_CQE_FAULT
))

	)

264 
	enix_rqšt_e
 {

265 
	mNIX_RQINT_DROP
 = 0,

266 
	mNIX_RQINT_RED
 = 1,

269 
	#NIX_RQINT_BITS
 (
	`BIT_ULL
(
NIX_RQINT_DROP
è| BIT_ULL(
NIX_RQINT_RED
))

	)

271 
	enix_sqšt_e
 {

272 
	mNIX_SQINT_LMT_ERR
 = 0,

273 
	mNIX_SQINT_MNQ_ERR
 = 1,

274 
	mNIX_SQINT_SEND_ERR
 = 2,

275 
	mNIX_SQINT_SQB_ALLOC_FAIL
 = 3,

278 
	#NIX_SQINT_BITS
 (
	`BIT_ULL
(
NIX_SQINT_LMT_ERR
) | \

279 
	`BIT_ULL
(
NIX_SQINT_MNQ_ERR
) | \

280 
	`BIT_ULL
(
NIX_SQINT_SEND_ERR
) | \

281 
	`BIT_ULL
(
NIX_SQINT_SQB_ALLOC_FAIL
))

	)

283 
	enix_sqİ”r_e
 {

284 
	mNIX_SQOPERR_OOR
 = 0,

285 
	mNIX_SQOPERR_CTX_FAULT
 = 1,

286 
	mNIX_SQOPERR_CTX_POISON
 = 2,

287 
	mNIX_SQOPERR_DISABLED
 = 3,

288 
	mNIX_SQOPERR_SIZE_ERR
 = 4,

289 
	mNIX_SQOPERR_OFLOW
 = 5,

290 
	mNIX_SQOPERR_SQB_NULL
 = 6,

291 
	mNIX_SQOPERR_SQB_FAULT
 = 7,

292 
	mNIX_SQOPERR_SQE_SZ_ZERO
 = 8,

293 
	mNIX_SQOPERR_MAX
,

296 
	enix_mnq”r_e
 {

297 
	mNIX_MNQERR_SQ_CTX_FAULT
 = 0,

298 
	mNIX_MNQERR_SQ_CTX_POISON
 = 1,

299 
	mNIX_MNQERR_SQB_FAULT
 = 2,

300 
	mNIX_MNQERR_SQB_POISON
 = 3,

301 
	mNIX_MNQERR_TOTAL_ERR
 = 4,

302 
	mNIX_MNQERR_LSO_ERR
 = 5,

303 
	mNIX_MNQERR_CQ_QUERY_ERR
 = 6,

304 
	mNIX_MNQERR_MAX_SQE_SIZE_ERR
 = 7,

305 
	mNIX_MNQERR_MAXLEN_ERR
 = 8,

306 
	mNIX_MNQERR_SQE_SIZEM1_ZERO
 = 9,

307 
	mNIX_MNQERR_MAX
,

310 
	enix_¢d_¡©us_e
 {

311 
	mNIX_SND_STATUS_GOOD
 = 0x0,

312 
	mNIX_SND_STATUS_SQ_CTX_FAULT
 = 0x1,

313 
	mNIX_SND_STATUS_SQ_CTX_POISON
 = 0x2,

314 
	mNIX_SND_STATUS_SQB_FAULT
 = 0x3,

315 
	mNIX_SND_STATUS_SQB_POISON
 = 0x4,

316 
	mNIX_SND_STATUS_HDR_ERR
 = 0x5,

317 
	mNIX_SND_STATUS_EXT_ERR
 = 0x6,

318 
	mNIX_SND_STATUS_JUMP_FAULT
 = 0x7,

319 
	mNIX_SND_STATUS_JUMP_POISON
 = 0x8,

320 
	mNIX_SND_STATUS_CRC_ERR
 = 0x9,

321 
	mNIX_SND_STATUS_IMM_ERR
 = 0x10,

322 
	mNIX_SND_STATUS_SG_ERR
 = 0x11,

323 
	mNIX_SND_STATUS_MEM_ERR
 = 0x12,

324 
	mNIX_SND_STATUS_INVALID_SUBDC
 = 0x13,

325 
	mNIX_SND_STATUS_SUBDC_ORDER_ERR
 = 0x14,

326 
	mNIX_SND_STATUS_DATA_FAULT
 = 0x15,

327 
	mNIX_SND_STATUS_DATA_POISON
 = 0x16,

328 
	mNIX_SND_STATUS_NPC_DROP_ACTION
 = 0x17,

329 
	mNIX_SND_STATUS_LOCK_VIOL
 = 0x18,

330 
	mNIX_SND_STATUS_NPC_UCAST_CHAN_ERR
 = 0x19,

331 
	mNIX_SND_STATUS_NPC_MCAST_CHAN_ERR
 = 0x20,

332 
	mNIX_SND_STATUS_NPC_MCAST_ABORT
 = 0x21,

333 
	mNIX_SND_STATUS_NPC_VTAG_PTR_ERR
 = 0x22,

334 
	mNIX_SND_STATUS_NPC_VTAG_SIZE_ERR
 = 0x23,

335 
	mNIX_SND_STATUS_SEND_MEM_FAULT
 = 0x24,

336 
	mNIX_SND_STATUS_SEND_STATS_ERR
 = 0x25,

337 
	mNIX_SND_STATUS_MAX
,

	@otx2_tc.c

8 
	~<lšux/Ãtdeviû.h
>

9 
	~<lšux/‘h”deviû.h
>

10 
	~<lšux/š‘deviû.h
>

11 
	~<lšux/rhashbË.h
>

12 
	~<lšux/b™f›ld.h
>

13 
	~<Ãt/æow_dis£ùÜ.h
>

14 
	~<Ãt/pkt_şs.h
>

15 
	~<Ãt/tc_aù/tc_gaù.h
>

16 
	~<Ãt/tc_aù/tc_mœ»d.h
>

17 
	~<Ãt/tc_aù/tc_vÏn.h
>

18 
	~<Ãt/v6.h
>

20 
	~"ú10k.h
"

21 
	~"Ùx2_commÚ.h
"

22 
	~"qos.h
"

25 
	#MAX_BURST_EXPONENT
 0x0FULL

	)

26 
	#MAX_BURST_MANTISSA
 0xFFULL

	)

27 
	#MAX_BURST_SIZE
 130816ULL

	)

28 
	#MAX_RATE_DIVIDER_EXPONENT
 12ULL

	)

29 
	#MAX_RATE_EXPONENT
 0x0FULL

	)

30 
	#MAX_RATE_MANTISSA
 0xFFULL

	)

32 
	#CN10K_MAX_BURST_MANTISSA
 0x7FFFULL

	)

33 
	#CN10K_MAX_BURST_SIZE
 8453888ULL

	)

36 
	#TLX_RATE_MANTISSA
 
	`GENMASK_ULL
(8, 1)

	)

37 
	#TLX_RATE_EXPONENT
 
	`GENMASK_ULL
(12, 9)

	)

38 
	#TLX_RATE_DIVIDER_EXPONENT
 
	`GENMASK_ULL
(16, 13)

	)

39 
	#TLX_BURST_MANTISSA
 
	`GENMASK_ULL
(36, 29)

	)

40 
	#TLX_BURST_EXPONENT
 
	`GENMASK_ULL
(40, 37)

	)

42 
	#CN10K_TLX_BURST_MANTISSA
 
	`GENMASK_ULL
(43, 29)

	)

43 
	#CN10K_TLX_BURST_EXPONENT
 
	`GENMASK_ULL
(47, 44)

	)

45 
	sÙx2_tc_æow_¡©s
 {

46 
u64
 
	mby‹s
;

47 
u64
 
	mpkts
;

48 
u64
 
	mu£d
;

51 
	sÙx2_tc_æow
 {

52 
rhash_h—d
 
	mnode
;

53 
	mcook›
;

54 
	mb™pos
;

55 
rcu_h—d
 
	mrcu
;

56 
Ùx2_tc_æow_¡©s
 
	m¡©s
;

57 
¥šlock_t
 
	mlock
;

58 
u16
 
	mrq
;

59 
u16
 
	m’Œy
;

60 
u16
 
	mËaf_´ofe
;

61 
boŞ
 
	mis_aù_pŞiû
;

64 
	$Ùx2_tc_®loc_’t_b™m­
(
Ùx2_nic
 *
nic
)

66 
Ùx2_tc_šfo
 *
tc
 = &
nic
->
tc_šfo
;

68 ià(!
nic
->
æow_cfg
->
max_æows
)

72 
	`kä“
(
tc
->
tc_’Œ›s_b™m­
);

74 
tc
->
tc_’Œ›s_b™m­
 =

75 
	`kÿÎoc
(
	`BITS_TO_LONGS
(
nic
->
æow_cfg
->
max_æows
),

76 (), 
GFP_KERNEL
);

77 ià(!
tc
->
tc_’Œ›s_b™m­
) {

78 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

80  -
ENOMEM
;

84 
	}
}

85 
EXPORT_SYMBOL
(
Ùx2_tc_®loc_’t_b™m­
);

87 
	$Ùx2_g‘_eg»ss_bur¡_cfg
(
Ùx2_nic
 *
nic
, 
u32
 
bur¡
,

88 
u32
 *
bur¡_exp
, u32 *
bur¡_mªtis§
)

90 
max_bur¡
, 
max_mªtis§
;

91 
tmp
;

93 ià(
	`is_dev_Ùx2
(
nic
->
pdev
)) {

94 
max_bur¡
 = 
MAX_BURST_SIZE
;

95 
max_mªtis§
 = 
MAX_BURST_MANTISSA
;

97 
max_bur¡
 = 
CN10K_MAX_BURST_SIZE
;

98 
max_mªtis§
 = 
CN10K_MAX_BURST_MANTISSA
;

105 
bur¡
 = 
	`mš_t
(
u32
, bur¡, 
max_bur¡
);

106 ià(
bur¡
) {

107 *
bur¡_exp
 = 
	`og2
(
bur¡
) ? ilog2(burst) - 1 : 0;

108 
tmp
 = 
bur¡
 - 
	`rounddown_pow_of_two
(burst);

109 ià(
bur¡
 < 
max_mªtis§
)

110 *
bur¡_mªtis§
 = 
tmp
 * 2;

112 *
bur¡_mªtis§
 = 
tmp
 / (1ULL << (*
bur¡_exp
 - 7));

114 *
bur¡_exp
 = 
MAX_BURST_EXPONENT
;

115 *
bur¡_mªtis§
 = 
max_mªtis§
;

117 
	}
}

119 
	$Ùx2_g‘_eg»ss_¿‹_cfg
(
u64
 
max¿‹
, 
u32
 *
exp
,

120 
u32
 *
mªtis§
, u32 *
div_exp
)

122 
u64
 
tmp
;

135 *
div_exp
 = 0;

137 ià(
max¿‹
) {

138 *
exp
 = 
	`og2
(
max¿‹
) ? ilog2(maxrate) - 1 : 0;

139 
tmp
 = 
max¿‹
 - 
	`rounddown_pow_of_two
(maxrate);

140 ià(
max¿‹
 < 
MAX_RATE_MANTISSA
)

141 *
mªtis§
 = 
tmp
 * 2;

143 *
mªtis§
 = 
tmp
 / (1ULL << (*
exp
 - 7));

146 *
exp
 = 
MAX_RATE_EXPONENT
;

147 *
mªtis§
 = 
MAX_RATE_MANTISSA
;

149 
	}
}

151 
u64
 
	$Ùx2_g‘_txschq_¿‹_»gv®
(
Ùx2_nic
 *
nic
,

152 
u64
 
max¿‹
, 
u32
 
bur¡
)

154 
u32
 
bur¡_exp
, 
bur¡_mªtis§
;

155 
u32
 
exp
, 
mªtis§
, 
div_exp
;

156 
u64
 
»gv®
 = 0;

159 
	`Ùx2_g‘_eg»ss_bur¡_cfg
(
nic
, 
bur¡
, &
bur¡_exp
, &
bur¡_mªtis§
);

160 
	`Ùx2_g‘_eg»ss_¿‹_cfg
(
max¿‹
, &
exp
, &
mªtis§
, &
div_exp
);

162 ià(
	`is_dev_Ùx2
(
nic
->
pdev
)) {

163 
»gv®
 = 
	`FIELD_PREP
(
TLX_BURST_EXPONENT
, (
u64
)
bur¡_exp
) |

164 
	`FIELD_PREP
(
TLX_BURST_MANTISSA
, (
u64
)
bur¡_mªtis§
) |

165 
	`FIELD_PREP
(
TLX_RATE_DIVIDER_EXPONENT
, 
div_exp
) |

166 
	`FIELD_PREP
(
TLX_RATE_EXPONENT
, 
exp
) |

167 
	`FIELD_PREP
(
TLX_RATE_MANTISSA
, 
mªtis§
è| 
	`BIT_ULL
(0);

169 
»gv®
 = 
	`FIELD_PREP
(
CN10K_TLX_BURST_EXPONENT
, (
u64
)
bur¡_exp
) |

170 
	`FIELD_PREP
(
CN10K_TLX_BURST_MANTISSA
, (
u64
)
bur¡_mªtis§
) |

171 
	`FIELD_PREP
(
TLX_RATE_DIVIDER_EXPONENT
, 
div_exp
) |

172 
	`FIELD_PREP
(
TLX_RATE_EXPONENT
, 
exp
) |

173 
	`FIELD_PREP
(
TLX_RATE_MANTISSA
, 
mªtis§
è| 
	`BIT_ULL
(0);

176  
»gv®
;

177 
	}
}

179 
	$Ùx2_£t_m©ch®l_eg»ss_¿‹
(
Ùx2_nic
 *
nic
,

180 
u32
 
bur¡
, 
u64
 
max¿‹
)

182 
Ùx2_hw
 *
hw
 = &
nic
->hw;

183 
nix_txschq_cÚfig
 *
»q
;

184 
txschq
, 
”r
;

187 
txschq
 = 
hw
->
txschq_li¡
[
NIX_TXSCH_LVL_TL4
][0];

189 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

190 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txschq_cfg
(&
nic
->
mbox
);

191 ià(!
»q
) {

192 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

193  -
ENOMEM
;

196 
»q
->
lvl
 = 
NIX_TXSCH_LVL_TL4
;

197 
»q
->
num_»gs
 = 1;

198 
»q
->
»g
[0] = 
	`NIX_AF_TL4X_PIR
(
txschq
);

199 
»q
->
»gv®
[0] = 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
nic
, 
max¿‹
, 
bur¡
);

201 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
nic
->
mbox
);

202 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

203  
”r
;

204 
	}
}

206 
	$Ùx2_tc_v®id©e_æow
(
Ùx2_nic
 *
nic
,

207 
æow_aùiÚ
 *
aùiÚs
,

208 
Ãšk_ext_ack
 *
exck
)

210 ià(
nic
->
æags
 & 
OTX2_FLAG_INTF_DOWN
) {

211 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Interface‚ot initialized");

212  -
EINVAL
;

215 ià(!
	`æow_aùiÚ_has_’Œ›s
(
aùiÚs
)) {

216 
	`NL_SET_ERR_MSG_MOD
(
exck
, "MATCHALL offload called with‚o‡ction");

217  -
EINVAL
;

220 ià(!
	`æow_ofæßd_has_Úe_aùiÚ
(
aùiÚs
)) {

221 
	`NL_SET_ERR_MSG_MOD
(
exck
,

223  -
EINVAL
;

226 
	}
}

228 
	$Ùx2_tc_eg»ss_m©ch®l_š¡®l
(
Ùx2_nic
 *
nic
,

229 
tc_şs_m©ch®l_ofæßd
 *
şs
)

231 
Ãšk_ext_ack
 *
exck
 = 
şs
->
commÚ
.extack;

232 
æow_aùiÚ
 *
aùiÚs
 = &
şs
->
ruË
->
aùiÚ
;

233 
æow_aùiÚ_’Œy
 *
’Œy
;

234 
u64
 
¿‹
;

235 
”r
;

237 
”r
 = 
	`Ùx2_tc_v®id©e_æow
(
nic
, 
aùiÚs
, 
exck
);

238 ià(
”r
)

239  
”r
;

241 ià(
nic
->
æags
 & 
OTX2_FLAG_TC_MATCHALL_EGRESS_ENABLED
) {

242 
	`NL_SET_ERR_MSG_MOD
(
exck
,

244  -
ENOMEM
;

247 
’Œy
 = &
şs
->
ruË
->
aùiÚ
.
’Œ›s
[0];

248 
’Œy
->
id
) {

249 
FLOW_ACTION_POLICE
:

250 ià(
’Œy
->
pŞiû
.
¿‹_pkt_ps
) {

251 
	`NL_SET_ERR_MSG_MOD
(
exck
, "QoS offload‚ot support…ackets…er second");

252  -
EOPNOTSUPP
;

255 
¿‹
 = 
’Œy
->
pŞiû
.
¿‹_by‹s_ps
 * 8;

256 
¿‹
 = 
	`max_t
(
u64
,„ate / 1000000, 1);

257 
”r
 = 
	`Ùx2_£t_m©ch®l_eg»ss_¿‹
(
nic
, 
’Œy
->
pŞiû
.
bur¡
, 
¿‹
);

258 ià(
”r
)

259  
”r
;

260 
nic
->
æags
 |ğ
OTX2_FLAG_TC_MATCHALL_EGRESS_ENABLED
;

263 
	`NL_SET_ERR_MSG_MOD
(
exck
,

265  -
EOPNOTSUPP
;

269 
	}
}

271 
	$Ùx2_tc_eg»ss_m©ch®l_d–‘e
(
Ùx2_nic
 *
nic
,

272 
tc_şs_m©ch®l_ofæßd
 *
şs
)

274 
Ãšk_ext_ack
 *
exck
 = 
şs
->
commÚ
.extack;

275 
”r
;

277 ià(
nic
->
æags
 & 
OTX2_FLAG_INTF_DOWN
) {

278 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Interface‚ot initialized");

279  -
EINVAL
;

282 
”r
 = 
	`Ùx2_£t_m©ch®l_eg»ss_¿‹
(
nic
, 0, 0);

283 
nic
->
æags
 &ğ~
OTX2_FLAG_TC_MATCHALL_EGRESS_ENABLED
;

284  
”r
;

285 
	}
}

287 
	$Ùx2_tc_aù_£t_pŞiû
(
Ùx2_nic
 *
nic
,

288 
Ùx2_tc_æow
 *
node
,

289 
æow_şs_ofæßd
 *
f
,

290 
u64
 
¿‹
, 
u32
 
bur¡
, u32 
m¬k
,

291 
Åc_š¡®l_æow_»q
 *
»q
, 
boŞ
 
µs
)

293 
Ãšk_ext_ack
 *
exck
 = 
f
->
commÚ
.extack;

294 
Ùx2_hw
 *
hw
 = &
nic
->hw;

295 
rq_idx
, 
rc
;

297 
rq_idx
 = 
	`fšd_fœ¡_z”o_b™
(&
nic
->
rq_bm­
, 
hw
->
rx_queues
);

298 ià(
rq_idx
 >ğ
hw
->
rx_queues
) {

299 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Police‡ction„ulesƒxceeded");

300  -
EINVAL
;

303 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

305 
rc
 = 
	`ú10k_®loc_Ëaf_´ofe
(
nic
, &
node
->
Ëaf_´ofe
);

306 ià(
rc
) {

307 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

308  
rc
;

311 
rc
 = 
	`ú10k_£t_Şiûr_¿‹
(
nic
, 
node
->
Ëaf_´ofe
, 
bur¡
, 
¿‹
, 
µs
);

312 ià(
rc
)

313 
ä“_Ëaf
;

315 
rc
 = 
	`ú10k_m­_unm­_rq_pŞiûr
(
nic
, 
rq_idx
, 
node
->
Ëaf_´ofe
, 
Œue
);

316 ià(
rc
)

317 
ä“_Ëaf
;

319 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

321 
»q
->
m©ch_id
 = 
m¬k
 & 0xFFFFULL;

322 
»q
->
šdex
 = 
rq_idx
;

323 
»q
->
İ
 = 
NIX_RX_ACTIONOP_UCAST
;

324 
	`£t_b™
(
rq_idx
, &
nic
->
rq_bm­
);

325 
node
->
is_aù_pŞiû
 = 
Œue
;

326 
node
->
rq
 = 
rq_idx
;

330 
ä“_Ëaf
:

331 ià(
	`ú10k_ä“_Ëaf_´ofe
(
nic
, 
node
->
Ëaf_´ofe
))

332 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

334 
node
->
Ëaf_´ofe
);

335 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

336  
rc
;

337 
	}
}

339 
	$Ùx2_tc_·r£_aùiÚs
(
Ùx2_nic
 *
nic
,

340 
æow_aùiÚ
 *flow_action,

341 
Åc_š¡®l_æow_»q
 *
»q
,

342 
æow_şs_ofæßd
 *
f
,

343 
Ùx2_tc_æow
 *
node
)

345 
Ãšk_ext_ack
 *
exck
 = 
f
->
commÚ
.extack;

346 
æow_aùiÚ_’Œy
 *
aù
;

347 
Ãt_deviû
 *
rg‘
;

348 
Ùx2_nic
 *
´iv
;

349 
u32
 
bur¡
, 
m¬k
 = 0;

350 
u8
 
Ä_pŞiû
 = 0;

351 
boŞ
 
µs
 = 
çl£
;

352 
u64
 
¿‹
;

353 
i
;

355 ià(!
	`æow_aùiÚ_has_’Œ›s
(
æow_aùiÚ
)) {

356 
	`NL_SET_ERR_MSG_MOD
(
exck
, "noc‡ctions specified");

357  -
EINVAL
;

360 
	`æow_aùiÚ_fÜ_—ch
(
i
, 
aù
, 
æow_aùiÚ
) {

361 
aù
->
id
) {

362 
FLOW_ACTION_DROP
:

363 
»q
->
İ
 = 
NIX_RX_ACTIONOP_DROP
;

365 
FLOW_ACTION_ACCEPT
:

366 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

368 
FLOW_ACTION_REDIRECT_INGRESS
:

369 
rg‘
 = 
aù
->
dev
;

370 
´iv
 = 
	`Ãtdev_´iv
(
rg‘
);

372 ià(
	`rvu_g‘_pf
(
nic
->
pcifunc
è!ğrvu_g‘_pf(
´iv
->pcifunc)) {

373 
	`NL_SET_ERR_MSG_MOD
(
exck
,

375  -
EOPNOTSUPP
;

377 
»q
->
vf
 = 
´iv
->
pcifunc
 & 
RVU_PFVF_FUNC_MASK
;

378 
»q
->
İ
 = 
NIX_RX_ACTION_DEFAULT
;

380 
FLOW_ACTION_VLAN_POP
:

381 
»q
->
vg0_v®id
 = 
Œue
;

383 
»q
->
vg0_ty³
 = 
NIX_AF_LFX_RX_VTAG_TYPE7
;

385 
FLOW_ACTION_POLICE
:

387 ià(
	`is_dev_Ùx2
(
nic
->
pdev
)) {

388 
	`NL_SET_ERR_MSG_MOD
(
exck
,

390  -
EOPNOTSUPP
;

393 ià(
aù
->
pŞiû
.
¿‹_by‹s_ps
 > 0) {

394 
¿‹
 = 
aù
->
pŞiû
.
¿‹_by‹s_ps
 * 8;

395 
bur¡
 = 
aù
->
pŞiû
.burst;

396 } ià(
aù
->
pŞiû
.
¿‹_pkt_ps
 > 0) {

402 
¿‹
 = 
aù
->
pŞiû
.
¿‹_pkt_ps
 * 8;

403 
bur¡
 = 
aù
->
pŞiû
.
bur¡_pkt
;

404 
µs
 = 
Œue
;

406 
Ä_pŞiû
++;

408 
FLOW_ACTION_MARK
:

409 
m¬k
 = 
aù
->mark;

412  -
EOPNOTSUPP
;

416 ià(
Ä_pŞiû
 > 1) {

417 
	`NL_SET_ERR_MSG_MOD
(
exck
,

419  -
EOPNOTSUPP
;

422 ià(
Ä_pŞiû
)

423  
	`Ùx2_tc_aù_£t_pŞiû
(
nic
, 
node
, 
f
, 
¿‹
, 
bur¡
,

424 
m¬k
, 
»q
, 
µs
);

427 
	}
}

429 
	$Ùx2_tc_´•¬e_æow
(
Ùx2_nic
 *
nic
, 
Ùx2_tc_æow
 *
node
,

430 
æow_şs_ofæßd
 *
f
,

431 
Åc_š¡®l_æow_»q
 *
»q
)

433 
Ãšk_ext_ack
 *
exck
 = 
f
->
commÚ
.extack;

434 
æow_msg
 *
æow_¥ec
 = &
»q
->
·ck‘
;

435 
æow_msg
 *
æow_mask
 = &
»q
->
mask
;

436 
æow_dis£ùÜ
 *
dis£ùÜ
;

437 
æow_ruË
 *
ruË
;

438 
u8
 
_´Ùo
 = 0;

440 
ruË
 = 
	`æow_şs_ofæßd_æow_ruË
(
f
);

441 
dis£ùÜ
 = 
ruË
->
m©ch
.dissector;

443 ià((
dis£ùÜ
->
u£d_keys
 &

444 ~(
	`BIT
(
FLOW_DISSECTOR_KEY_CONTROL
) |

445 
	`BIT
(
FLOW_DISSECTOR_KEY_BASIC
) |

446 
	`BIT
(
FLOW_DISSECTOR_KEY_ETH_ADDRS
) |

447 
	`BIT
(
FLOW_DISSECTOR_KEY_VLAN
) |

448 
	`BIT
(
FLOW_DISSECTOR_KEY_IPV4_ADDRS
) |

449 
	`BIT
(
FLOW_DISSECTOR_KEY_IPV6_ADDRS
) |

450 
	`BIT
(
FLOW_DISSECTOR_KEY_PORTS
) |

451 
	`BIT
(
FLOW_DISSECTOR_KEY_IP
)))) {

452 
	`Ãtdev_šfo
(
nic
->
Ãtdev
, "unsupported flow used key 0x%x",

453 
dis£ùÜ
->
u£d_keys
);

454  -
EOPNOTSUPP
;

457 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_BASIC
)) {

458 
æow_m©ch_basic
 
m©ch
;

460 
	`æow_ruË_m©ch_basic
(
ruË
, &
m©ch
);

463 
æow_¥ec
->
‘y³
 = 
m©ch
.
key
->
n_´Ùo
;

464 
æow_mask
->
‘y³
 = 
m©ch
.
mask
->
n_´Ùo
;

465 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_ETYPE
);

467 ià(
m©ch
.
mask
->
_´Ùo
 &&

468 (
m©ch
.
key
->
_´Ùo
 !ğ
IPPROTO_TCP
 &&

469 
m©ch
.
key
->
_´Ùo
 !ğ
IPPROTO_UDP
 &&

470 
m©ch
.
key
->
_´Ùo
 !ğ
IPPROTO_SCTP
 &&

471 
m©ch
.
key
->
_´Ùo
 !ğ
IPPROTO_ICMP
 &&

472 
m©ch
.
key
->
_´Ùo
 !ğ
IPPROTO_ICMPV6
)) {

473 
	`Ãtdev_šfo
(
nic
->
Ãtdev
,

475 
m©ch
.
key
->
_´Ùo
);

476  -
EOPNOTSUPP
;

478 ià(
m©ch
.
mask
->
_´Ùo
)

479 
_´Ùo
 = 
m©ch
.
key
->ip_proto;

481 ià(
_´Ùo
 =ğ
IPPROTO_UDP
)

482 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_UDP
);

483 ià(
_´Ùo
 =ğ
IPPROTO_TCP
)

484 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_TCP
);

485 ià(
_´Ùo
 =ğ
IPPROTO_SCTP
)

486 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_SCTP
);

487 ià(
_´Ùo
 =ğ
IPPROTO_ICMP
)

488 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ICMP
);

489 ià(
_´Ùo
 =ğ
IPPROTO_ICMPV6
)

490 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_IPPROTO_ICMP6
);

493 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_ETH_ADDRS
)) {

494 
æow_m©ch_‘h_addrs
 
m©ch
;

496 
	`æow_ruË_m©ch_‘h_addrs
(
ruË
, &
m©ch
);

497 ià(!
	`is_z”o_‘h”_addr
(
m©ch
.
mask
->
¤c
)) {

498 
	`NL_SET_ERR_MSG_MOD
(
exck
, "src mac match‚ot supported");

499  -
EOPNOTSUPP
;

502 ià(!
	`is_z”o_‘h”_addr
(
m©ch
.
mask
->
d¡
)) {

503 
	`‘h”_addr_cİy
(
æow_¥ec
->
dmac
, (
u8
 *)&
m©ch
.
key
->
d¡
);

504 
	`‘h”_addr_cİy
(
æow_mask
->
dmac
,

505 (
u8
 *)&
m©ch
.
mask
->
d¡
);

506 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DMAC
);

510 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_IP
)) {

511 
æow_m©ch_
 
m©ch
;

513 
	`æow_ruË_m©ch_
(
ruË
, &
m©ch
);

514 ià((
	`Áohs
(
æow_¥ec
->
‘y³
è!ğ
ETH_P_IP
) &&

515 
m©ch
.
mask
->
tos
) {

516 
	`NL_SET_ERR_MSG_MOD
(
exck
, "tos‚ot supported");

517  -
EOPNOTSUPP
;

519 ià(
m©ch
.
mask
->
‰l
) {

520 
	`NL_SET_ERR_MSG_MOD
(
exck
, "ttl‚ot supported");

521  -
EOPNOTSUPP
;

523 
æow_¥ec
->
tos
 = 
m©ch
.
key
->tos;

524 
æow_mask
->
tos
 = 
m©ch
.
mask
->tos;

525 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_TOS
);

528 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_VLAN
)) {

529 
æow_m©ch_vÏn
 
m©ch
;

530 
u16
 
vÏn_tci
, 
vÏn_tci_mask
;

532 
	`æow_ruË_m©ch_vÏn
(
ruË
, &
m©ch
);

534 ià(
	`Áohs
(
m©ch
.
key
->
vÏn_id
è!ğ
ETH_P_8021Q
) {

535 
	`Ãtdev_”r
(
nic
->
Ãtdev
, "vlanpid 0x%x‚ot supported\n",

536 
	`Áohs
(
m©ch
.
key
->
vÏn_id
));

537  -
EOPNOTSUPP
;

540 ià(
m©ch
.
mask
->
vÏn_id
 ||

541 
m©ch
.
mask
->
vÏn_dei
 ||

542 
m©ch
.
mask
->
vÏn_´iÜ™y
) {

543 
vÏn_tci
 = 
m©ch
.
key
->
vÏn_id
 |

544 
m©ch
.
key
->
vÏn_dei
 << 12 |

545 
m©ch
.
key
->
vÏn_´iÜ™y
 << 13;

547 
vÏn_tci_mask
 = 
m©ch
.
mask
->
vÏn_id
 |

548 
m©ch
.
mask
->
vÏn_dei
 << 12 |

549 
m©ch
.
mask
->
vÏn_´iÜ™y
 << 13;

551 
æow_¥ec
->
vÏn_tci
 = 
	`htÚs
(vlan_tci);

552 
æow_mask
->
vÏn_tci
 = 
	`htÚs
(
vÏn_tci_mask
);

553 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_OUTER_VID
);

557 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_IPV4_ADDRS
)) {

558 
æow_m©ch_v4_addrs
 
m©ch
;

560 
	`æow_ruË_m©ch_v4_addrs
(
ruË
, &
m©ch
);

562 
æow_¥ec
->
4d¡
 = 
m©ch
.
key
->
d¡
;

563 
æow_mask
->
4d¡
 = 
m©ch
.
mask
->
d¡
;

564 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV4
);

566 
æow_¥ec
->
4¤c
 = 
m©ch
.
key
->
¤c
;

567 
æow_mask
->
4¤c
 = 
m©ch
.
mask
->
¤c
;

568 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV4
);

569 } ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_IPV6_ADDRS
)) {

570 
æow_m©ch_v6_addrs
 
m©ch
;

572 
	`æow_ruË_m©ch_v6_addrs
(
ruË
, &
m©ch
);

574 ià(
	`v6_addr_loİback
(&
m©ch
.
key
->
d¡
) ||

575 
	`v6_addr_loİback
(&
m©ch
.
key
->
¤c
)) {

576 
	`NL_SET_ERR_MSG_MOD
(
exck
,

578  -
EOPNOTSUPP
;

581 ià(!
	`v6_addr_ªy
(&
m©ch
.
mask
->
d¡
)) {

582 
	`memıy
(&
æow_¥ec
->
6d¡
,

583 (
š6_addr
 *)&
m©ch
.
key
->
d¡
,

584 (
æow_¥ec
->
6d¡
));

585 
	`memıy
(&
æow_mask
->
6d¡
,

586 (
š6_addr
 *)&
m©ch
.
mask
->
d¡
,

587 (
æow_¥ec
->
6d¡
));

588 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DIP_IPV6
);

591 ià(!
	`v6_addr_ªy
(&
m©ch
.
mask
->
¤c
)) {

592 
	`memıy
(&
æow_¥ec
->
6¤c
,

593 (
š6_addr
 *)&
m©ch
.
key
->
¤c
,

594 (
æow_¥ec
->
6¤c
));

595 
	`memıy
(&
æow_mask
->
6¤c
,

596 (
š6_addr
 *)&
m©ch
.
mask
->
¤c
,

597 (
æow_¥ec
->
6¤c
));

598 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SIP_IPV6
);

602 ià(
	`æow_ruË_m©ch_key
(
ruË
, 
FLOW_DISSECTOR_KEY_PORTS
)) {

603 
æow_m©ch_pÜts
 
m©ch
;

605 
	`æow_ruË_m©ch_pÜts
(
ruË
, &
m©ch
);

607 
æow_¥ec
->
dpÜt
 = 
m©ch
.
key
->
d¡
;

608 
æow_mask
->
dpÜt
 = 
m©ch
.
mask
->
d¡
;

610 ià(
æow_mask
->
dpÜt
) {

611 ià(
_´Ùo
 =ğ
IPPROTO_UDP
)

612 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_UDP
);

613 ià(
_´Ùo
 =ğ
IPPROTO_TCP
)

614 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_TCP
);

615 ià(
_´Ùo
 =ğ
IPPROTO_SCTP
)

616 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_DPORT_SCTP
);

619 
æow_¥ec
->
¥Üt
 = 
m©ch
.
key
->
¤c
;

620 
æow_mask
->
¥Üt
 = 
m©ch
.
mask
->
¤c
;

622 ià(
æow_mask
->
¥Üt
) {

623 ià(
_´Ùo
 =ğ
IPPROTO_UDP
)

624 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_UDP
);

625 ià(
_´Ùo
 =ğ
IPPROTO_TCP
)

626 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_TCP
);

627 ià(
_´Ùo
 =ğ
IPPROTO_SCTP
)

628 
»q
->
ã©u»s
 |ğ
	`BIT_ULL
(
NPC_SPORT_SCTP
);

632  
	`Ùx2_tc_·r£_aùiÚs
(
nic
, &
ruË
->
aùiÚ
, 
»q
, 
f
, 
node
);

633 
	}
}

635 
	$Ùx2_d–_mÿm_æow_’Œy
(
Ùx2_nic
 *
nic
, 
u16
 
’Œy
)

637 
Åc_d–‘e_æow_»q
 *
»q
;

638 
”r
;

640 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

641 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_d–‘e_æow
(&
nic
->
mbox
);

642 ià(!
»q
) {

643 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

644  -
ENOMEM
;

647 
»q
->
’Œy
 =ƒntry;

650 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
nic
->
mbox
);

651 ià(
”r
) {

652 
	`Ãtdev_”r
(
nic
->
Ãtdev
, "Failedo delete MCAM flowƒntry %d\n",

653 
’Œy
);

654 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

655  -
EFAULT
;

657 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

660 
	}
}

662 
	$Ùx2_tc_d–_æow
(
Ùx2_nic
 *
nic
,

663 
æow_şs_ofæßd
 *
tc_æow_cmd
)

665 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
nic
->flow_cfg;

666 
Ùx2_tc_šfo
 *
tc_šfo
 = &
nic
->tc_info;

667 
Ùx2_tc_æow
 *
æow_node
;

668 
”r
;

670 
æow_node
 = 
	`rhashbË_lookup_ç¡
(&
tc_šfo
->
æow_bË
,

671 &
tc_æow_cmd
->
cook›
,

672 
tc_šfo
->
æow_ht_·¿ms
);

673 ià(!
æow_node
) {

674 
	`Ãtdev_”r
(
nic
->
Ãtdev
, "tc flow‚ot found for cookie 0x%lx\n",

675 
tc_æow_cmd
->
cook›
);

676  -
EINVAL
;

679 ià(
æow_node
->
is_aù_pŞiû
) {

680 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

682 
”r
 = 
	`ú10k_m­_unm­_rq_pŞiûr
(
nic
, 
æow_node
->
rq
,

683 
æow_node
->
Ëaf_´ofe
, 
çl£
);

684 ià(
”r
)

685 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

687 
æow_node
->
rq
, flow_node->
Ëaf_´ofe
);

689 
”r
 = 
	`ú10k_ä“_Ëaf_´ofe
(
nic
, 
æow_node
->
Ëaf_´ofe
);

690 ià(
”r
)

691 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

693 
æow_node
->
Ëaf_´ofe
);

695 
	`__ş—r_b™
(
æow_node
->
rq
, &
nic
->
rq_bm­
);

697 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

700 
	`Ùx2_d–_mÿm_æow_’Œy
(
nic
, 
æow_node
->
’Œy
);

702 
	`WARN_ON
(
	`rhashbË_»move_ç¡
(&
nic
->
tc_šfo
.
æow_bË
,

703 &
æow_node
->
node
,

704 
nic
->
tc_šfo
.
æow_ht_·¿ms
));

705 
	`kä“_rcu
(
æow_node
, 
rcu
);

707 
	`ş—r_b™
(
æow_node
->
b™pos
, 
tc_šfo
->
tc_’Œ›s_b™m­
);

708 
æow_cfg
->
Ä_æows
--;

711 
	}
}

713 
	$Ùx2_tc_add_æow
(
Ùx2_nic
 *
nic
,

714 
æow_şs_ofæßd
 *
tc_æow_cmd
)

716 
Ãšk_ext_ack
 *
exck
 = 
tc_æow_cmd
->
commÚ
.extack;

717 
Ùx2_æow_cÚfig
 *
æow_cfg
 = 
nic
->flow_cfg;

718 
Ùx2_tc_šfo
 *
tc_šfo
 = &
nic
->tc_info;

719 
Ùx2_tc_æow
 *
Ãw_node
, *
Şd_node
;

720 
Åc_š¡®l_æow_»q
 *
»q
, 
dummy
;

721 
rc
, 
”r
;

723 ià(!(
nic
->
æags
 & 
OTX2_FLAG_TC_FLOWER_SUPPORT
))

724  -
ENOMEM
;

726 ià(
	`b™m­_fuÎ
(
tc_šfo
->
tc_’Œ›s_b™m­
, 
æow_cfg
->
max_æows
)) {

727 
	`NL_SET_ERR_MSG_MOD
(
exck
,

729  -
ENOMEM
;

733 
Ãw_node
 = 
	`kz®loc
((*Ãw_node), 
GFP_KERNEL
);

734 ià(!
Ãw_node
)

735  -
ENOMEM
;

736 
	`¥š_lock_š™
(&
Ãw_node
->
lock
);

737 
Ãw_node
->
cook›
 = 
tc_æow_cmd
->cookie;

739 
	`mem£t
(&
dummy
, 0, (
Åc_š¡®l_æow_»q
));

741 
rc
 = 
	`Ùx2_tc_´•¬e_æow
(
nic
, 
Ãw_node
, 
tc_æow_cmd
, &
dummy
);

742 ià(
rc
) {

743 
	`kä“_rcu
(
Ãw_node
, 
rcu
);

744  
rc
;

748 
Şd_node
 = 
	`rhashbË_lookup_ç¡
(&
tc_šfo
->
æow_bË
,

749 &
tc_æow_cmd
->
cook›
,

750 
tc_šfo
->
æow_ht_·¿ms
);

751 ià(
Şd_node
)

752 
	`Ùx2_tc_d–_æow
(
nic
, 
tc_æow_cmd
);

754 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

755 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_š¡®l_æow
(&
nic
->
mbox
);

756 ià(!
»q
) {

757 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

758 
rc
 = -
ENOMEM
;

759 
ä“_Ëaf
;

762 
	`memıy
(&
dummy
.
hdr
, &
»q
->hdr, (
mbox_msghdr
));

763 
	`memıy
(
»q
, &
dummy
, (
Åc_š¡®l_æow_»q
));

765 
Ãw_node
->
b™pos
 = 
	`fšd_fœ¡_z”o_b™
(
tc_šfo
->
tc_’Œ›s_b™m­
,

766 
æow_cfg
->
max_æows
);

767 
»q
->
chªÃl
 = 
nic
->
hw
.
rx_chª_ba£
;

768 
»q
->
’Œy
 = 
æow_cfg
->
æow_’t
[æow_cfg->
max_æows
 - 
Ãw_node
->
b™pos
 - 1];

769 
»q
->
štf
 = 
NIX_INTF_RX
;

770 
»q
->
£t_úŒ
 = 1;

771 
Ãw_node
->
’Œy
 = 
»q
->entry;

774 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
nic
->
mbox
);

775 ià(
rc
) {

776 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Failedo install MCAM flowƒntry");

777 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

778 
	`kä“_rcu
(
Ãw_node
, 
rcu
);

779 
ä“_Ëaf
;

781 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

784 
rc
 = 
	`rhashbË_š£¹_ç¡
(&
nic
->
tc_šfo
.
æow_bË
, &
Ãw_node
->
node
,

785 
nic
->
tc_šfo
.
æow_ht_·¿ms
);

786 ià(
rc
) {

787 
	`Ùx2_d–_mÿm_æow_’Œy
(
nic
, 
»q
->
’Œy
);

788 
	`kä“_rcu
(
Ãw_node
, 
rcu
);

789 
ä“_Ëaf
;

792 
	`£t_b™
(
Ãw_node
->
b™pos
, 
tc_šfo
->
tc_’Œ›s_b™m­
);

793 
æow_cfg
->
Ä_æows
++;

797 
ä“_Ëaf
:

798 ià(
Ãw_node
->
is_aù_pŞiû
) {

799 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

801 
”r
 = 
	`ú10k_m­_unm­_rq_pŞiûr
(
nic
, 
Ãw_node
->
rq
,

802 
Ãw_node
->
Ëaf_´ofe
, 
çl£
);

803 ià(
”r
)

804 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

806 
Ãw_node
->
rq
,‚ew_node->
Ëaf_´ofe
);

807 
”r
 = 
	`ú10k_ä“_Ëaf_´ofe
(
nic
, 
Ãw_node
->
Ëaf_´ofe
);

808 ià(
”r
)

809 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

811 
Ãw_node
->
Ëaf_´ofe
);

813 
	`__ş—r_b™
(
Ãw_node
->
rq
, &
nic
->
rq_bm­
);

815 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

818  
rc
;

819 
	}
}

821 
	$Ùx2_tc_g‘_æow_¡©s
(
Ùx2_nic
 *
nic
,

822 
æow_şs_ofæßd
 *
tc_æow_cmd
)

824 
Ùx2_tc_šfo
 *
tc_šfo
 = &
nic
->tc_info;

825 
Åc_mÿm_g‘_¡©s_»q
 *
»q
;

826 
Åc_mÿm_g‘_¡©s_r¥
 *
r¥
;

827 
Ùx2_tc_æow_¡©s
 *
¡©s
;

828 
Ùx2_tc_æow
 *
æow_node
;

829 
”r
;

831 
æow_node
 = 
	`rhashbË_lookup_ç¡
(&
tc_šfo
->
æow_bË
,

832 &
tc_æow_cmd
->
cook›
,

833 
tc_šfo
->
æow_ht_·¿ms
);

834 ià(!
æow_node
) {

835 
	`Ãtdev_šfo
(
nic
->
Ãtdev
, "tc flow‚ot found for cookie %lx",

836 
tc_æow_cmd
->
cook›
);

837  -
EINVAL
;

840 
	`mu‹x_lock
(&
nic
->
mbox
.
lock
);

842 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_mÿm_’Œy_¡©s
(&
nic
->
mbox
);

843 ià(!
»q
) {

844 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

845  -
ENOMEM
;

848 
»q
->
’Œy
 = 
æow_node
->entry;

850 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
nic
->
mbox
);

851 ià(
”r
) {

852 
	`Ãtdev_”r
(
nic
->
Ãtdev
, "Failedo get stats for MCAM flowƒntry %d\n",

853 
»q
->
’Œy
);

854 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

855  -
EFAULT
;

858 
r¥
 = (
Åc_mÿm_g‘_¡©s_r¥
 *)
Ùx2_mbox_g‘_r¥


859 (&
nic
->
mbox
.mbox, 0, &
»q
->
hdr
);

860 ià(
	`IS_ERR
(
r¥
)) {

861 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

862  
	`PTR_ERR
(
r¥
);

865 
	`mu‹x_uÆock
(&
nic
->
mbox
.
lock
);

867 ià(!
r¥
->
¡©_’a
)

868  -
EINVAL
;

870 
¡©s
 = &
æow_node
->stats;

872 
	`¥š_lock
(&
æow_node
->
lock
);

873 
	`æow_¡©s_upd©e
(&
tc_æow_cmd
->
¡©s
, 0x0, 
r¥
->
¡©
 - sts->
pkts
, 0x0);

874 
¡©s
->
pkts
 = 
r¥
->
¡©
;

875 
	`¥š_uÆock
(&
æow_node
->
lock
);

878 
	}
}

880 
	$Ùx2_£tup_tc_şs_æow”
(
Ùx2_nic
 *
nic
,

881 
æow_şs_ofæßd
 *
şs_æow”
)

883 
şs_æow”
->
commªd
) {

884 
FLOW_CLS_REPLACE
:

885  
	`Ùx2_tc_add_æow
(
nic
, 
şs_æow”
);

886 
FLOW_CLS_DESTROY
:

887  
	`Ùx2_tc_d–_æow
(
nic
, 
şs_æow”
);

888 
FLOW_CLS_STATS
:

889  
	`Ùx2_tc_g‘_æow_¡©s
(
nic
, 
şs_æow”
);

891  -
EOPNOTSUPP
;

893 
	}
}

895 
	$Ùx2_tc_šg»ss_m©ch®l_š¡®l
(
Ùx2_nic
 *
nic
,

896 
tc_şs_m©ch®l_ofæßd
 *
şs
)

898 
Ãšk_ext_ack
 *
exck
 = 
şs
->
commÚ
.extack;

899 
æow_aùiÚ
 *
aùiÚs
 = &
şs
->
ruË
->
aùiÚ
;

900 
æow_aùiÚ_’Œy
 *
’Œy
;

901 
u64
 
¿‹
;

902 
”r
;

904 
”r
 = 
	`Ùx2_tc_v®id©e_æow
(
nic
, 
aùiÚs
, 
exck
);

905 ià(
”r
)

906  
”r
;

908 ià(
nic
->
æags
 & 
OTX2_FLAG_TC_MATCHALL_INGRESS_ENABLED
) {

909 
	`NL_SET_ERR_MSG_MOD
(
exck
,

911  -
ENOMEM
;

914 
’Œy
 = &
şs
->
ruË
->
aùiÚ
.
’Œ›s
[0];

915 
’Œy
->
id
) {

916 
FLOW_ACTION_POLICE
:

918 ià(
	`is_dev_Ùx2
(
nic
->
pdev
)) {

919 
	`NL_SET_ERR_MSG_MOD
(
exck
,

921  -
EOPNOTSUPP
;

924 
”r
 = 
	`ú10k_®loc_m©ch®l_Şiûr
(
nic
);

925 ià(
”r
)

926  
”r
;

929 
¿‹
 = 
’Œy
->
pŞiû
.
¿‹_by‹s_ps
 * 8;

930 
”r
 = 
	`ú10k_£t_m©ch®l_Şiûr_¿‹
(
nic
, 
’Œy
->
pŞiû
.
bur¡
, 
¿‹
);

931 ià(
”r
)

932  
”r
;

933 
nic
->
æags
 |ğ
OTX2_FLAG_TC_MATCHALL_INGRESS_ENABLED
;

936 
	`NL_SET_ERR_MSG_MOD
(
exck
,

938  -
EOPNOTSUPP
;

942 
	}
}

944 
	$Ùx2_tc_šg»ss_m©ch®l_d–‘e
(
Ùx2_nic
 *
nic
,

945 
tc_şs_m©ch®l_ofæßd
 *
şs
)

947 
Ãšk_ext_ack
 *
exck
 = 
şs
->
commÚ
.extack;

948 
”r
;

950 ià(
nic
->
æags
 & 
OTX2_FLAG_INTF_DOWN
) {

951 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Interface‚ot initialized");

952  -
EINVAL
;

955 
”r
 = 
	`ú10k_ä“_m©ch®l_Şiûr
(
nic
);

956 
nic
->
æags
 &ğ~
OTX2_FLAG_TC_MATCHALL_INGRESS_ENABLED
;

957  
”r
;

958 
	}
}

960 
	$Ùx2_£tup_tc_šg»ss_m©ch®l
(
Ùx2_nic
 *
nic
,

961 
tc_şs_m©ch®l_ofæßd
 *
şs_m©ch®l
)

963 
şs_m©ch®l
->
commªd
) {

964 
TC_CLSMATCHALL_REPLACE
:

965  
	`Ùx2_tc_šg»ss_m©ch®l_š¡®l
(
nic
, 
şs_m©ch®l
);

966 
TC_CLSMATCHALL_DESTROY
:

967  
	`Ùx2_tc_šg»ss_m©ch®l_d–‘e
(
nic
, 
şs_m©ch®l
);

968 
TC_CLSMATCHALL_STATS
:

973  -
EOPNOTSUPP
;

974 
	}
}

976 
	$Ùx2_£tup_tc_block_šg»ss_cb
(
tc_£tup_ty³
 
ty³
,

977 *
ty³_d©a
, *
cb_´iv
)

979 
Ùx2_nic
 *
nic
 = 
cb_´iv
;

981 ià(!
	`tc_şs_ÿn_ofæßd_ªd_chaš0
(
nic
->
Ãtdev
, 
ty³_d©a
))

982  -
EOPNOTSUPP
;

984 
ty³
) {

985 
TC_SETUP_CLSFLOWER
:

986  
	`Ùx2_£tup_tc_şs_æow”
(
nic
, 
ty³_d©a
);

987 
TC_SETUP_CLSMATCHALL
:

988  
	`Ùx2_£tup_tc_šg»ss_m©ch®l
(
nic
, 
ty³_d©a
);

993  -
EOPNOTSUPP
;

994 
	}
}

996 
	$Ùx2_£tup_tc_eg»ss_m©ch®l
(
Ùx2_nic
 *
nic
,

997 
tc_şs_m©ch®l_ofæßd
 *
şs_m©ch®l
)

999 
şs_m©ch®l
->
commªd
) {

1000 
TC_CLSMATCHALL_REPLACE
:

1001  
	`Ùx2_tc_eg»ss_m©ch®l_š¡®l
(
nic
, 
şs_m©ch®l
);

1002 
TC_CLSMATCHALL_DESTROY
:

1003  
	`Ùx2_tc_eg»ss_m©ch®l_d–‘e
(
nic
, 
şs_m©ch®l
);

1004 
TC_CLSMATCHALL_STATS
:

1009  -
EOPNOTSUPP
;

1010 
	}
}

1012 
	$Ùx2_£tup_tc_block_eg»ss_cb
(
tc_£tup_ty³
 
ty³
,

1013 *
ty³_d©a
, *
cb_´iv
)

1015 
Ùx2_nic
 *
nic
 = 
cb_´iv
;

1017 ià(!
	`tc_şs_ÿn_ofæßd_ªd_chaš0
(
nic
->
Ãtdev
, 
ty³_d©a
))

1018  -
EOPNOTSUPP
;

1020 
ty³
) {

1021 
TC_SETUP_CLSMATCHALL
:

1022  
	`Ùx2_£tup_tc_eg»ss_m©ch®l
(
nic
, 
ty³_d©a
);

1027  -
EOPNOTSUPP
;

1028 
	}
}

1030 
LIST_HEAD
(
Ùx2_block_cb_li¡
);

1032 
	$Ùx2_£tup_tc_block
(
Ãt_deviû
 *
Ãtdev
,

1033 
æow_block_ofæßd
 *
f
)

1035 
Ùx2_nic
 *
nic
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1036 
æow_£tup_cb_t
 *
cb
;

1037 
boŞ
 
šg»ss
;

1039 ià(
f
->
block_sh¬ed
)

1040  -
EOPNOTSUPP
;

1042 ià(
f
->
bšd”_ty³
 =ğ
FLOW_BLOCK_BINDER_TYPE_CLSACT_INGRESS
) {

1043 
cb
 = 
Ùx2_£tup_tc_block_šg»ss_cb
;

1044 
šg»ss
 = 
Œue
;

1045 } ià(
f
->
bšd”_ty³
 =ğ
FLOW_BLOCK_BINDER_TYPE_CLSACT_EGRESS
) {

1046 
cb
 = 
Ùx2_£tup_tc_block_eg»ss_cb
;

1047 
šg»ss
 = 
çl£
;

1049  -
EOPNOTSUPP
;

1052  
	`æow_block_cb_£tup_sim¶e
(
f
, &
Ùx2_block_cb_li¡
, 
cb
,

1053 
nic
,‚ic, 
šg»ss
);

1054 
	}
}

1056 
	$Ùx2_£tup_tc
(
Ãt_deviû
 *
Ãtdev
, 
tc_£tup_ty³
 
ty³
,

1057 *
ty³_d©a
)

1059 
ty³
) {

1060 
TC_SETUP_BLOCK
:

1061  
	`Ùx2_£tup_tc_block
(
Ãtdev
, 
ty³_d©a
);

1062 
TC_SETUP_QDISC_HTB
:

1063  
	`Ùx2_£tup_tc_htb
(
Ãtdev
, 
ty³_d©a
);

1065  -
EOPNOTSUPP
;

1067 
	}
}

1068 
EXPORT_SYMBOL
(
Ùx2_£tup_tc
);

1070 cÚ¡ 
rhashbË_·¿ms
 
	gtc_æow_ht_·¿ms
 = {

1071 .
h—d_off£t
 = 
off£tof
(
Ùx2_tc_æow
, 
node
),

1072 .
	gkey_off£t
 = 
off£tof
(
Ùx2_tc_æow
, 
cook›
),

1073 .
	gkey_Ën
 = (((
Ùx2_tc_æow
 *)0)->
cook›
),

1074 .
	gautom©ic_shrškšg
 = 
Œue
,

1077 
	$Ùx2_š™_tc
(
Ùx2_nic
 *
nic
)

1079 
Ùx2_tc_šfo
 *
tc
 = &
nic
->
tc_šfo
;

1080 
”r
;

1083 
	`£t_b™
(0, &
nic
->
rq_bm­
);

1085 ià(!
nic
->
æow_cfg
) {

1086 
	`Ãtdev_”r
(
nic
->
Ãtdev
,

1088  -
EINVAL
;

1091 
”r
 = 
	`Ùx2_tc_®loc_’t_b™m­
(
nic
);

1092 ià(
”r
)

1093  
”r
;

1095 
tc
->
æow_ht_·¿ms
 = 
tc_æow_ht_·¿ms
;

1096  
	`rhashbË_š™
(&
tc
->
æow_bË
, &tc->
æow_ht_·¿ms
);

1097 
	}
}

1098 
EXPORT_SYMBOL
(
Ùx2_š™_tc
);

1100 
	$Ùx2_shutdown_tc
(
Ùx2_nic
 *
nic
)

1102 
Ùx2_tc_šfo
 *
tc
 = &
nic
->
tc_šfo
;

1104 
	`kä“
(
tc
->
tc_’Œ›s_b™m­
);

1105 
	`rhashbË_de¡roy
(&
tc
->
æow_bË
);

1106 
	}
}

1107 
EXPORT_SYMBOL
(
Ùx2_shutdown_tc
);

	@otx2_thread.c

1 
	~<lšux/k”Ãl.h
>

2 
	~<lšux/kth»ad.h
>

3 
	~<lšux/sched.h
>

4 
	~<lšux/time.h
>

5 
	~<lšux/tim”.h
>

6 
	~<lšux/vm®loc.h
>

7 
	~<asm/pgbË.h
>

8 
	~<lšux/¦ab.h
>

9 
	~<lšux/d–ay.h
>

10 
	~<lšux/´oc_fs.h
>

11 
	~"Ùx2_th»ad.h
"

13 
LIST_HEAD
(
tšfo_lh
);

14 
©omic_t
 
	gŠum
;

15 
DEFINE_SPINLOCK
(
tšfo_lock
);

16 
´oc_dœ_’Œy
 *
	g´oc_’Œy
;

18 
u8
 
	g§m¶e_pkt
[256];

20 
tšfo
 *
	$Ùx2_th»ad_g‘_ä“_tšfo
()

22 
tšfo
 *
™”
;

23 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
tšfo_lh
, 
li¡
) {

24 ià(!
™”
->
’ded
) {

28 
™”
->
’ded
 = 
çl£
;

30 
	`mem£t
(
™”
->
mem
, 0, i‹r->
sz
);

31  
™”
;

33  
NULL
;

34 
	}
}

36 
	$Ùx2_th»ad_â
(*
d©a
)

38 
tšfo
 *
šfo
 = 
d©a
;

39 
func_±r_t
 
func
;

40 
»t
;

42 !
	`kth»ad_should_¡İ
()) {

44 
func
 = 
šfo
->func;

45 ià(!
func
) {

46 
	`scheduË
();

49 
	`xchg
(&
šfo
->
func
, 0);

51 
»t
 = 
	`func
(
§m¶e_pkt
);

52 
šfo
->
’ded
 = 
Œue
;

53 
	`´_”r
("»ˆäom % : 0x%x\n", 
šfo
->
Šame
, 
»t
);

54 
	`£t_cu¼’t_¡©e
(
TASK_INTERRUPTIBLE
);

55 
	`scheduË
();

59 
	}
}

61 
u32
 
	g§m¶e_code_01
[] 
	g__maybe_unu£d
 = {

68 
u32
 
	g§m¶e_code_02
[] 
	g__maybe_unu£d
 = {

75 
u32
 
	g§m¶e_code_03
[] 
	g__maybe_unu£d
 = {

82 
	$Ùx2_th»ad_tšfo_®loc
()

84 
tšfo
 *
šfo
;

87 
šfo
 = 
	`km®loc
((*šfo), 
GFP_KERNEL
);

88 ià(!
šfo
) {

89 
	`´_šfo
("No memory forask info\n");

90  -
ENOMEM
;

92 
	`mem£t
(
šfo
, 0, (*info));

95 
šfo
->
t
 = 
cu¼’t
;

96 
	`INIT_LIST_HEAD
(&
šfo
->
li¡
);

98 
šfo
->
mem
 = 
	`__vm®loc
(
PAGE_SIZE
, 
GFP_KERNEL
, 
PAGE_KERNEL_EXEC
);

99 ià(!
šfo
->
mem
) {

100 
	`´_šfo
("No memory for…rogram memory\n");

101  -
ENOMEM
;

104 
šfo
->
’ded
 = 
Œue
;

107 
	`¥š_lock
(&
tšfo_lock
);

108 
	`li¡_add_
(&
šfo
->
li¡
, &
tšfo_lh
);

109 
	`¥š_uÆock
(&
tšfo_lock
);

111 
	`¢´štf
(
šfo
->
Šame
, (šfo->Šame), "th»ad%d", 
	`©omic_šc_»tuº
(&
Šum
));

112 
šfo
->
t
 = 
	`kth»ad_ü—‹
(
Ùx2_th»ad_â
, info, info->
Šame
);

117 
	`wake_up_´oûss
(
šfo
->
t
);

120 
	}
}

122 
	$Ùx2_th»ad_¡¬t_´og
(
tšfo
 *tšfo, 
j™ed_Ën
)

124 
tšfo
->
sz
 = 
j™ed_Ën
;

125 
tšfo
->
func
 =šfo->
mem
;

127 
	`wake_up_´oûss
(
tšfo
->
t
);

129 
	}
}

131 
ssize_t
 
	$Ùx2_th»ad_´oc_wr™e
(
fe
 *file,

132 cÚ¡ 
__u£r
 *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
)

135  
couÁ
;

136 
	}
}

138 cÚ¡ 
fe_İ”©iÚs
 
	gÙx2_th»ad_´oc_İs
 = {

139 .
wr™e
 = 
Ùx2_th»ad_´oc_wr™e
,

142 
	$Ùx2_th»ad_š™
()

144 
»t
;

145 
»t
 = 
	`Ùx2_th»ad_tšfo_®loc
();

146 ià(
»t
) {

147 
	`´_”r
("Thread1‡lloc failed\n");

151 
´oc_’Œy
 = 
	`´oc_ü—‹
("execu‹-´og", 0644, 
NULL
, &
Ùx2_th»ad_´oc_İs
);

153 
	}
}

155 
	$Ùx2_th»ad_ş—nup
()

157 
tšfo
 *
™”
;

159 !
	`li¡_em±y
(&
tšfo_lh
)) {

160 
™”
 = 
	`li¡_’Œy
(
tšfo_lh
.
Ãxt
, 
tšfo
, 
li¡
);

161 
	`´_šfo
("TryšgØ¡İh»ad %s\n", 
™”
->
Šame
);

162 
	`wake_up_´oûss
(
™”
->
t
);

163 
	`kth»ad_¡İ
(
™”
->
t
);

165 
	`¥š_lock
(&
tšfo_lock
);

166 
	`li¡_d–_š™
(&
™”
->
li¡
);

167 
	`¥š_uÆock
(&
tšfo_lock
);

169 
	`m¦“p
(1);

170 
	`´_šfo
("D–‘edh»ad %s\n", 
™”
->
Šame
);

171 
	`vä“
(
™”
->
mem
);

172 
	`kä“
(
™”
);

176 
	`´oc_»move
(
´oc_’Œy
);

177 
	}
}

	@otx2_thread.h

1 #iâdeà
OTX2_THREAD_H_


2 
	#OTX2_THREAD_H_


	)

4 (*
	tfunc_±r_t
)(
	tu8
 *
	tpkt
);

5 
	stšfo
 {

6 
sk_¡ruù
 *
t
;

7 
func_±r_t
 
func
;

8 
li¡_h—d
 
li¡
;

9 
Šame
[40];

10 *
mem
;

11 
sz
;

12 
boŞ
 
’ded
;

15 
	`Ùx2_th»ad_š™
 ();

16 
	`Ùx2_th»ad_ş—nup
();

17 
	`Ùx2_th»ad_¡¬t_´og
(
tšfo
 *tšfo, 
j™ed_Ën
);

18 
tšfo
 *
	`Ùx2_th»ad_g‘_ä“_tšfo
();

	@otx2_txrx.c

8 
	~<lšux/‘h”deviû.h
>

9 
	~<Ãt/.h
>

10 
	~<Ãt/tso.h
>

11 
	~<lšux/bpf.h
>

12 
	~<lšux/bpf_Œaû.h
>

14 
	~"Ùx2_»g.h
"

15 
	~"Ùx2_commÚ.h
"

16 
	~"Ùx2_¡ruù.h
"

17 
	~"Ùx2_txrx.h
"

18 
	~"Ùx2_±p.h
"

19 
	~"ú10k.h
"

21 
	#CQE_ADDR
(
CQ
, 
idx
è((CQ)->
cqe_ba£
 + ((CQ)->
cqe_size
 * (idx)))

	)

22 
	#PTP_PORT
 0x13F

	)

26 
	#PTP_SYNC_SEC_OFFSET
 34

	)

28 
šlše
 
	$Ùx2_nix_cq_İ_¡©us
(
Ùx2_nic
 *
pfvf
,

29 
Ùx2_cq_queue
 *
cq
)

31 
u64
 
šü
 = (u64)(
cq
->
cq_idx
) << 32;

32 
u64
 
¡©us
;

34 
¡©us
 = 
	`Ùx2_©omic64_ãtch_add
(
šü
, 
pfvf
->
cq_İ_addr
);

36 ià(
	`uÆik–y
(
¡©us
 & 
	`BIT_ULL
(
CQ_OP_STAT_OP_ERR
) ||

37 
¡©us
 & 
	`BIT_ULL
(
CQ_OP_STAT_CQ_ERR
))) {

38 
	`dev_”r
(
pfvf
->
dev
, "CQ stopped dueoƒrror");

39  -
EINVAL
;

42 
cq
->
cq_
 = 
¡©us
 & 0xFFFFF;

43 
cq
->
cq_h—d
 = (
¡©us
 >> 20) & 0xFFFFF;

44 ià(
cq
->
cq_
 < cq->
cq_h—d
)

45 
cq
->
³nd_cqe
 = (cq->
cqe_út
 - cq->
cq_h—d
) +

46 
cq
->
cq_
;

48 
cq
->
³nd_cqe
 = cq->
cq_
 - cq->
cq_h—d
;

51 
	}
}

53 
šlše
 
boŞ
 
Ùx2_xdp_rcv_pkt_hªdËr
(
Ùx2_nic
 *
pfvf
,

54 
nix_cqe_rx_s
 *
cqe
,

55 
Ùx2_cq_queue
 *
cq
);

57 
nix_cqe_hdr_s
 *
	$Ùx2_g‘_Ãxt_cqe
(
Ùx2_cq_queue
 *
cq
)

59 
nix_cqe_hdr_s
 *
cqe_hdr
;

61 
cqe_hdr
 = (
nix_cqe_hdr_s
 *)
	`CQE_ADDR
(
cq
, cq->
cq_h—d
);

62 ià(
cqe_hdr
->
cqe_ty³
 =ğ
NIX_XQE_TYPE_INVALID
)

63  
NULL
;

65 
cq
->
cq_h—d
++;

66 
cq
->
cq_h—d
 &ğ(cq->
cqe_út
 - 1);

68  
cqe_hdr
;

69 
	}
}

71 
	$äag_num
(
i
)

73 #ifdeà
__BIG_ENDIAN


74  (
i
 & ~3) + 3 - (i & 3);

76  
i
;

78 
	}
}

80 
dma_addr_t
 
	$Ùx2_dma_m­_skb_äag
(
Ùx2_nic
 *
pfvf
,

81 
sk_buff
 *
skb
, 
£g
, *
Ën
)

83 cÚ¡ 
skb_äag_t
 *
äag
;

84 
·ge
 *page;

85 
off£t
;

88 ià(!
£g
) {

89 
·ge
 = 
	`vœt_to_·ge
(
skb
->
d©a
);

90 
off£t
 = 
	`off£t_š_·ge
(
skb
->
d©a
);

91 *
Ën
 = 
	`skb_h—dËn
(
skb
);

93 
äag
 = &
	`skb_shšfo
(
skb
)->
äags
[
£g
 - 1];

94 
·ge
 = 
	`skb_äag_·ge
(
äag
);

95 
off£t
 = 
	`skb_äag_off
(
äag
);

96 *
Ën
 = 
	`skb_äag_size
(
äag
);

98  
	`Ùx2_dma_m­_·ge
(
pfvf
, 
·ge
, 
off£t
, *
Ën
, 
DMA_TO_DEVICE
);

99 
	}
}

101 
	$Ùx2_dma_unm­_skb_äags
(
Ùx2_nic
 *
pfvf
, 
sg_li¡
 *
sg
)

103 
£g
;

105 
£g
 = 0; seg < 
sg
->
num_£gs
; seg++) {

106 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
sg
->
dma_addr
[
£g
],

107 
sg
->
size
[
£g
], 
DMA_TO_DEVICE
);

109 
sg
->
num_£gs
 = 0;

110 
	}
}

112 
	$Ùx2_xdp_¢d_pkt_hªdËr
(
Ùx2_nic
 *
pfvf
,

113 
Ùx2_¢d_queue
 *
sq
,

114 
nix_cqe_tx_s
 *
cqe
)

116 
nix_£nd_comp_s
 *
¢d_comp
 = &
cqe
->
comp
;

117 
sg_li¡
 *
sg
;

118 
·ge
 *page;

119 
u64
 
·
;

121 
sg
 = &
sq
->sg[
¢d_comp
->
sqe_id
];

123 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
sg
->
dma_addr
[0]);

124 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
sg
->
dma_addr
[0],

125 
sg
->
size
[0], 
DMA_TO_DEVICE
);

126 
·ge
 = 
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
));

127 
	`put_·ge
(
·ge
);

128 
	}
}

130 
	$Ùx2_¢d_pkt_hªdËr
(
Ùx2_nic
 *
pfvf
,

131 
Ùx2_cq_queue
 *
cq
,

132 
Ùx2_¢d_queue
 *
sq
,

133 
nix_cqe_tx_s
 *
cqe
,

134 
budg‘
, *
tx_pkts
, *
tx_by‹s
)

136 
nix_£nd_comp_s
 *
¢d_comp
 = &
cqe
->
comp
;

137 
skb_sh¬ed_hwt¡amps
 
ts
;

138 
sk_buff
 *
skb
 = 
NULL
;

139 
u64
 
time¡amp
, 
t¢s
;

140 
sg_li¡
 *
sg
;

141 
”r
;

143 ià(
	`uÆik–y
(
¢d_comp
->
¡©us
è&& 
	`Ãtif_msg_tx_”r
(
pfvf
))

144 
	`Ãt_”r_¿‹lim™ed
("%s: TX%d: Error in send CQ status:%x\n",

145 
pfvf
->
Ãtdev
->
Çme
, 
cq
->
cšt_idx
,

146 
¢d_comp
->
¡©us
);

149 
	`smp_mb
();

150 
sg
 = &
sq
->sg[
¢d_comp
->
sqe_id
];

151 
skb
 = (
sk_buff
 *)
sg
->skb;

152 ià(
	`uÆik–y
(!
skb
))

155 ià(
	`skb_shšfo
(
skb
)->
tx_æags
 & 
SKBTX_IN_PROGRESS
) {

156 
time¡amp
 = ((
u64
 *)
sq
->
time¡amps
->
ba£
)[
¢d_comp
->
sqe_id
];

157 ià(
time¡amp
 != 1) {

158 
time¡amp
 = 
pfvf
->
±p
->
	`cÚv”t_tx_±p_t¡mp
(timestamp);

159 
”r
 = 
	`Ùx2_±p_t¡amp2time
(
pfvf
, 
time¡amp
, &
t¢s
);

160 ià(!
”r
) {

161 
	`mem£t
(&
ts
, 0, (ts));

162 
ts
.
hwt¡amp
 = 
	`ns_to_ktime
(
t¢s
);

163 
	`skb_t¡amp_tx
(
skb
, &
ts
);

168 *
tx_by‹s
 +ğ
skb
->
Ën
;

169 (*
tx_pkts
)++;

170 
	`Ùx2_dma_unm­_skb_äags
(
pfvf
, 
sg
);

171 
	`Çpi_cÚsume_skb
(
skb
, 
budg‘
);

172 
sg
->
skb
 = (
u64
)
NULL
;

173 
	}
}

175 
šlše
 
	$Ùx2_£t_gšfo
(
nix_rx_·r£_s
 *
·r£
,

176 
sk_buff
 *
skb
)

179 ià(
·r£
->
vg0_v®id
 &&…¬£->
vg0_gÚe
) {

180 
skb_äag_t
 *
äag0
 = &
	`skb_shšfo
(
skb
)->
äags
[0];

183 ià(((
‘hhdr
 *)
	`skb_äag_add»ss
(
äag0
))->
h_´Ùo
 ==

184 
	`htÚs
(
ETH_P_8021Q
))

185 
	`__vÏn_hwacûl_put_g
(
skb
, 
	`htÚs
(
ETH_P_8021AD
),

186 
·r£
->
vg0_tci
);

188 
	`__vÏn_hwacûl_put_g
(
skb
, 
	`htÚs
(
ETH_P_8021Q
),

189 
·r£
->
vg0_tci
);

191 
	}
}

193 
šlše
 
	$Ùx2_£t_rxt¡amp
(
Ùx2_nic
 *
pfvf
,

194 
sk_buff
 *
skb
, *
d©a
)

196 
u64
 
time¡amp
, 
t¢s
;

197 
”r
;

199 ià(!(
pfvf
->
æags
 & 
OTX2_FLAG_RX_TSTAMP_ENABLED
))

202 
time¡amp
 = 
pfvf
->
±p
->
	`cÚv”t_rx_±p_t¡mp
(*(
u64
 *)
d©a
);

204 
”r
 = 
	`Ùx2_±p_t¡amp2time
(
pfvf
, 
time¡amp
, &
t¢s
);

205 ià(
”r
)

208 
	`skb_hwt¡amps
(
skb
)->
hwt¡amp
 = 
	`ns_to_ktime
(
t¢s
);

209 
	}
}

211 
boŞ
 
	$Ùx2_skb_add_äag
(
Ùx2_nic
 *
pfvf
, 
sk_buff
 *
skb
,

212 
u64
 
iova
, 
Ën
, 
nix_rx_·r£_s
 *
·r£
,

213 
qidx
)

215 
·ge
 *page;

216 
off
 = 0;

217 *
va
;

219 
va
 = 
	`phys_to_vœt
(
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
));

221 ià(
	`lik–y
(!
	`skb_shšfo
(
skb
)->
Ä_äags
)) {

227 ià(
·r£
->
Ï±r
) {

228 
	`Ùx2_£t_rxt¡amp
(
pfvf
, 
skb
, 
va
);

229 
off
 = 
OTX2_HW_TIMESTAMP_LEN
;

231 
off
 +ğ
pfvf
->
xŒa_hdr
;

234 
·ge
 = 
	`vœt_to_·ge
(
va
);

235 ià(
	`lik–y
(
	`skb_shšfo
(
skb
)->
Ä_äags
 < 
MAX_SKB_FRAGS
)) {

236 
	`skb_add_rx_äag
(
skb
, 
	`skb_shšfo
(skb)->
Ä_äags
, 
·ge
,

237 
va
 - 
	`·ge_add»ss
(
·ge
è+ 
off
,

238 
Ën
 - 
off
, 
pfvf
->
rbsize
);

240 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
iova
 - 
OTX2_HEAD_ROOM
,

241 
pfvf
->
rbsize
, 
DMA_FROM_DEVICE
);

242  
Œue
;

248 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
qidx
, 
iova
 & ~0x07ULL);

250  
çl£
;

251 
	}
}

253 
	$Ùx2_£t_rxhash
(
Ùx2_nic
 *
pfvf
,

254 
nix_cqe_rx_s
 *
cqe
, 
sk_buff
 *
skb
)

256 
pkt_hash_ty³s
 
hash_ty³
 = 
PKT_HASH_TYPE_NONE
;

257 
Ùx2_rss_šfo
 *
rss
;

258 
u32
 
hash
 = 0;

260 ià(!(
pfvf
->
Ãtdev
->
ã©u»s
 & 
NETIF_F_RXHASH
))

263 
rss
 = &
pfvf
->
hw
.
rss_šfo
;

264 ià(
rss
->
æowkey_cfg
) {

265 ià(
rss
->
æowkey_cfg
 &

266 ~(
NIX_FLOW_KEY_TYPE_IPV4
 | 
NIX_FLOW_KEY_TYPE_IPV6
))

267 
hash_ty³
 = 
PKT_HASH_TYPE_L4
;

269 
hash_ty³
 = 
PKT_HASH_TYPE_L3
;

270 
hash
 = 
cqe
->
hdr
.
æow_g
;

272 
	`skb_£t_hash
(
skb
, 
hash
, 
hash_ty³
);

273 
	}
}

275 
	$Ùx2_ä“_rcv_£g
(
Ùx2_nic
 *
pfvf
, 
nix_cqe_rx_s
 *
cqe
,

276 
qidx
)

278 
nix_rx_sg_s
 *
sg
 = &
cqe
->sg;

279 *
’d
, *
¡¬t
;

280 
u64
 *
£g_addr
;

281 
£g
;

283 
¡¬t
 = (*)
sg
;

284 
’d
 = 
¡¬t
 + ((
cqe
->
·r£
.
desc_sizem1
 + 1) * 16);

285 
¡¬t
 < 
’d
) {

286 
sg
 = (
nix_rx_sg_s
 *)
¡¬t
;

287 
£g_addr
 = &
sg
->seg_addr;

288 
£g
 = 0; seg < 
sg
->
£gs
; seg++, 
£g_addr
++)

289 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
qidx
,

290 *
£g_addr
 & ~0x07ULL);

291 
¡¬t
 +ğ(*
sg
);

293 
	}
}

295 
boŞ
 
	$Ùx2_check_rcv_”rÜs
(
Ùx2_nic
 *
pfvf
,

296 
nix_cqe_rx_s
 *
cqe
, 
qidx
)

298 
Ùx2_drv_¡©s
 *
¡©s
 = &
pfvf
->
hw
.
drv_¡©s
;

299 
nix_rx_·r£_s
 *
·r£
 = &
cqe
->parse;

301 ià(
	`Ãtif_msg_rx_”r
(
pfvf
))

302 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

304 
qidx
, 
·r£
->
”¾ev
,…¬£->
”rcode
);

306 ià(
·r£
->
”¾ev
 =ğ
NPC_ERRLVL_RE
) {

307 
·r£
->
”rcode
) {

308 
ERRCODE_FCS
:

309 
ERRCODE_FCS_RCV
:

310 
	`©omic_šc
(&
¡©s
->
rx_fcs_”rs
);

312 
ERRCODE_UNDERSIZE
:

313 
	`©omic_šc
(&
¡©s
->
rx_und”size_”rs
);

315 
ERRCODE_OVERSIZE
:

316 
	`©omic_šc
(&
¡©s
->
rx_ov”size_”rs
);

318 
ERRCODE_OL2_LEN_MISMATCH
:

319 
	`©omic_šc
(&
¡©s
->
rx_Ën_”rs
);

322 
	`©omic_šc
(&
¡©s
->
rx_Ùh”_”rs
);

325 } ià(
·r£
->
”¾ev
 =ğ
NPC_ERRLVL_NIX
) {

326 
·r£
->
”rcode
) {

327 
ERRCODE_OL3_LEN
:

328 
ERRCODE_OL4_LEN
:

329 
ERRCODE_IL3_LEN
:

330 
ERRCODE_IL4_LEN
:

331 
	`©omic_šc
(&
¡©s
->
rx_Ën_”rs
);

333 
ERRCODE_OL4_CSUM
:

334 
ERRCODE_IL4_CSUM
:

335 
	`©omic_šc
(&
¡©s
->
rx_csum_”rs
);

338 
	`©omic_šc
(&
¡©s
->
rx_Ùh”_”rs
);

342 
	`©omic_šc
(&
¡©s
->
rx_Ùh”_”rs
);

346  
çl£
;

350 ià(
pfvf
->
Ãtdev
->
ã©u»s
 & 
NETIF_F_RXALL
)

351  
çl£
;

354 ià(
cqe
->
sg
.
£gs
)

355 
	`Ùx2_ä“_rcv_£g
(
pfvf
, 
cqe
, 
qidx
);

356  
Œue
;

357 
	}
}

359 
	$Ùx2_rcv_pkt_hªdËr
(
Ùx2_nic
 *
pfvf
,

360 
Çpi_¡ruù
 *
Çpi
,

361 
Ùx2_cq_queue
 *
cq
,

362 
nix_cqe_rx_s
 *
cqe
)

364 
nix_rx_·r£_s
 *
·r£
 = &
cqe
->parse;

365 
nix_rx_sg_s
 *
sg
 = &
cqe
->sg;

366 
sk_buff
 *
skb
 = 
NULL
;

367 *
’d
, *
¡¬t
;

368 
u64
 *
£g_addr
;

369 
u16
 *
£g_size
;

370 
£g
;

372 ià(
	`uÆik–y
(
·r£
->
”¾ev
 ||…¬£->
”rcode
)) {

373 ià(
	`Ùx2_check_rcv_”rÜs
(
pfvf
, 
cqe
, 
cq
->
cq_idx
))

377 ià(
pfvf
->
xdp_´og
)

378 ià(
	`Ùx2_xdp_rcv_pkt_hªdËr
(
pfvf
, 
cqe
, 
cq
))

381 
skb
 = 
	`Çpi_g‘_äags
(
Çpi
);

382 ià(
	`uÆik–y
(!
skb
))

385 
¡¬t
 = (*)
sg
;

386 
’d
 = 
¡¬t
 + ((
cqe
->
·r£
.
desc_sizem1
 + 1) * 16);

387 
¡¬t
 < 
’d
) {

388 
sg
 = (
nix_rx_sg_s
 *)
¡¬t
;

389 
£g_addr
 = &
sg
->seg_addr;

390 
£g_size
 = (*)
sg
;

391 
£g
 = 0; seg < 
sg
->
£gs
; seg++, 
£g_addr
++) {

392 ià(
	`Ùx2_skb_add_äag
(
pfvf
, 
skb
, *
£g_addr
,

393 
£g_size
[
£g
], 
·r£
, 
cq
->
cq_idx
))

394 
cq
->
poŞ_±rs
++;

396 
¡¬t
 +ğ(*
sg
);

398 
	`Ùx2_£t_rxhash
(
pfvf
, 
cqe
, 
skb
);

400 
	`skb_»cÜd_rx_queue
(
skb
, 
cq
->
cq_idx
);

401 ià(
pfvf
->
Ãtdev
->
ã©u»s
 & 
NETIF_F_RXCSUM
)

402 
skb
->
_summed
 = 
CHECKSUM_UNNECESSARY
;

404 
	`Ùx2_£t_gšfo
(
·r£
, 
skb
);

405 
	`Çpi_gro_äags
(
Çpi
);

406 
	}
}

408 
	$Ùx2_rx_Çpi_hªdËr
(
Ùx2_nic
 *
pfvf
,

409 
Çpi_¡ruù
 *
Çpi
,

410 
Ùx2_cq_queue
 *
cq
, 
budg‘
)

412 
nix_cqe_rx_s
 *
cqe
;

413 
´oûs£d_cqe
 = 0;

415 ià(
cq
->
³nd_cqe
 >ğ
budg‘
)

416 
´oûss_cqe
;

418 ià(
	`Ùx2_nix_cq_İ_¡©us
(
pfvf
, 
cq
è|| !cq->
³nd_cqe
)

421 
´oûss_cqe
:

422 
	`lik–y
(
´oûs£d_cqe
 < 
budg‘
è&& 
cq
->
³nd_cqe
) {

423 
cqe
 = (
nix_cqe_rx_s
 *)
	`CQE_ADDR
(
cq
, cq->
cq_h—d
);

424 ià(
cqe
->
hdr
.
cqe_ty³
 =ğ
NIX_XQE_TYPE_INVALID
 ||

425 !
cqe
->
sg
.
£g_addr
) {

426 ià(!
´oûs£d_cqe
)

430 
cq
->
cq_h—d
++;

431 
cq
->
cq_h—d
 &ğ(cq->
cqe_út
 - 1);

433 
	`Ùx2_rcv_pkt_hªdËr
(
pfvf
, 
Çpi
, 
cq
, 
cqe
);

435 
cqe
->
hdr
.
cqe_ty³
 = 
NIX_XQE_TYPE_INVALID
;

436 
cqe
->
sg
.
£g_addr
 = 0x00;

437 
´oûs£d_cqe
++;

438 
cq
->
³nd_cqe
--;

442 
	`Ùx2_wr™e64
(
pfvf
, 
NIX_LF_CQ_OP_DOOR
,

443 ((
u64
)
cq
->
cq_idx
 << 32è| 
´oûs£d_cqe
);

445  
´oûs£d_cqe
;

446 
	}
}

448 
	$Ùx2_»fl_poŞ_±rs
(*
dev
, 
Ùx2_cq_queue
 *
cq
)

450 
Ùx2_nic
 *
pfvf
 = 
dev
;

451 
dma_addr_t
 
buåŒ
;

454 
cq
->
poŞ_±rs
) {

455 ià(
	`Ùx2_®loc_bufãr
(
pfvf
, 
cq
, &
buåŒ
))

457 
	`Ùx2_au¿_ä“±r
(
pfvf
, 
cq
->
cq_idx
, 
buåŒ
 + 
OTX2_HEAD_ROOM
);

458 
cq
->
poŞ_±rs
--;

460 
	}
}

462 
	$Ùx2_tx_Çpi_hªdËr
(
Ùx2_nic
 *
pfvf
,

463 
Ùx2_cq_queue
 *
cq
, 
budg‘
)

465 
tx_pkts
 = 0, 
tx_by‹s
 = 0, 
qidx
;

466 
Ùx2_¢d_queue
 *
sq
;

467 
nix_cqe_tx_s
 *
cqe
;

468 
´oûs£d_cqe
 = 0;

470 ià(
cq
->
³nd_cqe
 >ğ
budg‘
)

471 
´oûss_cqe
;

473 ià(
	`Ùx2_nix_cq_İ_¡©us
(
pfvf
, 
cq
è|| !cq->
³nd_cqe
)

476 
´oûss_cqe
:

477 
qidx
 = 
cq
->
cq_idx
 - 
pfvf
->
hw
.
rx_queues
;

478 
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

480 
	`lik–y
(
´oûs£d_cqe
 < 
budg‘
è&& 
cq
->
³nd_cqe
) {

481 
cqe
 = (
nix_cqe_tx_s
 *)
	`Ùx2_g‘_Ãxt_cqe
(
cq
);

482 ià(
	`uÆik–y
(!
cqe
)) {

483 ià(!
´oûs£d_cqe
)

488 ià(
cq
->
cq_ty³
 =ğ
CQ_XDP
)

489 
	`Ùx2_xdp_¢d_pkt_hªdËr
(
pfvf
, 
sq
, 
cqe
);

491 
	`Ùx2_¢d_pkt_hªdËr
(
pfvf
, 
cq
, 
sq
, 
cqe
, 
budg‘
,

492 &
tx_pkts
, &
tx_by‹s
);

494 
cqe
->
hdr
.
cqe_ty³
 = 
NIX_XQE_TYPE_INVALID
;

495 
´oûs£d_cqe
++;

496 
cq
->
³nd_cqe
--;

498 
sq
->
cÚs_h—d
++;

499 
sq
->
cÚs_h—d
 &ğ(sq->
sqe_út
 - 1);

503 
	`Ùx2_wr™e64
(
pfvf
, 
NIX_LF_CQ_OP_DOOR
,

504 ((
u64
)
cq
->
cq_idx
 << 32è| 
´oûs£d_cqe
);

506 ià(
	`lik–y
(
tx_pkts
)) {

507 
Ãtdev_queue
 *
txq
;

509 
qidx
 = 
cq
->
cq_idx
 - 
pfvf
->
hw
.
rx_queues
;

511 ià(
qidx
 >ğ
pfvf
->
hw
.
tx_queues
)

512 
qidx
 -ğ
pfvf
->
hw
.
xdp_queues
;

513 
txq
 = 
	`Ãtdev_g‘_tx_queue
(
pfvf
->
Ãtdev
, 
qidx
);

514 
	`Ãtdev_tx_com¶‘ed_queue
(
txq
, 
tx_pkts
, 
tx_by‹s
);

516 
	`smp_mb
();

517 ià(
	`Ãtif_tx_queue_¡İ³d
(
txq
) &&

518 
	`Ãtif_ÿ¼›r_ok
(
pfvf
->
Ãtdev
))

519 
	`Ãtif_tx_wake_queue
(
txq
);

522 
	}
}

524 
	$Ùx2_adju¡_ad­tive_cßË£
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_pŞl
 *
cq_pŞl
)

526 
dim_§m¶e
 dim_sample;

527 
u64
 
rx_äames
, 
rx_by‹s
;

528 
u64
 
tx_äames
, 
tx_by‹s
;

530 
rx_äames
 = 
	`OTX2_GET_RX_STATS
(
RX_BCAST
è+ OTX2_GET_RX_STATS(
RX_MCAST
) +

531 
	`OTX2_GET_RX_STATS
(
RX_UCAST
);

532 
rx_by‹s
 = 
	`OTX2_GET_RX_STATS
(
RX_OCTS
);

533 
tx_by‹s
 = 
	`OTX2_GET_TX_STATS
(
TX_OCTS
);

534 
tx_äames
 = 
	`OTX2_GET_TX_STATS
(
TX_UCAST
);

536 
	`dim_upd©e_§m¶e
(
pfvf
->
Çpi_ev’ts
,

537 
rx_äames
 + 
tx_äames
,

538 
rx_by‹s
 + 
tx_by‹s
,

539 &
dim_§m¶e
);

541 
	`Ãt_dim
(&
cq_pŞl
->
dim
, 
dim_§m¶e
);

542 
	}
}

544 
	$Ùx2_Çpi_hªdËr
(
Çpi_¡ruù
 *
Çpi
, 
budg‘
)

546 
Ùx2_cq_queue
 *
rx_cq
 = 
NULL
;

547 
Ùx2_cq_pŞl
 *
cq_pŞl
;

548 
wÜkdÚe
 = 0, 
cq_idx
, 
i
;

549 
Ùx2_cq_queue
 *
cq
;

550 
Ùx2_q£t
 *
q£t
;

551 
Ùx2_nic
 *
pfvf
;

553 
cq_pŞl
 = 
	`cÚš”_of
(
Çpi
, 
Ùx2_cq_pŞl
,‚api);

554 
pfvf
 = (
Ùx2_nic
 *)
cq_pŞl
->
dev
;

555 
q£t
 = &
pfvf
->qset;

557 
i
 = 0; i < 
CQS_PER_CINT
; i++) {

558 
cq_idx
 = 
cq_pŞl
->
cq_ids
[
i
];

559 ià(
	`uÆik–y
(
cq_idx
 =ğ
CINT_INVALID_CQ
))

561 
cq
 = &
q£t
->cq[
cq_idx
];

562 ià(
cq
->
cq_ty³
 =ğ
CQ_RX
) {

563 
rx_cq
 = 
cq
;

564 
wÜkdÚe
 +ğ
	`Ùx2_rx_Çpi_hªdËr
(
pfvf
, 
Çpi
,

565 
cq
, 
budg‘
);

567 
wÜkdÚe
 +ğ
	`Ùx2_tx_Çpi_hªdËr
(
pfvf
, 
cq
, 
budg‘
);

571 ià(
rx_cq
 &&„x_cq->
poŞ_±rs
)

572 
pfvf
->
hw_İs
->
	`»fl_poŞ_±rs
Õfvf, 
rx_cq
);

574 
	`Ùx2_wr™e64
(
pfvf
, 
	`NIX_LF_CINTX_INT
(
cq_pŞl
->
cšt_idx
), 
	`BIT_ULL
(0));

576 ià(
wÜkdÚe
 < 
budg‘
 && 
	`Çpi_com¶‘e_dÚe
(
Çpi
, workdone)) {

578 ià(
pfvf
->
æags
 & 
OTX2_FLAG_INTF_DOWN
)

579  
wÜkdÚe
;

582 ià(
pfvf
->
æags
 & 
OTX2_FLAG_ADPTV_INT_COAL_ENABLED
)

583 
	`Ùx2_adju¡_ad­tive_cßË£
(
pfvf
, 
cq_pŞl
);

586 
	`Ùx2_wr™e64
(
pfvf
, 
	`NIX_LF_CINTX_ENA_W1S
(
cq_pŞl
->
cšt_idx
),

587 
	`BIT_ULL
(0));

589  
wÜkdÚe
;

590 
	}
}

592 
	$Ùx2_sqe_æush
(*
dev
, 
Ùx2_¢d_queue
 *
sq
,

593 
size
, 
qidx
)

595 
u64
 
¡©us
;

598 
	`dma_wmb
();

601 
	`memıy
(
sq
->
lmt_addr
, sq->
sqe_ba£
, 
size
);

602 
¡©us
 = 
	`Ùx2_lmt_æush
(
sq
->
io_addr
);

603 } 
¡©us
 == 0);

605 
sq
->
h—d
++;

606 
sq
->
h—d
 &ğ(sq->
sqe_út
 - 1);

607 
	}
}

609 
	#MAX_SEGS_PER_SG
 3

	)

611 
boŞ
 
	$Ùx2_sqe_add_sg
(
Ùx2_nic
 *
pfvf
, 
Ùx2_¢d_queue
 *
sq
,

612 
sk_buff
 *
skb
, 
num_£gs
, *
off£t
)

614 
nix_sqe_sg_s
 *
sg
 = 
NULL
;

615 
u64
 
dma_addr
, *
iova
 = 
NULL
;

616 
u16
 *
sg_Ëns
 = 
NULL
;

617 
£g
, 
Ën
;

619 
sq
->
sg
[sq->
h—d
].
num_£gs
 = 0;

621 
£g
 = 0; seg < 
num_£gs
; seg++) {

622 ià((
£g
 % 
MAX_SEGS_PER_SG
) == 0) {

623 
sg
 = (
nix_sqe_sg_s
 *)(
sq
->
sqe_ba£
 + *
off£t
);

624 
sg
->
ld_ty³
 = 
NIX_SEND_LDTYPE_LDD
;

625 
sg
->
subdc
 = 
NIX_SUBDC_SG
;

626 
sg
->
£gs
 = 0;

627 
sg_Ëns
 = (*)
sg
;

628 
iova
 = (*)
sg
 + (*sg);

632 ià((
num_£gs
 - 
£g
è>ğ(
MAX_SEGS_PER_SG
 - 1))

633 *
off£t
 +ğ(*
sg
è+ (3 * (
u64
));

635 *
off£t
 +ğ(*
sg
è+ (
u64
);

637 
dma_addr
 = 
	`Ùx2_dma_m­_skb_äag
(
pfvf
, 
skb
, 
£g
, &
Ën
);

638 ià(
	`dma_m­pšg_”rÜ
(
pfvf
->
dev
, 
dma_addr
))

639  
çl£
;

641 
sg_Ëns
[
	`äag_num
(
£g
 % 
MAX_SEGS_PER_SG
)] = 
Ën
;

642 
sg
->
£gs
++;

643 *
iova
++ = 
dma_addr
;

646 
sq
->
sg
[sq->
h—d
].
dma_addr
[
£g
] = dma_addr;

647 
sq
->
sg
[sq->
h—d
].
size
[
£g
] = 
Ën
;

648 
sq
->
sg
[sq->
h—d
].
num_£gs
++;

651 
sq
->
sg
[sq->
h—d
].
skb
 = (
u64
)skb;

652  
Œue
;

653 
	}
}

656 
	$Ùx2_sqe_add_ext
(
Ùx2_nic
 *
pfvf
, 
Ùx2_¢d_queue
 *
sq
,

657 
sk_buff
 *
skb
, *
off£t
)

659 
nix_sqe_ext_s
 *
ext
;

661 
ext
 = (
nix_sqe_ext_s
 *)(
sq
->
sqe_ba£
 + *
off£t
);

662 
ext
->
subdc
 = 
NIX_SUBDC_EXT
;

663 ià(
	`skb_shšfo
(
skb
)->
gso_size
) {

664 
ext
->
lso
 = 1;

665 
ext
->
lso_sb
 = 
	`skb_Œª¥Üt_off£t
(
skb
è+ 
	`tı_hd¾’
(skb);

666 
ext
->
lso_mps
 = 
	`skb_shšfo
(
skb
)->
gso_size
;

669 ià(
	`skb_shšfo
(
skb
)->
gso_ty³
 & 
SKB_GSO_TCPV4
) {

670 
ext
->
lso_fÜm©
 = 
pfvf
->
hw
.
lso_tsov4_idx
;

676 
	`_hdr
(
skb
)->
tÙ_Ën
 =

677 
	`htÚs
(
ext
->
lso_sb
 - 
	`skb_ÃtwÜk_off£t
(
skb
));

678 } ià(
	`skb_shšfo
(
skb
)->
gso_ty³
 & 
SKB_GSO_TCPV6
) {

679 
ext
->
lso_fÜm©
 = 
pfvf
->
hw
.
lso_tsov6_idx
;

680 
	`v6_hdr
(
skb
)->
·ylßd_Ën
 = 
	`htÚs
(
	`tı_hd¾’
(skb));

681 } ià(
	`skb_shšfo
(
skb
)->
gso_ty³
 & 
SKB_GSO_UDP_L4
) {

682 
__be16
 
l3_´Ùo
 = 
	`vÏn_g‘_´ÙocŞ
(
skb
);

683 
udphdr
 *
udph
 = 
	`udp_hdr
(
skb
);

684 
u16
 
Ën
;

686 
ext
->
lso_sb
 = 
	`skb_Œª¥Üt_off£t
(
skb
) +

687 (
udphdr
);

693 
Ën
 = 
	`htÚs
(
ext
->
lso_sb
 - 
	`skb_ÃtwÜk_off£t
(
skb
));

694 ià(
l3_´Ùo
 =ğ
	`htÚs
(
ETH_P_IP
)) {

695 
	`_hdr
(
skb
)->
tÙ_Ën
 = 
Ën
;

696 
ext
->
lso_fÜm©
 = 
pfvf
->
hw
.
lso_udpv4_idx
;

698 
	`v6_hdr
(
skb
)->
·ylßd_Ën
 = 
Ën
;

699 
ext
->
lso_fÜm©
 = 
pfvf
->
hw
.
lso_udpv6_idx
;

702 
udph
->
Ën
 = 
	`htÚs
((
udphdr
));

704 } ià(
	`skb_shšfo
(
skb
)->
tx_æags
 & 
SKBTX_HW_TSTAMP
) {

705 
ext
->
t¡mp
 = 1;

708 
	#OTX2_VLAN_PTR_OFFSET
 (
ETH_HLEN
 - 
ETH_TLEN
)

	)

709 ià(
	`skb_vÏn_g_´e£Á
(
skb
)) {

710 ià(
skb
->
vÏn_´Ùo
 =ğ
	`htÚs
(
ETH_P_8021Q
)) {

711 
ext
->
vÏn1_šs_’a
 = 1;

712 
ext
->
vÏn1_šs_±r
 = 
OTX2_VLAN_PTR_OFFSET
;

713 
ext
->
vÏn1_šs_tci
 = 
	`skb_vÏn_g_g‘
(
skb
);

714 } ià(
skb
->
vÏn_´Ùo
 =ğ
	`htÚs
(
ETH_P_8021AD
)) {

715 
ext
->
vÏn0_šs_’a
 = 1;

716 
ext
->
vÏn0_šs_±r
 = 
OTX2_VLAN_PTR_OFFSET
;

717 
ext
->
vÏn0_šs_tci
 = 
	`skb_vÏn_g_g‘
(
skb
);

721 *
off£t
 +ğ(*
ext
);

722 
	}
}

724 
	$Ùx2_sqe_add_mem
(
Ùx2_¢d_queue
 *
sq
, *
off£t
,

725 
®g
, 
u64
 
iova
, 
±p_off£t
,

726 
u64
 
ba£_ns
, 
udp_csum
)

728 
nix_sqe_mem_s
 *
mem
;

730 
mem
 = (
nix_sqe_mem_s
 *)(
sq
->
sqe_ba£
 + *
off£t
);

731 
mem
->
subdc
 = 
NIX_SUBDC_MEM
;

732 
mem
->
®g
 =‡lg;

733 
mem
->
wmem
 = 1;

734 
mem
->
addr
 = 
iova
;

736 ià(
±p_off£t
) {

737 
mem
->
¡¬t_off£t
 = 
±p_off£t
;

738 
mem
->
udp_csum_üt
 = 
udp_csum
;

739 
mem
->
ba£_ns
 = base_ns;

740 
mem
->
¡•_ty³
 = 1;

743 *
off£t
 +ğ(*
mem
);

744 
	}
}

747 
	$Ùx2_sqe_add_hdr
(
Ùx2_nic
 *
pfvf
, 
Ùx2_¢d_queue
 *
sq
,

748 
nix_sqe_hdr_s
 *
sqe_hdr
,

749 
sk_buff
 *
skb
, 
u16
 
qidx
)

751 
´Ùo
 = 0;

756 ià(!
sqe_hdr
->
tÙ®
) {

758 
sqe_hdr
->
df
 = 1;

759 
sqe_hdr
->
au¿
 = 
sq
->
au¿_id
;

761 
sqe_hdr
->
²c
 = 1;

762 ià(
qidx
 >ğ
pfvf
->
hw
.
tx_queues
)

763 
sqe_hdr
->
sq
 = 
qidx
 + 
pfvf
->
hw
.
xdp_queues
;

765 
sqe_hdr
->
sq
 = 
qidx
;

767 
sqe_hdr
->
tÙ®
 = 
skb
->
Ën
;

769 
sqe_hdr
->
sqe_id
 = 
sq
->
h—d
;

772 ià(
skb
->
_summed
 =ğ
CHECKSUM_PARTIAL
) {

773 
sqe_hdr
->
Ş3±r
 = 
	`skb_ÃtwÜk_off£t
(
skb
);

774 
sqe_hdr
->
Ş4±r
 = 
	`skb_Œª¥Üt_off£t
(
skb
);

776 ià(
	`‘h_ty³_vÏn
(
skb
->
´ÙocŞ
))

777 
skb
->
´ÙocŞ
 = 
	`vÏn_g‘_´ÙocŞ
(skb);

779 ià(
skb
->
´ÙocŞ
 =ğ
	`htÚs
(
ETH_P_IP
)) {

780 
´Ùo
 = 
	`_hdr
(
skb
)->
´ÙocŞ
;

784 
sqe_hdr
->
Ş3ty³
 = 
NIX_SENDL3TYPE_IP4_CKSUM
;

785 } ià(
skb
->
´ÙocŞ
 =ğ
	`htÚs
(
ETH_P_IPV6
)) {

786 
´Ùo
 = 
	`v6_hdr
(
skb
)->
Ãxthdr
;

787 
sqe_hdr
->
Ş3ty³
 = 
NIX_SENDL3TYPE_IP6
;

790 ià(
´Ùo
 =ğ
IPPROTO_TCP
)

791 
sqe_hdr
->
Ş4ty³
 = 
NIX_SENDL4TYPE_TCP_CKSUM
;

792 ià(
´Ùo
 =ğ
IPPROTO_UDP
)

793 
sqe_hdr
->
Ş4ty³
 = 
NIX_SENDL4TYPE_UDP_CKSUM
;

795 
	}
}

797 
	$Ùx2_dma_m­_tso_skb
(
Ùx2_nic
 *
pfvf
,

798 
Ùx2_¢d_queue
 *
sq
,

799 
sk_buff
 *
skb
, 
sqe
, 
hdr_Ën
)

801 
num_£gs
 = 
	`skb_shšfo
(
skb
)->
Ä_äags
 + 1;

802 
sg_li¡
 *
sg
 = &
sq
->sg[
sqe
];

803 
u64
 
dma_addr
;

804 
£g
, 
Ën
;

806 
sg
->
num_£gs
 = 0;

809 
Ën
 = 
	`skb_h—dËn
(
skb
è- 
hdr_Ën
;

811 
£g
 = 0; seg < 
num_£gs
; seg++) {

813 ià(!
£g
 && !
Ën
)

815 
dma_addr
 = 
	`Ùx2_dma_m­_skb_äag
(
pfvf
, 
skb
, 
£g
, &
Ën
);

816 ià(
	`dma_m­pšg_”rÜ
(
pfvf
->
dev
, 
dma_addr
))

817 
unm­
;

820 
sg
->
dma_addr
[sg->
num_£gs
] = dma_addr;

821 
sg
->
size
[sg->
num_£gs
] = 
Ën
;

822 
sg
->
num_£gs
++;

825 
unm­
:

826 
	`Ùx2_dma_unm­_skb_äags
(
pfvf
, 
sg
);

827  -
EINVAL
;

828 
	}
}

830 
u64
 
	$Ùx2_tso_äag_dma_addr
(
Ùx2_¢d_queue
 *
sq
,

831 
sk_buff
 *
skb
, 
£g
,

832 
u64
 
£g_addr
, 
hdr_Ën
, 
sqe
)

834 
sg_li¡
 *
sg
 = &
sq
->sg[
sqe
];

835 cÚ¡ 
skb_äag_t
 *
äag
;

836 
off£t
;

838 ià(
£g
 < 0)

839  
sg
->
dma_addr
[0] + (
£g_addr
 - (
u64
)
skb
->
d©a
);

841 
äag
 = &
	`skb_shšfo
(
skb
)->
äags
[
£g
];

842 
off£t
 = 
£g_addr
 - (
u64
)
	`skb_äag_add»ss
(
äag
);

843 ià(
	`skb_h—dËn
(
skb
è- 
hdr_Ën
)

844 
£g
++;

845  
sg
->
dma_addr
[
£g
] + 
off£t
;

846 
	}
}

848 
	$Ùx2_sqe_tso_add_sg
(
Ùx2_¢d_queue
 *
sq
,

849 
sg_li¡
 *
li¡
, *
off£t
)

851 
nix_sqe_sg_s
 *
sg
 = 
NULL
;

852 
u16
 *
sg_Ëns
 = 
NULL
;

853 
u64
 *
iova
 = 
NULL
;

854 
£g
;

857 
£g
 = 0; seg < 
li¡
->
num_£gs
; seg++) {

858 ià((
£g
 % 
MAX_SEGS_PER_SG
) == 0) {

859 
sg
 = (
nix_sqe_sg_s
 *)(
sq
->
sqe_ba£
 + *
off£t
);

860 
sg
->
ld_ty³
 = 
NIX_SEND_LDTYPE_LDD
;

861 
sg
->
subdc
 = 
NIX_SUBDC_SG
;

862 
sg
->
£gs
 = 0;

863 
sg_Ëns
 = (*)
sg
;

864 
iova
 = (*)
sg
 + (*sg);

868 ià((
li¡
->
num_£gs
 - 
£g
è>ğ(
MAX_SEGS_PER_SG
 - 1))

869 *
off£t
 +ğ(*
sg
è+ (3 * (
u64
));

871 *
off£t
 +ğ(*
sg
è+ (
u64
);

873 
sg_Ëns
[
	`äag_num
(
£g
 % 
MAX_SEGS_PER_SG
)] = 
li¡
->
size
[seg];

874 *
iova
++ = 
li¡
->
dma_addr
[
£g
];

875 
sg
->
£gs
++;

877 
	}
}

879 
	$Ùx2_sq_­³nd_tso
(
Ùx2_nic
 *
pfvf
, 
Ùx2_¢d_queue
 *
sq
,

880 
sk_buff
 *
skb
, 
u16
 
qidx
)

882 
Ãtdev_queue
 *
txq
 = 
	`Ãtdev_g‘_tx_queue
(
pfvf
->
Ãtdev
, 
qidx
);

883 
hdr_Ën
 = 
	`skb_Œª¥Üt_off£t
(
skb
è+ 
	`tı_hd¾’
(skb);

884 
tı_d©a
, 
£g_Ën
, 
pkt_Ën
, 
off£t
;

885 
nix_sqe_hdr_s
 *
sqe_hdr
;

886 
fœ¡_sqe
 = 
sq
->
h—d
;

887 
sg_li¡
 
li¡
;

888 
tso_t
 
tso
;

893 ià(
	`Ùx2_dma_m­_tso_skb
(
pfvf
, 
sq
, 
skb
, 
fœ¡_sqe
, 
hdr_Ën
)) {

894 
	`dev_kä“_skb_ªy
(
skb
);

898 
	`Ãtdev_tx_£Á_queue
(
txq
, 
skb
->
Ën
);

900 
	`tso_¡¬t
(
skb
, &
tso
);

901 
tı_d©a
 = 
skb
->
Ën
 - 
hdr_Ën
;

902 
tı_d©a
 > 0) {

903 *
hdr
;

905 
£g_Ën
 = 
	`mš_t
(, 
	`skb_shšfo
(
skb
)->
gso_size
, 
tı_d©a
);

906 
tı_d©a
 -ğ
£g_Ën
;

909 
	`mem£t
(
sq
->
sqe_ba£
, 0, sq->
sqe_size
);

910 
sqe_hdr
 = (
nix_sqe_hdr_s
 *)(
sq
->
sqe_ba£
);

911 
	`Ùx2_sqe_add_hdr
(
pfvf
, 
sq
, 
sqe_hdr
, 
skb
, 
qidx
);

912 
off£t
 = (*
sqe_hdr
);

915 
hdr
 = 
sq
->
tso_hdrs
->
ba£
 + (sq->
h—d
 * 
TSO_HEADER_SIZE
);

916 
	`tso_bud_hdr
(
skb
, 
hdr
, &
tso
, 
£g_Ën
, 
tı_d©a
 == 0);

917 
li¡
.
dma_addr
[0] =

918 
sq
->
tso_hdrs
->
iova
 + (sq->
h—d
 * 
TSO_HEADER_SIZE
);

919 
li¡
.
size
[0] = 
hdr_Ën
;

920 
li¡
.
num_£gs
 = 1;

923 
pkt_Ën
 = 
hdr_Ën
;

924 
£g_Ën
 > 0) {

925 
size
;

927 
size
 = 
	`mš_t
(, 
tso
.size, 
£g_Ën
);

929 
li¡
.
size
[li¡.
num_£gs
] = size;

930 
li¡
.
dma_addr
[li¡.
num_£gs
] =

931 
	`Ùx2_tso_äag_dma_addr
(
sq
, 
skb
,

932 
tso
.
Ãxt_äag_idx
 - 1,

933 (
u64
)
tso
.
d©a
, 
hdr_Ën
,

934 
fœ¡_sqe
);

935 
li¡
.
num_£gs
++;

936 
pkt_Ën
 +ğ
size
;

937 
£g_Ën
 -ğ
size
;

938 
	`tso_bud_d©a
(
skb
, &
tso
, 
size
);

940 
sqe_hdr
->
tÙ®
 = 
pkt_Ën
;

941 
	`Ùx2_sqe_tso_add_sg
(
sq
, &
li¡
, &
off£t
);

949 ià(!
tı_d©a
) {

950 
sqe_hdr
->
²c
 = 1;

951 
sqe_hdr
->
sqe_id
 = 
fœ¡_sqe
;

952 
sq
->
sg
[
fœ¡_sqe
].
skb
 = (
u64
)skb;

954 
sqe_hdr
->
²c
 = 0;

957 
sqe_hdr
->
sizem1
 = (
off£t
 / 16) - 1;

960 
pfvf
->
hw_İs
->
	`sqe_æush
Õfvf, 
sq
, 
off£t
, 
qidx
);

962 
	}
}

964 
boŞ
 
	$is_hw_tso_suµÜ‹d
(
Ùx2_nic
 *
pfvf
,

965 
sk_buff
 *
skb
)

967 
·ylßd_Ën
, 
Ï¡_£g_size
;

969 ià(
	`‹¡_b™
(
HW_TSO
, &
pfvf
->
hw
.
ÿp_æag
))

970  
Œue
;

973 ià(!
	`is_96xx_B0
(
pfvf
->
pdev
))

974  
çl£
;

981 
·ylßd_Ën
 = 
skb
->
Ën
 - (
	`skb_Œª¥Üt_off£t
(skbè+ 
	`tı_hd¾’
(skb));

982 
Ï¡_£g_size
 = 
·ylßd_Ën
 % 
	`skb_shšfo
(
skb
)->
gso_size
;

983 ià(
Ï¡_£g_size
 &&†ast_seg_size < 16)

984  
çl£
;

986  
Œue
;

987 
	}
}

989 
	$Ùx2_g‘_sqe_couÁ
(
Ùx2_nic
 *
pfvf
, 
sk_buff
 *
skb
)

991 ià(!
	`skb_shšfo
(
skb
)->
gso_size
)

995 ià(
	`is_hw_tso_suµÜ‹d
(
pfvf
, 
skb
))

999  
	`skb_shšfo
(
skb
)->
gso_£gs
;

1000 
	}
}

1002 
boŞ
 
	$Ùx2_v®id©e_ÃtwÜk_Œª¥Üt
(
sk_buff
 *
skb
)

1004 ià((
	`_hdr
(
skb
)->
´ÙocŞ
 =ğ
IPPROTO_UDP
) ||

1005 (
	`v6_hdr
(
skb
)->
Ãxthdr
 =ğ
IPPROTO_UDP
)) {

1006 
udphdr
 *
udph
 = 
	`udp_hdr
(
skb
);

1008 ià(
udph
->
sourû
 =ğ
	`htÚs
(
PTP_PORT
) &&

1009 
udph
->
de¡
 =ğ
	`htÚs
(
PTP_PORT
))

1010  
Œue
;

1013  
çl£
;

1014 
	}
}

1016 
boŞ
 
	$Ùx2_±p_is_sync
(
sk_buff
 *
skb
, *
off£t
, *
udp_csum
)

1018 
‘hhdr
 *
‘h
 = (‘hhd¸*)(
skb
->
d©a
);

1019 
u16
 
nix_ofæßd_hËn
 = 0, 
šÃr_vhËn
 = 0;

1020 
u8
 *
d©a
 = 
skb
->d©a, *
msgty³
;

1021 
u16
 
´Ùo
 = 
‘h
->
h_´Ùo
;

1022 
ÃtwÜk_d•th
 = 0;

1028 ià(
skb
->
dev
->
ã©u»s
 & 
NETIF_F_HW_VLAN_CTAG_TX
 &&

1029 
skb
->
dev
->
ã©u»s
 & 
NETIF_F_HW_VLAN_STAG_TX
) {

1030 ià(
skb
->
vÏn_´Ùo
 =ğ
	`htÚs
(
ETH_P_8021AD
)) {

1032 
´Ùo
 = 
	`__vÏn_g‘_´ÙocŞ
(
skb
, 
‘h
->
h_´Ùo
, 
NULL
);

1037 
nix_ofæßd_hËn
 = 
VLAN_HLEN
;

1038 
šÃr_vhËn
 = 
VLAN_HLEN
;

1039 } ià(
skb
->
vÏn_´Ùo
 =ğ
	`htÚs
(
ETH_P_8021Q
)) {

1040 
nix_ofæßd_hËn
 = 
VLAN_HLEN
;

1042 } ià(
	`‘h_ty³_vÏn
(
‘h
->
h_´Ùo
)) {

1043 
´Ùo
 = 
	`__vÏn_g‘_´ÙocŞ
(
skb
, 
‘h
->
h_´Ùo
, &
ÃtwÜk_d•th
);

1046 
	`htÚs
(
´Ùo
)) {

1047 
ETH_P_1588
:

1048 ià(
ÃtwÜk_d•th
)

1049 *
off£t
 = 
ÃtwÜk_d•th
;

1051 *
off£t
 = 
ETH_HLEN
 + 
nix_ofæßd_hËn
 +

1052 
šÃr_vhËn
;

1054 
ETH_P_IP
:

1055 
ETH_P_IPV6
:

1056 ià(!
	`Ùx2_v®id©e_ÃtwÜk_Œª¥Üt
(
skb
))

1057  
çl£
;

1059 *
udp_csum
 = 1;

1060 *
off£t
 = 
nix_ofæßd_hËn
 + 
	`skb_Œª¥Üt_off£t
(
skb
) +

1061 (
udphdr
);

1064 
msgty³
 = 
d©a
 + *
off£t
;

1067  (*
msgty³
 & 0xf) == 0;

1068 
	}
}

1070 
	$Ùx2_£t_txt¡amp
(
Ùx2_nic
 *
pfvf
, 
sk_buff
 *
skb
,

1071 
Ùx2_¢d_queue
 *
sq
, *
off£t
)

1073 
±pv2_t¡amp
 *
Üigš_t¡amp
;

1074 
±p_off£t
 = 0, 
udp_csum
 = 0;

1075 
time¥ec64
 
ts
;

1076 
u64
 
iova
;

1078 ià(
	`uÆik–y
(!
	`skb_shšfo
(
skb
)->
gso_size
 &&

1079 (
	`skb_shšfo
(
skb
)->
tx_æags
 & 
SKBTX_HW_TSTAMP
))) {

1080 ià(
	`uÆik–y
(
pfvf
->
æags
 & 
OTX2_FLAG_PTP_ONESTEP_SYNC
 &&

1081 
	`Ùx2_±p_is_sync
(
skb
, &
±p_off£t
, &
udp_csum
))) {

1082 
Üigš_t¡amp
 = (
±pv2_t¡amp
 *)

1083 ((
u8
 *)
skb
->
d©a
 + 
±p_off£t
 +

1084 
PTP_SYNC_SEC_OFFSET
);

1085 
ts
 = 
	`ns_to_time¥ec64
(
pfvf
->
±p
->
t¡amp
);

1086 
Üigš_t¡amp
->
£cÚds_msb
 = 
	`Áohs
((
ts
.
tv_£c
 >> 32) & 0xffff);

1087 
Üigš_t¡amp
->
£cÚds_lsb
 = 
	`Áohl
(
ts
.
tv_£c
 & 0xffffffff);

1088 
Üigš_t¡amp
->
Çno£cÚds
 = 
	`Áohl
(
ts
.
tv_n£c
);

1090 
±p_off£t
 += 8;

1092 
	`skb_shšfo
(
skb
)->
tx_æags
 |ğ
SKBTX_IN_PROGRESS
;

1094 
iova
 = 
sq
->
time¡amps
->iov¨+ (sq->
h—d
 * (
u64
));

1095 
	`Ùx2_sqe_add_mem
(
sq
, 
off£t
, 
NIX_SENDMEMALG_E_SETTSTMP
, 
iova
,

1096 
±p_off£t
, 
pfvf
->
±p
->
ba£_ns
, 
udp_csum
);

1098 
	`skb_tx_time¡amp
(
skb
);

1100 
	}
}

1102 
boŞ
 
	$Ùx2_sq_­³nd_skb
(
Ãt_deviû
 *
Ãtdev
, 
Ùx2_¢d_queue
 *
sq
,

1103 
sk_buff
 *
skb
, 
u16
 
qidx
)

1105 
Ãtdev_queue
 *
txq
 = 
	`Ãtdev_g‘_tx_queue
(
Ãtdev
, 
qidx
);

1106 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

1107 
off£t
, 
num_£gs
, 
ä“_desc
;

1108 
nix_sqe_hdr_s
 *
sqe_hdr
;

1113 
ä“_desc
 = (
sq
->
cÚs_h—d
 - sq->
h—d
 - 1 + sq->
sqe_út
) & (sq->sqe_cnt - 1);

1114 ià(
ä“_desc
 < 
sq
->
sqe_th»sh
)

1115  
çl£
;

1117 ià(
ä“_desc
 < 
	`Ùx2_g‘_sqe_couÁ
(
pfvf
, 
skb
))

1118  
çl£
;

1120 
num_£gs
 = 
	`skb_shšfo
(
skb
)->
Ä_äags
 + 1;

1125 ià(
	`uÆik–y
(
num_£gs
 > 
OTX2_MAX_FRAGS_IN_SQE
)) {

1126 ià(
	`__skb_lš—rize
(
skb
)) {

1127 
	`dev_kä“_skb_ªy
(
skb
);

1128  
Œue
;

1130 
num_£gs
 = 
	`skb_shšfo
(
skb
)->
Ä_äags
 + 1;

1133 ià(
	`skb_shšfo
(
skb
)->
gso_size
 && !
	`is_hw_tso_suµÜ‹d
(
pfvf
, skb)) {

1135 ià(
	`skb_vÏn_g_´e£Á
(
skb
)) {

1136 
skb
 = 
	`__vÏn_hwacûl_push_šside
(skb);

1137 ià(!
skb
)

1138  
çl£
;

1141 
	`Ùx2_sq_­³nd_tso
(
pfvf
, 
sq
, 
skb
, 
qidx
);

1142  
Œue
;

1148 
	`mem£t
(
sq
->
sqe_ba£
 + 8, 0, sq->
sqe_size
 - 8);

1149 
sqe_hdr
 = (
nix_sqe_hdr_s
 *)(
sq
->
sqe_ba£
);

1150 
	`Ùx2_sqe_add_hdr
(
pfvf
, 
sq
, 
sqe_hdr
, 
skb
, 
qidx
);

1151 
off£t
 = (*
sqe_hdr
);

1154 
	`Ùx2_sqe_add_ext
(
pfvf
, 
sq
, 
skb
, &
off£t
);

1157 ià(!
	`Ùx2_sqe_add_sg
(
pfvf
, 
sq
, 
skb
, 
num_£gs
, &
off£t
)) {

1158 
	`Ùx2_dma_unm­_skb_äags
(
pfvf
, &
sq
->
sg
[sq->
h—d
]);

1159  
çl£
;

1162 
	`Ùx2_£t_txt¡amp
(
pfvf
, 
skb
, 
sq
, &
off£t
);

1164 
sqe_hdr
->
sizem1
 = (
off£t
 / 16) - 1;

1166 
	`Ãtdev_tx_£Á_queue
(
txq
, 
skb
->
Ën
);

1169 
pfvf
->
hw_İs
->
	`sqe_æush
Õfvf, 
sq
, 
off£t
, 
qidx
);

1171  
Œue
;

1172 
	}
}

1173 
EXPORT_SYMBOL
(
Ùx2_sq_­³nd_skb
);

1175 
	$Ùx2_ş—nup_rx_cqes
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
)

1177 
nix_cqe_rx_s
 *
cqe
;

1178 
´oûs£d_cqe
 = 0;

1179 
u64
 
iova
, 
·
;

1181 ià(
	`Ùx2_nix_cq_İ_¡©us
(
pfvf
, 
cq
è|| !cq->
³nd_cqe
)

1184 
cq
->
³nd_cqe
) {

1185 
cqe
 = (
nix_cqe_rx_s
 *)
	`Ùx2_g‘_Ãxt_cqe
(
cq
);

1186 
´oûs£d_cqe
++;

1187 
cq
->
³nd_cqe
--;

1189 ià(!
cqe
)

1191 ià(
cqe
->
sg
.
£gs
 > 1) {

1192 
	`Ùx2_ä“_rcv_£g
(
pfvf
, 
cqe
, 
cq
->
cq_idx
);

1195 
iova
 = 
cqe
->
sg
.
£g_addr
 - 
OTX2_HEAD_ROOM
;

1196 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

1197 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
iova
,…fvf->
rbsize
, 
DMA_FROM_DEVICE
);

1198 
	`put_·ge
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
)));

1202 
	`Ùx2_wr™e64
(
pfvf
, 
NIX_LF_CQ_OP_DOOR
,

1203 ((
u64
)
cq
->
cq_idx
 << 32è| 
´oûs£d_cqe
);

1204 
	}
}

1206 
	$Ùx2_ş—nup_tx_cqes
(
Ùx2_nic
 *
pfvf
, 
Ùx2_cq_queue
 *
cq
)

1208 
tx_pkts
 = 0, 
tx_by‹s
 = 0;

1209 
sk_buff
 *
skb
 = 
NULL
;

1210 
Ùx2_¢d_queue
 *
sq
;

1211 
nix_cqe_tx_s
 *
cqe
;

1212 
Ãtdev_queue
 *
txq
;

1213 
´oûs£d_cqe
 = 0;

1214 
sg_li¡
 *
sg
;

1215 
qidx
;

1217 
qidx
 = 
cq
->
cq_idx
 - 
pfvf
->
hw
.
rx_queues
;

1218 
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

1220 ià(
	`Ùx2_nix_cq_İ_¡©us
(
pfvf
, 
cq
è|| !cq->
³nd_cqe
)

1223 
cq
->
³nd_cqe
) {

1224 
cqe
 = (
nix_cqe_tx_s
 *)
	`Ùx2_g‘_Ãxt_cqe
(
cq
);

1225 
´oûs£d_cqe
++;

1226 
cq
->
³nd_cqe
--;

1228 ià(!
cqe
)

1230 
sg
 = &
sq
->sg[
cqe
->
comp
.
sqe_id
];

1231 
skb
 = (
sk_buff
 *)
sg
->skb;

1232 ià(
skb
) {

1233 
tx_by‹s
 +ğ
skb
->
Ën
;

1234 
tx_pkts
++;

1235 
	`Ùx2_dma_unm­_skb_äags
(
pfvf
, 
sg
);

1236 
	`dev_kä“_skb_ªy
(
skb
);

1237 
sg
->
skb
 = (
u64
)
NULL
;

1241 ià(
	`lik–y
(
tx_pkts
)) {

1242 ià(
qidx
 >ğ
pfvf
->
hw
.
tx_queues
)

1243 
qidx
 -ğ
pfvf
->
hw
.
xdp_queues
;

1244 
txq
 = 
	`Ãtdev_g‘_tx_queue
(
pfvf
->
Ãtdev
, 
qidx
);

1245 
	`Ãtdev_tx_com¶‘ed_queue
(
txq
, 
tx_pkts
, 
tx_by‹s
);

1248 
	`Ùx2_wr™e64
(
pfvf
, 
NIX_LF_CQ_OP_DOOR
,

1249 ((
u64
)
cq
->
cq_idx
 << 32è| 
´oûs£d_cqe
);

1250 
	}
}

1252 
	$Ùx2_rxtx_’abË
(
Ùx2_nic
 *
pfvf
, 
boŞ
 
’abË
)

1254 
msg_»q
 *
msg
;

1255 
”r
;

1257 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

1258 ià(
’abË
)

1259 
msg
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_¡¬t_rx
(&
pfvf
->
mbox
);

1261 
msg
 = 
	`Ùx2_mbox_®loc_msg_nix_lf_¡İ_rx
(&
pfvf
->
mbox
);

1263 ià(!
msg
) {

1264 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1265  -
ENOMEM
;

1268 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

1269 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

1270  
”r
;

1271 
	}
}

1273 
	$Ùx2_ä“_³ndšg_sqe
(
Ùx2_nic
 *
pfvf
)

1275 
tx_pkts
 = 0, 
tx_by‹s
 = 0;

1276 
sk_buff
 *
skb
 = 
NULL
;

1277 
Ùx2_¢d_queue
 *
sq
;

1278 
Ãtdev_queue
 *
txq
;

1279 
sg_li¡
 *
sg
;

1280 
sq_idx
, 
sqe
;

1282 
sq_idx
 = 0; sq_idx < 
pfvf
->
hw
.
tx_queues
; sq_idx++) {

1283 
sq
 = &
pfvf
->
q£t
.sq[
sq_idx
];

1284 
sqe
 = 0; sq< 
sq
->
sqe_út
; sqe++) {

1285 
sg
 = &
sq
->sg[
sqe
];

1286 
skb
 = (
sk_buff
 *)
sg
->skb;

1287 ià(
skb
) {

1288 
tx_by‹s
 +ğ
skb
->
Ën
;

1289 
tx_pkts
++;

1290 
	`Ùx2_dma_unm­_skb_äags
(
pfvf
, 
sg
);

1291 
	`dev_kä“_skb_ªy
(
skb
);

1292 
sg
->
skb
 = (
u64
)
NULL
;

1296 ià(!
tx_pkts
)

1298 
txq
 = 
	`Ãtdev_g‘_tx_queue
(
pfvf
->
Ãtdev
, 
sq_idx
);

1299 
	`Ãtdev_tx_com¶‘ed_queue
(
txq
, 
tx_pkts
, 
tx_by‹s
);

1300 
tx_pkts
 = 0;

1301 
tx_by‹s
 = 0;

1303 
	}
}

1305 
šlše
 
	$Ùx2_xdp_sqe_add_sg
(
Ùx2_¢d_queue
 *
sq
, 
u64
 
dma_addr
,

1306 
Ën
, *
off£t
)

1308 
nix_sqe_sg_s
 *
sg
 = 
NULL
;

1309 
u64
 *
iova
 = 
NULL
;

1311 
sg
 = (
nix_sqe_sg_s
 *)(
sq
->
sqe_ba£
 + *
off£t
);

1312 
sg
->
ld_ty³
 = 
NIX_SEND_LDTYPE_LDD
;

1313 
sg
->
subdc
 = 
NIX_SUBDC_SG
;

1314 
sg
->
£gs
 = 1;

1315 
sg
->
£g1_size
 = 
Ën
;

1316 
iova
 = (*)
sg
 + (*sg);

1317 *
iova
 = 
dma_addr
;

1318 *
off£t
 +ğ(*
sg
è+ (
u64
);

1320 
sq
->
sg
[sq->
h—d
].
dma_addr
[0] = dma_addr;

1321 
sq
->
sg
[sq->
h—d
].
size
[0] = 
Ën
;

1322 
sq
->
sg
[sq->
h—d
].
num_£gs
 = 1;

1323 
	}
}

1325 
boŞ
 
	$Ùx2_xdp_sq_­³nd_pkt
(
Ùx2_nic
 *
pfvf
, 
u64
 
iova
, 
Ën
, 
u16
 
qidx
)

1327 
nix_sqe_hdr_s
 *
sqe_hdr
;

1328 
Ùx2_¢d_queue
 *
sq
;

1329 
off£t
, 
ä“_sqe
;

1331 
sq
 = &
pfvf
->
q£t
.sq[
qidx
];

1332 
ä“_sqe
 = (
sq
->
num_sqbs
 - *sq->
au¿_fc_addr
è* sq->
sqe_³r_sqb
;

1333 ià(
ä“_sqe
 < 
sq
->
sqe_th»sh
)

1334  
çl£
;

1336 
	`mem£t
(
sq
->
sqe_ba£
 + 8, 0, sq->
sqe_size
 - 8);

1338 
sqe_hdr
 = (
nix_sqe_hdr_s
 *)(
sq
->
sqe_ba£
);

1340 ià(!
sqe_hdr
->
tÙ®
) {

1341 
sqe_hdr
->
au¿
 = 
sq
->
au¿_id
;

1342 
sqe_hdr
->
df
 = 1;

1343 
sqe_hdr
->
sq
 = 
qidx
;

1344 
sqe_hdr
->
²c
 = 1;

1346 
sqe_hdr
->
tÙ®
 = 
Ën
;

1347 
sqe_hdr
->
sqe_id
 = 
sq
->
h—d
;

1349 
off£t
 = (*
sqe_hdr
);

1351 
	`Ùx2_xdp_sqe_add_sg
(
sq
, 
iova
, 
Ën
, &
off£t
);

1352 
sqe_hdr
->
sizem1
 = (
off£t
 / 16) - 1;

1353 
pfvf
->
hw_İs
->
	`sqe_æush
Õfvf, 
sq
, 
off£t
, 
qidx
);

1355  
Œue
;

1356 
	}
}

1358 
šlše
 
boŞ
 
	$Ùx2_xdp_rcv_pkt_hªdËr
(
Ùx2_nic
 *
pfvf
,

1359 
nix_cqe_rx_s
 *
cqe
,

1360 
Ùx2_cq_queue
 *
cq
)

1362 
bpf_´og
 *
xdp_´og
;

1363 
qidx
 = 
cq
->
cq_idx
;

1364 
xdp_buff
 
xdp
;

1365 
·ge
 *page;

1366 
u64
 
iova
, 
·
;

1367 
u32
 
aù
;

1368 
”r
;

1370 
iova
 = 
cqe
->
sg
.
£g_addr
;

1371 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

1372 
·ge
 = 
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
));

1374 
xdp
.
d©a
 = 
	`phys_to_vœt
(
·
);

1375 
xdp
.
d©a_h¬d_¡¬t
 = 
	`·ge_add»ss
(
·ge
è+ 
OTX2_HEAD_ROOM
;

1376 
xdp
.
d©a_’d
 = xdp.
d©a
 + 
cqe
->
sg
.
£g_size
;

1378 
	`rcu_»ad_lock
();

1379 
xdp_´og
 = 
	`READ_ONCE
(
pfvf
->xdp_prog);

1380 
aù
 = 
	`bpf_´og_run_xdp
(
xdp_´og
, &
xdp
);

1381 
	`rcu_»ad_uÆock
();

1383 
aù
) {

1384 
XDP_PASS
:

1386 
XDP_TX
:

1387 
qidx
 +ğ
pfvf
->
hw
.
tx_queues
;

1388 
cq
->
poŞ_±rs
++;

1389  
	`Ùx2_xdp_sq_­³nd_pkt
(
pfvf
, 
iova
,

1390 
cqe
->
sg
.
£g_size
, 
qidx
);

1391 
XDP_REDIRECT
:

1392 
cq
->
poŞ_±rs
++;

1393 
”r
 = 
	`xdp_do_»dœeù
(
pfvf
->
Ãtdev
, &
xdp
, 
xdp_´og
);

1395 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
iova
,…fvf->
rbsize
,

1396 
DMA_FROM_DEVICE
);

1397 ià(!
”r
)

1398  
Œue
;

1399 
	`put_·ge
(
·ge
);

1402 
	`bpf_w¬n_šv®id_xdp_aùiÚ
(
aù
);

1404 
XDP_ABORTED
:

1405 
	`Œaû_xdp_exû±iÚ
(
pfvf
->
Ãtdev
, 
xdp_´og
, 
aù
);

1407 
XDP_DROP
:

1408 
	`Ùx2_dma_unm­_·ge
(
pfvf
, 
iova
,…fvf->
rbsize
,

1409 
DMA_FROM_DEVICE
);

1410 
	`put_·ge
(
·ge
);

1411 
cq
->
poŞ_±rs
++;

1412  
Œue
;

1414  
çl£
;

1415 
	}
}

	@otx2_txrx.h

8 #iâdeà
OTX2_TXRX_H


9 
	#OTX2_TXRX_H


	)

11 
	~<lšux/‘h”deviû.h
>

12 
	~<lšux/iommu.h
>

13 
	~<lšux/if_vÏn.h
>

15 
	#LBK_CHAN_BASE
 0x000

	)

16 
	#SDP_CHAN_BASE
 0x700

	)

17 
	#CGX_CHAN_BASE
 0x800

	)

19 
	#OTX2_DATA_ALIGN
(
X
è
	`ALIGN
(X, 
OTX2_ALIGN
)

	)

20 
	#OTX2_HEAD_ROOM
 
OTX2_ALIGN


	)

22 
	#OTX2_ETH_HLEN
 (
VLAN_ETH_HLEN
 + 
VLAN_HLEN
)

	)

23 
	#OTX2_MIN_MTU
 60

	)

25 
	#OTX2_MAX_GSO_SEGS
 255

	)

26 
	#OTX2_MAX_FRAGS_IN_SQE
 9

	)

29 
	#RCV_FRAG_LEN1
(
x
) \

30 ((
OTX2_HEAD_ROOM
 + 
	`OTX2_DATA_ALIGN
(
x
)) + \

31 
	`OTX2_DATA_ALIGN
((
skb_sh¬ed_šfo
)))

	)

36 
	#RCV_FRAG_LEN
(
x
) \

37 ((
	`RCV_FRAG_LEN1
(
x
è< 2048è? 2048 : RCV_FRAG_LEN1(x))

	)

39 
	#DMA_BUFFER_LEN
(
x
è((xè- 
OTX2_HEAD_ROOM
)

	)

44 
	#CQ_CQE_THRESH_DEFAULT
 10

	)

49 
	#CQ_TIMER_THRESH_DEFAULT
 1

	)

50 
	#CQ_TIMER_THRESH_MAX
 25

	)

55 
	#CQ_QCOUNT_DEFAULT
 1

	)

57 
	#CQ_OP_STAT_OP_ERR
 63

	)

58 
	#CQ_OP_STAT_CQ_ERR
 46

	)

60 
	squeue_¡©s
 {

61 
u64
 
	mby‹s
;

62 
u64
 
	mpkts
;

65 
	sÙx2_rcv_queue
 {

66 
queue_¡©s
 
	m¡©s
;

69 
	ssg_li¡
 {

70 
u16
 
	mnum_£gs
;

71 
u64
 
	mskb
;

72 
u64
 
	msize
[
OTX2_MAX_FRAGS_IN_SQE
];

73 
u64
 
	mdma_addr
[
OTX2_MAX_FRAGS_IN_SQE
];

76 
	sÙx2_¢d_queue
 {

77 
u8
 
	mau¿_id
;

78 
u16
 
	mh—d
;

79 
u16
 
	mcÚs_h—d
;

80 
u16
 
	msqe_size
;

81 
u32
 
	msqe_út
;

82 
u16
 
	mnum_sqbs
;

83 
u16
 
	msqe_th»sh
;

84 
u8
 
	msqe_³r_sqb
;

85 
u64
 
	mio_addr
;

86 
u64
 *
	mau¿_fc_addr
;

87 
u64
 *
	mlmt_addr
;

88 *
	msqe_ba£
;

89 
qmem
 *
	msqe
;

90 
qmem
 *
	mtso_hdrs
;

91 
sg_li¡
 *
	msg
;

92 
qmem
 *
	mtime¡amps
;

93 
queue_¡©s
 
	m¡©s
;

94 
u16
 
	msqb_couÁ
;

95 
u64
 *
	msqb_±rs
;

96 } 
	g____ÿch–še_®igÃd_š_smp
;

98 
	ecq_ty³
 {

99 
	mCQ_RX
,

100 
	mCQ_TX
,

101 
	mCQ_XDP
,

102 
	mCQ_QOS
,

103 
	mCQS_PER_CINT
 = 4,

106 
	sÙx2_cq_pŞl
 {

107 *
	mdev
;

108 
	#CINT_INVALID_CQ
 255

	)

109 
u8
 
	mcšt_idx
;

110 
u8
 
	mcq_ids
[
CQS_PER_CINT
];

111 
dim
 
	mdim
;

112 
Çpi_¡ruù
 
	mÇpi
;

115 
	sÙx2_poŞ
 {

116 
qmem
 *
	m¡ack
;

117 
qmem
 *
	mfc_addr
;

118 
u16
 
	mrbsize
;

121 
	sÙx2_cq_queue
 {

122 
u8
 
	mcq_idx
;

123 
u8
 
	mcq_ty³
;

124 
u8
 
	mcšt_idx
;

125 
u8
 
	m»fl_sk_sched
;

126 
u16
 
	mcqe_size
;

127 
u16
 
	mpoŞ_±rs
;

128 
u32
 
	mcqe_út
;

129 
u32
 
	mcq_h—d
;

130 
u32
 
	mcq_
;

131 
u32
 
	m³nd_cqe
;

132 *
	mcqe_ba£
;

133 
qmem
 *
	mcqe
;

134 
Ùx2_poŞ
 *
	mrbpoŞ
;

135 } 
	g____ÿch–še_®igÃd_š_smp
;

137 
	sÙx2_q£t
 {

138 
u32
 
	mrqe_út
;

139 
u32
 
	msqe_út
;

140 
	#OTX2_MAX_CQ_CNT
 64

	)

141 
u16
 
	mcq_út
;

142 
u16
 
	mxqe_size
;

143 
Ùx2_poŞ
 *
	mpoŞ
;

144 
Ùx2_cq_pŞl
 *
	mÇpi
;

145 
Ùx2_cq_queue
 *
	mcq
;

146 
Ùx2_¢d_queue
 *
	msq
;

147 
Ùx2_rcv_queue
 *
	mrq
;

151 
šlše
 
u64
 
	$Ùx2_iova_to_phys
(*
iommu_domaš
, 
dma_addr_t
 
dma_addr
)

154 ià(
	`lik–y
(
iommu_domaš
))

155  
	`iommu_iova_to_phys
(
iommu_domaš
, 
dma_addr
);

156  
dma_addr
;

157 
	}
}

159 
Ùx2_Çpi_hªdËr
(
Çpi_¡ruù
 *
Çpi
, 
budg‘
);

160 
boŞ
 
Ùx2_sq_­³nd_skb
(
Ãt_deviû
 *
Ãtdev
, 
Ùx2_¢d_queue
 *
sq
,

161 
sk_buff
 *
skb
, 
u16
 
qidx
);

162 
ú10k_sqe_æush
(*
dev
, 
Ùx2_¢d_queue
 *
sq
,

163 
size
, 
qidx
);

164 
Ùx2_sqe_æush
(*
dev
, 
Ùx2_¢d_queue
 *
sq
,

165 
size
, 
qidx
);

166 
Ùx2_»fl_poŞ_±rs
(*
dev
, 
Ùx2_cq_queue
 *
cq
);

167 
ú10k_»fl_poŞ_±rs
(*
dev
, 
Ùx2_cq_queue
 *
cq
);

	@otx2_vf.c

8 
	~<lšux/‘h”deviû.h
>

9 
	~<lšux/moduË.h
>

10 
	~<lšux/pci.h
>

11 
	~<lšux/Ãt_t¡amp.h
>

13 
	~"Ùx2_commÚ.h
"

14 
	~"Ùx2_»g.h
"

15 
	~"Ùx2_±p.h
"

16 
	~"ú10k.h
"

18 
	#DRV_NAME
 "rvu_nicvf"

	)

19 
	#DRV_STRING
 "M¬v–ÈRVU NIC Vœtu® FunùiÚ Driv”"

	)

21 cÚ¡ 
pci_deviû_id
 
	gÙx2_vf_id_bË
[] = {

22 { 
PCI_DEVICE
(
PCI_VENDOR_ID_CAVIUM
, 
PCI_DEVID_OCTEONTX2_RVU_AFVF
) },

23 { 
PCI_DEVICE
(
PCI_VENDOR_ID_CAVIUM
, 
PCI_DEVID_OCTEONTX2_RVU_VF
) },

24 { 
PCI_DEVICE
(
PCI_VENDOR_ID_CAVIUM
, 
PCI_DEVID_OCTEONTX2_SDP_VF
) },

28 
MODULE_AUTHOR
("Marvell International Ltd.");

29 
MODULE_DESCRIPTION
(
DRV_STRING
);

30 
MODULE_LICENSE
("GPL v2");

31 
MODULE_DEVICE_TABLE
(
pci
, 
Ùx2_vf_id_bË
);

35 
	mRVU_VF_INT_VEC_MBOX
 = 0x0,

38 
	$Ùx2vf_´oûss_vçf_mbox_msg
(
Ùx2_nic
 *
vf
,

39 
mbox_msghdr
 *
msg
)

41 ià(
msg
->
id
 >ğ
MBOX_MSG_MAX
) {

42 
	`dev_”r
(
vf
->
dev
,

43 "Mbox msg w™h unknowÀID %d\n", 
msg
->
id
);

47 ià(
msg
->
sig
 !ğ
OTX2_MBOX_RSP_SIG
) {

48 
	`dev_”r
(
vf
->
dev
,

50 
msg
->
sig
, msg->
id
);

54 ià(
msg
->
rc
 =ğ
MBOX_MSG_INVALID
) {

55 
	`dev_”r
(
vf
->
dev
,

57 
msg
->
id
);

61 
msg
->
id
) {

62 
MBOX_MSG_READY
:

63 
vf
->
pcifunc
 = 
msg
->pcifunc;

65 
MBOX_MSG_MSIX_OFFSET
:

66 
	`mbox_hªdËr_msix_off£t
(
vf
, (
msix_off£t_r¥
 *)
msg
);

68 
MBOX_MSG_NPA_LF_ALLOC
:

69 
	`mbox_hªdËr_Åa_lf_®loc
(
vf
, (
Åa_lf_®loc_r¥
 *)
msg
);

71 
MBOX_MSG_NIX_LF_ALLOC
:

72 
	`mbox_hªdËr_nix_lf_®loc
(
vf
, (
nix_lf_®loc_r¥
 *)
msg
);

74 
MBOX_MSG_NIX_BP_ENABLE
:

75 
	`mbox_hªdËr_nix_bp_’abË
(
vf
, (
nix_bp_cfg_r¥
 *)
msg
);

78 ià(
msg
->
rc
)

79 
	`dev_”r
(
vf
->
dev
,

81 
msg
->
rc
, msg->
id
);

83 
	}
}

85 
	$Ùx2vf_vçf_mbox_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

87 
Ùx2_mbox_dev
 *
mdev
;

88 
mbox_hdr
 *
r¥_hdr
;

89 
mbox_msghdr
 *
msg
;

90 
Ùx2_mbox
 *
mbox
;

91 
mbox
 *
af_mbox
;

92 
off£t
, 
id
;

94 
af_mbox
 = 
	`cÚš”_of
(
wÜk
, 
mbox
, 
mbox_wrk
);

95 
mbox
 = &
af_mbox
->mbox;

96 
mdev
 = &
mbox
->
dev
[0];

97 
r¥_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

98 ià(
af_mbox
->
num_msgs
 == 0)

100 
off£t
 = 
mbox
->
rx_¡¬t
 + 
	`ALIGN
((*
r¥_hdr
), 
MBOX_MSG_ALIGN
);

102 
id
 = 0; id < 
af_mbox
->
num_msgs
; id++) {

103 
msg
 = (
mbox_msghdr
 *)(
mdev
->
mba£
 + 
off£t
);

104 
	`Ùx2vf_´oûss_vçf_mbox_msg
(
af_mbox
->
pfvf
, 
msg
);

105 
off£t
 = 
mbox
->
rx_¡¬t
 + 
msg
->
Ãxt_msgoff
;

106 ià(
mdev
->
msgs_acked
 =ğ(
af_mbox
->
num_msgs
 - 1))

107 
	`__Ùx2_mbox_»£t
(
mbox
, 0);

108 
mdev
->
msgs_acked
++;

110 
	}
}

112 
	$Ùx2vf_´oûss_mbox_msg_up
(
Ùx2_nic
 *
vf
,

113 
mbox_msghdr
 *
»q
)

116 ià(
»q
->
sig
 !ğ
OTX2_MBOX_REQ_SIG
) {

117 
	`Ùx2_»¶y_šv®id_msg
(&
vf
->
mbox
.
mbox_up
, 0, 0, 
»q
->
id
);

118  -
ENODEV
;

121 
»q
->
id
) {

122 
	#M
(
_Çme
, 
_id
, 
_â_Çme
, 
_»q_ty³
, 
_r¥_ty³
) \

123 
_id
: { \

124 
_r¥_ty³
 *
r¥
; \

125 
”r
; \

127 
r¥
 = (
_r¥_ty³
 *)
	`Ùx2_mbox_®loc_msg
( \

128 &
vf
->
mbox
.
mbox_up
, 0, \

129 (
_r¥_ty³
)); \

130 ià(!
r¥
) \

131  -
ENOMEM
; \

133 
r¥
->
hdr
.
id
 = 
_id
; \

134 
r¥
->
hdr
.
sig
 = 
OTX2_MBOX_RSP_SIG
; \

135 
r¥
->
hdr
.
pcifunc
 = 0; \

136 
r¥
->
hdr
.
rc
 = 0; \

138 
”r
 = 
Ùx2_mbox_up_hªdËr_
 ## 
	`_â_Çme
( \

139 
vf
, (
_»q_ty³
 *)
»q
, 
r¥
); \

140  
”r
; \

141 }

	)

142 
MBOX_UP_CGX_MESSAGES


143 #undeà
M


146 
	`Ùx2_»¶y_šv®id_msg
(&
vf
->
mbox
.
mbox_up
, 0, 0, 
»q
->
id
);

147  -
ENODEV
;

150 
	}
}

152 
	$Ùx2vf_vçf_mbox_up_hªdËr
(
wÜk_¡ruù
 *
wÜk
)

154 
Ùx2_mbox_dev
 *
mdev
;

155 
mbox_hdr
 *
r¥_hdr
;

156 
mbox_msghdr
 *
msg
;

157 
Ùx2_mbox
 *
mbox
;

158 
mbox
 *
vf_mbox
;

159 
Ùx2_nic
 *
vf
;

160 
off£t
, 
id
;

162 
vf_mbox
 = 
	`cÚš”_of
(
wÜk
, 
mbox
, 
mbox_up_wrk
);

163 
vf
 = 
vf_mbox
->
pfvf
;

164 
mbox
 = &
vf_mbox
->
mbox_up
;

165 
mdev
 = &
mbox
->
dev
[0];

167 
r¥_hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

168 ià(
vf_mbox
->
up_num_msgs
 == 0)

171 
off£t
 = 
mbox
->
rx_¡¬t
 + 
	`ALIGN
((*
r¥_hdr
), 
MBOX_MSG_ALIGN
);

173 
id
 = 0; id < 
vf_mbox
->
up_num_msgs
; id++) {

174 
msg
 = (
mbox_msghdr
 *)(
mdev
->
mba£
 + 
off£t
);

175 
	`Ùx2vf_´oûss_mbox_msg_up
(
vf
, 
msg
);

176 
off£t
 = 
mbox
->
rx_¡¬t
 + 
msg
->
Ãxt_msgoff
;

179 
	`Ùx2_mbox_msg_£nd
(
mbox
, 0);

180 
	}
}

182 
œq»tuº_t
 
	$Ùx2vf_vçf_mbox_šŒ_hªdËr
(
œq
, *
vf_œq
)

184 
Ùx2_nic
 *
vf
 = (Ùx2_niø*)
vf_œq
;

185 
Ùx2_mbox_dev
 *
mdev
;

186 
Ùx2_mbox
 *
mbox
;

187 
mbox_hdr
 *
hdr
;

190 
	`Ùx2_wr™e64
(
vf
, 
RVU_VF_INT
, 
	`BIT_ULL
(0));

193 
	`smp_rmb
();

196 
mbox
 = &
vf
->mbox.mbox;

197 
mdev
 = &
mbox
->
dev
[0];

198 
	`Ùx2_sync_mbox_bbuf
(
mbox
, 0);

200 
	`Œaû_Ùx2_msg_š‹¼u±
(
mbox
->
pdev
, "PFØVF", 
	`BIT_ULL
(0));

202 
hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

203 ià(
hdr
->
num_msgs
) {

204 
vf
->
mbox
.
num_msgs
 = 
hdr
->num_msgs;

205 
hdr
->
num_msgs
 = 0;

206 
	`mem£t
(
mbox
->
hwba£
 + mbox->
rx_¡¬t
, 0,

207 
	`ALIGN
((
mbox_hdr
), (
u64
)));

208 
	`queue_wÜk
(
vf
->
mbox_wq
, &vf->
mbox
.
mbox_wrk
);

211 
mbox
 = &
vf
->mbox.
mbox_up
;

212 
mdev
 = &
mbox
->
dev
[0];

213 
	`Ùx2_sync_mbox_bbuf
(
mbox
, 0);

215 
hdr
 = (
mbox_hdr
 *)(
mdev
->
mba£
 + 
mbox
->
rx_¡¬t
);

216 ià(
hdr
->
num_msgs
) {

217 
vf
->
mbox
.
up_num_msgs
 = 
hdr
->
num_msgs
;

218 
hdr
->
num_msgs
 = 0;

219 
	`mem£t
(
mbox
->
hwba£
 + mbox->
rx_¡¬t
, 0,

220 
	`ALIGN
((
mbox_hdr
), (
u64
)));

221 
	`queue_wÜk
(
vf
->
mbox_wq
, &vf->
mbox
.
mbox_up_wrk
);

224  
IRQ_HANDLED
;

225 
	}
}

227 
	$Ùx2vf_di§bË_mbox_šŒ
(
Ùx2_nic
 *
vf
)

229 
veùÜ
 = 
	`pci_œq_veùÜ
(
vf
->
pdev
, 
RVU_VF_INT_VEC_MBOX
);

232 
	`Ùx2_wr™e64
(
vf
, 
RVU_VF_INT_ENA_W1C
, 
	`BIT_ULL
(0));

233 
	`ä“_œq
(
veùÜ
, 
vf
);

234 
	}
}

236 
	$Ùx2vf_»gi¡”_mbox_šŒ
(
Ùx2_nic
 *
vf
, 
boŞ
 
´obe_pf
)

238 
Ùx2_hw
 *
hw
 = &
vf
->hw;

239 
msg_»q
 *
»q
;

240 *
œq_Çme
;

241 
”r
;

244 
œq_Çme
 = &
hw
->œq_Çme[
RVU_VF_INT_VEC_MBOX
 * 
NAME_SIZE
];

245 
	`¢´štf
(
œq_Çme
, 
NAME_SIZE
, "RVUVFAF Mbox");

246 
”r
 = 
	`»que¡_œq
(
	`pci_œq_veùÜ
(
vf
->
pdev
, 
RVU_VF_INT_VEC_MBOX
),

247 
Ùx2vf_vçf_mbox_šŒ_hªdËr
, 0, 
œq_Çme
, 
vf
);

248 ià(
”r
) {

249 
	`dev_”r
(
vf
->
dev
,

251  
”r
;

257 
	`Ùx2_wr™e64
(
vf
, 
RVU_VF_INT
, 
	`BIT_ULL
(0));

258 
	`Ùx2_wr™e64
(
vf
, 
RVU_VF_INT_ENA_W1S
, 
	`BIT_ULL
(0));

260 ià(!
´obe_pf
)

264 
»q
 = 
	`Ùx2_mbox_®loc_msg_»ady
(&
vf
->
mbox
);

265 ià(!
»q
) {

266 
	`Ùx2vf_di§bË_mbox_šŒ
(
vf
);

267  -
ENOMEM
;

270 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
);

271 ià(
”r
) {

272 
	`dev_w¬n
(
vf
->
dev
,

274 
	`Ùx2vf_di§bË_mbox_šŒ
(
vf
);

275  -
EPROBE_DEFER
;

278 
	}
}

280 
	$Ùx2vf_vçf_mbox_de¡roy
(
Ùx2_nic
 *
vf
)

282 
mbox
 *mbox = &
vf
->mbox;

284 ià(
vf
->
mbox_wq
) {

285 
	`æush_wÜkqueue
(
vf
->
mbox_wq
);

286 
	`de¡roy_wÜkqueue
(
vf
->
mbox_wq
);

287 
vf
->
mbox_wq
 = 
NULL
;

290 ià(
mbox
->mbox.
hwba£
 && !
	`‹¡_b™
(
CN10K_MBOX
, &
vf
->
hw
.
ÿp_æag
))

291 
	`iounm­
((
__iomem
 *)
mbox
->mbox.
hwba£
);

293 
	`Ùx2_mbox_de¡roy
(&
mbox
->mbox);

294 
	`Ùx2_mbox_de¡roy
(&
mbox
->
mbox_up
);

295 
	}
}

297 
	$Ùx2vf_vçf_mbox_š™
(
Ùx2_nic
 *
vf
)

299 
mbox
 *mbox = &
vf
->mbox;

300 
__iomem
 *
hwba£
;

301 
”r
;

303 
mbox
->
pfvf
 = 
vf
;

304 
vf
->
mbox_wq
 = 
	`®loc_wÜkqueue
("otx2_vfaf_mailbox",

305 
WQ_UNBOUND
 | 
WQ_HIGHPRI
 |

306 
WQ_MEM_RECLAIM
, 1);

307 ià(!
vf
->
mbox_wq
)

308  -
ENOMEM
;

310 ià(
	`‹¡_b™
(
CN10K_MBOX
, &
vf
->
hw
.
ÿp_æag
)) {

314 
hwba£
 = 
vf
->
»g_ba£
 + 
RVU_VF_MBOX_REGION
;

320 
hwba£
 = 
	`iÜem­_wc
(
	`pci_»sourû_¡¬t
(
vf
->
pdev
,

321 
PCI_MBOX_BAR_NUM
),

322 
	`pci_»sourû_Ën
(
vf
->
pdev
,

323 
PCI_MBOX_BAR_NUM
));

324 ià(!
hwba£
) {

325 
	`dev_”r
(
vf
->
dev
, "Unableo map VFAF mailbox„egion\n");

326 
”r
 = -
ENOMEM
;

327 
ex™
;

331 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->mbox, 
hwba£
, 
vf
->
pdev
, vf->
»g_ba£
,

332 
MBOX_DIR_VFPF
, 1);

333 ià(
”r
)

334 
ex™
;

336 
”r
 = 
	`Ùx2_mbox_š™
(&
mbox
->
mbox_up
, 
hwba£
, 
vf
->
pdev
, vf->
»g_ba£
,

337 
MBOX_DIR_VFPF_UP
, 1);

338 ià(
”r
)

339 
ex™
;

341 
”r
 = 
	`Ùx2_mbox_bbuf_š™
(
mbox
, 
vf
->
pdev
);

342 ià(
”r
)

343 
ex™
;

345 
	`INIT_WORK
(&
mbox
->
mbox_wrk
, 
Ùx2vf_vçf_mbox_hªdËr
);

346 
	`INIT_WORK
(&
mbox
->
mbox_up_wrk
, 
Ùx2vf_vçf_mbox_up_hªdËr
);

347 
	`mu‹x_š™
(&
mbox
->
lock
);

350 
ex™
:

351 ià(
hwba£
 && !
	`‹¡_b™
(
CN10K_MBOX
, &
vf
->
hw
.
ÿp_æag
))

352 
	`iounm­
(
hwba£
);

353 
	`de¡roy_wÜkqueue
(
vf
->
mbox_wq
);

354  
”r
;

355 
	}
}

357 
	$Ùx2vf_İ’
(
Ãt_deviû
 *
Ãtdev
)

359 
Ùx2_nic
 *
vf
;

360 
”r
;

362 
”r
 = 
	`Ùx2_İ’
(
Ãtdev
);

363 ià(
”r
)

364  
”r
;

367 
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

368 ià(
	`is_Ùx2_lbkvf
(
vf
->
pdev
è|| 
	`is_Ùx2_sdpvf
(vf->pdev)) {

369 
	`´_šfo
("% NIC Lšk i UP\n", 
Ãtdev
->
Çme
);

370 
	`Ãtif_ÿ¼›r_Ú
(
Ãtdev
);

371 
	`Ãtif_tx_¡¬t_®l_queues
(
Ãtdev
);

375 
	}
}

377 
	$Ùx2vf_¡İ
(
Ãt_deviû
 *
Ãtdev
)

379  
	`Ùx2_¡İ
(
Ãtdev
);

380 
	}
}

382 
Ãtdev_tx_t
 
	$Ùx2vf_xm™
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
Ãtdev
)

384 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

385 
qidx
 = 
	`skb_g‘_queue_m­pšg
(
skb
);

386 
Ùx2_¢d_queue
 *
sq
;

387 
Ãtdev_queue
 *
txq
;

390 ià(
skb
->
Ën
 <ğ
ETH_HLEN
 ||

391 (!
	`skb_shšfo
(
skb
)->
gso_size
 && skb->
Ën
 > 
vf
->
tx_max_pk’
)) {

392 
	`dev_kä“_skb
(
skb
);

393  
NETDEV_TX_OK
;

396 
sq
 = &
vf
->
q£t
.sq[
qidx
];

397 
txq
 = 
	`Ãtdev_g‘_tx_queue
(
Ãtdev
, 
qidx
);

399 ià(!
	`Ùx2_sq_­³nd_skb
(
Ãtdev
, 
sq
, 
skb
, 
qidx
)) {

400 
	`Ãtif_tx_¡İ_queue
(
txq
);

403 
	`smp_mb
();

404 ià(((
sq
->
num_sqbs
 - *sq->
au¿_fc_addr
è* sq->
sqe_³r_sqb
)

405 > 
sq
->
sqe_th»sh
)

406 
	`Ãtif_tx_wake_queue
(
txq
);

408  
NETDEV_TX_BUSY
;

411  
NETDEV_TX_OK
;

412 
	}
}

414 
	$Ùx2vf_£t_rx_mode
(
Ãt_deviû
 *
Ãtdev
)

416 
Ùx2_nic
 *
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

418 
	`queue_wÜk
(
vf
->
Ùx2_wq
, &vf->
rx_mode_wÜk
);

419 
	}
}

421 
	$Ùx2vf_do_£t_rx_mode
(
wÜk_¡ruù
 *
wÜk
)

423 
Ùx2_nic
 *
vf
 = 
	`cÚš”_of
(
wÜk
, Ùx2_nic, 
rx_mode_wÜk
);

424 
Ãt_deviû
 *
Ãtdev
 = 
vf
->netdev;

425 
æags
 = 
Ãtdev
->flags;

426 
nix_rx_mode
 *
»q
;

428 
	`mu‹x_lock
(&
vf
->
mbox
.
lock
);

430 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_£t_rx_mode
(&
vf
->
mbox
);

431 ià(!
»q
) {

432 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

436 
»q
->
mode
 = 
NIX_RX_MODE_UCAST
;

438 ià(
æags
 & 
IFF_PROMISC
)

439 
»q
->
mode
 |ğ
NIX_RX_MODE_PROMISC
;

440 ià(
æags
 & (
IFF_ALLMULTI
 | 
IFF_MULTICAST
))

441 
»q
->
mode
 |ğ
NIX_RX_MODE_ALLMULTI
;

443 
»q
->
mode
 |ğ
NIX_RX_MODE_USE_MCE
;

445 
	`Ùx2_sync_mbox_msg
(&
vf
->
mbox
);

447 
	`mu‹x_uÆock
(&
vf
->
mbox
.
lock
);

448 
	}
}

450 
	$Ùx2vf_chªge_mtu
(
Ãt_deviû
 *
Ãtdev
, 
Ãw_mtu
)

452 
boŞ
 
if_up
 = 
	`Ãtif_ruÂšg
(
Ãtdev
);

453 
”r
 = 0;

455 ià(
if_up
)

456 
	`Ùx2vf_¡İ
(
Ãtdev
);

458 
	`Ãtdev_šfo
(
Ãtdev
, "Changing MTU from %do %d\n",

459 
Ãtdev
->
mtu
, 
Ãw_mtu
);

460 
Ãtdev
->
mtu
 = 
Ãw_mtu
;

462 ià(
if_up
)

463 
”r
 = 
	`Ùx2vf_İ’
(
Ãtdev
);

465  
”r
;

466 
	}
}

468 
	$Ùx2vf_»£t_sk
(
wÜk_¡ruù
 *
wÜk
)

470 
Ùx2_nic
 *
vf
 = 
	`cÚš”_of
(
wÜk
, Ùx2_nic, 
»£t_sk
);

472 
	`¹Æ_lock
();

474 ià(
	`Ãtif_ruÂšg
(
vf
->
Ãtdev
)) {

475 
	`Ùx2vf_¡İ
(
vf
->
Ãtdev
);

476 
vf
->
»£t_couÁ
++;

477 
	`Ùx2vf_İ’
(
vf
->
Ãtdev
);

480 
	`¹Æ_uÆock
();

481 
	}
}

483 
	$Ùx2vf_£t_ã©u»s
(
Ãt_deviû
 *
Ãtdev
,

484 
Ãtdev_ã©u»s_t
 
ã©u»s
)

486  
	`Ùx2_hªdË_Áu¶e_tc_ã©u»s
(
Ãtdev
, 
ã©u»s
);

487 
	}
}

489 cÚ¡ 
Ãt_deviû_İs
 
	gÙx2vf_Ãtdev_İs
 = {

490 .
ndo_İ’
 = 
Ùx2vf_İ’
,

491 .
	gndo_¡İ
 = 
Ùx2vf_¡İ
,

492 .
	gndo_¡¬t_xm™
 = 
Ùx2vf_xm™
,

493 .
	gndo_£Ëù_queue
 = 
Ùx2_£Ëù_queue
,

494 .
	gndo_£t_rx_mode
 = 
Ùx2vf_£t_rx_mode
,

495 .
	gndo_£t_mac_add»ss
 = 
Ùx2_£t_mac_add»ss
,

496 .
	gndo_chªge_mtu
 = 
Ùx2vf_chªge_mtu
,

497 .
	gndo_£t_ã©u»s
 = 
Ùx2vf_£t_ã©u»s
,

498 .
	gndo_g‘_¡©s64
 = 
Ùx2_g‘_¡©s64
,

499 .
	gndo_tx_timeout
 = 
Ùx2_tx_timeout
,

500 .
	gndo_do_ioùl
 = 
Ùx2_ioùl
,

501 .
	gndo_£tup_tc
 = 
Ùx2_£tup_tc
,

504 
	$Ùx2_wq_š™
(
Ùx2_nic
 *
vf
)

506 
vf
->
Ùx2_wq
 = 
	`ü—‹_sšgËth»ad_wÜkqueue
("otx2vf_wq");

507 ià(!
vf
->
Ùx2_wq
)

508  -
ENOMEM
;

510 
	`INIT_WORK
(&
vf
->
rx_mode_wÜk
, 
Ùx2vf_do_£t_rx_mode
);

511 
	`INIT_WORK
(&
vf
->
»£t_sk
, 
Ùx2vf_»£t_sk
);

513 
	}
}

515 
	$Ùx2vf_»®loc_msix_veùÜs
(
Ùx2_nic
 *
vf
)

517 
Ùx2_hw
 *
hw
 = &
vf
->hw;

518 
num_vec
, 
”r
;

520 
num_vec
 = 
hw
->
nix_msixoff
;

521 
num_vec
 +ğ
NIX_LF_CINT_VEC_START
 + 
hw
->
max_queues
;

523 
	`Ùx2vf_di§bË_mbox_šŒ
(
vf
);

524 
	`pci_ä“_œq_veùÜs
(
hw
->
pdev
);

525 
”r
 = 
	`pci_®loc_œq_veùÜs
(
hw
->
pdev
, 
num_vec
,‚um_vec, 
PCI_IRQ_MSIX
);

526 ià(
”r
 < 0) {

527 
	`dev_”r
(
vf
->
dev
, "%s: Failedo„ealloc %d IRQ vectors\n",

528 
__func__
, 
num_vec
);

529  
”r
;

532  
	`Ùx2vf_»gi¡”_mbox_šŒ
(
vf
, 
çl£
);

533 
	}
}

535 
	$Ùx2vf_´obe
(
pci_dev
 *
pdev
, cÚ¡ 
pci_deviû_id
 *
id
)

537 
num_vec
 = 
	`pci_msix_vec_couÁ
(
pdev
);

538 
deviû
 *
dev
 = &
pdev
->dev;

539 
”r
, 
qcouÁ
, 
qos_txqs
;

540 
Ãt_deviû
 *
Ãtdev
;

541 
Ùx2_nic
 *
vf
;

542 
Ùx2_hw
 *
hw
;

544 
”r
 = 
	`pcim_’abË_deviû
(
pdev
);

545 ià(
”r
) {

546 
	`dev_”r
(
dev
, "Failedoƒnable PCI device\n");

547  
”r
;

550 
”r
 = 
	`pci_»que¡_»giÚs
(
pdev
, 
DRV_NAME
);

551 ià(
”r
) {

552 
	`dev_”r
(
dev
, "PCI„eque¡„egiÚ çed 0x%x\n", 
”r
);

553  
”r
;

556 
”r
 = 
	`dma_£t_mask_ªd_coh”’t
(
dev
, 
	`DMA_BIT_MASK
(48));

557 ià(
”r
) {

558 
	`dev_”r
(
dev
, "DMA mask config failed,‡bort\n");

559 
”r_»Ëa£_»giÚs
;

562 
	`pci_£t_ma¡”
(
pdev
);

564 
qcouÁ
 = 
	`num_Úlše_ıus
();

565 
qos_txqs
 = 
	`mš_t
(, 
qcouÁ
, 
OTX2_QOS_MAX_LEAF_NODES
);

566 
Ãtdev
 = 
	`®loc_‘h”dev_mqs
((*
vf
), 
qcouÁ
 + 
qos_txqs
, qcount);

567 ià(!
Ãtdev
) {

568 
”r
 = -
ENOMEM
;

569 
”r_»Ëa£_»giÚs
;

572 
	`pci_£t_drvd©a
(
pdev
, 
Ãtdev
);

573 
	`SET_NETDEV_DEV
(
Ãtdev
, &
pdev
->
dev
);

574 
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

575 
vf
->
Ãtdev
 =‚etdev;

576 
vf
->
pdev
 =…dev;

577 
vf
->
dev
 = dev;

578 
vf
->
iommu_domaš
 = 
	`iommu_g‘_domaš_fÜ_dev
(
dev
);

579 ià(
vf
->
iommu_domaš
)

580 
vf
->
iommu_domaš_ty³
 =

581 ((
iommu_domaš
 *)
vf
->iommu_domaš)->
ty³
;

583 
vf
->
æags
 |ğ
OTX2_FLAG_INTF_DOWN
;

584 
hw
 = &
vf
->hw;

585 
hw
->
pdev
 = 
vf
->pdev;

586 
hw
->
rx_queues
 = 
qcouÁ
;

587 
hw
->
tx_queues
 = 
qcouÁ
;

588 
hw
->
max_queues
 = 
qcouÁ
;

589 
hw
->
tÙ_tx_queues
 = 
qcouÁ
;

590 
hw
->
rbuf_fixed_size
 = 
OTX2_DEFAULT_RBUF_LEN
;

592 
hw
->
xqe_size
 = 128;

594 
hw
->
œq_Çme
 = 
	`devm_km®loc_¬¿y
(&hw->
pdev
->
dev
, 
num_vec
, 
NAME_SIZE
,

595 
GFP_KERNEL
);

596 ià(!
hw
->
œq_Çme
) {

597 
”r
 = -
ENOMEM
;

598 
”r_ä“_Ãtdev
;

601 
hw
->
affš™y_mask
 = 
	`devm_kÿÎoc
(&hw->
pdev
->
dev
, 
num_vec
,

602 (
ıumask_v¬_t
), 
GFP_KERNEL
);

603 ià(!
hw
->
affš™y_mask
) {

604 
”r
 = -
ENOMEM
;

605 
”r_ä“_Ãtdev
;

608 
”r
 = 
	`pci_®loc_œq_veùÜs
(
hw
->
pdev
, 
num_vec
,‚um_vec, 
PCI_IRQ_MSIX
);

609 ià(
”r
 < 0) {

610 
	`dev_”r
(
dev
, "%s: Failedo‡lloc %d IRQ vectors\n",

611 
__func__
, 
num_vec
);

612 
”r_ä“_Ãtdev
;

615 
vf
->
»g_ba£
 = 
	`pcim_iom­
(
pdev
, 
PCI_CFG_REG_BAR_NUM
, 0);

616 ià(!
vf
->
»g_ba£
) {

617 
	`dev_”r
(
dev
, "Unableo map…hysical function CSRs,‡borting\n");

618 
”r
 = -
ENOMEM
;

619 
”r_ä“_œq_veùÜs
;

622 
	`Ùx2_£tup_dev_hw_£‰šgs
(
vf
);

624 
”r
 = 
	`Ùx2vf_vçf_mbox_š™
(
vf
);

625 ià(
”r
)

626 
”r_ä“_œq_veùÜs
;

629 
”r
 = 
	`Ùx2vf_»gi¡”_mbox_šŒ
(
vf
, 
Œue
);

630 ià(
”r
)

631 
”r_mbox_de¡roy
;

634 
”r
 = 
	`Ùx2_©ch_Åa_nix
(
vf
);

635 ià(
”r
)

636 
”r_di§bË_mbox_šŒ
;

638 
”r
 = 
	`Ùx2vf_»®loc_msix_veùÜs
(
vf
);

639 ià(
”r
)

640 
”r_mbox_de¡roy
;

642 
”r
 = 
	`Ùx2_£t_»®_num_queues
(
Ãtdev
, 
qcouÁ
, qcount);

643 ià(
”r
)

644 
”r_d‘ach_r¤c
;

646 
”r
 = 
	`ú10k_lmt¡_š™
(
vf
);

647 ià(
”r
)

648 
”r_d‘ach_r¤c
;

650 
”r
 = 
	`Ùx2smqvf_´obe
(
vf
);

651 ià(!
”r
)

653 ià(
”r
 =ğ-
EINVAL
)

654 
”r_d‘ach_r¤c
;

657 
	`Ùx2_±p_š™
(
vf
);

660 
	`Ùx2_g‘_mac_äom_af
(
Ãtdev
);

662 
Ãtdev
->
hw_ã©u»s
 = 
NETIF_F_RXCSUM
 | 
NETIF_F_IP_CSUM
 |

663 
NETIF_F_IPV6_CSUM
 | 
NETIF_F_RXHASH
 |

664 
NETIF_F_SG
 | 
NETIF_F_TSO
 | 
NETIF_F_TSO6
 |

665 
NETIF_F_GSO_UDP_L4
;

666 
Ãtdev
->
ã©u»s
 =‚‘dev->
hw_ã©u»s
;

668 
Ãtdev
->
vÏn_ã©u»s
 |ğÃtdev->
ã©u»s
;

669 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_HW_VLAN_CTAG_TX
 |

670 
NETIF_F_HW_VLAN_STAG_TX
;

671 
Ãtdev
->
ã©u»s
 |ğÃtdev->
hw_ã©u»s
;

673 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_NTUPLE
;

674 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_RXALL
;

675 
Ãtdev
->
hw_ã©u»s
 |ğ
NETIF_F_HW_TC
;

677 
Ãtdev
->
gso_max_£gs
 = 
OTX2_MAX_GSO_SEGS
;

678 
Ãtdev
->
w©chdog_timeo
 = 
OTX2_TX_TIMEOUT
;

680 
Ãtdev
->
Ãtdev_İs
 = &
Ùx2vf_Ãtdev_İs
;

682 
Ãtdev
->
mš_mtu
 = 
OTX2_MIN_MTU
;

683 
Ãtdev
->
max_mtu
 = 
	`Ùx2_g‘_max_mtu
(
vf
);

686 ià(
	`is_Ùx2_lbkvf
(
vf
->
pdev
)) {

687 
n
;

689 
n
 = (
vf
->
pcifunc
 >> 
RVU_PFVF_FUNC_SHIFT
è& 
RVU_PFVF_FUNC_MASK
;

691 
n
 -= 1;

692 
	`¢´štf
(
Ãtdev
->
Çme
, Ò‘dev->Çme), "lbk%d", 
n
);

696 ià(
	`is_Ùx2_sdpvf
(
vf
->
pdev
)) {

697 
n
;

699 
n
 = (
vf
->
pcifunc
 >> 
RVU_PFVF_FUNC_SHIFT
è& 
RVU_PFVF_FUNC_MASK
;

701 
n
 -= 1;

702 
	`¢´štf
(
Ãtdev
->
Çme
, Ò‘dev->Çme), "sdp%d-%d", 
pdev
->
bus
->
numb”
, 
n
);

705 
”r
 = 
	`»gi¡”_Ãtdev
(
Ãtdev
);

706 ià(
”r
) {

707 
	`dev_”r
(
dev
, "Failedo„egister‚etdevice\n");

708 
”r_±p_de¡roy
;

711 
”r
 = 
	`Ùx2_wq_š™
(
vf
);

712 ià(
”r
)

713 
”r_uÄeg_Ãtdev
;

715 
	`Ùx2vf_£t_‘htoŞ_İs
(
Ãtdev
);

717 
”r
 = 
	`Ùx2vf_mÿm_æow_š™
(
vf
);

718 ià(
”r
)

719 
”r_uÄeg_Ãtdev
;

721 
”r
 = 
	`Ùx2_š™_tc
(
vf
);

722 ià(
”r
)

723 
”r_uÄeg_Ãtdev
;

725 
”r
 = 
	`Ùx2_»gi¡”_dl
(
vf
);

726 ià(
”r
)

727 
”r_shutdown_tc
;

730 
vf
->
‘htoŞ_æags
 |ğ
OTX2_PRIV_FLAG_DEF_MODE
;

732 #ifdeà
CONFIG_DCB


733 
”r
 = 
	`Ùx2_dcbÆ_£t_İs
(
Ãtdev
);

734 ià(
”r
)

735 
”r_shutdown_tc
;

737 
	`Ùx2_qos_sq_£tup
(
vf
, 
qos_txqs
);

741 
”r_shutdown_tc
:

742 
	`Ùx2_shutdown_tc
(
vf
);

743 
”r_uÄeg_Ãtdev
:

744 
	`uÄegi¡”_Ãtdev
(
Ãtdev
);

745 
”r_±p_de¡roy
:

746 
	`Ùx2_±p_de¡roy
(
vf
);

747 
”r_d‘ach_r¤c
:

748 ià(
vf
->
hw
.
lmt_šfo
)

749 
	`ä“_³rıu
(
vf
->
hw
.
lmt_šfo
);

750 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
vf
->
hw
.
ÿp_æag
))

751 
	`qmem_ä“
(
vf
->
dev
, vf->
dync_lmt
);

752 
	`Ùx2_d‘ach_»sourûs
(&
vf
->
mbox
);

753 
”r_di§bË_mbox_šŒ
:

754 
	`Ùx2vf_di§bË_mbox_šŒ
(
vf
);

755 
”r_mbox_de¡roy
:

756 
	`Ùx2vf_vçf_mbox_de¡roy
(
vf
);

757 
”r_ä“_œq_veùÜs
:

758 
	`pci_ä“_œq_veùÜs
(
hw
->
pdev
);

759 
”r_ä“_Ãtdev
:

760 
	`pci_£t_drvd©a
(
pdev
, 
NULL
);

761 
	`ä“_Ãtdev
(
Ãtdev
);

762 
”r_»Ëa£_»giÚs
:

763 
	`pci_»Ëa£_»giÚs
(
pdev
);

764  
”r
;

765 
	}
}

767 
	$Ùx2vf_»move
(
pci_dev
 *
pdev
)

769 
Ãt_deviû
 *
Ãtdev
 = 
	`pci_g‘_drvd©a
(
pdev
);

770 
Ùx2_nic
 *
vf
;

772 ià(!
Ãtdev
)

775 
vf
 = 
	`Ãtdev_´iv
(
Ãtdev
);

778 ià(
vf
->
æags
 & 
OTX2_FLAG_RX_PAUSE_ENABLED
 ||

779 (
vf
->
æags
 & 
OTX2_FLAG_TX_PAUSE_ENABLED
)) {

780 
vf
->
æags
 &ğ~
OTX2_FLAG_RX_PAUSE_ENABLED
;

781 
vf
->
æags
 &ğ~
OTX2_FLAG_TX_PAUSE_ENABLED
;

782 
	`Ùx2_cÚfig_·u£_äm
(
vf
);

785 #ifdeà
CONFIG_DCB


787 ià(
vf
->
pfc_’
) {

788 
vf
->
pfc_’
 = 0;

789 
	`Ùx2_cÚfig_´iÜ™y_æow_ù¾
(
vf
);

793 ià(
	`Ùx2smqvf_»move
(
vf
)) {

794 
	`Ùx2_uÄegi¡”_dl
(
vf
);

795 
	`uÄegi¡”_Ãtdev
(
Ãtdev
);

798 ià(
vf
->
Ùx2_wq
)

799 
	`de¡roy_wÜkqueue
(
vf
->
Ùx2_wq
);

801 
	`Ùx2_±p_de¡roy
(
vf
);

802 
	`Ùx2vf_di§bË_mbox_šŒ
(
vf
);

803 
	`Ùx2_d‘ach_»sourûs
(&
vf
->
mbox
);

804 ià(
vf
->
hw
.
lmt_šfo
)

805 
	`ä“_³rıu
(
vf
->
hw
.
lmt_šfo
);

806 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
vf
->
hw
.
ÿp_æag
))

807 
	`qmem_ä“
(
vf
->
dev
, vf->
dync_lmt
);

808 
	`Ùx2vf_vçf_mbox_de¡roy
(
vf
);

809 
	`pci_ä“_œq_veùÜs
(
vf
->
pdev
);

810 
	`pci_£t_drvd©a
(
pdev
, 
NULL
);

811 
	`ä“_Ãtdev
(
Ãtdev
);

813 
	`pci_»Ëa£_»giÚs
(
pdev
);

814 
	}
}

816 
pci_driv”
 
	gÙx2vf_driv”
 = {

817 .
Çme
 = 
DRV_NAME
,

818 .
	gid_bË
 = 
Ùx2_vf_id_bË
,

819 .
	g´obe
 = 
Ùx2vf_´obe
,

820 .
	g»move
 = 
Ùx2vf_»move
,

821 .
	gshutdown
 = 
Ùx2vf_»move
,

824 
__š™
 
	$Ùx2vf_š™_moduË
()

826 
	`´_šfo
("%s: %s\n", 
DRV_NAME
, 
DRV_STRING
);

828  
	`pci_»gi¡”_driv”
(&
Ùx2vf_driv”
);

829 
	}
}

831 
__ex™
 
	$Ùx2vf_ş—nup_moduË
()

833 
	`pci_uÄegi¡”_driv”
(&
Ùx2vf_driv”
);

834 
	}
}

836 
moduË_š™
(
Ùx2vf_š™_moduË
);

837 
moduË_ex™
(
Ùx2vf_ş—nup_moduË
);

	@otx2_xdp.c

1 
	~<lšux/Ãtdeviû.h
>

2 
	~<lšux/f‹r.h
>

3 
	~<lšux/´oc_fs.h
>

4 
	~<lšux/bpf.h
>

5 
	~<lšux/bpf_v”if›r.h
>

6 
	~"Ùx2_commÚ.h
"

7 
	~"Ùx2_xdp_debug.h
"

8 
	~"Ùx2_th»ad.h
"

9 
	~"Ùx2_xdp.h
"

10 
	~"Ùx2_bpf.h
"

12 
´oc_dœ_’Œy
 *
	g´oc_’Œy
;

14 
	sÙx2_xdp_t
 {

15 
Ãt_deviû
 *
	mpma_dev
;

18 
mu‹x
 
	mmu‹x
;

21 
Ùx2_xdp_t
 
	gÙx2_xdp_gbl
 = {

22 .
pma_dev
 = 
NULL
,

23 .
	gmu‹x
 = 
__MUTEX_INITIALIZER
(
Ùx2_xdp_gbl
.
mu‹x
),

26 
	eoxt2_š¢_æag
 {

27 
	mOTX2_INSN_FLAG_SUBPROG_START
 = 
BIT_ULL
(0),

28 
	mOTX2_INSN_FLAG_JMP_DST
 = 
BIT_ULL
(1),

29 
	mOTX2_INSN_FLAG_VERIFIER
 = 
BIT_ULL
(2),

30 
	mOTX2_INSN_FLAG_FIXUP_INSN
 = 
BIT_ULL
(3),

33 
	$oxt2_bpf_ı_¬ch_ùx2mem
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, 
u32
 *
exec_mem
, *
off£t
)

35 
idx
 = *
off£t
;

36 
i
;

38 
ùx
->
off£t
 = 
idx
;

40 
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
idx
++) {

41 
exec_mem
[
idx
] = 
ùx
->
bi
[
i
];

44 *
off£t
 = 
idx
;

45 
	}
}

47 
	$Ùx2_´št_¬ch_š¢
(
Ùx2_bpf_´og
 *
obp
, 
u32
 *
exec_mem
)

49 
Ùx2_bpf_¬ch_ùx
 *
ùx
;

50 
Ùx2_bpf_š¢
 *
š¢
;

51 
off
 = 0;

52 
i
;

54 
	`´_”r
("prologue\n");

55 
ùx
 = &
obp
->
´Şogue
;

56  
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

57 
	`´_”r
("0x%04x off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), off);

60 
	`´_”r
("Body \n");

62 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

64 
ùx
 = &
š¢
->ctx;

65 
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

66 
	`´_”r
("0x%04x idx=%d off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), 
š¢
->
idx
, off);

68 
	`´_”r
("\n");

71 
	`´_”r
("epilogue\n");

72 
ùx
 = &
obp
->
•ogue
;

73  
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++, 
off
++) {

74 
	`´_”r
("0x%4x off=%d\n", 
	`Áohl
(
exec_mem
[
off
]), off);

77 
	`´_”r
("off£ˆğ%d obp->off£t=%d\n", 
off
, 
obp
->
j™ed_Ën
);

78 
	}
}

80 
	$Ùx2_´og_·ss
(
Ùx2_bpf_´og
 *
obp
, 
u32
 *
exec_mem
)

82 
Ùx2_bpf_š¢
 *
š¢
;

83 
Ùx2_bpf_¬ch_ùx
 *
ùx
;

84 
off£t
 = 0;

85 
ùx
 = &
obp
->
´Şogue
;

87 
	`oxt2_bpf_ı_¬ch_ùx2mem
(
ùx
, 
exec_mem
, &
off£t
);

90 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

91 
	`bud_š¢
(&
š¢
->š¢, &š¢->
ùx
, 
çl£
, (
u64
)
exec_mem
, 
obp
);

92 
	`oxt2_bpf_ı_¬ch_ùx2mem
(&
š¢
->
ùx
, 
exec_mem
, &
off£t
);

95 
ùx
 = &
obp
->
•ogue
;

96 
	`oxt2_bpf_ı_¬ch_ùx2mem
(
ùx
, 
exec_mem
, &
off£t
);

97 
obp
->
j™ed_Ën
 = 
off£t
 * 4;

99 
	`´_”r
("Second…ass\n");

102 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

103 
tmp
;

105 ià(!(
š¢
->
æags
 & 
OTX2_INSN_FLAG_FIXUP_INSN
)) {

109 
tmp
 = 
š¢
->
ùx
.
off£t
;

110 
	`mem£t
(&
š¢
->
ùx
, 0, (
Ùx2_bpf_¬ch_ùx
));

112 
	`bud_š¢
(&
š¢
->š¢, &š¢->
ùx
, 
Œue
, (
u64
)
exec_mem
, 
obp
);

113 
	`oxt2_bpf_ı_¬ch_ùx2mem
(&
š¢
->
ùx
, 
exec_mem
, &
tmp
);

116 
	}
}

121 
boŞ
 
	$oxt2_is_hw_´og_aùive
(
Ãt_deviû
 *
dev
)

123 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
dev
);

124  !!
pf
->
xdp_hw
.
©ch_šfo
.
´og
;

125 
	}
}

127 
	$Ùx2_v”ify_š¢
(
bpf_v”if›r_’v
 *
’v
,

128 
š¢_idx
, 
´ev_š¢_idx
)

131 
	}
}

133 
	$Ùx2_bpf_fš®ize
(
bpf_v”if›r_’v
 *
’v
)

136 
	}
}

138 
	$Ùx2_bpf_İt_»¶aû_š¢
(
bpf_v”if›r_’v
 *
’v
,

139 
u32
 
off
, 
bpf_š¢
 *
š¢
)

142 
	}
}

144 
	$Ùx2_bpf_İt_»move_š¢s
(
bpf_v”if›r_’v
 *
’v
,

145 
u32
 
off
, u32 
út
)

147 
Ùx2_bpf_´og
 *
obp
 = 
’v
->
´og
->
aux
->
ofæßd
->
dev_´iv
;

148 
bpf_š¢_aux_d©a
 *
aux_d©a
 = 
’v
->
š¢_aux_d©a
;

149 
Ùx2_bpf_š¢
 *
š¢
;

150 
idx
 = 
aux_d©a
[
off
].
Üig_idx
;

151 
i
;

153 
š¢
 = &
obp
->
obšs
[
idx
];

155 
i
 = 0; i < 
út
; i++, 
š¢
++) {

158 ià(
š¢
->
æags
 & 
OTX2_INSN_FLAG_VERIFIER
)

159 
i
--;

161 
š¢
->
æags
 |ğ
OTX2_INSN_FLAG_VERIFIER
;

162 
	`li¡_d–_š™
(&
š¢
->
li¡
);

166 
	}
}

168 
Ùx2_bpf_š¢
 *
	$Ùx2_bpf_g‘_š¢
(
Ùx2_bpf_š¢
 *
š¢
, 
n
)

170 
n
-- && 
š¢
) {

171 
š¢
 = 
	`li¡_Ãxt_’Œy
(š¢, 
li¡
);

174  
š¢
;

175 
	}
}

177 
	$Ùx2_bpf_m¬k_jmp_š¢
(
Ùx2_bpf_´og
 *
obp
)

179 
Ùx2_bpf_š¢
 *
š¢
;

182 
	`li¡_fÜ_—ch_’Œy
(
š¢
, &
obp
->
lh—d
, 
li¡
) {

183 
Ùx2_bpf_š¢
 *
d¡_š¢
;

185 
u64
 
code
 = 
š¢
->insn.code;

186 
u8
 
şass
 = 
	`BPF_CLASS
(
code
);

187 
d¡_idx
;

189 ià(
şass
 !ğ
BPF_JMP
 &&

190 
şass
 !ğ
BPF_JMP32
)

193 ià(
	`BPF_OP
(
code
è=ğ
BPF_EXIT
) {

194 
š¢
->
æags
 |ğ
OTX2_INSN_FLAG_FIXUP_INSN
;

200 ià(
code
 =ğ(
BPF_JMP
 | 
BPF_CALL
) &&

201 
š¢
->š¢.
¤c_»g
 !ğ
BPF_PSEUDO_CALL
) {

202 
	`´_”r
("insn->insn.imm= 0x%x BPF_FUNC_map_lookup_elem=0x%x\n",

203 
š¢
->š¢.
imm
, 
BPF_FUNC_m­_lookup_–em
);

205 ià(
š¢
->š¢.
imm
 =ğ
BPF_FUNC_m­_lookup_–em
) {

206 
	`´_”r
("it is matching BPF_FUNC_map_lookup_elem\n");

212 ià(
	`BPF_OP
(
code
è=ğ
BPF_CALL
)

213 
d¡_idx
 = 
š¢
->
idx
 + 1 + in¢->š¢.
imm
;

217 
d¡_idx
 = 
š¢
->
idx
 + 1 + in¢->š¢.
off
;

219 ià(
d¡_idx
 >ğ
obp
->
bpf_´og
->
Ën
) {

220 
	`´_”r
("%s: JMPo‡n invalid idx=%d,†en=%d\n",

221 
__func__
, 
d¡_idx
, 
obp
->
bpf_´og
->
Ën
);

222  -
EINVAL
;

225 
d¡_š¢
 = 
	`Ùx2_bpf_g‘_š¢
(
š¢
, 
d¡_idx
 - in¢->
idx
);

226 
š¢
->
to_jmp
 = 
d¡_š¢
;

228 
	`´_”r
("Jumping from insn->idx=%do dst_ins->idx=%d\n",

229 
š¢
->
idx
, 
d¡_š¢
->idx);

231 ià(
	`BPF_OP
(
code
è=ğ
BPF_CALL
) {

232 
š¢
->
æags
 |ğ
OTX2_INSN_FLAG_FIXUP_INSN
;

233 
d¡_š¢
->
æags
 |ğ
OTX2_INSN_FLAG_SUBPROG_START
;

239 
d¡_š¢
->
æags
 |ğ
OTX2_INSN_FLAG_JMP_DST
;

243 
	}
}

245 
	$Ùx2_bpf_´•¬e_šs_li¡
(
bpf_´og
 *
´og
)

247 
Ùx2_bpf_´og
 *
obp
 = 
	`kz®loc
((*obp), 
GFP_KERNEL
);

248 
Ùx2_bpf_š¢
 *
d¡
;

249 
bpf_š¢
 *
¤c
;

250 
”r
, 
i
;

252 ià(!
obp
) {

253 
	`´_”r
("%s: unableo‡llocate memory for oxt2_prog\n",

254 
__func__
);

255 
”r
 = -
ENOMEM
;

256 
ç_Ùx2_´og
;

259 
obp
->
bpf_´og
 = 
´og
;

260 
obp
->
j™ed
 = 
çl£
;

261 
obp
->
j™ed_Ën
 = 0;

262 
	`mu‹x_š™
(&
obp
->
mu‹x
);

263 
	`INIT_LIST_HEAD
(&
obp
->
lh—d
);

265 
obp
->
obšs
 = 
	`kz®loc
((
Ùx2_bpf_š¢
è* 
´og
->
Ën
, 
GFP_KERNEL
);

266 ià(!
obp
->
obšs
) {

267 
”r
 = -
ENOMEM
;

268 
ç_š¢_mem
;

271 
d¡
 = 
obp
->
obšs
;

272 
¤c
 = 
´og
->
š¢si
;

273 
i
 = 0; i < 
´og
->
Ën
; i++, 
¤c
++, 
d¡
++) {

274 
d¡
->
š¢
 = *
¤c
;

275 
	`li¡_add_
(&
d¡
->
li¡
, &
obp
->
lh—d
);

276 
d¡
->
idx
 = 
i
;

279 
´og
->
aux
->
ofæßd
->
dev_´iv
 = 
obp
;

283 
ç_š¢_mem
:

284 
	`kä“
(
obp
);

286 
ç_Ùx2_´og
:

287  
”r
;

289 
	}
}

291 
	$Ùx2_bpf_v”if›r_´•
(
bpf_´og
 *
´og
)

293  
	`Ùx2_bpf_´•¬e_šs_li¡
(
´og
);

294 
	}
}

296 
	$Ùx2_´št_š¢_ùx
(
Ùx2_bpf_¬ch_ùx
 *
ùx
, cÚ¡ *
func
)

298 
i
;

299 
	`´_”r
(" ++++ % +++ \n", 
func
);

301 
i
 = 0; i < 
ùx
->
bpf2bi_út
; i++) {

302 
	`´_”r
("0x%4x\n", 
	`Áohl
(
ùx
->
bi
[
i
]));

305 
	}
}

307 
	$Ùx2_bpf_Œª¦©e
(
bpf_´og
 *
´og
)

311 
”r
 = 
	`bpf_´og_®loc_j™ed_lšfo
(
´og
);

312 
bpf_´og_aux
 *
aux
 = 
´og
->aux;

313 
i
;

315 
”r
;

316 
Ùx2_bpf_´og
 *
obp
;

318 
obp
 = 
´og
->
aux
->
ofæßd
->
dev_´iv
;

320 
”r
 = 
	`Ùx2_bpf_m¬k_jmp_š¢
(
obp
);

321 ià(
”r
) {

322 
	`´_”r
("Error during marking\n");

323  -
EINVAL
;

328 
exec_mem
 = 
	`kz®loc
((
PAGE_SIZE
), 
GFP_KERNEL
);

329 ià(
”r
)

330  
”r
;

333 
	`bud_´Şogue
(&
obp
->
´Şogue
, 
´og
);

334 
	`bud_•ogue
(&
obp
->
•ogue
, 
´og
);

339 
´og
 = 
	`bpf_št_j™_compe
(prog);

340 ià(!
´og
->
j™ed
) {

341 
	`bpf_´og_ä“_j™ed_lšfo
(
´og
);

342 #ifdeà
CONFIG_BPF_JIT_ALWAYS_ON


343  -
ENOTSUPP
;

346 
	`bpf_´og_ä“_unu£d_j™ed_lšfo
(
´og
);

348 
	`bpf_´og_lock_ro
(
´og
);

352 
i
 = 0; i < 
aux
->
u£d_m­_út
; i++) {

353 
bpf_m­
 *
m­
 = 
aux
->
u£d_m­s
[
i
];

354 
bpf_¬¿y
 *
¬¿y
;

356 ià(
maobp
->
m­_ty³
 !ğ
BPF_MAP_TYPE_PROG_ARRAY
)

359 
¬¿y
 = 
	`cÚš”_of
(
m­
, 
bpf_¬¿y
, map);

360 ià(!
	`bpf_´og_¬¿y_com·tibË
(
¬¿y
, 
´og
))

361  -
EINVAL
;

365 
	}
}

367 
	$Ùx2_bpf_de¡roy
(
bpf_´og
 *
´og
)

370 
	}
}

372 cÚ¡ 
bpf_´og_ofæßd_İs
 
	gÙx2_bpf_dev_İs
 = {

373 .
š¢_hook
 = 
Ùx2_v”ify_š¢
,

374 .
	gfš®ize
 = 
Ùx2_bpf_fš®ize
,

375 .
	g»¶aû_š¢
 = 
Ùx2_bpf_İt_»¶aû_š¢
,

376 .
	g»move_š¢s
 = 
Ùx2_bpf_İt_»move_š¢s
,

377 .
	g´•¬e
 = 
Ùx2_bpf_v”if›r_´•
,

378 .
	gŒª¦©e
 = 
Ùx2_bpf_Œª¦©e
,

379 .
	gde¡roy
 = 
Ùx2_bpf_de¡roy
,

382 
	#BUFSIZE
 50

	)

383 
	gÇme
[
BUFSIZE
];

385 
ssize_t
 
	$Ùx2_xdp_´oc_wr™e
(
fe
 *file,

386 cÚ¡ 
__u£r
 *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
)

388 
Ùx2_nic
 *
pf
;

389 
Åc_di§bË_’Œy_»q
 *
»q
;

390 
Ãt_deviû
 *
dev
;

391 
”r
;

393 if(*
µos
 > 0 || 
couÁ
 > 
BUFSIZE
)

394  -
EFAULT
;

396 if(
	`cİy_äom_u£r
(
Çme
, 
buf
, 
couÁ
))

397  -
EFAULT
;

399 
Çme
[
couÁ
 - 1] = 0;

401 
dev
 = 
	`dev_g‘_by_Çme
(&
š™_Ãt
, 
Çme
);

402 ià(!
dev
) {

403 
	`´_”r
("NØÃtdev by‚am%s\n", 
Çme
);

404  -
EFAULT
;

407 
	`dev_put
(
dev
);

409 
pf
 = 
	`Ãtdev_´iv
(
dev
);

410 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

413 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_di§bË_’Œy
(&
pf
->
mbox
);

414 ià(!
»q
) {

415 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

416  -
ENOMEM
;

418 
»q
->
Åcifunc
 = 
pf
->
pcifunc
;

419 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

420 ià(
”r
) {

421 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

422 
	`´_”r
("Disabling…madev‚pc failed\n");

423  -
EFAULT
;

426 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

427 
Ùx2_xdp_gbl
.
pma_dev
 = 
dev
;

429  
couÁ
;

430 
	}
}

432 
ssize_t
 
	$Ùx2_xdp_´oc_»ad
(
fe
 *fe, 
__u£r
 *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
)

434 
Ën
=0;

435 
my_buf
[
BUFSIZE
];

437 if(*
µos
 > 0 || 
couÁ
 < 
BUFSIZE
)

440 
Ën
 +ğ
	`¥rštf
(
my_buf
, "%s", 
Çme
);

442 if(
	`cİy_to_u£r
((*)
buf
, 
Çme
, 
Ën
))

443  -
EFAULT
;

445 *
µos
 = 
Ën
;

446  
Ën
;

447 
	}
}

449 cÚ¡ 
fe_İ”©iÚs
 
	gÙx2_xdp_´oc_İs
 = {

450 .
wr™e
 = 
Ùx2_xdp_´oc_wr™e
,

451 .
	g»ad
 = 
Ùx2_xdp_´oc_»ad
,

454 
	$Ùx2_xdp_´oc_ü—‹
()

456 
´oc_’Œy
 = 
	`´oc_ü—‹
("pma", 0644, 
NULL
, &
Ùx2_xdp_´oc_İs
);

457 
	}
}

462 
	$Ùx2_xdp_ofæßd_dev_uÄegi¡”
(
Ãt_deviû
 *
dev
)

464 
bpf_ofæßd_dev
 *
bpf_dev
;

465 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
dev
);

467 
bpf_dev
 = 
pf
->
xdp_hw
.bpf_dev;

469 ià(!!
bpf_dev
) {

470 
	`´_”r
("%s: NØofæßd deviû found fÜ %s\n", 
__func__
, 
dev
->
Çme
);

474 
	`bpf_ofæßd_dev_Ãtdev_uÄegi¡”
(
bpf_dev
, 
dev
);

475 
	`bpf_ofæßd_dev_de¡roy
(
bpf_dev
);

476 
	}
}

481 
	$Ùx2_xdp_ofæßd_dev_»gi¡”
(
Ãt_deviû
 *
dev
)

483 
bpf_ofæßd_dev
 *
bpf_dev
;

484 
Ùx2_nic
 *
pf
 = 
	`Ãtdev_´iv
(
dev
);

486 
bpf_dev
 = 
	`bpf_ofæßd_dev_ü—‹
(&
Ùx2_bpf_dev_İs
, &
Ùx2_xdp_gbl
);

487 ià(!
bpf_dev
) {

488 
	`´_”r
("%s: ofæßd dev c»©iÚ faed\n", 
__func__
);

489  -
ENOMEM
;

491 
pf
->
xdp_hw
.
bpf_dev
 = bpf_dev;

493  
	`bpf_ofæßd_dev_Ãtdev_»gi¡”
(
bpf_dev
, 
dev
);

494 
	}
}

499 
	$Ùx2_£tup_hw_xdp
(
Ãt_deviû
 *
dev
, 
Ãtdev_bpf
 *
bpf
)

502 
Ùx2_nic
 *
Åf
 = 
	`Ãtdev_´iv
(
dev
);

503 
Ùx2_nic
 *
pm­f
 = 
	`Ãtdev_´iv
(
Ùx2_xdp_gbl
.
pma_dev
);

504 
Åc_upd©e_aùiÚ_»q
 *
»q
;

506 
tšfo
 *tinfo;

507 
Ãt_deviû
 *
lbk1_dev
;

508 
Ùx2_bpf_´og
 *
obp
;

509 
Ùx2_nic
 *
pf
;

510 
u16
 
lbk1_pfunc
;

512 ià(!
bpf
->
´og
)

515 
obp
 = 
bpf
->
´og
->
aux
->
ofæßd
->
dev_´iv
;

517 
	`DUMP_bpf_´og
(
bpf
->
´og
);

519 
	`DUMP_bpf_´og_aux
(
bpf
->
´og
->
aux
);

521 ià(!
bpf
->
´og
->
aux
->
ofæßd
) {

522 
	`NL_SET_ERR_MSG_MOD
(
bpf
->
exck
, "xdpoffload of‚on-bound…rogram");

523  -
EINVAL
;

526 ià(!
	`bpf_ofæßd_dev_m©ch
(
bpf
->
´og
, 
dev
)) {

527 
	`NL_SET_ERR_MSG_MOD
(
bpf
->
exck
, "program boundo different dev");

528  -
EINVAL
;

533 
¡©e
 = 
bpf
->
´og
->
aux
->
ofæßd
->
dev_´iv
;

534 ià(
	`WARN_ON
(
	`¡rcmp
(
¡©e
->state, "xlated"))) {

535 
	`NL_SET_ERR_MSG_MOD
(
bpf
->
exck
, "offloading…rogram in bad state");

536  -
EINVAL
;

539 ià(!
Ùx2_xdp_gbl
.
pma_dev
) {

540 
	`NL_SET_ERR_MSG_MOD
(
bpf
->
exck
, "PMA dev is‚ot configured yet");

541  -
EINVAL
;

544 
lbk1_dev
 = 
	`dev_g‘_by_Çme
(&
š™_Ãt
, "lbk1");

545 ià(!
lbk1_dev
) {

546 
	`´_”r
("No‚etdev by‚ame†kb1\n");

547  -
EINVAL
;

549 
pf
 = 
	`Ãtdev_´iv
(
lbk1_dev
);

550 
lbk1_pfunc
 = 
pf
->
pcifunc
;

551 
	`dev_put
(
lbk1_dev
);

553 ià(
pf
->
xdp_hw
.
Åc_cÚfigu»d
)

554 
cİy_´og
;

558 
	`mu‹x_lock
(&
pf
->
mbox
.
lock
);

560 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_upd©e_aùiÚ
(&
pf
->
mbox
);

561 ià(!
»q
) {

562 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

563  -
ENOMEM
;

567 
»q
->
Åcifunc
 = 
pm­f
->
pcifunc
;

568 
»q
->
İcifunc
 = 
Åf
->
pcifunc
;

570 
	`´_”r
("Modiy NPC…cifunc from 0x%x(%s)o 0x%x(%s)\n",

571 
Åf
->
pcifunc
, 
dev
->
Çme
, 
pm­f
->pcifunc, 
Ùx2_xdp_gbl
.
pma_dev
->name);

573 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

574 ià(
”r
) {

575 
	`´_”r
("Setting„eq->opcifunc=0x%xo„eq->npcifunc=0x%x failed\n",

576 
»q
->
İcifunc
,„eq->
Åcifunc
);

577 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

578  -
EFAULT
;

581 
»q
 = 
	`Ùx2_mbox_®loc_msg_Åc_upd©e_aùiÚ
(&
pf
->
mbox
);

582 ià(!
»q
) {

583 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

584  -
ENOMEM
;

588 
»q
->
Åcifunc
 = 
Åf
->
pcifunc
;

589 
»q
->
İcifunc
 = 
lbk1_pfunc
;

590 
	`´_”r
("Modiy NPC…cifunc from 0x%x(%s)o 0x%x(%s)\n",

591 
lbk1_pfunc
, 
lbk1_dev
->
Çme
, 
Åf
->
pcifunc
, 
dev
->name);

593 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pf
->
mbox
);

594 ià(
”r
) {

595 
	`´_”r
("Setting„eq->opcifunc=0x%xo„eq->npcifunc=0x%x failed\n",

596 
»q
->
İcifunc
,„eq->
Åcifunc
);

597 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

598  -
EFAULT
;

601 
	`mu‹x_uÆock
(&
pf
->
mbox
.
lock
);

603 
pf
->
xdp_hw
.
Åc_cÚfigu»d
 = 
Œue
;

606 
cİy_´og
:

608 
tšfo
 = 
	`Ùx2_th»ad_g‘_ä“_tšfo
();

609 ià(!
tšfo
) {

610 
	`´_”r
("No freehread‡vailable\n");

614 
	`Ùx2_´og_·ss
(
obp
, (
u32
 *)
tšfo
->
mem
);

615 
	`Ùx2_´št_¬ch_š¢
(
obp
, (
u32
 *)
tšfo
->
mem
);

617 
	`´_”r
("tšfo->mem=%pK\n", 
tšfo
->
mem
);

619 
	`Ùx2_th»ad_¡¬t_´og
(
tšfo
, 
obp
->
j™ed_Ën
);

621 
	`xdp_©chm’t_£tup
(&
pf
->
xdp_hw
.
©ch_šfo
, 
bpf
);

624 
	}
}

	@otx2_xdp.h

3 #iâdeà
OTX2_XDP_H_


4 
	#OTX2_XDP_H_


	)

6 
Ùx2_£tup_hw_xdp
(
Ãt_deviû
 *
dev
, 
Ãtdev_bpf
 *
xdp
);

8 
Ùx2_xdp_´oc_ü—‹
();

10 
Ùx2_xdp_ofæßd_dev_uÄegi¡”
(
Ãt_deviû
 *
dev
);

11 
Ùx2_xdp_ofæßd_dev_»gi¡”
(
Ãt_deviû
 *
dev
);

	@otx2_xdp_debug.h

2 #iâdeà
OTX2_XDP_DEBUG_H


3 
	#OTX2_XDP_DEBUG_H


	)

7 
	sbpf_ofæßd_dev
 {

8 cÚ¡ 
bpf_´og_ofæßd_İs
 *
	mİs
;

9 
li¡_h—d
 
	mÃtdevs
;

10 *
	m´iv
;

15 
	#DUMP_bpf_ofæßd_dev
(
a
) \

17 
u8
 *
±r
 = (u8 *)((
a
)->
´iv
); \

18 
	`´_”r
("%p: ops=%p\n", 
a
, (a)->
İs
); \

19 ià((
a
)->
´iv
) { \

20 
	`´_”r
("priv= 0x%x 0x%x 0x%x 0x%x\n", \

21 
±r
[0],…tr[1],…tr[2],…tr[3]); \

23 } 0);

	)

27 
	sbpf_´og_ofæßd
 {

28 
bpf_´og
 *
	m´og
;

29 
Ãt_deviû
 *
	mÃtdev
;

30 
bpf_ofæßd_dev
 *
	moffdev
;

31 *
	mdev_´iv
;

32 
li¡_h—d
 
	mofæßds
;

33 
boŞ
 
	mdev_¡©e
;

34 
boŞ
 
	mİt_çed
;

35 *
	mj™ed_image
;

36 
u32
 
	mj™ed_Ën
;

39 
	#DUMP_bpf_´og_ofæßd
(
a
) \

41 
nsim_bpf_bound_´og
 *
¡©e
; \

42 
¡©e
 = (
a
)->
dev_´iv
; \

43 
	`´_”r
("%p:…rog=%p dev=%s dev_state=%d opt_failed=%d jited_len=%u\n", \

44 (
a
), (a)->
´og
, (a)->
Ãtdev
->
Çme
, (a)->
dev_¡©e
, \

45 (
a
)->
İt_çed
, 
j™ed_Ën
); \

46 
	`´_”r
("prog=%p state=%s is_loaded=%d\n", \

47 
¡©e
->
´og
, s‹->¡©e, s‹->
is_lßded
); \

48 ià((
a
)->
j™ed_image
) { \

49 
	`´_”r
("j™ed imag0x%x 0x%x 0x%x 0x%x\n",(
a
)->
j™ed_image
[0], \

50 (
a
)->
j™ed_image
[1], (a)->jited_image[2], (a)->jited_image[3]); \

52 0);

	)

61 
	sbpf_´og_aux
 {

62 
©omic_t
 
	m»fút
;

63 
u32
 
	mu£d_m­_út
;

64 
u32
 
	mmax_ùx_off£t
;

65 
u32
 
	mmax_pkt_off£t
;

66 
u32
 
	mmax__acûss
;

67 
u32
 
	m¡ack_d•th
;

68 
u32
 
	mid
;

69 
u32
 
	mfunc_út
;

70 
u32
 
	mfunc_idx
;

71 
boŞ
 
	mv”if›r_zext
;

72 
boŞ
 
	mofæßd_»que¡ed
;

73 
bpf_´og
 **
	mfunc
;

74 *
	mj™_d©a
;

75 
Ïtch_Œ“_node
 
	mksym_Šode
;

76 
li¡_h—d
 
	mksym_Êode
;

77 cÚ¡ 
bpf_´og_İs
 *
	mİs
;

78 
bpf_m­
 **
	mu£d_m­s
;

79 
bpf_´og
 *
	m´og
;

80 
u£r_¡ruù
 *
	mu£r
;

81 
u64
 
	mlßd_time
;

82 
bpf_m­
 *
	mcgroup_¡Üage
[
MAX_BPF_CGROUP_STORAGE_TYPE
];

83 
	mÇme
[
BPF_OBJ_NAME_LEN
];

84 #ifdeà
CONFIG_SECURITY


85 *
	m£cur™y
;

87 
bpf_´og_ofæßd
 *
	mofæßd
;

88 
btf
 *
	mbtf
;

89 
bpf_func_šfo
 *
	mfunc_šfo
;

96 
bpf_lše_šfo
 *
	mlšfo
;

104 **
	mj™ed_lšfo
;

105 
u32
 
	mfunc_šfo_út
;

106 
u32
 
	mÄ_lšfo
;

111 
u32
 
	mlšfo_idx
;

112 
bpf_´og_¡©s
 
__³rıu
 *
	m¡©s
;

114 
wÜk_¡ruù
 
	mwÜk
;

115 
rcu_h—d
 
	mrcu
;

121 
	#DUMP_bpf_´og_aux
(
a
) \

123 
	`´_”r
("%p: id=%u offload_requested=%u\n", \

124 
a
, (a)->
id
, (a)->
ofæßd_»que¡ed
); \

125 
	`´_”r
("´og=%°Çme=%s\n", (
a
)->
´og
, (a)->
Çme
); \

126 } 0);

	)

130 
	ssock_f‹r
 {

131 
__u16
 
	gcode
;

132 
__u8
 
	gjt
;

133 
__u8
 
	gjf
;

134 
__u32
 
	gk
;

139 
	#DUMP_sock_f‹r
(
a
) \

141 
	`´_”r
("%p: code=0x%x jt=%d jf=%d k=%u\n", \

142 
a
, (a)->
code
, (a)->
jt
, (a)->
jf
, (a)->
k
); \

143 } 0);

	)

146 
	sbpf_š¢
 {

147 
__u8
 
	gcode
;

148 
__u8
 
	gd¡_»g
:4;

149 
__u8
 
	g¤c_»g
:4;

150 
__s16
 
	goff
;

151 
__s32
 
	gimm
;

155 
	#DUMP_bpf_š¢
(
a
) \

157 
	`´_”r
("%p: code=0x%x dst_reg=0x%x src_reg=0x%x off=0x%x imm=0x%x\n", \

158 
a
, (a)->
code
, (a)->
d¡_»g
, (a)->
¤c_»g
, (a)->
off
, (a)->
imm
); \

159 } 0);

	)

162 
	sbpf_´og
 {

163 
u16
 
	g·ges
;

164 
u16
 
	gj™ed
:1,

165 
	gj™_»que¡ed
:1,

166 
	gg¶_com·tibË
:1,

167 
	gcb_acûss
:1,

168 
	gd¡_Ãeded
:1,

169 
	gblšded
:1,

170 
	gis_func
:1,

171 
	gk´obe_ov”ride
:1,

172 
	ghas_ÿÎchaš_buf
:1,

173 
	g’fÜû_ex³ùed_©ch_ty³
:1;

174 
bpf_´og_ty³
 
	gty³
;

175 
bpf_©ch_ty³
 
	gex³ùed_©ch_ty³
;

176 
u32
 
	gËn
;

177 
u32
 
	gj™ed_Ën
;

178 
u8
 
	gg
[
BPF_TAG_SIZE
];

179 
bpf_´og_aux
 *
	gaux
;

180 
sock_årog_k”n
 *
	gÜig_´og
;

181 (*
	gbpf_func
)(cÚ¡ *
	gùx
,

182 cÚ¡ 
bpf_š¢
 *
	gš¢
);

185 
sock_f‹r
 
	gš¢s
[0];

186 
bpf_š¢
 
	gš¢si
[0];

191 
	#DUMP_bpf_´og
(
a
) \

193 
u32
 
™”
 = 0, *
±r
; \

194 
bpf_š¢
 *
šs
; \

195 
	`´_”r
("%p: Pages=%d jited=%d jit_requested=%d gpl_compatible=%d" \

197 
a
, (a)->
·ges
, (a)->
j™ed
, (a)->
j™_»que¡ed
, (a)->
g¶_com·tibË
, \

198 (
a
)->
cb_acûss
, (a)->
d¡_Ãeded
, (a)->
blšded
, (a)->
is_func
); \

199 
	`´_”r
("kprobe_override=%d has_callchain_buf=%d" \

201 (
a
)->
k´obe_ov”ride
, (a)->
has_ÿÎchaš_buf
, \

202 (
a
)->
’fÜû_ex³ùed_©ch_ty³
); \

203 
	`´_”r
("type=%uƒxpected_attach_type=%u†en=%u jited_len=%u\n", \

204 (
a
)->
ty³
, (a)->
ex³ùed_©ch_ty³
, (a)->
Ën
, (a)->
j™ed_Ën
); \

205 
	`´_”r
("Jited ins\n"); \

206 
	`´_”r
("\n Jitted…rogram \n"); \

207 
±r
 = (
u32
 *)((
a
)->
bpf_func
); \

208 
™”
 = 0; i‹¸< (
a
)->
j™ed_Ën
 / 4; iter++) { \

209 
	`´_”r
("%02d: 0x%08x\n", 
™”
, 
	`htÚl
(*
±r
++)); \

211 
	`´_”r
("\n BPF…rogram \n"); \

212 
šs
 = (
a
)->
š¢si
; \

213 
™”
 = 0; i‹¸< (
a
)->
Ën
; i‹r++, 
šs
++) { \

214 
	`´_”r
("%d :", 
™”
); \

215 
	`DUMP_bpf_š¢
(
šs
); \

217 } 0);

	)

220 
	sÃtdev_bpf
 {

221 
bpf_Ãtdev_commªd
 
	gcommªd
;

225 
u32
 
	gæags
;

226 
bpf_´og
 *
	g´og
;

227 
Ãšk_ext_ack
 *
	gexck
;

231 
u32
 
	g´og_id
;

233 
u32
 
	g´og_æags
;

237 
bpf_ofæßded_m­
 *
	goffm­
;

241 
xdp_umem
 *
	gumem
;

242 
u16
 
	gqueue_id
;

243 } 
	gxsk
;

248 
	#DUMP_Ãtdev_bpf
(
a
) \

250 
	`´_”r
("%p: commªd %u, fÏgs=0x%x…rog=%°id=%d id_æags=0x%x", 
a
, \

251 (
a
)->
commªd
, (a)->
æags
, (a)->
´og
, (a)->
´og_id
, (a)->
´og_æags
); \

252 0);

	)

	@qos.c

7 
	~<lšux/Ãtdeviû.h
>

8 
	~<lšux/‘h”deviû.h
>

9 
	~<lšux/š‘deviû.h
>

10 
	~<lšux/b™f›ld.h
>

12 
	~"Ùx2_commÚ.h
"

13 
	~"ú10k.h
"

14 
	~"qos.h
"

16 
	#OTX2_QOS_QID_INNER
 0xFFFFU

	)

17 
	#OTX2_QOS_QID_NONE
 0xFFFEU

	)

18 
	#OTX2_QOS_ROOT_CLASSID
 0xFFFFFFFF

	)

19 
	#OTX2_QOS_CLASS_NONE
 0

	)

20 
	#OTX2_QOS_DEFAULT_PRIO
 0xF

	)

21 
	#OTX2_QOS_INVALID_SQ
 0xFFFF

	)

22 
	#OTX2_QOS_INVALID_TXSCHQ_IDX
 0xFFFF

	)

25 
	#MAX_BURST_EXPONENT
 0x0FULL

	)

26 
	#MAX_BURST_MANTISSA
 0xFFULL

	)

27 
	#MAX_BURST_SIZE
 130816ULL

	)

28 
	#MAX_RATE_DIVIDER_EXPONENT
 12ULL

	)

29 
	#MAX_RATE_EXPONENT
 0x0FULL

	)

30 
	#MAX_RATE_MANTISSA
 0xFFULL

	)

33 
	#TLX_RATE_MANTISSA
 
	`GENMASK_ULL
(8, 1)

	)

34 
	#TLX_RATE_EXPONENT
 
	`GENMASK_ULL
(12, 9)

	)

35 
	#TLX_RATE_DIVIDER_EXPONENT
 
	`GENMASK_ULL
(16, 13)

	)

36 
	#TLX_BURST_MANTISSA
 
	`GENMASK_ULL
(36, 29)

	)

37 
	#TLX_BURST_EXPONENT
 
	`GENMASK_ULL
(40, 37)

	)

39 
boŞ
 
	$is_qos_node_dw¼
(
Ùx2_qos_node
 *
·»Á
,

40 
Ùx2_nic
 *
pfvf
,

41 
u64
 
´io
)

43 
Ùx2_qos_node
 *
node
;

44 
boŞ
 
»t
 = 
çl£
;

46 ià(
·»Á
->
chd_dw¼_´io
 =ğ
´io
)

47  
Œue
;

49 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

50 
	`li¡_fÜ_—ch_’Œy
(
node
, &
·»Á
->
chd_li¡
, 
li¡
) {

51 ià(
´io
 =ğ
node
->prio) {

52 ià(
·»Á
->
chd_dw¼_´io
 !ğ
OTX2_QOS_DEFAULT_PRIO
 &&

53 
·»Á
->
chd_dw¼_´io
 !ğ
´io
)

56 
node
->
is_¡©ic
 = 
çl£
;

57 
·»Á
->
chd_dw¼_út
++;

58 
·»Á
->
chd_¡©ic_út
--;

59 
»t
 = 
Œue
;

63 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

65  
»t
;

66 
	}
}

68 
	$Ùx2_qos_upd©e_tx_Ãtdev_queues
(
Ùx2_nic
 *
pfvf
)

70 
tx_queues
, 
”r
, 
qos_txqs
 = 0;

71 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

73 
qos_txqs
 = 
	`b™m­_weight
(
pfvf
->
qos
.
qos_sq_bm­
,

74 
OTX2_QOS_MAX_LEAF_NODES
);

76 
tx_queues
 = 
hw
->tx_queue + 
qos_txqs
;

78 
”r
 = 
	`Ãtif_£t_»®_num_tx_queues
(
pfvf
->
Ãtdev
, 
tx_queues
);

79 ià(
”r
) {

80 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

81 "FaedØ£ˆnØoàTx queues: %d\n", 
tx_queues
);

82  
”r
;

86 
	}
}

88 
u64
 
	$Ùx2_qos_cÚv”t_¿‹
(
u64
 
¿‹
)

90 
u64
 
cÚv”‹d_¿‹
;

93 
cÚv”‹d_¿‹
 = 
¿‹
 * 8;

94 
cÚv”‹d_¿‹
 = 
	`max_t
(
u64
, converted_rate / 1000000, 1);

96  
cÚv”‹d_¿‹
;

97 
	}
}

99 
	$Ùx2_qos_quªtum_to_dw¼_weight
(
Ùx2_nic
 *
pfvf
, 
u32
 
quªtum
)

101 
u32
 
weight
;

103 
weight
 = 
quªtum
 / 
pfvf
->
hw
.
dw¼_mtu
;

104 ià(
quªtum
 % 
pfvf
->
hw
.
dw¼_mtu
)

105 
weight
 += 1;

107  
weight
;

108 
	}
}

110 
	$__Ùx2_qos_txschq_cfg
(
Ùx2_nic
 *
pfvf
,

111 
Ùx2_qos_node
 *
node
,

112 
nix_txschq_cÚfig
 *
cfg
)

114 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

115 
num_»gs
 = 0;

116 
u16
 
¼_weight
;

117 
u32
 
quªtum
;

118 
u64
 
max¿‹
;

119 
u8
 
Ëv–
;

121 
Ëv–
 = 
node
->level;

124 ià(
Ëv–
 =ğ
NIX_TXSCH_LVL_SMQ
) {

125 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_SMQX_CFG
(
node
->
schq
);

126 
cfg
->
»gv®
[
num_»gs
] = ((
u64
)
pfvf
->
tx_max_pk’
 << 8) |

127 
OTX2_MIN_MTU
;

128 
cfg
->
»gv®
[
num_»gs
] |= (0x20ULL << 51) | (0x80ULL << 39) |

130 
num_»gs
++;

133 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_MDQX_PARENT
(
node
->
schq
);

134 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
schq
 << 16;

135 
num_»gs
++;

138 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_NONE
) {

139 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_MDQX_SCHEDULE
(
node
->
schq
);

140 
cfg
->
»gv®
[
num_»gs
] = 
node
->
´io
 << 24 |

141 
	`mtu_to_dw¼_weight
(
pfvf
,

142 
pfvf
->
tx_max_pk’
);

143 
num_»gs
++;

144 
txschq_cfg_out
;

148 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_MDQX_SCHEDULE
(
node
->
schq
);

149 ià(
node
->
is_¡©ic
) {

150 
cfg
->
»gv®
[
num_»gs
] = (
node
->
schq
 -

151 
node
->
·»Á
->
´io_ªchÜ
) << 24;

153 
quªtum
 = 
node
->quantum ?

154 
node
->
quªtum
 : 
pfvf
->
tx_max_pk’
;

155 
¼_weight
 = 
	`Ùx2_qos_quªtum_to_dw¼_weight
(
pfvf
,

156 
quªtum
);

157 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
chd_dw¼_´io
 << 24 |

158 
¼_weight
;

160 
num_»gs
++;

163 
max¿‹
 = (
node
->
¿‹
 >‚ode->
û
) ?‚ode->rate :‚ode->ceil;

165 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_MDQX_PIR
(
node
->
schq
);

166 
cfg
->
»gv®
[
num_»gs
] =

167 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
max¿‹
, 65536);

168 
num_»gs
++;

171 ià(!
	`‹¡_b™
(
QOS_CIR_PIR_SUPPORT
, &
pfvf
->
hw
.
ÿp_æag
)) {

175 
txschq_cfg_out
;

178 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_MDQX_CIR
(
node
->
schq
);

179 
cfg
->
»gv®
[
num_»gs
] =

180 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
node
->
¿‹
, 65536);

181 
num_»gs
++;

182 } ià(
Ëv–
 =ğ
NIX_TXSCH_LVL_TL4
) {

184 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL4X_PARENT
(
node
->
schq
);

185 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
schq
 << 16;

186 
num_»gs
++;

189 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_NONE
) {

190 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL4X_SCHEDULE
(
node
->
schq
);

191 
cfg
->
»gv®
[
num_»gs
] = 
node
->
´io
 << 24 |

192 
	`mtu_to_dw¼_weight
(
pfvf
,

193 
pfvf
->
tx_max_pk’
);

194 
num_»gs
++;

195 
txschq_cfg_out
;

199 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL4X_SCHEDULE
(
node
->
schq
);

200 ià(
node
->
is_¡©ic
) {

201 
cfg
->
»gv®
[
num_»gs
] = (
node
->
schq
 -

202 
node
->
·»Á
->
´io_ªchÜ
) << 24;

204 
quªtum
 = 
node
->quantum ?

205 
node
->
quªtum
 : 
pfvf
->
tx_max_pk’
;

206 
¼_weight
 = 
	`Ùx2_qos_quªtum_to_dw¼_weight
(
pfvf
,

207 
quªtum
);

208 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
chd_dw¼_´io
 << 24 |

209 
¼_weight
;

211 
num_»gs
++;

214 
max¿‹
 = (
node
->
¿‹
 >‚ode->
û
) ?‚ode->rate :‚ode->ceil;

215 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL4X_PIR
(
node
->
schq
);

216 
cfg
->
»gv®
[
num_»gs
] =

217 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
max¿‹
, 65536);

218 
num_»gs
++;

221 ià(!
	`‹¡_b™
(
QOS_CIR_PIR_SUPPORT
, &
pfvf
->
hw
.
ÿp_æag
)) {

225 
txschq_cfg_out
;

228 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL4X_CIR
(
node
->
schq
);

229 
cfg
->
»gv®
[
num_»gs
] =

230 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
node
->
¿‹
, 65536);

231 
num_»gs
++;

232 } ià(
Ëv–
 =ğ
NIX_TXSCH_LVL_TL3
) {

234 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3X_PARENT
(
node
->
schq
);

235 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
schq
 << 16;

236 
num_»gs
++;

239 ià(
Ëv–
 =ğ
pfvf
->
qos
.
lšk_cfg_lvl
) {

240 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3_TL2X_LINKX_CFG
(
node
->
schq
, 
hw
->
tx_lšk
);

241 
cfg
->
»gv®
[
num_»gs
] = 
	`BIT_ULL
(13) | BIT_ULL(12);

242 
num_»gs
++;

246 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_NONE
) {

247 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3X_SCHEDULE
(
node
->
schq
);

248 
cfg
->
»gv®
[
num_»gs
] = 
node
->
´io
 << 24 |

249 
	`mtu_to_dw¼_weight
(
pfvf
,

250 
pfvf
->
tx_max_pk’
);

251 
num_»gs
++;

252 
txschq_cfg_out
;

256 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3X_SCHEDULE
(
node
->
schq
);

257 ià(
node
->
is_¡©ic
) {

258 
cfg
->
»gv®
[
num_»gs
] = (
node
->
schq
 -

259 
node
->
·»Á
->
´io_ªchÜ
) << 24;

261 
quªtum
 = 
node
->quantum ?

262 
node
->
quªtum
 : 
pfvf
->
tx_max_pk’
;

263 
¼_weight
 = 
	`Ùx2_qos_quªtum_to_dw¼_weight
(
pfvf
,

264 
quªtum
);

265 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
chd_dw¼_´io
 << 24 |

266 
¼_weight
;

268 
num_»gs
++;

272 
max¿‹
 = (
node
->
¿‹
 >‚ode->
û
) ?‚ode->rate :‚ode->ceil;

273 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3X_PIR
(
node
->
schq
);

274 
cfg
->
»gv®
[
num_»gs
] =

275 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
max¿‹
, 65536);

276 
num_»gs
++;

279 ià(!
	`‹¡_b™
(
QOS_CIR_PIR_SUPPORT
, &
pfvf
->
hw
.
ÿp_æag
)) {

283 
txschq_cfg_out
;

286 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3X_CIR
(
node
->
schq
);

287 
cfg
->
»gv®
[
num_»gs
] =

288 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
node
->
¿‹
, 65536);

289 
num_»gs
++;

290 } ià(
Ëv–
 =ğ
NIX_TXSCH_LVL_TL2
) {

292 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_PARENT
(
node
->
schq
);

293 
cfg
->
»gv®
[
num_»gs
] = 
hw
->
tx_lšk
 << 16;

294 
num_»gs
++;

297 ià(
Ëv–
 =ğ
pfvf
->
qos
.
lšk_cfg_lvl
) {

298 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL3_TL2X_LINKX_CFG
(
node
->
schq
, 
hw
->
tx_lšk
);

299 
cfg
->
»gv®
[
num_»gs
] = 
	`BIT_ULL
(13) | BIT_ULL(12);

300 
num_»gs
++;

304 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_NONE
) {

305 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_SCHEDULE
(
node
->
schq
);

306 
cfg
->
»gv®
[
num_»gs
] = 
node
->
´io
 << 24 |

307 
	`mtu_to_dw¼_weight
(
pfvf
,

308 
pfvf
->
tx_max_pk’
);

309 
num_»gs
++;

310 
txschq_cfg_out
;

314 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_INNER
 && !node->
·»Á
) {

315 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_SCHEDULE
(
node
->
schq
);

316 
cfg
->
»gv®
[
num_»gs
] = 
hw
->
txschq_aggr_lvl_¼_´io
 << 24 |

317 
	`mtu_to_dw¼_weight
(
pfvf
,

318 
pfvf
->
tx_max_pk’
);

319 
num_»gs
++;

320 
txschq_cfg_out
;

324 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_SCHEDULE
(
node
->
schq
);

325 ià(
node
->
is_¡©ic
) {

326 
cfg
->
»gv®
[
num_»gs
] = (
node
->
schq
 -

327 
node
->
·»Á
->
´io_ªchÜ
) << 24;

329 
quªtum
 = 
node
->quantum ?

330 
node
->
quªtum
 : 
pfvf
->
tx_max_pk’
;

331 
¼_weight
 = 
	`Ùx2_qos_quªtum_to_dw¼_weight
(
pfvf
,

332 
quªtum
);

333 
cfg
->
»gv®
[
num_»gs
] = 
node
->
·»Á
->
chd_dw¼_´io
 << 24 |

334 
¼_weight
;

336 
num_»gs
++;

339 
max¿‹
 = (
node
->
¿‹
 >‚ode->
û
) ?‚ode->rate :‚ode->ceil;

340 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_PIR
(
node
->
schq
);

341 
cfg
->
»gv®
[
num_»gs
] =

342 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
max¿‹
, 65536);

343 
num_»gs
++;

346 ià(!
	`‹¡_b™
(
QOS_CIR_PIR_SUPPORT
, &
pfvf
->
hw
.
ÿp_æag
)) {

350 
txschq_cfg_out
;

353 
cfg
->
»g
[
num_»gs
] = 
	`NIX_AF_TL2X_CIR
(
node
->
schq
);

354 
cfg
->
»gv®
[
num_»gs
] =

355 
	`Ùx2_g‘_txschq_¿‹_»gv®
(
pfvf
, 
node
->
¿‹
, 65536);

356 
num_»gs
++;

359 
txschq_cfg_out
:

360 
cfg
->
num_»gs
 =‚um_regs;

361 
	}
}

363 
	$Ùx2_qos_txschq_£t_·»Á_tİŞogy
(
Ùx2_nic
 *
pfvf
,

364 
Ùx2_qos_node
 *
·»Á
)

366 
mbox
 *mbox = &
pfvf
->mbox;

367 
nix_txschq_cÚfig
 *
cfg
;

368 
rc
;

370 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
)

373 
	`mu‹x_lock
(&
mbox
->
lock
);

375 
cfg
 = 
	`Ùx2_mbox_®loc_msg_nix_txschq_cfg
(&
pfvf
->
mbox
);

376 ià(!
cfg
)

377  -
ENOMEM
;

379 
cfg
->
lvl
 = 
·»Á
->
Ëv–
;

381 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_TL4
)

382 
cfg
->
»g
[0] = 
	`NIX_AF_TL4X_TOPOLOGY
(
·»Á
->
schq
);

383 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_TL3
)

384 
cfg
->
»g
[0] = 
	`NIX_AF_TL3X_TOPOLOGY
(
·»Á
->
schq
);

385 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_TL2
)

386 
cfg
->
»g
[0] = 
	`NIX_AF_TL2X_TOPOLOGY
(
·»Á
->
schq
);

387 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_TL1
)

388 
cfg
->
»g
[0] = 
	`NIX_AF_TL1X_TOPOLOGY
(
·»Á
->
schq
);

390 
cfg
->
»gv®
[0] = (
u64
)
·»Á
->
´io_ªchÜ
 << 32;

391 
cfg
->
»gv®
[0] |ğ((
·»Á
->
chd_dw¼_´io
 !ğ
OTX2_QOS_DEFAULT_PRIO
) ?

392 
·»Á
->
chd_dw¼_´io
 : 0) << 1;

393 
cfg
->
num_»gs
++;

395 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

397 
	`mu‹x_uÆock
(&
mbox
->
lock
);

399  
rc
;

400 
	}
}

402 
	$Ùx2_qos_ä“_hw_node_schq
(
Ùx2_nic
 *
pfvf
,

403 
Ùx2_qos_node
 *
·»Á
)

405 
Ùx2_qos_node
 *
node
, *
tmp
;

407 
	`li¡_fÜ_—ch_’Œy_§ã
(
node
, 
tmp
, &
·»Á
->
chd_schq_li¡
, 
li¡
)

408 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
node
->
Ëv–
,‚ode->
schq
);

409 
	}
}

411 
	$Ùx2_qos_ä“_hw_node
(
Ùx2_nic
 *
pfvf
,

412 
Ùx2_qos_node
 *
·»Á
)

414 
Ùx2_qos_node
 *
node
, *
tmp
;

416 
	`li¡_fÜ_—ch_’Œy_§ã
(
node
, 
tmp
, &
·»Á
->
chd_li¡
, 
li¡
) {

417 
	`Ùx2_qos_ä“_hw_node
(
pfvf
, 
node
);

418 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
node
->
Ëv–
,‚ode->
schq
);

419 
	`Ùx2_qos_ä“_hw_node_schq
(
pfvf
, 
node
);

421 
	}
}

423 
	$Ùx2_qos_ä“_hw_cfg
(
Ùx2_nic
 *
pfvf
,

424 
Ùx2_qos_node
 *
node
)

426 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

429 
	`Ùx2_qos_ä“_hw_node
(
pfvf
, 
node
);

430 
	`Ùx2_qos_ä“_hw_node_schq
(
pfvf
, 
node
);

433 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
node
->
Ëv–
,‚ode->
schq
);

435 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

436 
	}
}

438 
	$Ùx2_qos_sw_node_d–‘e
(
Ùx2_nic
 *
pfvf
,

439 
Ùx2_qos_node
 *
node
)

441 
	`hash_d–
(&
node
->
hli¡
);

443 ià(
node
->
qid
 !ğ
OTX2_QOS_QID_INNER
 &&‚ode->qid !ğ
OTX2_QOS_QID_NONE
) {

444 
	`__ş—r_b™
(
node
->
qid
, 
pfvf
->
qos
.
qos_sq_bm­
);

445 
	`Ùx2_qos_upd©e_tx_Ãtdev_queues
(
pfvf
);

448 
	`li¡_d–
(&
node
->
li¡
);

449 
	`kä“
(
node
);

450 
	}
}

452 
	$Ùx2_qos_ä“_sw_node_schq
(
Ùx2_nic
 *
pfvf
,

453 
Ùx2_qos_node
 *
·»Á
)

455 
Ùx2_qos_node
 *
node
, *
tmp
;

457 
	`li¡_fÜ_—ch_’Œy_§ã
(
node
, 
tmp
, &
·»Á
->
chd_schq_li¡
, 
li¡
) {

458 
	`li¡_d–
(&
node
->
li¡
);

459 
	`kä“
(
node
);

461 
	}
}

463 
	$__Ùx2_qos_ä“_sw_node
(
Ùx2_nic
 *
pfvf
,

464 
Ùx2_qos_node
 *
·»Á
)

466 
Ùx2_qos_node
 *
node
, *
tmp
;

468 
	`li¡_fÜ_—ch_’Œy_§ã
(
node
, 
tmp
, &
·»Á
->
chd_li¡
, 
li¡
) {

469 
	`__Ùx2_qos_ä“_sw_node
(
pfvf
, 
node
);

470 
	`Ùx2_qos_ä“_sw_node_schq
(
pfvf
, 
node
);

471 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
node
);

473 
	}
}

475 
	$Ùx2_qos_ä“_sw_node
(
Ùx2_nic
 *
pfvf
,

476 
Ùx2_qos_node
 *
node
)

478 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

480 
	`__Ùx2_qos_ä“_sw_node
(
pfvf
, 
node
);

481 
	`Ùx2_qos_ä“_sw_node_schq
(
pfvf
, 
node
);

482 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
node
);

484 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

485 
	}
}

487 
	$Ùx2_qos_de¡roy_node
(
Ùx2_nic
 *
pfvf
,

488 
Ùx2_qos_node
 *
node
)

490 
	`Ùx2_qos_ä“_hw_cfg
(
pfvf
, 
node
);

491 
	`Ùx2_qos_ä“_sw_node
(
pfvf
, 
node
);

492 
	}
}

494 
	$Ùx2_qos_fl_cfg_schq
(
Ùx2_qos_node
 *
·»Á
,

495 
Ùx2_qos_cfg
 *
cfg
)

497 
Ùx2_qos_node
 *
node
;

499 
	`li¡_fÜ_—ch_’Œy
(
node
, &
·»Á
->
chd_schq_li¡
, 
li¡
)

500 
cfg
->
schq
[
node
->
Ëv–
]++;

501 
	}
}

503 
	$Ùx2_qos_fl_cfg_
(
Ùx2_qos_node
 *
·»Á
,

504 
Ùx2_qos_cfg
 *
cfg
)

506 
Ùx2_qos_node
 *
node
;

508 
	`li¡_fÜ_—ch_’Œy
(
node
, &
·»Á
->
chd_li¡
, 
li¡
) {

509 
	`Ùx2_qos_fl_cfg_
(
node
, 
cfg
);

510 
	`Ùx2_qos_fl_cfg_schq
(
node
, 
cfg
);

512 
cfg
->
schq_cÚtig
[
·»Á
->
Ëv–
 - 1] =…¬’t->
chd_dw¼_út
 +

513 
·»Á
->
max_¡©ic_´io
 + 1;

514 
	}
}

516 
	$Ùx2_qos_´•¬e_txschq_cfg
(
Ùx2_nic
 *
pfvf
,

517 
Ùx2_qos_node
 *
·»Á
,

518 
Ùx2_qos_cfg
 *
cfg
)

520 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

521 
	`Ùx2_qos_fl_cfg_
(
·»Á
, 
cfg
);

522 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

523 
	}
}

525 
	$Ùx2_qos_»ad_txschq_cfg_schq
(
Ùx2_qos_node
 *
·»Á
,

526 
Ùx2_qos_cfg
 *
cfg
)

528 
Ùx2_qos_node
 *
node
;

529 
út
;

531 
	`li¡_fÜ_—ch_’Œy
(
node
, &
·»Á
->
chd_schq_li¡
, 
li¡
) {

532 
út
 = 
cfg
->
dw¼_node_pos
[
node
->
Ëv–
];

533 
cfg
->
schq_li¡
[
node
->
Ëv–
][
út
] =‚ode->
schq
;

534 
cfg
->
schq
[
node
->
Ëv–
]++;

535 
cfg
->
dw¼_node_pos
[
node
->
Ëv–
]++;

537 
	}
}

539 
	$Ùx2_qos_»ad_txschq_cfg_
(
Ùx2_qos_node
 *
·»Á
,

540 
Ùx2_qos_cfg
 *
cfg
)

542 
Ùx2_qos_node
 *
node
;

543 
út
;

545 
	`li¡_fÜ_—ch_’Œy
(
node
, &
·»Á
->
chd_li¡
, 
li¡
) {

546 
	`Ùx2_qos_»ad_txschq_cfg_
(
node
, 
cfg
);

547 
út
 = 
cfg
->
¡©ic_node_pos
[
node
->
Ëv–
];

548 
cfg
->
schq_cÚtig_li¡
[
node
->
Ëv–
][
út
] =‚ode->
schq
;

549 
cfg
->
schq_cÚtig
[
node
->
Ëv–
]++;

550 
cfg
->
¡©ic_node_pos
[
node
->
Ëv–
]++;

551 
	`Ùx2_qos_»ad_txschq_cfg_schq
(
node
, 
cfg
);

553 
	}
}

555 
	$Ùx2_qos_»ad_txschq_cfg
(
Ùx2_nic
 *
pfvf
,

556 
Ùx2_qos_node
 *
node
,

557 
Ùx2_qos_cfg
 *
cfg
)

559 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

560 
	`Ùx2_qos_»ad_txschq_cfg_
(
node
, 
cfg
);

561 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

562 
	}
}

564 
Ùx2_qos_node
 *

565 
	$Ùx2_qos_®loc_roÙ
(
Ùx2_nic
 *
pfvf
)

567 
Ùx2_qos_node
 *
node
;

569 
node
 = 
	`kz®loc
((*node), 
GFP_KERNEL
);

570 ià(!
node
)

571  
	`ERR_PTR
(-
ENOMEM
);

573 
node
->
·»Á
 = 
NULL
;

574 ià(!
	`is_Ùx2_vf
(
pfvf
->
pcifunc
)) {

575 
node
->
Ëv–
 = 
NIX_TXSCH_LVL_TL1
;

576 
node
->
chd_dw¼_´io
 = 
pfvf
->
hw
.
txschq_aggr_lvl_¼_´io
;

578 
node
->
Ëv–
 = 
NIX_TXSCH_LVL_TL2
;

579 
node
->
chd_dw¼_´io
 = 
OTX2_QOS_DEFAULT_PRIO
;

582 
node
->
qid
 = 
OTX2_QOS_QID_INNER
;

583 
node
->
şassid
 = 
OTX2_QOS_ROOT_CLASSID
;

585 
	`hash_add
(
pfvf
->
qos
.
qos_hli¡
, &
node
->
hli¡
,‚ode->
şassid
);

586 
	`li¡_add_
(&
node
->
li¡
, &
pfvf
->
qos
.
qos_Œ“
);

587 
	`INIT_LIST_HEAD
(&
node
->
chd_li¡
);

588 
	`INIT_LIST_HEAD
(&
node
->
chd_schq_li¡
);

590  
node
;

591 
	}
}

593 
	$Ùx2_qos_add_chd_node
(
Ùx2_qos_node
 *
·»Á
,

594 
Ùx2_qos_node
 *
node
)

596 
li¡_h—d
 *
h—d
 = &
·»Á
->
chd_li¡
;

597 
Ùx2_qos_node
 *
tmp_node
;

598 
li¡_h—d
 *
tmp
;

600 ià(
node
->
´io
 > 
·»Á
->
max_¡©ic_´io
)

601 
·»Á
->
max_¡©ic_´io
 = 
node
->
´io
;

603 
tmp
 = 
h—d
->
Ãxt
;mp != head;mp =mp->next) {

604 
tmp_node
 = 
	`li¡_’Œy
(
tmp
, 
Ùx2_qos_node
, 
li¡
);

605 ià(
tmp_node
->
´io
 =ğ
node
->prio &&

606 
tmp_node
->
is_¡©ic
)

607  -
EEXIST
;

608 ià(
tmp_node
->
´io
 > 
node
->prio) {

609 
	`li¡_add_
(&
node
->
li¡
, 
tmp
);

614 
	`li¡_add_
(&
node
->
li¡
, 
h—d
);

616 
	}
}

618 
	$Ùx2_qos_®loc_txschq_node
(
Ùx2_nic
 *
pfvf
,

619 
Ùx2_qos_node
 *
node
)

621 
Ùx2_qos_node
 *
txschq_node
, *
·»Á
, *
tmp
;

622 
lvl
;

624 
·»Á
 = 
node
;

625 
lvl
 = 
node
->
Ëv–
 - 1;†vÈ>ğ
NIX_TXSCH_LVL_MDQ
;†vl--) {

626 
txschq_node
 = 
	`kz®loc
((*txschq_node), 
GFP_KERNEL
);

627 ià(!
txschq_node
)

628 
”r_out
;

630 
txschq_node
->
·»Á
 =…arent;

631 
txschq_node
->
Ëv–
 = 
lvl
;

632 
txschq_node
->
şassid
 = 
OTX2_QOS_CLASS_NONE
;

633 
txschq_node
->
qid
 = 
OTX2_QOS_QID_NONE
;

634 
txschq_node
->
¿‹
 = 0;

635 
txschq_node
->
û
 = 0;

636 
txschq_node
->
´io
 = 0;

637 
txschq_node
->
quªtum
 = 0;

638 
txschq_node
->
is_¡©ic
 = 
Œue
;

639 
txschq_node
->
chd_dw¼_´io
 = 
OTX2_QOS_DEFAULT_PRIO
;

640 
txschq_node
->
txschq_idx
 = 
OTX2_QOS_INVALID_TXSCHQ_IDX
;

642 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

643 
	`li¡_add_
(&
txschq_node
->
li¡
, &
node
->
chd_schq_li¡
);

644 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

646 
	`INIT_LIST_HEAD
(&
txschq_node
->
chd_li¡
);

647 
	`INIT_LIST_HEAD
(&
txschq_node
->
chd_schq_li¡
);

648 
·»Á
 = 
txschq_node
;

653 
”r_out
:

654 
	`li¡_fÜ_—ch_’Œy_§ã
(
txschq_node
, 
tmp
, &
node
->
chd_schq_li¡
,

655 
li¡
) {

656 
	`li¡_d–
(&
txschq_node
->
li¡
);

657 
	`kä“
(
txschq_node
);

659  -
ENOMEM
;

660 
	}
}

662 
Ùx2_qos_node
 *

663 
	$Ùx2_qos_sw_ü—‹_Ëaf_node
(
Ùx2_nic
 *
pfvf
,

664 
Ùx2_qos_node
 *
·»Á
,

665 
u16
 
şassid
, 
u32
 
´io
, 
u64
 
¿‹
, u64 
û
,

666 
u32
 
quªtum
, 
u16
 
qid
, 
boŞ
 
¡©ic_cfg
)

668 
Ùx2_qos_node
 *
node
;

669 
”r
;

671 
node
 = 
	`kz®loc
((*node), 
GFP_KERNEL
);

672 ià(!
node
)

673  
	`ERR_PTR
(-
ENOMEM
);

675 
node
->
·»Á
 =…arent;

676 
node
->
Ëv–
 = 
·»Á
->level - 1;

677 
node
->
şassid
 = classid;

678 
node
->
qid
 = qid;

679 
node
->
¿‹
 = 
	`Ùx2_qos_cÚv”t_¿‹
(rate);

680 
node
->
û
 = 
	`Ùx2_qos_cÚv”t_¿‹
(ceil);

681 
node
->
´io
 =…rio;

682 
node
->
quªtum
 = quantum;

683 
node
->
is_¡©ic
 = 
¡©ic_cfg
;

684 
node
->
chd_dw¼_´io
 = 
OTX2_QOS_DEFAULT_PRIO
;

685 
node
->
txschq_idx
 = 
OTX2_QOS_INVALID_TXSCHQ_IDX
;

687 
	`__£t_b™
(
qid
, 
pfvf
->
qos
.
qos_sq_bm­
);

689 
	`hash_add
(
pfvf
->
qos
.
qos_hli¡
, &
node
->
hli¡
, 
şassid
);

691 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

692 
	`Ùx2_qos_add_chd_node
(
·»Á
, 
node
);

693 ià(
”r
) {

694 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

695  
	`ERR_PTR
(
”r
);

697 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

699 
	`INIT_LIST_HEAD
(&
node
->
chd_li¡
);

700 
	`INIT_LIST_HEAD
(&
node
->
chd_schq_li¡
);

702 
”r
 = 
	`Ùx2_qos_®loc_txschq_node
(
pfvf
, 
node
);

703 ià(
”r
) {

704 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
node
);

705  
	`ERR_PTR
(-
ENOMEM
);

708  
node
;

709 
	}
}

711 
Ùx2_qos_node


712 *
	$Ùx2_sw_node_fšd_by_qid
(
Ùx2_nic
 *
pfvf
, 
u16
 
qid
)

714 
Ùx2_qos_node
 *
node
 = 
NULL
;

715 
bkt
;

717 
	`hash_fÜ_—ch
(
pfvf
->
qos
.
qos_hli¡
, 
bkt
, 
node
, 
hli¡
) {

718 ià(
node
->
qid
 == qid)

722  
node
;

723 
	}
}

725 
Ùx2_qos_node
 *

726 
	$Ùx2_sw_node_fšd
(
Ùx2_nic
 *
pfvf
, 
u32
 
şassid
)

728 
Ùx2_qos_node
 *
node
 = 
NULL
;

730 
	`hash_fÜ_—ch_possibË
(
pfvf
->
qos
.
qos_hli¡
, 
node
, 
hli¡
, 
şassid
) {

731 ià(
node
->
şassid
 == classid)

735  
node
;

736 
	}
}

738 
	$Ùx2_g‘_txq_by_şassid
(
Ùx2_nic
 *
pfvf
, 
u16
 
şassid
)

740 
Ùx2_qos_node
 *
node
;

741 
u16
 
qid
;

742 
»s
;

744 
node
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
şassid
);

745 ià(!
node
) {

746 
»s
 = -
ENOENT
;

747 
out
;

749 
qid
 = 
	`READ_ONCE
(
node
->qid);

750 ià(
qid
 =ğ
OTX2_QOS_QID_INNER
) {

751 
»s
 = -
EINVAL
;

752 
out
;

754 
»s
 = 
pfvf
->
hw
.
tx_queues
 + 
qid
;

755 
out
:

756  
»s
;

757 
	}
}

760 
	$Ùx2_qos_txschq_cÚfig
(
Ùx2_nic
 *
pfvf
, 
Ùx2_qos_node
 *
node
)

762 
mbox
 *mbox = &
pfvf
->mbox;

763 
nix_txschq_cÚfig
 *
»q
;

764 
rc
;

766 
	`mu‹x_lock
(&
mbox
->
lock
);

768 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txschq_cfg
(&
pfvf
->
mbox
);

769 ià(!
»q
)

770  -
ENOMEM
;

772 
»q
->
lvl
 = 
node
->
Ëv–
;

773 
	`__Ùx2_qos_txschq_cfg
(
pfvf
, 
node
, 
»q
);

775 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

777 
	`mu‹x_uÆock
(&
mbox
->
lock
);

779  
rc
;

780 
	}
}

782 
	$Ùx2_qos_txschq_®loc
(
Ùx2_nic
 *
pfvf
,

783 
Ùx2_qos_cfg
 *
cfg
)

785 
nix_txsch_®loc_»q
 *
»q
;

786 
nix_txsch_®loc_r¥
 *
r¥
;

787 
mbox
 *mbox = &
pfvf
->mbox;

788 
lvl
, 
rc
, 
schq
;

790 
	`mu‹x_lock
(&
mbox
->
lock
);

791 
»q
 = 
	`Ùx2_mbox_®loc_msg_nix_txsch_®loc
(&
pfvf
->
mbox
);

792 ià(!
»q
)

793  -
ENOMEM
;

795 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

796 
»q
->
schq
[
lvl
] = 
cfg
->schq[lvl];

797 
»q
->
schq_cÚtig
[
lvl
] = 
cfg
->schq_contig[lvl];

800 
rc
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

801 ià(
rc
)

802  
rc
;

804 
r¥
 = (
nix_txsch_®loc_r¥
 *)

805 
	`Ùx2_mbox_g‘_r¥
(&
pfvf
->
mbox
.mbox, 0, &
»q
->
hdr
);

807 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

808 
schq
 = 0; schq < 
r¥
->
schq_cÚtig
[
lvl
]; schq++) {

809 
cfg
->
schq_cÚtig_li¡
[
lvl
][
schq
] =

810 
r¥
->
schq_cÚtig_li¡
[
lvl
][
schq
];

814 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

815 
schq
 = 0; schq < 
r¥
->schq[
lvl
]; schq++) {

816 
cfg
->
schq_li¡
[
lvl
][
schq
] =

817 
r¥
->
schq_li¡
[
lvl
][
schq
];

821 
pfvf
->
qos
.
lšk_cfg_lvl
 = 
r¥
->link_cfg_lvl;

823 
	`mu‹x_uÆock
(&
mbox
->
lock
);

825  
rc
;

826 
	}
}

828 
	$Ùx2_qos_txschq_fl_cfg_schq
(
Ùx2_nic
 *
pfvf
,

829 
Ùx2_qos_node
 *
node
,

830 
Ùx2_qos_cfg
 *
cfg
)

832 
Ùx2_qos_node
 *
tmp
;

833 
út
;

835 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_schq_li¡
, 
li¡
) {

836 
út
 = 
cfg
->
dw¼_node_pos
[
tmp
->
Ëv–
];

837 
tmp
->
schq
 = 
cfg
->
schq_li¡
[tmp->
Ëv–
][
út
];

838 
cfg
->
dw¼_node_pos
[
tmp
->
Ëv–
]++;

840 
	}
}

842 
	$Ùx2_qos_txschq_fl_cfg_
(
Ùx2_nic
 *
pfvf
,

843 
Ùx2_qos_node
 *
node
,

844 
Ùx2_qos_cfg
 *
cfg
)

846 
Ùx2_qos_node
 *
tmp
;

847 
út
;

849 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
) {

850 
	`Ùx2_qos_txschq_fl_cfg_
(
pfvf
, 
tmp
, 
cfg
);

851 
út
 = 
cfg
->
¡©ic_node_pos
[
tmp
->
Ëv–
];

852 
tmp
->
schq
 = 
cfg
->
schq_cÚtig_li¡
[tmp->
Ëv–
][tmp->
txschq_idx
];

853 ià(
út
 == 0)

854 
node
->
´io_ªchÜ
 = 
cfg
->
schq_cÚtig_li¡
[
tmp
->
Ëv–
][0];

855 
cfg
->
¡©ic_node_pos
[
tmp
->
Ëv–
]++;

856 
	`Ùx2_qos_txschq_fl_cfg_schq
(
pfvf
, 
tmp
, 
cfg
);

858 
	}
}

860 
	$Ùx2_qos_txschq_fl_cfg
(
Ùx2_nic
 *
pfvf
,

861 
Ùx2_qos_node
 *
node
,

862 
Ùx2_qos_cfg
 *
cfg
)

864 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

865 
	`Ùx2_qos_txschq_fl_cfg_
(
pfvf
, 
node
, 
cfg
);

866 
	`Ùx2_qos_txschq_fl_cfg_schq
(
pfvf
, 
node
, 
cfg
);

867 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

868 
	}
}

870 
	$__Ùx2_qos_assign_ba£_idx_
(
Ùx2_nic
 *
pfvf
,

871 
Ùx2_qos_node
 *
tmp
,

872 *
chd_idx_bm­
,

873 
chd_út
)

875 
idx
;

877 ià(
tmp
->
txschq_idx
 !ğ
OTX2_QOS_INVALID_TXSCHQ_IDX
)

881 
idx
 = 0; idx < 
chd_út
; idx++) {

882 ià(
tmp
->
is_¡©ic
 &&mp->
´io
 =ğ
idx
 &&

883 !
	`‹¡_b™
(
idx
, 
chd_idx_bm­
)) {

884 
tmp
->
txschq_idx
 = 
idx
;

885 
	`£t_b™
(
idx
, 
chd_idx_bm­
);

887 } ià(!
tmp
->
is_¡©ic
 && 
idx
 >ğtmp->
´io
 &&

888 !
	`‹¡_b™
(
idx
, 
chd_idx_bm­
)) {

889 
tmp
->
txschq_idx
 = 
idx
;

890 
	`£t_b™
(
idx
, 
chd_idx_bm­
);

894 
	}
}

896 
	$Ùx2_qos_assign_ba£_idx_
(
Ùx2_nic
 *
pfvf
,

897 
Ùx2_qos_node
 *
node
)

899 *
chd_idx_bm­
;

900 
Ùx2_qos_node
 *
tmp
;

901 
chd_út
;

903 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
)

904 
tmp
->
txschq_idx
 = 
OTX2_QOS_INVALID_TXSCHQ_IDX
;

907 
chd_út
 = 
node
->
chd_dw¼_út
 +‚ode->
max_¡©ic_´io
 + 1;

908 
chd_idx_bm­
 = 
	`kÿÎoc
(
	`BITS_TO_LONGS
(
chd_út
), (),

909 
GFP_KERNEL
);

910 ià(!
chd_idx_bm­
)

911  -
ENOMEM
;

913 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
)

914 
	`Ùx2_qos_assign_ba£_idx_
(
pfvf
, 
tmp
);

917 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
) {

918 ià(!
tmp
->
is_¡©ic
)

920 
	`__Ùx2_qos_assign_ba£_idx_
(
pfvf
, 
tmp
, 
chd_idx_bm­
, 
chd_út
);

924 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
)

925 
	`__Ùx2_qos_assign_ba£_idx_
(
pfvf
, 
tmp
, 
chd_idx_bm­
, 
chd_út
);

927 
	`kä“
(
chd_idx_bm­
);

930 
	}
}

932 
	$Ùx2_qos_assign_ba£_idx
(
Ùx2_nic
 *
pfvf
,

933 
Ùx2_qos_node
 *
node
)

935 
»t
 = 0;

937 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

938 
»t
 = 
	`Ùx2_qos_assign_ba£_idx_
(
pfvf
, 
node
);

939 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

941  
»t
;

942 
	}
}

944 
	$Ùx2_qos_txschq_push_cfg_schq
(
Ùx2_nic
 *
pfvf
,

945 
Ùx2_qos_node
 *
node
,

946 
Ùx2_qos_cfg
 *
cfg
)

948 
Ùx2_qos_node
 *
tmp
;

949 
»t
 = 0;

951 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_schq_li¡
, 
li¡
) {

952 
»t
 = 
	`Ùx2_qos_txschq_cÚfig
(
pfvf
, 
tmp
);

953 ià(
»t
)

954  -
EIO
;

955 
»t
 = 
	`Ùx2_qos_txschq_£t_·»Á_tİŞogy
(
pfvf
, 
tmp
->
·»Á
);

956 ià(
»t
)

957  -
EIO
;

961 
	}
}

963 
	$Ùx2_qos_txschq_push_cfg_
(
Ùx2_nic
 *
pfvf
,

964 
Ùx2_qos_node
 *
node
,

965 
Ùx2_qos_cfg
 *
cfg
)

967 
Ùx2_qos_node
 *
tmp
;

968 
»t
 = 0;

970 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
) {

971 
»t
 = 
	`Ùx2_qos_txschq_push_cfg_
(
pfvf
, 
tmp
, 
cfg
);

972 ià(
»t
)

973  -
EIO
;

974 
»t
 = 
	`Ùx2_qos_txschq_cÚfig
(
pfvf
, 
tmp
);

975 ià(
»t
)

976  -
EIO
;

977 
»t
 = 
	`Ùx2_qos_txschq_push_cfg_schq
(
pfvf
, 
tmp
, 
cfg
);

978 ià(
»t
)

979  -
EIO
;

982 
»t
 = 
	`Ùx2_qos_txschq_£t_·»Á_tİŞogy
(
pfvf
, 
node
);

983 ià(
»t
)

984  -
EIO
;

987 
	}
}

989 
	$Ùx2_qos_txschq_push_cfg
(
Ùx2_nic
 *
pfvf
,

990 
Ùx2_qos_node
 *
node
,

991 
Ùx2_qos_cfg
 *
cfg
)

993 
»t
 = 0;

995 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

996 
»t
 = 
	`Ùx2_qos_txschq_push_cfg_
(
pfvf
, 
node
, 
cfg
);

997 ià(
»t
)

998 
out
;

999 
»t
 = 
	`Ùx2_qos_txschq_push_cfg_schq
(
pfvf
, 
node
, 
cfg
);

1000 
out
:

1001 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

1002  
»t
;

1003 
	}
}

1005 
	$Ùx2_qos_txschq_upd©e_cÚfig
(
Ùx2_nic
 *
pfvf
,

1006 
Ùx2_qos_node
 *
node
,

1007 
Ùx2_qos_cfg
 *
cfg
)

1009 
»t
 = 0;

1011 
	`Ùx2_qos_txschq_fl_cfg
(
pfvf
, 
node
, 
cfg
);

1012 
»t
 = 
	`Ùx2_qos_txschq_push_cfg
(
pfvf
, 
node
, 
cfg
);

1014  
»t
;

1015 
	}
}

1017 
	$Ùx2_qos_txschq_upd©e_roÙ_cfg
(
Ùx2_nic
 *
pfvf
,

1018 
Ùx2_qos_node
 *
roÙ
,

1019 
Ùx2_qos_cfg
 *
cfg
)

1021 
»t
 = 0;

1023 
roÙ
->
schq
 = 
cfg
->
schq_li¡
[roÙ->
Ëv–
][0];

1024 
»t
 = 
	`Ùx2_qos_txschq_cÚfig
(
pfvf
, 
roÙ
);

1026  
»t
;

1027 
	}
}

1029 
	$Ùx2_qos_ä“_cfg
(
Ùx2_nic
 *
pfvf
, 
Ùx2_qos_cfg
 *
cfg
)

1031 
lvl
, 
idx
, 
schq
;

1033 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

1034 
idx
 = 0; idx < 
cfg
->
schq_cÚtig
[
lvl
]; idx++) {

1035 
schq
 = 
cfg
->
schq_cÚtig_li¡
[
lvl
][
idx
];

1036 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
lvl
, 
schq
);

1040 
lvl
 = 0;†vÈ< 
NIX_TXSCH_LVL_CNT
;†vl++) {

1041 
idx
 = 0; idx < 
cfg
->
schq
[
lvl
]; idx++) {

1042 
schq
 = 
cfg
->
schq_li¡
[
lvl
][
idx
];

1043 
	`Ùx2_txschq_ä“_Úe
(
pfvf
, 
lvl
, 
schq
);

1046 
	}
}

1048 
	$Ùx2_qos_’adis_sq
(
Ùx2_nic
 *
pfvf
,

1049 
Ùx2_qos_node
 *
node
,

1050 
u16
 
qid
)

1052 ià(
pfvf
->
qos
.
qid_to_sqm­
[
qid
] !ğ
OTX2_QOS_INVALID_SQ
)

1053 
	`Ùx2_qos_di§bË_sq
(
pfvf
, 
qid
);

1055 
pfvf
->
qos
.
qid_to_sqm­
[
qid
] = 
node
->
schq
;

1056 
	`Ùx2_qos_’abË_sq
(
pfvf
, 
qid
);

1057 
	}
}

1059 
	$Ùx2_qos_upd©e_smq_schq
(
Ùx2_nic
 *
pfvf
,

1060 
Ùx2_qos_node
 *
node
,

1061 
boŞ
 
aùiÚ
)

1063 
Ùx2_qos_node
 *
tmp
;

1065 ià(
node
->
qid
 =ğ
OTX2_QOS_QID_INNER
)

1068 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_schq_li¡
, 
li¡
) {

1069 ià(
tmp
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
) {

1070 ià(
aùiÚ
 =ğ
QOS_SMQ_FLUSH
)

1071 
	`Ùx2_smq_æush
(
pfvf
, 
tmp
->
schq
);

1073 
	`Ùx2_qos_’adis_sq
(
pfvf
, 
tmp
, 
node
->
qid
);

1077 
	}
}

1079 
	$__Ùx2_qos_upd©e_smq
(
Ùx2_nic
 *
pfvf
,

1080 
Ùx2_qos_node
 *
node
,

1081 
boŞ
 
aùiÚ
)

1083 
Ùx2_qos_node
 *
tmp
;

1085 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_li¡
, 
li¡
) {

1086 
	`__Ùx2_qos_upd©e_smq
(
pfvf
, 
tmp
, 
aùiÚ
);

1087 ià(
tmp
->
qid
 =ğ
OTX2_QOS_QID_INNER
)

1089 ià(
tmp
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
) {

1090 ià(
aùiÚ
 =ğ
QOS_SMQ_FLUSH
)

1091 
	`Ùx2_smq_æush
(
pfvf
, 
tmp
->
schq
);

1093 
	`Ùx2_qos_’adis_sq
(
pfvf
, 
tmp
,mp->
qid
);

1095 
	`Ùx2_qos_upd©e_smq_schq
(
pfvf
, 
tmp
, 
aùiÚ
);

1098 
	}
}

1100 
	$Ùx2_qos_upd©e_smq
(
Ùx2_nic
 *
pfvf
,

1101 
Ùx2_qos_node
 *
node
,

1102 
boŞ
 
aùiÚ
)

1104 
	`mu‹x_lock
(&
pfvf
->
qos
.
qos_lock
);

1105 
	`__Ùx2_qos_upd©e_smq
(
pfvf
, 
node
, 
aùiÚ
);

1106 
	`Ùx2_qos_upd©e_smq_schq
(
pfvf
, 
node
, 
aùiÚ
);

1107 
	`mu‹x_uÆock
(&
pfvf
->
qos
.
qos_lock
);

1110 
	}
}

1112 
	$Ùx2_qos_push_txschq_cfg
(
Ùx2_nic
 *
pfvf
,

1113 
Ùx2_qos_node
 *
node
,

1114 
Ùx2_qos_cfg
 *
cfg
)

1116 
»t
 = 0;

1118 
»t
 = 
	`Ùx2_qos_txschq_®loc
(
pfvf
, 
cfg
);

1119 ià(
»t
)

1120  -
ENOSPC
;

1122 
»t
 = 
	`Ùx2_qos_assign_ba£_idx
(
pfvf
, 
node
);

1123 ià(
»t
)

1124  -
ENOMEM
;

1126 ià(!(
pfvf
->
Ãtdev
->
æags
 & 
IFF_UP
)) {

1127 
	`Ùx2_qos_txschq_fl_cfg
(
pfvf
, 
node
, 
cfg
);

1131 
»t
 = 
	`Ùx2_qos_txschq_upd©e_cÚfig
(
pfvf
, 
node
, 
cfg
);

1132 ià(
»t
) {

1133 
	`Ùx2_qos_ä“_cfg
(
pfvf
, 
cfg
);

1134  -
EIO
;

1137 
»t
 = 
	`Ùx2_qos_upd©e_smq
(
pfvf
, 
node
, 
QOS_CFG_SQ
);

1138 ià(
»t
) {

1139 
	`Ùx2_qos_ä“_cfg
(
pfvf
, 
cfg
);

1140  -
EIO
;

1144 
	}
}

1146 
	$Ùx2_qos_upd©e_Œ“
(
Ùx2_nic
 *
pfvf
,

1147 
Ùx2_qos_node
 *
node
,

1148 
Ùx2_qos_cfg
 *
cfg
)

1150 
»t
 = 0;

1152 
	`Ùx2_qos_´•¬e_txschq_cfg
(
pfvf
, 
node
->
·»Á
, 
cfg
);

1153 
»t
 = 
	`Ùx2_qos_push_txschq_cfg
(
pfvf
, 
node
->
·»Á
, 
cfg
);

1155  
»t
;

1156 
	}
}

1158 
	$Ùx2_qos_roÙ_add
(
Ùx2_nic
 *
pfvf
, 
u16
 
htb_maj_id
, u16 
htb_defşs
,

1159 
Ãšk_ext_ack
 *
exck
)

1161 
Ùx2_qos_cfg
 *
Ãw_cfg
;

1162 
Ùx2_qos_node
 *
roÙ
;

1163 
”r
;

1165 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
,

1167 
htb_maj_id
, 
htb_defşs
);

1169 
	`INIT_LIST_HEAD
(&
pfvf
->
qos
.
qos_Œ“
);

1170 
	`mu‹x_š™
(&
pfvf
->
qos
.
qos_lock
);

1172 
roÙ
 = 
	`Ùx2_qos_®loc_roÙ
(
pfvf
);

1173 ià(
	`IS_ERR
(
roÙ
)) {

1174 
	`mu‹x_de¡roy
(&
pfvf
->
qos
.
qos_lock
);

1175 
”r
 = 
	`PTR_ERR
(
roÙ
);

1176  
”r
;

1180 ià(!
	`is_Ùx2_vf
(
pfvf
->
pcifunc
)) {

1181 
roÙ
->
schq
 = 
pfvf
->
hw
.
txschq_li¡
[roÙ->
Ëv–
][0];

1182 
out
;

1186 
Ãw_cfg
 = 
	`kz®loc
((*Ãw_cfg), 
GFP_KERNEL
);

1187 ià(!
Ãw_cfg
) {

1188 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1189 
	`mu‹x_de¡roy
(&
pfvf
->
qos
.
qos_lock
);

1190  -
ENOMEM
;

1193 
Ãw_cfg
->
schq
[
roÙ
->
Ëv–
] = 1;

1194 
”r
 = 
	`Ùx2_qos_txschq_®loc
(
pfvf
, 
Ãw_cfg
);

1195 ià(
”r
) {

1196 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Error‡llocatingxschq");

1197 
ä“_roÙ_node
;

1200 ià(!(
pfvf
->
Ãtdev
->
æags
 & 
IFF_UP
)) {

1201 
roÙ
->
schq
 = 
Ãw_cfg
->
schq_li¡
[roÙ->
Ëv–
][0];

1202 
out
;

1206 
”r
 = 
	`Ùx2_qos_txschq_upd©e_roÙ_cfg
(
pfvf
, 
roÙ
, 
Ãw_cfg
);

1207 ià(
”r
) {

1208 
	`NL_SET_ERR_MSG_MOD
(
exck
,

1210 
txschq_ä“
;

1212 
out
:

1213 
	`WRITE_ONCE
(
pfvf
->
qos
.
defşs
, 
htb_defşs
);

1214 
	`smp_¡Üe_»Ëa£
(&
pfvf
->
qos
.
maj_id
, 
htb_maj_id
);

1218 
txschq_ä“
:

1219 
	`Ùx2_qos_ä“_cfg
(
pfvf
, 
Ãw_cfg
);

1220 
ä“_roÙ_node
:

1221 
	`kä“
(
Ãw_cfg
);

1222 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
roÙ
);

1223 
	`mu‹x_de¡roy
(&
pfvf
->
qos
.
qos_lock
);

1224  
”r
;

1225 
	}
}

1227 
	$Ùx2_qos_roÙ_de¡roy
(
Ùx2_nic
 *
pfvf
)

1229 
Ùx2_qos_node
 *
roÙ
;

1231 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
, "TC_HTB_DESTROY\n");

1234 
roÙ
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
OTX2_QOS_ROOT_CLASSID
);

1235 ià(!
roÙ
)

1236  -
ENOENT
;

1240 
	`Ùx2_qos_de¡roy_node
(
pfvf
, 
roÙ
);

1241 
	`mu‹x_de¡roy
(&
pfvf
->
qos
.
qos_lock
);

1244 
	}
}

1246 
	$Ùx2_qos_v®id©e_dw¼_cfg
(
Ùx2_qos_node
 *
·»Á
,

1247 
Ãšk_ext_ack
 *
exck
,

1248 
u64
 
´io
)

1250 ià(
·»Á
->
chd_dw¼_´io
 =ğ
OTX2_QOS_DEFAULT_PRIO
) {

1251 
·»Á
->
chd_dw¼_´io
 = 
´io
;

1252 } ià(
´io
 !ğ
·»Á
->
chd_dw¼_´io
) {

1253 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Only one DWRR group is‡llowed");

1254  -
EOPNOTSUPP
;

1258 
	}
}

1260 
	$Ùx2_qos_v®id©e_cÚfigu¿tiÚ
(
Ùx2_qos_node
 *
·»Á
,

1261 
Ãšk_ext_ack
 *
exck
,

1262 
Ùx2_nic
 *
pfvf
,

1263 
u64
 
´io
, u64 
quªtum
,

1264 
boŞ
 
¡©ic_cfg
)

1266 ià(
´io
 =ğ
·»Á
->
chd_dw¼_´io
 && 
¡©ic_cfg
) {

1267 
	`NL_SET_ERR_MSG_MOD
(
exck
, "DWRR child group with same…riorityƒxists");

1268  -
EEXIST
;

1271 ià(
¡©ic_cfg
 && 
	`‹¡_b™
(
´io
, 
·»Á
->
´io_bm­
)) {

1272 
	`NL_SET_ERR_MSG_MOD
(
exck
,

1274  -
EEXIST
;

1278 
	}
}

1280 
	$Ùx2_qos_Ëaf_®loc_queue
(
Ùx2_nic
 *
pfvf
, 
u16
 
şassid
,

1281 
u32
 
·»Á_şassid
, 
u64
 
¿‹
, u64 
û
,

1282 
u64
 
´io
, u64 
quªtum
,

1283 
Ãšk_ext_ack
 *
exck
)

1285 
Ùx2_qos_cfg
 *
Şd_cfg
, *
Ãw_cfg
;

1286 
Ùx2_qos_node
 *
node
, *
·»Á
;

1287 
qid
, 
»t
, 
”r
;

1288 
boŞ
 
¡©ic_cfg
;

1290 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
,

1292 
şassid
, 
·»Á_şassid
, 
¿‹
, 
û
, 
´io
, 
quªtum
);

1294 ià(
´io
 > 
OTX2_QOS_MAX_PRIO
) {

1295 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Valid…riority„ange 0o 7");

1296 
»t
 = -
EOPNOTSUPP
;

1297 
out
;

1300 ià(!
quªtum
 || quªtum > 
INT_MAX
) {

1301 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Invalid quantum,„ange 1 - 2147483647 bytes");

1302 
»t
 = -
EOPNOTSUPP
;

1303 
out
;

1307 
·»Á
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
·»Á_şassid
);

1308 ià(!
·»Á
) {

1309 
	`NL_SET_ERR_MSG_MOD
(
exck
, "parent‚ode‚ot found");

1310 
»t
 = -
ENOENT
;

1311 
out
;

1313 ià(
·»Á
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
) {

1314 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB qos max†evels„eached");

1315 
»t
 = -
EOPNOTSUPP
;

1316 
out
;

1319 
¡©ic_cfg
 = !
	`is_qos_node_dw¼
(
·»Á
, 
pfvf
, 
´io
);

1320 
»t
 = 
	`Ùx2_qos_v®id©e_cÚfigu¿tiÚ
(
·»Á
, 
exck
, 
pfvf
, 
´io
,

1321 
quªtum
, 
¡©ic_cfg
);

1322 ià(
»t
)

1323 
out
;

1325 ià(!
¡©ic_cfg
) {

1326 
»t
 = 
	`Ùx2_qos_v®id©e_dw¼_cfg
(
·»Á
, 
exck
, 
´io
);

1327 ià(
»t
)

1328 
out
;

1331 ià(
¡©ic_cfg
)

1332 
·»Á
->
chd_¡©ic_út
++;

1334 
·»Á
->
chd_dw¼_út
++;

1336 
	`£t_b™
(
´io
, 
·»Á
->
´io_bm­
);

1339 
Şd_cfg
 = 
	`kz®loc
((*Şd_cfg), 
GFP_KERNEL
);

1340 ià(!
Şd_cfg
) {

1341 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1342 
»t
 = -
ENOMEM
;

1343 
out
;

1345 
	`Ùx2_qos_»ad_txschq_cfg
(
pfvf
, 
·»Á
, 
Şd_cfg
);

1348 
qid
 = 
	`Ùx2_qos_g‘_qid
(
pfvf
);

1349 ià(
qid
 < 0) {

1350 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Reached max supported QOS SQ's");

1351 
»t
 = -
ENOMEM
;

1352 
ä“_Şd_cfg
;

1356 
pfvf
->
qos
.
qid_to_sqm­
[
qid
] = 
OTX2_QOS_INVALID_SQ
;

1359 
node
 = 
	`Ùx2_qos_sw_ü—‹_Ëaf_node
(
pfvf
, 
·»Á
, 
şassid
, 
´io
, 
¿‹
,

1360 
û
, 
quªtum
, 
qid
, 
¡©ic_cfg
);

1361 ià(
	`IS_ERR
(
node
)) {

1362 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Unableo‡llocate†eaf‚ode");

1363 
»t
 = 
	`PTR_ERR
(
node
);

1364 
ä“_Şd_cfg
;

1368 
Ãw_cfg
 = 
	`kz®loc
((*Ãw_cfg), 
GFP_KERNEL
);

1369 ià(!
Ãw_cfg
) {

1370 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1371 
»t
 = -
ENOMEM
;

1372 
ä“_node
;

1374 
»t
 = 
	`Ùx2_qos_upd©e_Œ“
(
pfvf
, 
node
, 
Ãw_cfg
);

1375 ià(
»t
) {

1376 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB HW configurationƒrror");

1377 
	`kä“
(
Ãw_cfg
);

1378 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
node
);

1380 
”r
 = 
	`Ùx2_qos_txschq_upd©e_cÚfig
(
pfvf
, 
·»Á
, 
Şd_cfg
);

1381 ià(
”r
) {

1382 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1384 
ä“_Şd_cfg
;

1386 
”r
 = 
	`Ùx2_qos_upd©e_smq
(
pfvf
, 
·»Á
, 
QOS_CFG_SQ
);

1387 ià(
”r
)

1388 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1390 
ä“_Şd_cfg
;

1394 
	`Ùx2_qos_upd©e_tx_Ãtdev_queues
(
pfvf
);

1397 
	`kä“
(
Ãw_cfg
);

1400 
	`Ùx2_qos_ä“_cfg
(
pfvf
, 
Şd_cfg
);

1401 
	`kä“
(
Şd_cfg
);

1403  
pfvf
->
hw
.
tx_queues
 + 
qid
;

1405 
ä“_node
:

1406 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
node
);

1407 
ä“_Şd_cfg
:

1408 
	`kä“
(
Şd_cfg
);

1409 
out
:

1410  
»t
;

1411 
	}
}

1413 
	$Ùx2_qos_Ëaf_to_šÃr
(
Ùx2_nic
 *
pfvf
, 
u16
 
şassid
,

1414 
u16
 
chd_şassid
, 
u64
 
¿‹
, u64 
û
, u64 
´io
,

1415 
u64
 
quªtum
, 
Ãšk_ext_ack
 *
exck
)

1417 
Ùx2_qos_cfg
 *
Şd_cfg
, *
Ãw_cfg
;

1418 
Ùx2_qos_node
 *
node
, *
chd
;

1419 
boŞ
 
¡©ic_cfg
;

1420 
»t
, 
”r
;

1421 
u16
 
qid
;

1423 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
,

1425 
şassid
, 
chd_şassid
, 
¿‹
, 
û
);

1427 ià(
´io
 > 
OTX2_QOS_MAX_PRIO
) {

1428 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Valid…riority„ange 0o 7");

1429 
»t
 = -
EOPNOTSUPP
;

1430 
out
;

1433 ià(!
quªtum
 || quªtum > 
INT_MAX
) {

1434 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Invalid quantum,„ange 1 - 2147483647 bytes");

1435 
»t
 = -
EOPNOTSUPP
;

1436 
out
;

1440 
node
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
şassid
);

1441 ià(!
node
) {

1442 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB‚ode‚ot found");

1443 
»t
 = -
ENOENT
;

1444 
out
;

1447 ià(
node
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
) {

1448 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB qos†evel‚ot supported");

1449 
»t
 = -
EOPNOTSUPP
;

1450 
out
;

1453 
¡©ic_cfg
 = !
	`is_qos_node_dw¼
(
node
, 
pfvf
, 
´io
);

1454 ià(!
¡©ic_cfg
) {

1455 
»t
 = 
	`Ùx2_qos_v®id©e_dw¼_cfg
(
node
, 
exck
, 
´io
);

1456 ià(
»t
)

1457 
out
;

1460 ià(
¡©ic_cfg
)

1461 
node
->
chd_¡©ic_út
++;

1463 
node
->
chd_dw¼_út
++;

1465 
	`£t_b™
(
´io
, 
node
->
´io_bm­
);

1468 
qid
 = 
node
->qid;

1471 
Şd_cfg
 = 
	`kz®loc
((*Şd_cfg), 
GFP_KERNEL
);

1472 ià(!
Şd_cfg
) {

1473 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1474 
»t
 = -
ENOMEM
;

1475 
out
;

1477 
	`Ùx2_qos_»ad_txschq_cfg
(
pfvf
, 
node
, 
Şd_cfg
);

1480 
	`Ùx2_qos_ä“_sw_node_schq
(
pfvf
, 
node
);

1483 
node
->
qid
 = 
OTX2_QOS_QID_INNER
;

1486 
chd
 = 
	`Ùx2_qos_sw_ü—‹_Ëaf_node
(
pfvf
, 
node
, 
chd_şassid
,

1487 
´io
, 
¿‹
, 
û
, 
quªtum
,

1488 
qid
, 
¡©ic_cfg
);

1489 ià(
	`IS_ERR
(
chd
)) {

1490 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Unableo‡llocate†eaf‚ode");

1491 
»t
 = 
	`PTR_ERR
(
chd
);

1492 
ä“_Şd_cfg
;

1496 
Ãw_cfg
 = 
	`kz®loc
((*Ãw_cfg), 
GFP_KERNEL
);

1497 ià(!
Ãw_cfg
) {

1498 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1499 
»t
 = -
ENOMEM
;

1500 
ä“_node
;

1502 
»t
 = 
	`Ùx2_qos_upd©e_Œ“
(
pfvf
, 
chd
, 
Ãw_cfg
);

1503 ià(
»t
) {

1504 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB HW configurationƒrror");

1505 
	`kä“
(
Ãw_cfg
);

1506 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
chd
);

1508 
node
->
qid
 = qid;

1509 
”r
 = 
	`Ùx2_qos_®loc_txschq_node
(
pfvf
, 
node
);

1510 ià(
”r
) {

1511 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1513 
ä“_Şd_cfg
;

1515 
”r
 = 
	`Ùx2_qos_txschq_upd©e_cÚfig
(
pfvf
, 
node
, 
Şd_cfg
);

1516 ià(
”r
) {

1517 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1519 
ä“_Şd_cfg
;

1521 
”r
 = 
	`Ùx2_qos_upd©e_smq
(
pfvf
, 
node
, 
QOS_CFG_SQ
);

1522 ià(
”r
)

1523 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
,

1525 
ä“_Şd_cfg
;

1529 
	`kä“
(
Ãw_cfg
);

1532 
	`Ùx2_qos_ä“_cfg
(
pfvf
, 
Şd_cfg
);

1533 
	`kä“
(
Şd_cfg
);

1537 
ä“_node
:

1538 
	`Ùx2_qos_sw_node_d–‘e
(
pfvf
, 
chd
);

1539 
ä“_Şd_cfg
:

1540 
	`kä“
(
Şd_cfg
);

1541 
out
:

1542  
»t
;

1543 
	}
}

1545 
	$Ùx2_qos_cur_Ëaf_nodes
(
Ùx2_nic
 *
pfvf
)

1547 
Ï¡
 = 
	`fšd_Ï¡_b™
(
pfvf
->
qos
.
qos_sq_bm­
,…fvf->
hw
.
tc_tx_queues
);

1549  
Ï¡
 =ğ
pfvf
->
hw
.
tc_tx_queues
 ? 0 :†ast + 1;

1550 
	}
}

1552 
	$Ùx2_»£t_qdisc
(
Ãt_deviû
 *
dev
, 
u16
 
qid
)

1554 
Ãtdev_queue
 *
dev_queue
 = 
	`Ãtdev_g‘_tx_queue
(
dev
, 
qid
);

1555 
Qdisc
 *
qdisc
 = 
dev_queue
->
qdisc_¦“pšg
;

1557 ià(!
qdisc
)

1560 
	`¥š_lock_bh
(
	`qdisc_lock
(
qdisc
));

1561 
	`qdisc_»£t
(
qdisc
);

1562 
	`¥š_uÆock_bh
(
	`qdisc_lock
(
qdisc
));

1563 
	}
}

1565 
	$Ùx2_cfg_smq
(
Ùx2_nic
 *
pfvf
, 
Ùx2_qos_node
 *
node
, 
qid
)

1567 
Ùx2_qos_node
 *
tmp
;

1569 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
node
->
chd_schq_li¡
, 
li¡
)

1570 ià(
tmp
->
Ëv–
 =ğ
NIX_TXSCH_LVL_MDQ
) {

1571 
	`Ùx2_qos_txschq_cÚfig
(
pfvf
, 
tmp
);

1572 
pfvf
->
qos
.
qid_to_sqm­
[
qid
] = 
tmp
->
schq
;

1574 
	}
}

1576 
	$Ùx2_qos_Ëaf_d–
(
Ùx2_nic
 *
pfvf
, 
u16
 *
şassid
,

1577 
Ãšk_ext_ack
 *
exck
)

1579 
Ùx2_qos_node
 *
node
, *
·»Á
;

1580 
dw¼_d–_node
 = 
çl£
;

1581 
u16
 
qid
, 
moved_qid
;

1582 
u64
 
´io
;

1584 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
, "TC_HTB_LEAF_DEL cÏssid %04x\n", *
şassid
);

1587 
node
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, *
şassid
);

1588 ià(!
node
) {

1589 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB‚ode‚ot found");

1590  -
ENOENT
;

1592 
·»Á
 = 
node
->parent;

1593 
´io
 = 
node
->prio;

1594 
qid
 = 
node
->qid;

1596 ià(!
node
->
is_¡©ic
)

1597 
dw¼_d–_node
 = 
Œue
;

1600 
	`Ùx2_qos_di§bË_sq
(
pfvf
, 
node
->
qid
);

1603 
	`Ùx2_qos_de¡roy_node
(
pfvf
, 
node
);

1604 
pfvf
->
qos
.
qid_to_sqm­
[
qid
] = 
OTX2_QOS_INVALID_SQ
;

1606 ià(
dw¼_d–_node
) {

1607 
·»Á
->
chd_dw¼_út
--;

1609 
·»Á
->
chd_¡©ic_út
--;

1610 
	`ş—r_b™
(
´io
, 
·»Á
->
´io_bm­
);

1614 ià(!
·»Á
->
chd_dw¼_út
 &&

1615 
·»Á
->
chd_dw¼_´io
 !ğ
OTX2_QOS_DEFAULT_PRIO
) {

1616 
·»Á
->
chd_dw¼_´io
 = 
OTX2_QOS_DEFAULT_PRIO
;

1617 
	`ş—r_b™
(
´io
, 
·»Á
->
´io_bm­
);

1620 
moved_qid
 = 
	`Ùx2_qos_cur_Ëaf_nodes
(
pfvf
);

1623 ià(
moved_qid
 =ğ0 || moved_qid =ğ
qid
)

1626 
moved_qid
--;

1628 
node
 = 
	`Ùx2_sw_node_fšd_by_qid
(
pfvf
, 
moved_qid
);

1629 ià(!
node
)

1635 
node
->
qid
 = 
OTX2_QOS_QID_INNER
;

1636 
	`__ş—r_b™
(
moved_qid
, 
pfvf
->
qos
.
qos_sq_bm­
);

1637 
	`Ùx2_qos_di§bË_sq
(
pfvf
, 
moved_qid
);

1639 
	`Ùx2_»£t_qdisc
(
pfvf
->
Ãtdev
,…fvf->
hw
.
tx_queues
 + 
moved_qid
);

1644 
	`Ùx2_cfg_smq
(
pfvf
, 
node
, 
qid
);

1646 
	`Ùx2_qos_’abË_sq
(
pfvf
, 
qid
);

1647 
	`__£t_b™
(
qid
, 
pfvf
->
qos
.
qos_sq_bm­
);

1648 
node
->
qid
 = qid;

1650 *
şassid
 = 
node
->classid;

1653 
	}
}

1655 
	$Ùx2_qos_Ëaf_d–_Ï¡
(
Ùx2_nic
 *
pfvf
, 
u16
 
şassid
, 
boŞ
 
fÜû
,

1656 
Ãšk_ext_ack
 *
exck
)

1658 
Ùx2_qos_node
 *
node
, *
·»Á
;

1659 
Ùx2_qos_cfg
 *
Ãw_cfg
;

1660 
dw¼_d–_node
 = 
çl£
;

1661 
u64
 
´io
;

1662 
”r
;

1663 
u16
 
qid
;

1665 
	`Ãtdev_dbg
(
pfvf
->
Ãtdev
,

1666 "TC_HTB_LEAF_DEL_LAST cÏssid %04x\n", 
şassid
);

1669 
node
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
şassid
);

1670 ià(!
node
) {

1671 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB‚ode‚ot found");

1672  -
ENOENT
;

1676 
qid
 = 
node
->qid;

1677 
´io
 = 
node
->prio;

1679 
·»Á
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
node
->·»Á->
şassid
);

1680 ià(!
·»Á
) {

1681 
	`NL_SET_ERR_MSG_MOD
(
exck
, "parent‚ode‚ot found");

1682  -
ENOENT
;

1685 ià(!
node
->
is_¡©ic
)

1686 
dw¼_d–_node
 = 
Œue
;

1689 
	`Ùx2_qos_de¡roy_node
(
pfvf
, 
node
);

1690 
pfvf
->
qos
.
qid_to_sqm­
[
qid
] = 
OTX2_QOS_INVALID_SQ
;

1692 ià(
dw¼_d–_node
) {

1693 
·»Á
->
chd_dw¼_út
--;

1695 
·»Á
->
chd_¡©ic_út
--;

1696 
	`ş—r_b™
(
´io
, 
·»Á
->
´io_bm­
);

1700 ià(!
·»Á
->
chd_dw¼_út
 &&

1701 
·»Á
->
chd_dw¼_´io
 !ğ
OTX2_QOS_DEFAULT_PRIO
) {

1702 
·»Á
->
chd_dw¼_´io
 = 
OTX2_QOS_DEFAULT_PRIO
;

1703 
	`ş—r_b™
(
´io
, 
·»Á
->
´io_bm­
);

1707 
	`Ùx2_qos_®loc_txschq_node
(
pfvf
, 
·»Á
);

1708 
·»Á
->
qid
 = qid;

1709 
	`__£t_b™
(
qid
, 
pfvf
->
qos
.
qos_sq_bm­
);

1712 
Ãw_cfg
 = 
	`kz®loc
((*Ãw_cfg), 
GFP_KERNEL
);

1713 ià(!
Ãw_cfg
) {

1714 
	`NL_SET_ERR_MSG_MOD
(
exck
, "Memory‡llocationƒrror");

1715  -
ENOMEM
;

1718 
	`Ùx2_qos_fl_cfg_schq
(
·»Á
, 
Ãw_cfg
);

1719 
”r
 = 
	`Ùx2_qos_push_txschq_cfg
(
pfvf
, 
·»Á
, 
Ãw_cfg
);

1720 ià(
”r
) {

1721 
	`NL_SET_ERR_MSG_MOD
(
exck
, "HTB HW configurationƒrror");

1722 
	`kä“
(
Ãw_cfg
);

1723  
”r
;

1725 
	`kä“
(
Ãw_cfg
);

1728 
	`Ùx2_qos_upd©e_tx_Ãtdev_queues
(
pfvf
);

1731 
	}
}

1733 
	$Ùx2_ş—n_qos_queues
(
Ùx2_nic
 *
pfvf
)

1735 
Ùx2_qos_node
 *
roÙ
;

1737 
roÙ
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
OTX2_QOS_ROOT_CLASSID
);

1738 ià(!
roÙ
)

1741  
	`Ùx2_qos_upd©e_smq
(
pfvf
, 
roÙ
, 
QOS_SMQ_FLUSH
);

1742 
	}
}

1744 
	$Ùx2_qos_cÚfig_txschq
(
Ùx2_nic
 *
pfvf
)

1746 
Ùx2_qos_node
 *
roÙ
;

1747 
”r
;

1749 
roÙ
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
OTX2_QOS_ROOT_CLASSID
);

1750 ià(!
roÙ
)

1753 
”r
 = 
	`Ùx2_qos_txschq_cÚfig
(
pfvf
, 
roÙ
);

1754 ià(
”r
) {

1755 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
, "Error updatexschq configuration\n");

1756 
roÙ_de¡roy
;

1760 
”r
 = 
	`Ùx2_qos_txschq_push_cfg_
(
pfvf
, 
roÙ
, 
NULL
);

1761 ià(
”r
) {

1762 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
, "Error updatexschq configuration\n");

1763 
roÙ_de¡roy
;

1766 
”r
 = 
	`Ùx2_qos_upd©e_smq
(
pfvf
, 
roÙ
, 
QOS_CFG_SQ
);

1767 ià(
”r
) {

1768 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
, "Error update smq configuration\n");

1769 
roÙ_de¡roy
;

1774 
roÙ_de¡roy
:

1775 
	`Ùx2_qos_roÙ_de¡roy
(
pfvf
);

1776 
	}
}

1778 
boŞ
 
	$Ùx2_is_qos_cÚfigu»d
(
Ùx2_nic
 *
pfvf
)

1780 
Ùx2_qos_node
 *
roÙ
;

1782 
roÙ
 = 
	`Ùx2_sw_node_fšd
(
pfvf
, 
OTX2_QOS_ROOT_CLASSID
);

1783 ià(!
roÙ
)

1784  
çl£
;

1786  
Œue
;

1787 
	}
}

1788 
EXPORT_SYMBOL
(
Ùx2_is_qos_cÚfigu»d
);

1790 
	$Ùx2_£tup_tc_htb
(
Ãt_deviû
 *
ndev
, 
tc_htb_qİt_ofæßd
 *
htb
)

1792 
Ùx2_nic
 *
pfvf
 = 
	`Ãtdev_´iv
(
ndev
);

1793 
»s
;

1795 
htb
->
commªd
) {

1796 
TC_HTB_CREATE
:

1797  
	`Ùx2_qos_roÙ_add
(
pfvf
, 
htb
->
·»Á_şassid
,

1798 
htb
->
şassid
, htb->
exck
);

1799 
TC_HTB_DESTROY
:

1800  
	`Ùx2_qos_roÙ_de¡roy
(
pfvf
);

1801 
TC_HTB_LEAF_ALLOC_QUEUE
:

1802 
»s
 = 
	`Ùx2_qos_Ëaf_®loc_queue
(
pfvf
, 
htb
->
şassid
,

1803 
htb
->
·»Á_şassid
,

1804 
htb
->
¿‹
, htb->
û
,

1805 
htb
->
´io
, htb->
quªtum
,

1806 
htb
->
exck
);

1807 ià(
»s
 < 0)

1808  
»s
;

1809 
htb
->
qid
 = 
»s
;

1811 
TC_HTB_LEAF_TO_INNER
:

1812  
	`Ùx2_qos_Ëaf_to_šÃr
(
pfvf
, 
htb
->
·»Á_şassid
,

1813 
htb
->
şassid
, htb->
¿‹
,

1814 
htb
->
û
, htb->
´io
,

1815 
htb
->
quªtum
, htb->
exck
);

1816 
TC_HTB_LEAF_DEL
:

1817  
	`Ùx2_qos_Ëaf_d–
(
pfvf
, &
htb
->
şassid
, htb->
exck
);

1818 
TC_HTB_LEAF_DEL_LAST
:

1819 
TC_HTB_LEAF_DEL_LAST_FORCE
:

1820  
	`Ùx2_qos_Ëaf_d–_Ï¡
(
pfvf
, 
htb
->
şassid
,

1821 
htb
->
commªd
 =ğ
TC_HTB_LEAF_DEL_LAST_FORCE
,

1822 
htb
->
exck
);

1823 
TC_HTB_LEAF_QUERY_QUEUE
:

1824 
»s
 = 
	`Ùx2_g‘_txq_by_şassid
(
pfvf
, 
htb
->
şassid
);

1825 
htb
->
qid
 = 
»s
;

1827 
TC_HTB_NODE_MODIFY
:

1829  -
EOPNOTSUPP
;

1831 
	}
}

	@qos.h

7 #iâdeà
OTX2_QOS_H


8 
	#OTX2_QOS_H


	)

10 
	~<lšux/ty³s.h
>

11 
	~<lšux/Ãtdeviû.h
>

12 
	~<lšux/rhashbË.h
>

14 
	#OTX2_QOS_MAX_LVL
 4

	)

15 
	#OTX2_QOS_MAX_PRIO
 7

	)

16 
	#OTX2_QOS_MAX_LEAF_NODES
 16

	)

18 
	eqos_smq_İ”©iÚs
 {

19 
	mQOS_CFG_SQ
,

20 
	mQOS_SMQ_FLUSH
,

23 
u64
 
Ùx2_g‘_txschq_¿‹_»gv®
(
Ùx2_nic
 *
nic
, u64 
max¿‹
, 
u32
 
bur¡
);

25 
Ùx2_£tup_tc_htb
(
Ãt_deviû
 *
ndev
, 
tc_htb_qİt_ofæßd
 *
htb
);

26 
Ùx2_qos_g‘_qid
(
Ùx2_nic
 *
pfvf
);

27 
Ùx2_qos_ä“_qid
(
Ùx2_nic
 *
pfvf
, 
qidx
);

28 
Ùx2_qos_’abË_sq
(
Ùx2_nic
 *
pfvf
, 
qidx
);

29 
Ùx2_qos_di§bË_sq
(
Ùx2_nic
 *
pfvf
, 
qidx
);

31 
	sÙx2_qos_cfg
 {

32 
u16
 
	mschq
[
NIX_TXSCH_LVL_CNT
];

33 
u16
 
	mschq_cÚtig
[
NIX_TXSCH_LVL_CNT
];

34 
u16
 
	mschq_li¡
[
NIX_TXSCH_LVL_CNT
][
MAX_TXSCHQ_PER_FUNC
];

35 
u16
 
	mschq_cÚtig_li¡
[
NIX_TXSCH_LVL_CNT
][
MAX_TXSCHQ_PER_FUNC
];

36 
	m¡©ic_node_pos
[
NIX_TXSCH_LVL_CNT
];

37 
	mdw¼_node_pos
[
NIX_TXSCH_LVL_CNT
];

40 
	sÙx2_qos
 {

41 
DECLARE_HASHTABLE
(
qos_hli¡
, 
Üd”_ba£_2
(
OTX2_QOS_MAX_LEAF_NODES
));

42 
DECLARE_BITMAP
(
qos_sq_bm­
, 
OTX2_QOS_MAX_LEAF_NODES
);

43 
u16
 
	mqid_to_sqm­
[
OTX2_QOS_MAX_LEAF_NODES
];

44 
u16
 
	mmaj_id
;

45 
u16
 
	mdefşs
;

46 
li¡_h—d
 
	mqos_Œ“
;

47 
mu‹x
 
	mqos_lock
;

48 
u8
 
	mlšk_cfg_lvl
;

51 
	sÙx2_qos_node
 {

53 
u32
 
	mşassid
;

54 
u64
 
	m¿‹
;

55 
u64
 
	mû
;

56 
u32
 
	m´io
;

57 
u32
 
	mquªtum
;

59 
u8
 
	mËv–
;

60 
u16
 
	mschq
;

61 
u16
 
	mqid
;

62 
boŞ
 
	mis_¡©ic
;

63 
u16
 
	m´io_ªchÜ
;

64 
DECLARE_BITMAP
(
´io_bm­
, 
OTX2_QOS_MAX_PRIO
 + 1);

65 
u16
 
	mchd_dw¼_´io
;

66 
u16
 
	mchd_dw¼_út
;

67 
u16
 
	mchd_¡©ic_út
;

68 
u16
 
	mmax_¡©ic_´io
;

69 
u16
 
	mtxschq_idx
;

71 
hli¡_node
 
	mhli¡
;

72 
Ùx2_qos_node
 *
	m·»Á
;

73 
li¡_h—d
 
	mli¡
;

74 
li¡_h—d
 
	mchd_li¡
;

75 
li¡_h—d
 
	mchd_schq_li¡
;

	@qos_sq.c

8 
	~<lšux/Ãtdeviû.h
>

9 
	~<Ãt/tso.h
>

11 
	~"ú10k.h
"

12 
	~"Ùx2_»g.h
"

13 
	~"Ùx2_commÚ.h
"

14 
	~"Ùx2_txrx.h
"

15 
	~"Ùx2_¡ruù.h
"

17 
	#OTX2_QOS_MAX_LEAF_NODES
 16

	)

19 
	$Ùx2_qos_sq_£tup
(
Ùx2_nic
 *
pfvf
, 
qos_txqs
)

21 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

23 
hw
->
tc_tx_queues
 = 
qos_txqs
;

24 
	}
}

25 
EXPORT_SYMBOL
(
Ùx2_qos_sq_£tup
);

27 
	$Ùx2_qos_au¿_poŞ_ä“
(
Ùx2_nic
 *
pfvf
, 
poŞ_id
)

29 
Ùx2_poŞ
 *
poŞ
;

31 ià(!
pfvf
->
q£t
.
poŞ
)

34 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

35 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
¡ack
);

36 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
fc_addr
);

37 
poŞ
->
¡ack
 = 
NULL
;

38 
poŞ
->
fc_addr
 = 
NULL
;

39 
	}
}

41 
	$Ùx2_qos_sq_au¿_poŞ_š™
(
Ùx2_nic
 *
pfvf
, 
qidx
)

43 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

44 
poŞ_id
, 
¡ack_·ges
, 
num_sqbs
;

45 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

46 
Ùx2_¢d_queue
 *
sq
;

47 
Ùx2_poŞ
 *
poŞ
;

48 
dma_addr_t
 
buåŒ
;

49 
”r
, 
±r
;

50 
u64
 
iova
, 
·
;

57 
num_sqbs
 = (
hw
->
sqb_size
 / 128) - 1;

58 
num_sqbs
 = (
q£t
->
sqe_út
 +‚um_sqbs) /‚um_sqbs;

61 
¡ack_·ges
 =

62 (
num_sqbs
 + 
hw
->
¡ack_pg_±rs
 - 1) / hw->stack_pg_ptrs;

64 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
qidx
);

65 
poŞ
 = &
pfvf
->
q£t
.poŞ[
poŞ_id
];

68 
”r
 = 
	`Ùx2_au¿_š™
(
pfvf
, 
poŞ_id
,…oŞ_id, 
num_sqbs
);

69 ià(
”r
)

70  
”r
;

73 
”r
 = 
	`Ùx2_poŞ_š™
(
pfvf
, 
poŞ_id
, 
¡ack_·ges
,

74 
num_sqbs
, 
hw
->
sqb_size
);

75 ià(
”r
)

76 
au¿_ä“
;

79 
”r
 = 
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

80 ià(
”r
)

81 
poŞ_ä“
;

84 
sq
 = &
q£t
->sq[
qidx
];

85 
sq
->
sqb_couÁ
 = 0;

86 
sq
->
sqb_±rs
 = 
	`kÿÎoc
(
num_sqbs
, (*sq->sqb_±rs), 
GFP_KERNEL
);

87 ià(!
sq
->
sqb_±rs
) {

88 
”r
 = -
ENOMEM
;

89 
poŞ_ä“
;

92 
±r
 = 0;…Œ < 
num_sqbs
;…tr++) {

93 
”r
 = 
	`__Ùx2_®loc_rbuf
(
pfvf
, 
poŞ
, &
buåŒ
);

94 ià(
”r
)

95 
sqb_ä“
;

96 
pfvf
->
hw_İs
->
	`au¿_ä“±r
Õfvf, 
poŞ_id
, 
buåŒ
);

97 
sq
->
sqb_±rs
[sq->
sqb_couÁ
++] = (
u64
)
buåŒ
;

102 
sqb_ä“
:

103 
±r
--) {

104 ià(!
sq
->
sqb_±rs
[
±r
])

106 
iova
 = 
sq
->
sqb_±rs
[
±r
];

107 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

108 
	`dma_unm­_·ge_©Œs
(
pfvf
->
dev
, 
iova
, 
hw
->
sqb_size
,

109 
DMA_FROM_DEVICE
,

110 
DMA_ATTR_SKIP_CPU_SYNC
);

111 
	`put_·ge
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
)));

112 
	`Ùx2_au¿_®loıŒ
(
pfvf
, 
poŞ_id
);

114 
sq
->
sqb_couÁ
 = 0;

115 
	`kä“
(
sq
->
sqb_±rs
);

116 
poŞ_ä“
:

117 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
¡ack
);

118 
au¿_ä“
:

119 
	`qmem_ä“
(
pfvf
->
dev
, 
poŞ
->
fc_addr
);

120 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

121  
”r
;

122 
	}
}

124 
	$Ùx2_qos_sq_ä“_sqbs
(
Ùx2_nic
 *
pfvf
, 
qidx
)

126 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

127 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

128 
Ùx2_¢d_queue
 *
sq
;

129 
u64
 
iova
, 
·
;

130 
sqb
;

132 
sq
 = &
q£t
->sq[
qidx
];

133 ià(!
sq
->
sqb_±rs
)

135 
sqb
 = 0; sqb < 
sq
->
sqb_couÁ
; sqb++) {

136 ià(!
sq
->
sqb_±rs
[
sqb
])

138 
iova
 = 
sq
->
sqb_±rs
[
sqb
];

139 
·
 = 
	`Ùx2_iova_to_phys
(
pfvf
->
iommu_domaš
, 
iova
);

140 
	`dma_unm­_·ge_©Œs
(
pfvf
->
dev
, 
iova
, 
hw
->
sqb_size
,

141 
DMA_FROM_DEVICE
,

142 
DMA_ATTR_SKIP_CPU_SYNC
);

143 ià(
	`·ge_»f_couÁ
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
))))

144 
	`put_·ge
(
	`vœt_to_·ge
(
	`phys_to_vœt
(
·
)));

147 
sq
->
sqb_couÁ
 = 0;

149 
sq
 = &
q£t
->sq[
qidx
];

150 
	`qmem_ä“
(
pfvf
->
dev
, 
sq
->
sqe
);

151 
	`qmem_ä“
(
pfvf
->
dev
, 
sq
->
tso_hdrs
);

152 
	`kä“
(
sq
->
sg
);

153 
	`kä“
(
sq
->
sqb_±rs
);

154 
	`qmem_ä“
(
pfvf
->
dev
, 
sq
->
time¡amps
);

156 
	`mem£t
((*)
sq
, 0, (*sq));

157 
	}
}

160 
	$Ùx2_qos_sqb_æush
(
Ùx2_nic
 *
pfvf
, 
qidx
)

162 
sqe_
, 
sqe_h—d
;

163 
u64
 
šü
, *
±r
, 
v®
;

165 
±r
 = (
u64
 *)
	`Ùx2_g‘_»gaddr
(
pfvf
, 
NIX_LF_SQ_OP_STATUS
);

166 
šü
 = (
u64
)
qidx
 << 32;

167 
v®
 = 
	`Ùx2_©omic64_add
(
šü
, 
±r
);

168 
sqe_h—d
 = (
v®
 >> 20) & 0x3F;

169 
sqe_
 = (
v®
 >> 28) & 0x3F;

170 ià(
sqe_h—d
 !ğ
sqe_
)

171 
	`u¦“p_¿nge
(50, 60);

172 
	}
}

174 
	$Ùx2_qos_ùx_di§bË
(
Ùx2_nic
 *
pfvf
, 
u16
 
qidx
, 
au¿_id
)

176 
nix_ú10k_aq_’q_»q
 *
ú10k_sq_aq
;

177 
Åa_aq_’q_»q
 *
au¿_aq
;

178 
Åa_aq_’q_»q
 *
poŞ_aq
;

179 
nix_aq_’q_»q
 *
sq_aq
;

181 ià(
	`‹¡_b™
(
CN10K_LMTST
, &
pfvf
->
hw
.
ÿp_æag
)) {

182 
ú10k_sq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_ú10k_aq_’q
(&
pfvf
->
mbox
);

183 ià(!
ú10k_sq_aq
)

184  -
ENOMEM
;

185 
ú10k_sq_aq
->
qidx
 = qidx;

186 
ú10k_sq_aq
->
sq
.
’a
 = 0;

187 
ú10k_sq_aq
->
sq_mask
.
’a
 = 1;

188 
ú10k_sq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

189 
ú10k_sq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

191 
sq_aq
 = 
	`Ùx2_mbox_®loc_msg_nix_aq_’q
(&
pfvf
->
mbox
);

192 ià(!
sq_aq
)

193  -
ENOMEM
;

194 
sq_aq
->
qidx
 = qidx;

195 
sq_aq
->
sq
.
’a
 = 0;

196 
sq_aq
->
sq_mask
.
’a
 = 1;

197 
sq_aq
->
ùy³
 = 
NIX_AQ_CTYPE_SQ
;

198 
sq_aq
->
İ
 = 
NIX_AQ_INSTOP_WRITE
;

201 
au¿_aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

202 ià(!
au¿_aq
) {

203 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

204  -
ENOMEM
;

207 
au¿_aq
->
au¿_id
 =‡ura_id;

208 
au¿_aq
->
au¿
.
’a
 = 0;

209 
au¿_aq
->
au¿_mask
.
’a
 = 1;

210 
au¿_aq
->
ùy³
 = 
NPA_AQ_CTYPE_AURA
;

211 
au¿_aq
->
İ
 = 
NPA_AQ_INSTOP_WRITE
;

213 
poŞ_aq
 = 
	`Ùx2_mbox_®loc_msg_Åa_aq_’q
(&
pfvf
->
mbox
);

214 ià(!
poŞ_aq
) {

215 
	`Ùx2_mbox_»£t
(&
pfvf
->
mbox
.mbox, 0);

216  -
ENOMEM
;

219 
poŞ_aq
->
au¿_id
 =‡ura_id;

220 
poŞ_aq
->
poŞ
.
’a
 = 0;

221 
poŞ_aq
->
poŞ_mask
.
’a
 = 1;

223 
poŞ_aq
->
ùy³
 = 
NPA_AQ_CTYPE_POOL
;

224 
poŞ_aq
->
İ
 = 
NPA_AQ_INSTOP_WRITE
;

226  
	`Ùx2_sync_mbox_msg
(&
pfvf
->
mbox
);

227 
	}
}

229 
	$Ùx2_qos_g‘_qid
(
Ùx2_nic
 *
pfvf
)

231 
qidx
;

233 
qidx
 = 
	`fšd_fœ¡_z”o_b™
(
pfvf
->
qos
.
qos_sq_bm­
,

234 
pfvf
->
hw
.
tc_tx_queues
);

236  
qidx
 =ğ
pfvf
->
hw
.
tc_tx_queues
 ? -
ENOSPC
 : qidx;

237 
	}
}

239 
	$Ùx2_qos_ä“_qid
(
Ùx2_nic
 *
pfvf
, 
qidx
)

241 
	`ş—r_b™
(
qidx
, 
pfvf
->
qos
.
qos_sq_bm­
);

242 
	}
}

244 
	$Ùx2_qos_’abË_sq
(
Ùx2_nic
 *
pfvf
, 
qidx
)

246 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

247 
poŞ_id
, 
sq_idx
, 
”r
;

249 ià(
pfvf
->
æags
 & 
OTX2_FLAG_INTF_DOWN
)

250  -
EPERM
;

252 
sq_idx
 = 
hw
->
tÙ_tx_queues
 + 
qidx
;

254 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

255 
”r
 = 
	`Ùx2_qos_sq_au¿_poŞ_š™
(
pfvf
, 
sq_idx
);

256 ià(
”r
)

257 
out
;

259 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
sq_idx
);

260 
”r
 = 
	`Ùx2_sq_š™
(
pfvf
, 
sq_idx
, 
poŞ_id
);

261 ià(
”r
)

262 
out
;

263 
out
:

264 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

265  
”r
;

266 
	}
}

268 
	$Ùx2_qos_di§bË_sq
(
Ùx2_nic
 *
pfvf
, 
qidx
)

270 
Ùx2_q£t
 *
q£t
 = &
pfvf
->qset;

271 
Ùx2_hw
 *
hw
 = &
pfvf
->hw;

272 
Ùx2_¢d_queue
 *
sq
;

273 
Ùx2_cq_queue
 *
cq
;

274 
poŞ_id
, 
sq_idx
;

276 
sq_idx
 = 
hw
->
tÙ_tx_queues
 + 
qidx
;

279 ià(
pfvf
->
æags
 & 
OTX2_FLAG_INTF_DOWN
)

282 
sq
 = &
pfvf
->
q£t
.sq[
sq_idx
];

283 ià(!
sq
->
sqb_±rs
)

286 ià(
sq_idx
 < 
hw
->
tÙ_tx_queues
 ||

287 
sq_idx
 >ğ
hw
->
tÙ_tx_queues
 + hw->
tc_tx_queues
) {

288 
	`Ãtdev_”r
(
pfvf
->
Ãtdev
, "Send Queue is‚ot‡ QoS queue\n");

292 
cq
 = &
q£t
->cq[
pfvf
->
hw
.
rx_queues
 + 
sq_idx
];

293 
poŞ_id
 = 
	`Ùx2_g‘_poŞ_idx
(
pfvf
, 
AURA_NIX_SQ
, 
sq_idx
);

295 
	`Ùx2_qos_sqb_æush
(
pfvf
, 
sq_idx
);

296 
	`Ùx2_smq_æush
(
pfvf
, 
	`Ùx2_g‘_smq_idx
Õfvf, 
sq_idx
));

297 
	`Ùx2_ş—nup_tx_cqes
(
pfvf
, 
cq
);

299 
	`mu‹x_lock
(&
pfvf
->
mbox
.
lock
);

300 
	`Ùx2_qos_ùx_di§bË
(
pfvf
, 
sq_idx
, 
poŞ_id
);

301 
	`mu‹x_uÆock
(&
pfvf
->
mbox
.
lock
);

303 
	`Ùx2_qos_sq_ä“_sqbs
(
pfvf
, 
sq_idx
);

304 
	`Ùx2_qos_au¿_poŞ_ä“
(
pfvf
, 
poŞ_id
);

305 
	}
}

	@/usr/include/asm/byteorder.h

2 #iâdeà
_ASM_X86_BYTEORDER_H


3 
	#_ASM_X86_BYTEORDER_H


	)

5 
	~<lšux/by‹Üd”/l™e_’dŸn.h
>

	@/usr/include/linux/bpf.h

8 #iâdeà
__LINUX_BPF_H__


9 
	#__LINUX_BPF_H__


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/bpf_commÚ.h
>

17 
	#BPF_JMP32
 0x06

	)

18 
	#BPF_ALU64
 0x07

	)

21 
	#BPF_DW
 0x18

	)

22 
	#BPF_XADD
 0xc0

	)

25 
	#BPF_MOV
 0xb0

	)

26 
	#BPF_ARSH
 0xc0

	)

29 
	#BPF_END
 0xd0

	)

30 
	#BPF_TO_LE
 0x00

	)

31 
	#BPF_TO_BE
 0x08

	)

32 
	#BPF_FROM_LE
 
BPF_TO_LE


	)

33 
	#BPF_FROM_BE
 
BPF_TO_BE


	)

36 
	#BPF_JNE
 0x50

	)

37 
	#BPF_JLT
 0xa0

	)

38 
	#BPF_JLE
 0xb0

	)

39 
	#BPF_JSGT
 0x60

	)

40 
	#BPF_JSGE
 0x70

	)

41 
	#BPF_JSLT
 0xc0

	)

42 
	#BPF_JSLE
 0xd0

	)

43 
	#BPF_CALL
 0x80

	)

44 
	#BPF_EXIT
 0x90

	)

48 
	mBPF_REG_0
 = 0,

49 
	mBPF_REG_1
,

50 
	mBPF_REG_2
,

51 
	mBPF_REG_3
,

52 
	mBPF_REG_4
,

53 
	mBPF_REG_5
,

54 
	mBPF_REG_6
,

55 
	mBPF_REG_7
,

56 
	mBPF_REG_8
,

57 
	mBPF_REG_9
,

58 
	mBPF_REG_10
,

59 
	m__MAX_BPF_REG
,

63 
	#MAX_BPF_REG
 
__MAX_BPF_REG


	)

65 
	sbpf_š¢
 {

66 
__u8
 
	mcode
;

67 
__u8
 
	md¡_»g
:4;

68 
__u8
 
	m¤c_»g
:4;

69 
__s16
 
	moff
;

70 
__s32
 
	mimm
;

74 
	sbpf_Ím_Œ›_key
 {

75 
__u32
 
	m´efixËn
;

76 
__u8
 
	md©a
[0];

79 
	sbpf_cgroup_¡Üage_key
 {

80 
__u64
 
	mcgroup_šode_id
;

81 
__u32
 
	m©ch_ty³
;

85 
	ebpf_cmd
 {

86 
	mBPF_MAP_CREATE
,

87 
	mBPF_MAP_LOOKUP_ELEM
,

88 
	mBPF_MAP_UPDATE_ELEM
,

89 
	mBPF_MAP_DELETE_ELEM
,

90 
	mBPF_MAP_GET_NEXT_KEY
,

91 
	mBPF_PROG_LOAD
,

92 
	mBPF_OBJ_PIN
,

93 
	mBPF_OBJ_GET
,

94 
	mBPF_PROG_ATTACH
,

95 
	mBPF_PROG_DETACH
,

96 
	mBPF_PROG_TEST_RUN
,

97 
	mBPF_PROG_GET_NEXT_ID
,

98 
	mBPF_MAP_GET_NEXT_ID
,

99 
	mBPF_PROG_GET_FD_BY_ID
,

100 
	mBPF_MAP_GET_FD_BY_ID
,

101 
	mBPF_OBJ_GET_INFO_BY_FD
,

102 
	mBPF_PROG_QUERY
,

103 
	mBPF_RAW_TRACEPOINT_OPEN
,

104 
	mBPF_BTF_LOAD
,

105 
	mBPF_BTF_GET_FD_BY_ID
,

106 
	mBPF_TASK_FD_QUERY
,

107 
	mBPF_MAP_LOOKUP_AND_DELETE_ELEM
,

108 
	mBPF_MAP_FREEZE
,

109 
	mBPF_BTF_GET_NEXT_ID
,

112 
	ebpf_m­_ty³
 {

113 
	mBPF_MAP_TYPE_UNSPEC
,

114 
	mBPF_MAP_TYPE_HASH
,

115 
	mBPF_MAP_TYPE_ARRAY
,

116 
	mBPF_MAP_TYPE_PROG_ARRAY
,

117 
	mBPF_MAP_TYPE_PERF_EVENT_ARRAY
,

118 
	mBPF_MAP_TYPE_PERCPU_HASH
,

119 
	mBPF_MAP_TYPE_PERCPU_ARRAY
,

120 
	mBPF_MAP_TYPE_STACK_TRACE
,

121 
	mBPF_MAP_TYPE_CGROUP_ARRAY
,

122 
	mBPF_MAP_TYPE_LRU_HASH
,

123 
	mBPF_MAP_TYPE_LRU_PERCPU_HASH
,

124 
	mBPF_MAP_TYPE_LPM_TRIE
,

125 
	mBPF_MAP_TYPE_ARRAY_OF_MAPS
,

126 
	mBPF_MAP_TYPE_HASH_OF_MAPS
,

127 
	mBPF_MAP_TYPE_DEVMAP
,

128 
	mBPF_MAP_TYPE_SOCKMAP
,

129 
	mBPF_MAP_TYPE_CPUMAP
,

130 
	mBPF_MAP_TYPE_XSKMAP
,

131 
	mBPF_MAP_TYPE_SOCKHASH
,

132 
	mBPF_MAP_TYPE_CGROUP_STORAGE
,

133 
	mBPF_MAP_TYPE_REUSEPORT_SOCKARRAY
,

134 
	mBPF_MAP_TYPE_PERCPU_CGROUP_STORAGE
,

135 
	mBPF_MAP_TYPE_QUEUE
,

136 
	mBPF_MAP_TYPE_STACK
,

137 
	mBPF_MAP_TYPE_SK_STORAGE
,

138 
	mBPF_MAP_TYPE_DEVMAP_HASH
,

149 
	ebpf_´og_ty³
 {

150 
	mBPF_PROG_TYPE_UNSPEC
,

151 
	mBPF_PROG_TYPE_SOCKET_FILTER
,

152 
	mBPF_PROG_TYPE_KPROBE
,

153 
	mBPF_PROG_TYPE_SCHED_CLS
,

154 
	mBPF_PROG_TYPE_SCHED_ACT
,

155 
	mBPF_PROG_TYPE_TRACEPOINT
,

156 
	mBPF_PROG_TYPE_XDP
,

157 
	mBPF_PROG_TYPE_PERF_EVENT
,

158 
	mBPF_PROG_TYPE_CGROUP_SKB
,

159 
	mBPF_PROG_TYPE_CGROUP_SOCK
,

160 
	mBPF_PROG_TYPE_LWT_IN
,

161 
	mBPF_PROG_TYPE_LWT_OUT
,

162 
	mBPF_PROG_TYPE_LWT_XMIT
,

163 
	mBPF_PROG_TYPE_SOCK_OPS
,

164 
	mBPF_PROG_TYPE_SK_SKB
,

165 
	mBPF_PROG_TYPE_CGROUP_DEVICE
,

166 
	mBPF_PROG_TYPE_SK_MSG
,

167 
	mBPF_PROG_TYPE_RAW_TRACEPOINT
,

168 
	mBPF_PROG_TYPE_CGROUP_SOCK_ADDR
,

169 
	mBPF_PROG_TYPE_LWT_SEG6LOCAL
,

170 
	mBPF_PROG_TYPE_LIRC_MODE2
,

171 
	mBPF_PROG_TYPE_SK_REUSEPORT
,

172 
	mBPF_PROG_TYPE_FLOW_DISSECTOR
,

173 
	mBPF_PROG_TYPE_CGROUP_SYSCTL
,

174 
	mBPF_PROG_TYPE_RAW_TRACEPOINT_WRITABLE
,

175 
	mBPF_PROG_TYPE_CGROUP_SOCKOPT
,

178 
	ebpf_©ch_ty³
 {

179 
	mBPF_CGROUP_INET_INGRESS
,

180 
	mBPF_CGROUP_INET_EGRESS
,

181 
	mBPF_CGROUP_INET_SOCK_CREATE
,

182 
	mBPF_CGROUP_SOCK_OPS
,

183 
	mBPF_SK_SKB_STREAM_PARSER
,

184 
	mBPF_SK_SKB_STREAM_VERDICT
,

185 
	mBPF_CGROUP_DEVICE
,

186 
	mBPF_SK_MSG_VERDICT
,

187 
	mBPF_CGROUP_INET4_BIND
,

188 
	mBPF_CGROUP_INET6_BIND
,

189 
	mBPF_CGROUP_INET4_CONNECT
,

190 
	mBPF_CGROUP_INET6_CONNECT
,

191 
	mBPF_CGROUP_INET4_POST_BIND
,

192 
	mBPF_CGROUP_INET6_POST_BIND
,

193 
	mBPF_CGROUP_UDP4_SENDMSG
,

194 
	mBPF_CGROUP_UDP6_SENDMSG
,

195 
	mBPF_LIRC_MODE2
,

196 
	mBPF_FLOW_DISSECTOR
,

197 
	mBPF_CGROUP_SYSCTL
,

198 
	mBPF_CGROUP_UDP4_RECVMSG
,

199 
	mBPF_CGROUP_UDP6_RECVMSG
,

200 
	mBPF_CGROUP_GETSOCKOPT
,

201 
	mBPF_CGROUP_SETSOCKOPT
,

202 
	m__MAX_BPF_ATTACH_TYPE


205 
	#MAX_BPF_ATTACH_TYPE
 
__MAX_BPF_ATTACH_TYPE


	)

246 
	#BPF_F_ALLOW_OVERRIDE
 (1U << 0)

	)

247 
	#BPF_F_ALLOW_MULTI
 (1U << 1)

	)

254 
	#BPF_F_STRICT_ALIGNMENT
 (1U << 0)

	)

268 
	#BPF_F_ANY_ALIGNMENT
 (1U << 1)

	)

286 
	#BPF_F_TEST_RND_HI32
 (1U << 2)

	)

289 
	#BPF_F_TEST_STATE_FREQ
 (1U << 3)

	)

302 
	#BPF_PSEUDO_MAP_FD
 1

	)

303 
	#BPF_PSEUDO_MAP_VALUE
 2

	)

308 
	#BPF_PSEUDO_CALL
 1

	)

311 
	#BPF_ANY
 0

	)

312 
	#BPF_NOEXIST
 1

	)

313 
	#BPF_EXIST
 2

	)

314 
	#BPF_F_LOCK
 4

	)

317 
	#BPF_F_NO_PREALLOC
 (1U << 0)

	)

324 
	#BPF_F_NO_COMMON_LRU
 (1U << 1)

	)

326 
	#BPF_F_NUMA_NODE
 (1U << 2)

	)

328 
	#BPF_OBJ_NAME_LEN
 16U

	)

331 
	#BPF_F_RDONLY
 (1U << 3)

	)

332 
	#BPF_F_WRONLY
 (1U << 4)

	)

335 
	#BPF_F_STACK_BUILD_ID
 (1U << 5)

	)

338 
	#BPF_F_ZERO_SEED
 (1U << 6)

	)

341 
	#BPF_F_RDONLY_PROG
 (1U << 7)

	)

342 
	#BPF_F_WRONLY_PROG
 (1U << 8)

	)

345 
	#BPF_F_CLONE
 (1U << 9)

	)

348 
	#BPF_F_QUERY_EFFECTIVE
 (1U << 0)

	)

350 
	ebpf_¡ack_bud_id_¡©us
 {

352 
	mBPF_STACK_BUILD_ID_EMPTY
 = 0,

354 
	mBPF_STACK_BUILD_ID_VALID
 = 1,

356 
	mBPF_STACK_BUILD_ID_IP
 = 2,

359 
	#BPF_BUILD_ID_SIZE
 20

	)

360 
	sbpf_¡ack_bud_id
 {

361 
__s32
 
	m¡©us
;

362 
	mbud_id
[
BPF_BUILD_ID_SIZE
];

364 
__u64
 
	moff£t
;

365 
__u64
 
	m
;

369 
	ubpf_©Œ
 {

371 
__u32
 
	mm­_ty³
;

372 
__u32
 
	mkey_size
;

373 
__u32
 
	mv®ue_size
;

374 
__u32
 
	mmax_’Œ›s
;

375 
__u32
 
	mm­_æags
;

378 
__u32
 
	mšÃr_m­_fd
;

379 
__u32
 
	mnuma_node
;

382 
	mm­_Çme
[
BPF_OBJ_NAME_LEN
];

383 
__u32
 
	mm­_ifšdex
;

384 
__u32
 
	mbtf_fd
;

385 
__u32
 
	mbtf_key_ty³_id
;

386 
__u32
 
	mbtf_v®ue_ty³_id
;

390 
__u32
 
	mm­_fd
;

391 
__®igÃd_u64
 
	mkey
;

393 
__®igÃd_u64
 
	mv®ue
;

394 
__®igÃd_u64
 
	mÃxt_key
;

396 
__u64
 
	mæags
;

400 
__u32
 
	m´og_ty³
;

401 
__u32
 
	mš¢_út
;

402 
__®igÃd_u64
 
	mš¢s
;

403 
__®igÃd_u64
 
	mliûn£
;

404 
__u32
 
	mlog_Ëv–
;

405 
__u32
 
	mlog_size
;

406 
__®igÃd_u64
 
	mlog_buf
;

407 
__u32
 
	mk”n_v”siÚ
;

408 
__u32
 
	m´og_æags
;

409 
	m´og_Çme
[
BPF_OBJ_NAME_LEN
];

410 
__u32
 
	m´og_ifšdex
;

415 
__u32
 
	mex³ùed_©ch_ty³
;

416 
__u32
 
	m´og_btf_fd
;

417 
__u32
 
	mfunc_šfo_»c_size
;

418 
__®igÃd_u64
 
	mfunc_šfo
;

419 
__u32
 
	mfunc_šfo_út
;

420 
__u32
 
	mlše_šfo_»c_size
;

421 
__®igÃd_u64
 
	mlše_šfo
;

422 
__u32
 
	mlše_šfo_út
;

426 
__®igÃd_u64
 
	m·thÇme
;

427 
__u32
 
	mbpf_fd
;

428 
__u32
 
	mfe_æags
;

432 
__u32
 
	mrg‘_fd
;

433 
__u32
 
	m©ch_bpf_fd
;

434 
__u32
 
	m©ch_ty³
;

435 
__u32
 
	m©ch_æags
;

439 
__u32
 
	m´og_fd
;

440 
__u32
 
	m»tv®
;

441 
__u32
 
	md©a_size_š
;

442 
__u32
 
	md©a_size_out
;

446 
__®igÃd_u64
 
	md©a_š
;

447 
__®igÃd_u64
 
	md©a_out
;

448 
__u32
 
	m»³©
;

449 
__u32
 
	mdu¿tiÚ
;

450 
__u32
 
	mùx_size_š
;

451 
__u32
 
	mùx_size_out
;

455 
__®igÃd_u64
 
	mùx_š
;

456 
__®igÃd_u64
 
	mùx_out
;

457 } 
	m‹¡
;

461 
__u32
 
	m¡¬t_id
;

462 
__u32
 
	m´og_id
;

463 
__u32
 
	mm­_id
;

464 
__u32
 
	mbtf_id
;

466 
__u32
 
	mÃxt_id
;

467 
__u32
 
	mİ’_æags
;

471 
__u32
 
	mbpf_fd
;

472 
__u32
 
	mšfo_Ën
;

473 
__®igÃd_u64
 
	mšfo
;

474 } 
	mšfo
;

477 
__u32
 
	mrg‘_fd
;

478 
__u32
 
	m©ch_ty³
;

479 
__u32
 
	mqu”y_æags
;

480 
__u32
 
	m©ch_æags
;

481 
__®igÃd_u64
 
	m´og_ids
;

482 
__u32
 
	m´og_út
;

483 } 
	mqu”y
;

486 
__u64
 
	mÇme
;

487 
__u32
 
	m´og_fd
;

488 } 
	m¿w_Œaûpošt
;

491 
__®igÃd_u64
 
	mbtf
;

492 
__®igÃd_u64
 
	mbtf_log_buf
;

493 
__u32
 
	mbtf_size
;

494 
__u32
 
	mbtf_log_size
;

495 
__u32
 
	mbtf_log_Ëv–
;

499 
__u32
 
	mpid
;

500 
__u32
 
	mfd
;

501 
__u32
 
	mæags
;

502 
__u32
 
	mbuf_Ën
;

503 
__®igÃd_u64
 
	mbuf
;

508 
__u32
 
	m´og_id
;

509 
__u32
 
	mfd_ty³
;

510 
__u64
 
	m´obe_off£t
;

511 
__u64
 
	m´obe_addr
;

512 } 
	msk_fd_qu”y
;

513 } 
__©Œibu‹__
((
®igÃd
(8)));

2754 
	#__BPF_FUNC_MAPPER
(
FN
) \

2755 
	`FN
(
un¥ec
), \

2756 
	`FN
(
m­_lookup_–em
), \

2757 
	`FN
(
m­_upd©e_–em
), \

2758 
	`FN
(
m­_d–‘e_–em
), \

2759 
	`FN
(
´obe_»ad
), \

2760 
	`FN
(
ktime_g‘_ns
), \

2761 
	`FN
(
Œaû_´štk
), \

2762 
	`FN
(
g‘_´ªdom_u32
), \

2763 
	`FN
(
g‘_smp_´oûssÜ_id
), \

2764 
	`FN
(
skb_¡Üe_by‹s
), \

2765 
	`FN
(
l3_csum_»¶aû
), \

2766 
	`FN
(
l4_csum_»¶aû
), \

2767 
	`FN
(
_ÿÎ
), \

2768 
	`FN
(
şÚe_»dœeù
), \

2769 
	`FN
(
g‘_cu¼’t_pid_tgid
), \

2770 
	`FN
(
g‘_cu¼’t_uid_gid
), \

2771 
	`FN
(
g‘_cu¼’t_comm
), \

2772 
	`FN
(
g‘_cgroup_şassid
), \

2773 
	`FN
(
skb_vÏn_push
), \

2774 
	`FN
(
skb_vÏn_pİ
), \

2775 
	`FN
(
skb_g‘_tuÂ–_key
), \

2776 
	`FN
(
skb_£t_tuÂ–_key
), \

2777 
	`FN
(
³rf_ev’t_»ad
), \

2778 
	`FN
(
»dœeù
), \

2779 
	`FN
(
g‘_rou‹_»®m
), \

2780 
	`FN
(
³rf_ev’t_ouut
), \

2781 
	`FN
(
skb_lßd_by‹s
), \

2782 
	`FN
(
g‘_¡ackid
), \

2783 
	`FN
(
csum_diff
), \

2784 
	`FN
(
skb_g‘_tuÂ–_İt
), \

2785 
	`FN
(
skb_£t_tuÂ–_İt
), \

2786 
	`FN
(
skb_chªge_´Ùo
), \

2787 
	`FN
(
skb_chªge_ty³
), \

2788 
	`FN
(
skb_und”_cgroup
), \

2789 
	`FN
(
g‘_hash_»ÿlc
), \

2790 
	`FN
(
g‘_cu¼’t_sk
), \

2791 
	`FN
(
´obe_wr™e_u£r
), \

2792 
	`FN
(
cu¼’t_sk_und”_cgroup
), \

2793 
	`FN
(
skb_chªge_
), \

2794 
	`FN
(
skb_puÎ_d©a
), \

2795 
	`FN
(
csum_upd©e
), \

2796 
	`FN
(
£t_hash_šv®id
), \

2797 
	`FN
(
g‘_numa_node_id
), \

2798 
	`FN
(
skb_chªge_h—d
), \

2799 
	`FN
(
xdp_adju¡_h—d
), \

2800 
	`FN
(
´obe_»ad_¡r
), \

2801 
	`FN
(
g‘_sock‘_cook›
), \

2802 
	`FN
(
g‘_sock‘_uid
), \

2803 
	`FN
(
£t_hash
), \

2804 
	`FN
(
£tsockİt
), \

2805 
	`FN
(
skb_adju¡_room
), \

2806 
	`FN
(
»dœeù_m­
), \

2807 
	`FN
(
sk_»dœeù_m­
), \

2808 
	`FN
(
sock_m­_upd©e
), \

2809 
	`FN
(
xdp_adju¡_m‘a
), \

2810 
	`FN
(
³rf_ev’t_»ad_v®ue
), \

2811 
	`FN
(
³rf_´og_»ad_v®ue
), \

2812 
	`FN
(
g‘sockİt
), \

2813 
	`FN
(
ov”ride_»tuº
), \

2814 
	`FN
(
sock_İs_cb_æags_£t
), \

2815 
	`FN
(
msg_»dœeù_m­
), \

2816 
	`FN
(
msg_­¶y_by‹s
), \

2817 
	`FN
(
msg_cÜk_by‹s
), \

2818 
	`FN
(
msg_puÎ_d©a
), \

2819 
	`FN
(
bšd
), \

2820 
	`FN
(
xdp_adju¡_
), \

2821 
	`FN
(
skb_g‘_xäm_¡©e
), \

2822 
	`FN
(
g‘_¡ack
), \

2823 
	`FN
(
skb_lßd_by‹s_»Ïtive
), \

2824 
	`FN
(
fib_lookup
), \

2825 
	`FN
(
sock_hash_upd©e
), \

2826 
	`FN
(
msg_»dœeù_hash
), \

2827 
	`FN
(
sk_»dœeù_hash
), \

2828 
	`FN
(
lwt_push_’ÿp
), \

2829 
	`FN
(
lwt_£g6_¡Üe_by‹s
), \

2830 
	`FN
(
lwt_£g6_adju¡_¤h
), \

2831 
	`FN
(
lwt_£g6_aùiÚ
), \

2832 
	`FN
(
rc_»³©
), \

2833 
	`FN
(
rc_keydown
), \

2834 
	`FN
(
skb_cgroup_id
), \

2835 
	`FN
(
g‘_cu¼’t_cgroup_id
), \

2836 
	`FN
(
g‘_loÿl_¡Üage
), \

2837 
	`FN
(
sk_£Ëù_»u£pÜt
), \

2838 
	`FN
(
skb_ªû¡Ü_cgroup_id
), \

2839 
	`FN
(
sk_lookup_tı
), \

2840 
	`FN
(
sk_lookup_udp
), \

2841 
	`FN
(
sk_»Ëa£
), \

2842 
	`FN
(
m­_push_–em
), \

2843 
	`FN
(
m­_pİ_–em
), \

2844 
	`FN
(
m­_³ek_–em
), \

2845 
	`FN
(
msg_push_d©a
), \

2846 
	`FN
(
msg_pİ_d©a
), \

2847 
	`FN
(
rc_poš‹r_»l
), \

2848 
	`FN
(
¥š_lock
), \

2849 
	`FN
(
¥š_uÆock
), \

2850 
	`FN
(
sk_fuÎsock
), \

2851 
	`FN
(
tı_sock
), \

2852 
	`FN
(
skb_eú_£t_û
), \

2853 
	`FN
(
g‘_li¡’”_sock
), \

2854 
	`FN
(
skc_lookup_tı
), \

2855 
	`FN
(
tı_check_syncook›
), \

2856 
	`FN
(
sysùl_g‘_Çme
), \

2857 
	`FN
(
sysùl_g‘_cu¼’t_v®ue
), \

2858 
	`FN
(
sysùl_g‘_Ãw_v®ue
), \

2859 
	`FN
(
sysùl_£t_Ãw_v®ue
), \

2860 
	`FN
(
¡¹Ş
), \

2861 
	`FN
(
¡¹oul
), \

2862 
	`FN
(
sk_¡Üage_g‘
), \

2863 
	`FN
(
sk_¡Üage_d–‘e
), \

2864 
	`FN
(
£nd_sigÇl
), \

2865 
	`FN
(
tı_g’_syncook›
),

	)

2870 
	#__BPF_ENUM_FN
(
x
è
BPF_FUNC_
 ## 
	)
x

2871 
	ebpf_func_id
 {

2872 
__BPF_FUNC_MAPPER
(
__BPF_ENUM_FN
)

2873 
	m__BPF_FUNC_MAX_ID
,

2875 #undeà
__BPF_ENUM_FN


2880 
	#BPF_F_RECOMPUTE_CSUM
 (1ULL << 0)

	)

2881 
	#BPF_F_INVALIDATE_HASH
 (1ULL << 1)

	)

2886 
	#BPF_F_HDR_FIELD_MASK
 0xfULL

	)

2889 
	#BPF_F_PSEUDO_HDR
 (1ULL << 4)

	)

2890 
	#BPF_F_MARK_MANGLED_0
 (1ULL << 5)

	)

2891 
	#BPF_F_MARK_ENFORCE
 (1ULL << 6)

	)

2894 
	#BPF_F_INGRESS
 (1ULL << 0)

	)

2897 
	#BPF_F_TUNINFO_IPV6
 (1ULL << 0)

	)

2900 
	#BPF_F_SKIP_FIELD_MASK
 0xffULL

	)

2901 
	#BPF_F_USER_STACK
 (1ULL << 8)

	)

2903 
	#BPF_F_FAST_STACK_CMP
 (1ULL << 9)

	)

2904 
	#BPF_F_REUSE_STACKID
 (1ULL << 10)

	)

2906 
	#BPF_F_USER_BUILD_ID
 (1ULL << 11)

	)

2909 
	#BPF_F_ZERO_CSUM_TX
 (1ULL << 1)

	)

2910 
	#BPF_F_DONT_FRAGMENT
 (1ULL << 2)

	)

2911 
	#BPF_F_SEQ_NUMBER
 (1ULL << 3)

	)

2916 
	#BPF_F_INDEX_MASK
 0xffffffffULL

	)

2917 
	#BPF_F_CURRENT_CPU
 
BPF_F_INDEX_MASK


	)

2919 
	#BPF_F_CTXLEN_MASK
 (0xfffffULL << 32)

	)

2922 
	#BPF_F_CURRENT_NETNS
 (-1L)

	)

2925 
	#BPF_F_ADJ_ROOM_FIXED_GSO
 (1ULL << 0)

	)

2927 
	#BPF_ADJ_ROOM_ENCAP_L2_MASK
 0xff

	)

2928 
	#BPF_ADJ_ROOM_ENCAP_L2_SHIFT
 56

	)

2930 
	#BPF_F_ADJ_ROOM_ENCAP_L3_IPV4
 (1ULL << 1)

	)

2931 
	#BPF_F_ADJ_ROOM_ENCAP_L3_IPV6
 (1ULL << 2)

	)

2932 
	#BPF_F_ADJ_ROOM_ENCAP_L4_GRE
 (1ULL << 3)

	)

2933 
	#BPF_F_ADJ_ROOM_ENCAP_L4_UDP
 (1ULL << 4)

	)

2934 
	#BPF_F_ADJ_ROOM_ENCAP_L2
(
Ën
è(((
__u64
)len & \

2935 
BPF_ADJ_ROOM_ENCAP_L2_MASK
) \

2936 << 
BPF_ADJ_ROOM_ENCAP_L2_SHIFT
)

	)

2939 
	#BPF_F_SYSCTL_BASE_NAME
 (1ULL << 0)

	)

2942 
	#BPF_SK_STORAGE_GET_F_CREATE
 (1ULL << 0)

	)

2945 
	ebpf_adj_room_mode
 {

2946 
	mBPF_ADJ_ROOM_NET
,

2947 
	mBPF_ADJ_ROOM_MAC
,

2951 
	ebpf_hdr_¡¬t_off
 {

2952 
	mBPF_HDR_START_MAC
,

2953 
	mBPF_HDR_START_NET
,

2957 
	ebpf_lwt_’ÿp_mode
 {

2958 
	mBPF_LWT_ENCAP_SEG6
,

2959 
	mBPF_LWT_ENCAP_SEG6_INLINE
,

2960 
	mBPF_LWT_ENCAP_IP
,

2963 
	#__bpf_md_±r
(
ty³
, 
Çme
) \

2965 
ty³
 
Çme
; \

2966 
__u64
 :64; \

2967 } 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

2972 
	s__sk_buff
 {

2973 
__u32
 
	mËn
;

2974 
__u32
 
	mpkt_ty³
;

2975 
__u32
 
	mm¬k
;

2976 
__u32
 
	mqueue_m­pšg
;

2977 
__u32
 
	m´ÙocŞ
;

2978 
__u32
 
	mvÏn_´e£Á
;

2979 
__u32
 
	mvÏn_tci
;

2980 
__u32
 
	mvÏn_´Ùo
;

2981 
__u32
 
	m´iÜ™y
;

2982 
__u32
 
	mšg»ss_ifšdex
;

2983 
__u32
 
	mifšdex
;

2984 
__u32
 
	mtc_šdex
;

2985 
__u32
 
	mcb
[5];

2986 
__u32
 
	mhash
;

2987 
__u32
 
	mtc_şassid
;

2988 
__u32
 
	md©a
;

2989 
__u32
 
	md©a_’d
;

2990 
__u32
 
	mÇpi_id
;

2993 
__u32
 
	mçmy
;

2994 
__u32
 
	m»mÙe_4
;

2995 
__u32
 
	mloÿl_4
;

2996 
__u32
 
	m»mÙe_6
[4];

2997 
__u32
 
	mloÿl_6
[4];

2998 
__u32
 
	m»mÙe_pÜt
;

2999 
__u32
 
	mloÿl_pÜt
;

3002 
__u32
 
	md©a_m‘a
;

3003 
__bpf_md_±r
(
bpf_æow_keys
 *, 
æow_keys
);

3004 
__u64
 
	mt¡amp
;

3005 
__u32
 
	mwœe_Ën
;

3006 
__u32
 
	mgso_£gs
;

3007 
__bpf_md_±r
(
bpf_sock
 *, 
sk
);

3010 
	sbpf_tuÂ–_key
 {

3011 
__u32
 
	mtuÂ–_id
;

3013 
__u32
 
	m»mÙe_v4
;

3014 
__u32
 
	m»mÙe_v6
[4];

3016 
__u8
 
	mtuÂ–_tos
;

3017 
__u8
 
	mtuÂ–_‰l
;

3018 
__u16
 
	mtuÂ–_ext
;

3019 
__u32
 
	mtuÂ–_Ïb–
;

3025 
	sbpf_xäm_¡©e
 {

3026 
__u32
 
	m»qid
;

3027 
__u32
 
	m¥i
;

3028 
__u16
 
	mçmy
;

3029 
__u16
 
	mext
;

3031 
__u32
 
	m»mÙe_v4
;

3032 
__u32
 
	m»mÙe_v6
[4];

3043 
	ebpf_»t_code
 {

3044 
	mBPF_OK
 = 0,

3046 
	mBPF_DROP
 = 2,

3048 
	mBPF_REDIRECT
 = 7,

3057 
	mBPF_LWT_REROUTE
 = 128,

3060 
	sbpf_sock
 {

3061 
__u32
 
	mbound_dev_if
;

3062 
__u32
 
	mçmy
;

3063 
__u32
 
	mty³
;

3064 
__u32
 
	m´ÙocŞ
;

3065 
__u32
 
	mm¬k
;

3066 
__u32
 
	m´iÜ™y
;

3068 
__u32
 
	m¤c_4
;

3069 
__u32
 
	m¤c_6
[4];

3070 
__u32
 
	m¤c_pÜt
;

3071 
__be16
 
	md¡_pÜt
;

3072 
	m__u16
 :16;

3073 
__u32
 
	md¡_4
;

3074 
__u32
 
	md¡_6
[4];

3075 
__u32
 
	m¡©e
;

3078 
	sbpf_tı_sock
 {

3079 
__u32
 
	m¢d_cwnd
;

3080 
__u32
 
	m¤‰_us
;

3081 
__u32
 
	m¹t_mš
;

3082 
__u32
 
	m¢d_s¡h»sh
;

3083 
__u32
 
	mrcv_nxt
;

3084 
__u32
 
	m¢d_nxt
;

3085 
__u32
 
	m¢d_uÇ
;

3086 
__u32
 
	mmss_ÿche
;

3087 
__u32
 
	meú_æags
;

3088 
__u32
 
	m¿‹_d–iv”ed
;

3089 
__u32
 
	m¿‹_š‹rv®_us
;

3090 
__u32
 
	m·ck‘s_out
;

3091 
__u32
 
	m»Œªs_out
;

3092 
__u32
 
	mtÙ®_»Œªs
;

3093 
__u32
 
	m£gs_š
;

3096 
__u32
 
	md©a_£gs_š
;

3099 
__u32
 
	m£gs_out
;

3102 
__u32
 
	md©a_£gs_out
;

3105 
__u32
 
	mlo¡_out
;

3106 
__u32
 
	m§cked_out
;

3107 
__u64
 
	mby‹s_»ûived
;

3111 
__u64
 
	mby‹s_acked
;

3115 
__u32
 
	md§ck_dups
;

3118 
__u32
 
	md–iv”ed
;

3119 
__u32
 
	md–iv”ed_û
;

3120 
__u32
 
	micsk_»Œªsm™s
;

3123 
	sbpf_sock_tu¶e
 {

3126 
__be32
 
	m§ddr
;

3127 
__be32
 
	mdaddr
;

3128 
__be16
 
	m¥Üt
;

3129 
__be16
 
	mdpÜt
;

3130 } 
	mv4
;

3132 
__be32
 
	m§ddr
[4];

3133 
__be32
 
	mdaddr
[4];

3134 
__be16
 
	m¥Üt
;

3135 
__be16
 
	mdpÜt
;

3136 } 
	mv6
;

3140 
	sbpf_xdp_sock
 {

3141 
__u32
 
	mqueue_id
;

3144 
	#XDP_PACKET_HEADROOM
 256

	)

3151 
	exdp_aùiÚ
 {

3152 
	mXDP_ABORTED
 = 0,

3153 
	mXDP_DROP
,

3154 
	mXDP_PASS
,

3155 
	mXDP_TX
,

3156 
	mXDP_REDIRECT
,

3162 
	sxdp_md
 {

3163 
__u32
 
	md©a
;

3164 
__u32
 
	md©a_’d
;

3165 
__u32
 
	md©a_m‘a
;

3167 
__u32
 
	mšg»ss_ifšdex
;

3168 
__u32
 
	mrx_queue_šdex
;

3171 
	esk_aùiÚ
 {

3172 
	mSK_DROP
 = 0,

3173 
	mSK_PASS
,

3179 
	ssk_msg_md
 {

3180 
__bpf_md_±r
(*, 
d©a
);

3181 
__bpf_md_±r
(*, 
d©a_’d
);

3183 
__u32
 
	mçmy
;

3184 
__u32
 
	m»mÙe_4
;

3185 
__u32
 
	mloÿl_4
;

3186 
__u32
 
	m»mÙe_6
[4];

3187 
__u32
 
	mloÿl_6
[4];

3188 
__u32
 
	m»mÙe_pÜt
;

3189 
__u32
 
	mloÿl_pÜt
;

3190 
__u32
 
	msize
;

3193 
	ssk_»u£pÜt_md
 {

3198 
__bpf_md_±r
(*, 
d©a
);

3200 
__bpf_md_±r
(*, 
d©a_’d
);

3207 
__u32
 
	mËn
;

3212 
__u32
 
	m‘h_´ÙocŞ
;

3213 
__u32
 
	m_´ÙocŞ
;

3214 
__u32
 
	mbšd_šªy
;

3215 
__u32
 
	mhash
;

3218 
	#BPF_TAG_SIZE
 8

	)

3220 
	sbpf_´og_šfo
 {

3221 
__u32
 
	mty³
;

3222 
__u32
 
	mid
;

3223 
__u8
 
	mg
[
BPF_TAG_SIZE
];

3224 
__u32
 
	mj™ed_´og_Ën
;

3225 
__u32
 
	mxÏ‹d_´og_Ën
;

3226 
__®igÃd_u64
 
	mj™ed_´og_š¢s
;

3227 
__®igÃd_u64
 
	mxÏ‹d_´og_š¢s
;

3228 
__u64
 
	mlßd_time
;

3229 
__u32
 
	mü—‹d_by_uid
;

3230 
__u32
 
	mÄ_m­_ids
;

3231 
__®igÃd_u64
 
	mm­_ids
;

3232 
	mÇme
[
BPF_OBJ_NAME_LEN
];

3233 
__u32
 
	mifšdex
;

3234 
__u32
 
	mg¶_com·tibË
:1;

3235 
	m__u32
 :31;

3236 
__u64
 
	mÃŠs_dev
;

3237 
__u64
 
	mÃŠs_šo
;

3238 
__u32
 
	mÄ_j™ed_ksyms
;

3239 
__u32
 
	mÄ_j™ed_func_Ëns
;

3240 
__®igÃd_u64
 
	mj™ed_ksyms
;

3241 
__®igÃd_u64
 
	mj™ed_func_Ëns
;

3242 
__u32
 
	mbtf_id
;

3243 
__u32
 
	mfunc_šfo_»c_size
;

3244 
__®igÃd_u64
 
	mfunc_šfo
;

3245 
__u32
 
	mÄ_func_šfo
;

3246 
__u32
 
	mÄ_lše_šfo
;

3247 
__®igÃd_u64
 
	mlše_šfo
;

3248 
__®igÃd_u64
 
	mj™ed_lše_šfo
;

3249 
__u32
 
	mÄ_j™ed_lše_šfo
;

3250 
__u32
 
	mlše_šfo_»c_size
;

3251 
__u32
 
	mj™ed_lše_šfo_»c_size
;

3252 
__u32
 
	mÄ_´og_gs
;

3253 
__®igÃd_u64
 
	m´og_gs
;

3254 
__u64
 
	mrun_time_ns
;

3255 
__u64
 
	mrun_út
;

3256 } 
__©Œibu‹__
((
®igÃd
(8)));

3258 
	sbpf_m­_šfo
 {

3259 
__u32
 
	mty³
;

3260 
__u32
 
	mid
;

3261 
__u32
 
	mkey_size
;

3262 
__u32
 
	mv®ue_size
;

3263 
__u32
 
	mmax_’Œ›s
;

3264 
__u32
 
	mm­_æags
;

3265 
	mÇme
[
BPF_OBJ_NAME_LEN
];

3266 
__u32
 
	mifšdex
;

3267 
	m__u32
 :32;

3268 
__u64
 
	mÃŠs_dev
;

3269 
__u64
 
	mÃŠs_šo
;

3270 
__u32
 
	mbtf_id
;

3271 
__u32
 
	mbtf_key_ty³_id
;

3272 
__u32
 
	mbtf_v®ue_ty³_id
;

3273 } 
__©Œibu‹__
((
®igÃd
(8)));

3275 
	sbpf_btf_šfo
 {

3276 
__®igÃd_u64
 
	mbtf
;

3277 
__u32
 
	mbtf_size
;

3278 
__u32
 
	mid
;

3279 } 
__©Œibu‹__
((
®igÃd
(8)));

3285 
	sbpf_sock_addr
 {

3286 
__u32
 
	mu£r_çmy
;

3287 
__u32
 
	mu£r_4
;

3290 
__u32
 
	mu£r_6
[4];

3293 
__u32
 
	mu£r_pÜt
;

3296 
__u32
 
	mçmy
;

3297 
__u32
 
	mty³
;

3298 
__u32
 
	m´ÙocŞ
;

3299 
__u32
 
	mmsg_¤c_4
;

3302 
__u32
 
	mmsg_¤c_6
[4];

3305 
__bpf_md_±r
(
bpf_sock
 *, 
sk
);

3314 
	sbpf_sock_İs
 {

3315 
__u32
 
	mİ
;

3317 
__u32
 
	m¬gs
[4];

3318 
__u32
 
	m»¶y
;

3319 
__u32
 
	m»¶ylÚg
[4];

3321 
__u32
 
	mçmy
;

3322 
__u32
 
	m»mÙe_4
;

3323 
__u32
 
	mloÿl_4
;

3324 
__u32
 
	m»mÙe_6
[4];

3325 
__u32
 
	mloÿl_6
[4];

3326 
__u32
 
	m»mÙe_pÜt
;

3327 
__u32
 
	mloÿl_pÜt
;

3328 
__u32
 
	mis_fuÎsock
;

3332 
__u32
 
	m¢d_cwnd
;

3333 
__u32
 
	m¤‰_us
;

3334 
__u32
 
	mbpf_sock_İs_cb_æags
;

3335 
__u32
 
	m¡©e
;

3336 
__u32
 
	m¹t_mš
;

3337 
__u32
 
	m¢d_s¡h»sh
;

3338 
__u32
 
	mrcv_nxt
;

3339 
__u32
 
	m¢d_nxt
;

3340 
__u32
 
	m¢d_uÇ
;

3341 
__u32
 
	mmss_ÿche
;

3342 
__u32
 
	meú_æags
;

3343 
__u32
 
	m¿‹_d–iv”ed
;

3344 
__u32
 
	m¿‹_š‹rv®_us
;

3345 
__u32
 
	m·ck‘s_out
;

3346 
__u32
 
	m»Œªs_out
;

3347 
__u32
 
	mtÙ®_»Œªs
;

3348 
__u32
 
	m£gs_š
;

3349 
__u32
 
	md©a_£gs_š
;

3350 
__u32
 
	m£gs_out
;

3351 
__u32
 
	md©a_£gs_out
;

3352 
__u32
 
	mlo¡_out
;

3353 
__u32
 
	m§cked_out
;

3354 
__u32
 
	msk_txhash
;

3355 
__u64
 
	mby‹s_»ûived
;

3356 
__u64
 
	mby‹s_acked
;

3357 
__bpf_md_±r
(
bpf_sock
 *, 
sk
);

3361 
	#BPF_SOCK_OPS_RTO_CB_FLAG
 (1<<0)

	)

3362 
	#BPF_SOCK_OPS_RETRANS_CB_FLAG
 (1<<1)

	)

3363 
	#BPF_SOCK_OPS_STATE_CB_FLAG
 (1<<2)

	)

3364 
	#BPF_SOCK_OPS_RTT_CB_FLAG
 (1<<3)

	)

3365 
	#BPF_SOCK_OPS_ALL_CB_FLAGS
 0xF

	)

3373 
	mBPF_SOCK_OPS_VOID
,

3374 
	mBPF_SOCK_OPS_TIMEOUT_INIT
,

3377 
	mBPF_SOCK_OPS_RWND_INIT
,

3381 
	mBPF_SOCK_OPS_TCP_CONNECT_CB
,

3384 
	mBPF_SOCK_OPS_ACTIVE_ESTABLISHED_CB
,

3388 
	mBPF_SOCK_OPS_PASSIVE_ESTABLISHED_CB
,

3392 
	mBPF_SOCK_OPS_NEEDS_ECN
,

3395 
	mBPF_SOCK_OPS_BASE_RTT
,

3402 
	mBPF_SOCK_OPS_RTO_CB
,

3407 
	mBPF_SOCK_OPS_RETRANS_CB
,

3413 
	mBPF_SOCK_OPS_STATE_CB
,

3417 
	mBPF_SOCK_OPS_TCP_LISTEN_CB
,

3420 
	mBPF_SOCK_OPS_RTT_CB
,

3430 
	mBPF_TCP_ESTABLISHED
 = 1,

3431 
	mBPF_TCP_SYN_SENT
,

3432 
	mBPF_TCP_SYN_RECV
,

3433 
	mBPF_TCP_FIN_WAIT1
,

3434 
	mBPF_TCP_FIN_WAIT2
,

3435 
	mBPF_TCP_TIME_WAIT
,

3436 
	mBPF_TCP_CLOSE
,

3437 
	mBPF_TCP_CLOSE_WAIT
,

3438 
	mBPF_TCP_LAST_ACK
,

3439 
	mBPF_TCP_LISTEN
,

3440 
	mBPF_TCP_CLOSING
,

3441 
	mBPF_TCP_NEW_SYN_RECV
,

3443 
	mBPF_TCP_MAX_STATES


3446 
	#TCP_BPF_IW
 1001

	)

3447 
	#TCP_BPF_SNDCWND_CLAMP
 1002

	)

3449 
	sbpf_³rf_ev’t_v®ue
 {

3450 
__u64
 
	mcouÁ”
;

3451 
__u64
 
	m’abËd
;

3452 
__u64
 
	mruÂšg
;

3455 
	#BPF_DEVCG_ACC_MKNOD
 (1ULL << 0)

	)

3456 
	#BPF_DEVCG_ACC_READ
 (1ULL << 1)

	)

3457 
	#BPF_DEVCG_ACC_WRITE
 (1ULL << 2)

	)

3459 
	#BPF_DEVCG_DEV_BLOCK
 (1ULL << 0)

	)

3460 
	#BPF_DEVCG_DEV_CHAR
 (1ULL << 1)

	)

3462 
	sbpf_cgroup_dev_ùx
 {

3464 
__u32
 
	macûss_ty³
;

3465 
__u32
 
	mmajÜ
;

3466 
__u32
 
	mmšÜ
;

3469 
	sbpf_¿w_Œaûpošt_¬gs
 {

3470 
__u64
 
	m¬gs
[0];

3476 
	#BPF_FIB_LOOKUP_DIRECT
 (1U << 0)

	)

3477 
	#BPF_FIB_LOOKUP_OUTPUT
 (1U << 1)

	)

3480 
	mBPF_FIB_LKUP_RET_SUCCESS
,

3481 
	mBPF_FIB_LKUP_RET_BLACKHOLE
,

3482 
	mBPF_FIB_LKUP_RET_UNREACHABLE
,

3483 
	mBPF_FIB_LKUP_RET_PROHIBIT
,

3484 
	mBPF_FIB_LKUP_RET_NOT_FWDED
,

3485 
	mBPF_FIB_LKUP_RET_FWD_DISABLED
,

3486 
	mBPF_FIB_LKUP_RET_UNSUPP_LWT
,

3487 
	mBPF_FIB_LKUP_RET_NO_NEIGH
,

3488 
	mBPF_FIB_LKUP_RET_FRAG_NEEDED
,

3491 
	sbpf_fib_lookup
 {

3495 
__u8
 
	mçmy
;

3498 
__u8
 
	ml4_´ÙocŞ
;

3499 
__be16
 
	m¥Üt
;

3500 
__be16
 
	mdpÜt
;

3503 
__u16
 
	mtÙ_Ën
;

3508 
__u32
 
	mifšdex
;

3512 
__u8
 
	mtos
;

3513 
__be32
 
	mæowšfo
;

3516 
__u32
 
	m¹_m‘ric
;

3520 
__be32
 
	mv4_¤c
;

3521 
__u32
 
	mv6_¤c
[4];

3529 
__be32
 
	mv4_d¡
;

3530 
__u32
 
	mv6_d¡
[4];

3534 
__be16
 
	mh_vÏn_´Ùo
;

3535 
__be16
 
	mh_vÏn_TCI
;

3536 
__u8
 
	msmac
[6];

3537 
__u8
 
	mdmac
[6];

3540 
	ebpf_sk_fd_ty³
 {

3541 
	mBPF_FD_TYPE_RAW_TRACEPOINT
,

3542 
	mBPF_FD_TYPE_TRACEPOINT
,

3543 
	mBPF_FD_TYPE_KPROBE
,

3544 
	mBPF_FD_TYPE_KRETPROBE
,

3545 
	mBPF_FD_TYPE_UPROBE
,

3546 
	mBPF_FD_TYPE_URETPROBE
,

3549 
	#BPF_FLOW_DISSECTOR_F_PARSE_1ST_FRAG
 (1U << 0)

	)

3550 
	#BPF_FLOW_DISSECTOR_F_STOP_AT_FLOW_LABEL
 (1U << 1)

	)

3551 
	#BPF_FLOW_DISSECTOR_F_STOP_AT_ENCAP
 (1U << 2)

	)

3553 
	sbpf_æow_keys
 {

3554 
__u16
 
	mnhoff
;

3555 
__u16
 
	mthoff
;

3556 
__u16
 
	maddr_´Ùo
;

3557 
__u8
 
	mis_äag
;

3558 
__u8
 
	mis_fœ¡_äag
;

3559 
__u8
 
	mis_’ÿp
;

3560 
__u8
 
	m_´Ùo
;

3561 
__be16
 
	mn_´Ùo
;

3562 
__be16
 
	m¥Üt
;

3563 
__be16
 
	mdpÜt
;

3566 
__be32
 
	mv4_¤c
;

3567 
__be32
 
	mv4_d¡
;

3570 
__u32
 
	mv6_¤c
[4];

3571 
__u32
 
	mv6_d¡
[4];

3574 
__u32
 
	mæags
;

3575 
__be32
 
	mæow_Ïb–
;

3578 
	sbpf_func_šfo
 {

3579 
__u32
 
	mš¢_off
;

3580 
__u32
 
	mty³_id
;

3583 
	#BPF_LINE_INFO_LINE_NUM
(
lše_cŞ
è(Öše_cŞè>> 10)

	)

3584 
	#BPF_LINE_INFO_LINE_COL
(
lše_cŞ
è(Öše_cŞè& 0x3ff)

	)

3586 
	sbpf_lše_šfo
 {

3587 
__u32
 
	mš¢_off
;

3588 
__u32
 
	mfe_Çme_off
;

3589 
__u32
 
	mlše_off
;

3590 
__u32
 
	mlše_cŞ
;

3593 
	sbpf_¥š_lock
 {

3594 
__u32
 
	mv®
;

3597 
	sbpf_sysùl
 {

3598 
__u32
 
	mwr™e
;

3601 
__u32
 
	mfe_pos
;

3606 
	sbpf_sockİt
 {

3607 
__bpf_md_±r
(
bpf_sock
 *, 
sk
);

3608 
__bpf_md_±r
(*, 
İtv®
);

3609 
__bpf_md_±r
(*, 
İtv®_’d
);

3611 
__s32
 
	mËv–
;

3612 
__s32
 
	mİŠame
;

3613 
__s32
 
	mİ’
;

3614 
__s32
 
	m»tv®
;

	@/usr/include/linux/ethtool.h

14 #iâdeà
_LINUX_ETHTOOL_H


15 
	#_LINUX_ETHTOOL_H


	)

17 
	~<lšux/cÚ¡.h
>

18 
	~<lšux/ty³s.h
>

19 
	~<lšux/if_‘h”.h
>

21 
	~<lim™s.h
>

94 
	s‘htoŞ_cmd
 {

95 
__u32
 
	mcmd
;

96 
__u32
 
	msuµÜ‹d
;

97 
__u32
 
	madv”tisšg
;

98 
__u16
 
	m¥“d
;

99 
__u8
 
	mdu¶ex
;

100 
__u8
 
	mpÜt
;

101 
__u8
 
	mphy_add»ss
;

102 
__u8
 
	mŒªsûiv”
;

103 
__u8
 
	mautÚeg
;

104 
__u8
 
	mmdio_suµÜt
;

105 
__u32
 
	mmaxtxpkt
;

106 
__u32
 
	mmaxrxpkt
;

107 
__u16
 
	m¥“d_hi
;

108 
__u8
 
	m‘h__mdix
;

109 
__u8
 
	m‘h__mdix_ù¾
;

110 
__u32
 
	mÍ_adv”tisšg
;

111 
__u32
 
	m»£rved
[2];

114 
__šlše__
 
	$‘htoŞ_cmd_¥“d_£t
(
‘htoŞ_cmd
 *
•
,

115 
__u32
 
¥“d
)

117 
•
->
¥“d
 = (
__u16
)(speed & 0xFFFF);

118 
•
->
¥“d_hi
 = (
__u16
)(
¥“d
 >> 16);

119 
	}
}

121 
__šlše__
 
__u32
 
	$‘htoŞ_cmd_¥“d
(cÚ¡ 
‘htoŞ_cmd
 *
•
)

123  (
•
->
¥“d_hi
 << 16è|ƒp->
¥“d
;

124 
	}
}

131 
	#ETH_MDIO_SUPPORTS_C22
 1

	)

138 
	#ETH_MDIO_SUPPORTS_C45
 2

	)

140 
	#ETHTOOL_FWVERS_LEN
 32

	)

141 
	#ETHTOOL_BUSINFO_LEN
 32

	)

142 
	#ETHTOOL_EROMVERS_LEN
 32

	)

175 
	s‘htoŞ_drvšfo
 {

176 
__u32
 
	mcmd
;

177 
	mdriv”
[32];

178 
	mv”siÚ
[32];

179 
	mfw_v”siÚ
[
ETHTOOL_FWVERS_LEN
];

180 
	mbus_šfo
[
ETHTOOL_BUSINFO_LEN
];

181 
	m”om_v”siÚ
[
ETHTOOL_EROMVERS_LEN
];

182 
	m»£rved2
[12];

183 
__u32
 
	mn_´iv_æags
;

184 
__u32
 
	mn_¡©s
;

185 
__u32
 
	m‹¡šfo_Ën
;

186 
__u32
 
	m“dump_Ën
;

187 
__u32
 
	m»gdump_Ën
;

190 
	#SOPASS_MAX
 6

	)

201 
	s‘htoŞ_wŞšfo
 {

202 
__u32
 
	mcmd
;

203 
__u32
 
	msuµÜ‹d
;

204 
__u32
 
	mwŞİts
;

205 
__u8
 
	msİass
[
SOPASS_MAX
];

209 
	s‘htoŞ_v®ue
 {

210 
__u32
 
	mcmd
;

211 
__u32
 
	md©a
;

214 
	#PFC_STORM_PREVENTION_AUTO
 0xffff

	)

215 
	#PFC_STORM_PREVENTION_DISABLE
 0

	)

217 
	etuÇbË_id
 {

218 
	mETHTOOL_ID_UNSPEC
,

219 
	mETHTOOL_RX_COPYBREAK
,

220 
	mETHTOOL_TX_COPYBREAK
,

221 
	mETHTOOL_PFC_PREVENTION_TOUT
,

226 
	m__ETHTOOL_TUNABLE_COUNT
,

229 
	etuÇbË_ty³_id
 {

230 
	mETHTOOL_TUNABLE_UNSPEC
,

231 
	mETHTOOL_TUNABLE_U8
,

232 
	mETHTOOL_TUNABLE_U16
,

233 
	mETHTOOL_TUNABLE_U32
,

234 
	mETHTOOL_TUNABLE_U64
,

235 
	mETHTOOL_TUNABLE_STRING
,

236 
	mETHTOOL_TUNABLE_S8
,

237 
	mETHTOOL_TUNABLE_S16
,

238 
	mETHTOOL_TUNABLE_S32
,

239 
	mETHTOOL_TUNABLE_S64
,

242 
	s‘htoŞ_tuÇbË
 {

243 
__u32
 
	mcmd
;

244 
__u32
 
	mid
;

245 
__u32
 
	mty³_id
;

246 
__u32
 
	mËn
;

247 *
	md©a
[0];

250 
	#DOWNSHIFT_DEV_DEFAULT_COUNT
 0xff

	)

251 
	#DOWNSHIFT_DEV_DISABLE
 0

	)

257 
	#ETHTOOL_PHY_FAST_LINK_DOWN_ON
 0

	)

258 
	#ETHTOOL_PHY_FAST_LINK_DOWN_OFF
 0xff

	)

277 
	#ETHTOOL_PHY_EDPD_DFLT_TX_MSECS
 0xffff

	)

278 
	#ETHTOOL_PHY_EDPD_NO_TX
 0xffã

	)

279 
	#ETHTOOL_PHY_EDPD_DISABLE
 0

	)

281 
	ephy_tuÇbË_id
 {

282 
	mETHTOOL_PHY_ID_UNSPEC
,

283 
	mETHTOOL_PHY_DOWNSHIFT
,

284 
	mETHTOOL_PHY_FAST_LINK_DOWN
,

285 
	mETHTOOL_PHY_EDPD
,

290 
	m__ETHTOOL_PHY_TUNABLE_COUNT
,

308 
	s‘htoŞ_»gs
 {

309 
__u32
 
	mcmd
;

310 
__u32
 
	mv”siÚ
;

311 
__u32
 
	mËn
;

312 
__u8
 
	md©a
[0];

333 
	s‘htoŞ_“´om
 {

334 
__u32
 
	mcmd
;

335 
__u32
 
	mmagic
;

336 
__u32
 
	moff£t
;

337 
__u32
 
	mËn
;

338 
__u8
 
	md©a
[0];

358 
	s‘htoŞ_“e
 {

359 
__u32
 
	mcmd
;

360 
__u32
 
	msuµÜ‹d
;

361 
__u32
 
	madv”ti£d
;

362 
__u32
 
	mÍ_adv”ti£d
;

363 
__u32
 
	m“e_aùive
;

364 
__u32
 
	m“e_’abËd
;

365 
__u32
 
	mtx_Íi_’abËd
;

366 
__u32
 
	mtx_Íi_tim”
;

367 
__u32
 
	m»£rved
[2];

380 
	s‘htoŞ_modšfo
 {

381 
__u32
 
	mcmd
;

382 
__u32
 
	mty³
;

383 
__u32
 
	m“´om_Ën
;

384 
__u32
 
	m»£rved
[8];

460 
	s‘htoŞ_cßËsû
 {

461 
__u32
 
	mcmd
;

462 
__u32
 
	mrx_cßËsû_u£cs
;

463 
__u32
 
	mrx_max_cßËsûd_äames
;

464 
__u32
 
	mrx_cßËsû_u£cs_œq
;

465 
__u32
 
	mrx_max_cßËsûd_äames_œq
;

466 
__u32
 
	mtx_cßËsû_u£cs
;

467 
__u32
 
	mtx_max_cßËsûd_äames
;

468 
__u32
 
	mtx_cßËsû_u£cs_œq
;

469 
__u32
 
	mtx_max_cßËsûd_äames_œq
;

470 
__u32
 
	m¡©s_block_cßËsû_u£cs
;

471 
__u32
 
	mu£_ad­tive_rx_cßËsû
;

472 
__u32
 
	mu£_ad­tive_tx_cßËsû
;

473 
__u32
 
	mpkt_¿‹_low
;

474 
__u32
 
	mrx_cßËsû_u£cs_low
;

475 
__u32
 
	mrx_max_cßËsûd_äames_low
;

476 
__u32
 
	mtx_cßËsû_u£cs_low
;

477 
__u32
 
	mtx_max_cßËsûd_äames_low
;

478 
__u32
 
	mpkt_¿‹_high
;

479 
__u32
 
	mrx_cßËsû_u£cs_high
;

480 
__u32
 
	mrx_max_cßËsûd_äames_high
;

481 
__u32
 
	mtx_cßËsû_u£cs_high
;

482 
__u32
 
	mtx_max_cßËsûd_äames_high
;

483 
__u32
 
	m¿‹_§m¶e_š‹rv®
;

511 
	s‘htoŞ_ršg·¿m
 {

512 
__u32
 
	mcmd
;

513 
__u32
 
	mrx_max_³ndšg
;

514 
__u32
 
	mrx_mši_max_³ndšg
;

515 
__u32
 
	mrx_jumbo_max_³ndšg
;

516 
__u32
 
	mtx_max_³ndšg
;

517 
__u32
 
	mrx_³ndšg
;

518 
__u32
 
	mrx_mši_³ndšg
;

519 
__u32
 
	mrx_jumbo_³ndšg
;

520 
__u32
 
	mtx_³ndšg
;

539 
	s‘htoŞ_chªÃls
 {

540 
__u32
 
	mcmd
;

541 
__u32
 
	mmax_rx
;

542 
__u32
 
	mmax_tx
;

543 
__u32
 
	mmax_Ùh”
;

544 
__u32
 
	mmax_combšed
;

545 
__u32
 
	mrx_couÁ
;

546 
__u32
 
	mtx_couÁ
;

547 
__u32
 
	mÙh”_couÁ
;

548 
__u32
 
	mcombšed_couÁ
;

573 
	s‘htoŞ_·u£·¿m
 {

574 
__u32
 
	mcmd
;

575 
__u32
 
	mautÚeg
;

576 
__u32
 
	mrx_·u£
;

577 
__u32
 
	mtx_·u£
;

580 
	#ETH_GSTRING_LEN
 32

	)

595 
	e‘htoŞ_¡ršg£t
 {

596 
	mETH_SS_TEST
 = 0,

597 
	mETH_SS_STATS
,

598 
	mETH_SS_PRIV_FLAGS
,

599 
	mETH_SS_NTUPLE_FILTERS
,

600 
	mETH_SS_FEATURES
,

601 
	mETH_SS_RSS_HASH_FUNCS
,

602 
	mETH_SS_TUNABLES
,

603 
	mETH_SS_PHY_STATS
,

604 
	mETH_SS_PHY_TUNABLES
,

619 
	s‘htoŞ_g¡ršgs
 {

620 
__u32
 
	mcmd
;

621 
__u32
 
	m¡ršg_£t
;

622 
__u32
 
	mËn
;

623 
__u8
 
	md©a
[0];

643 
	s‘htoŞ_s£t_šfo
 {

644 
__u32
 
	mcmd
;

645 
__u32
 
	m»£rved
;

646 
__u64
 
	ms£t_mask
;

647 
__u32
 
	md©a
[0];

660 
	e‘htoŞ_‹¡_æags
 {

661 
	mETH_TEST_FL_OFFLINE
 = (1 << 0),

662 
	mETH_TEST_FL_FAILED
 = (1 << 1),

663 
	mETH_TEST_FL_EXTERNAL_LB
 = (1 << 2),

664 
	mETH_TEST_FL_EXTERNAL_LB_DONE
 = (1 << 3),

681 
	s‘htoŞ_‹¡
 {

682 
__u32
 
	mcmd
;

683 
__u32
 
	mæags
;

684 
__u32
 
	m»£rved
;

685 
__u32
 
	mËn
;

686 
__u64
 
	md©a
[0];

700 
	s‘htoŞ_¡©s
 {

701 
__u32
 
	mcmd
;

702 
__u32
 
	mn_¡©s
;

703 
__u64
 
	md©a
[0];

717 
	s‘htoŞ_³rm_addr
 {

718 
__u32
 
	mcmd
;

719 
__u32
 
	msize
;

720 
__u8
 
	md©a
[0];

732 
	e‘htoŞ_æags
 {

733 
	mETH_FLAG_TXVLAN
 = (1 << 7),

734 
	mETH_FLAG_RXVLAN
 = (1 << 8),

735 
	mETH_FLAG_LRO
 = (1 << 15),

736 
	mETH_FLAG_NTUPLE
 = (1 << 27),

737 
	mETH_FLAG_RXHASH
 = (1 << 28),

756 
	s‘htoŞ_tı4_¥ec
 {

757 
__be32
 
	m4¤c
;

758 
__be32
 
	m4d¡
;

759 
__be16
 
	mp¤c
;

760 
__be16
 
	mpd¡
;

761 
__u8
 
	mtos
;

773 
	s‘htoŞ_ah_e¥4_¥ec
 {

774 
__be32
 
	m4¤c
;

775 
__be32
 
	m4d¡
;

776 
__be32
 
	m¥i
;

777 
__u8
 
	mtos
;

780 
	#ETH_RX_NFC_IP4
 1

	)

791 
	s‘htoŞ_u¤4_¥ec
 {

792 
__be32
 
	m4¤c
;

793 
__be32
 
	m4d¡
;

794 
__be32
 
	ml4_4_by‹s
;

795 
__u8
 
	mtos
;

796 
__u8
 
	m_v”
;

797 
__u8
 
	m´Ùo
;

810 
	s‘htoŞ_tı6_¥ec
 {

811 
__be32
 
	m6¤c
[4];

812 
__be32
 
	m6d¡
[4];

813 
__be16
 
	mp¤c
;

814 
__be16
 
	mpd¡
;

815 
__u8
 
	mtşass
;

827 
	s‘htoŞ_ah_e¥6_¥ec
 {

828 
__be32
 
	m6¤c
[4];

829 
__be32
 
	m6d¡
[4];

830 
__be32
 
	m¥i
;

831 
__u8
 
	mtşass
;

842 
	s‘htoŞ_u¤6_¥ec
 {

843 
__be32
 
	m6¤c
[4];

844 
__be32
 
	m6d¡
[4];

845 
__be32
 
	ml4_4_by‹s
;

846 
__u8
 
	mtşass
;

847 
__u8
 
	ml4_´Ùo
;

850 
	u‘htoŞ_æow_uniÚ
 {

851 
‘htoŞ_tı4_¥ec
 
	mtı_4_¥ec
;

852 
‘htoŞ_tı4_¥ec
 
	mudp_4_¥ec
;

853 
‘htoŞ_tı4_¥ec
 
	msùp_4_¥ec
;

854 
‘htoŞ_ah_e¥4_¥ec
 
	mah_4_¥ec
;

855 
‘htoŞ_ah_e¥4_¥ec
 
	me¥_4_¥ec
;

856 
‘htoŞ_u¤4_¥ec
 
	mu¤_4_¥ec
;

857 
‘htoŞ_tı6_¥ec
 
	mtı_6_¥ec
;

858 
‘htoŞ_tı6_¥ec
 
	mudp_6_¥ec
;

859 
‘htoŞ_tı6_¥ec
 
	msùp_6_¥ec
;

860 
‘htoŞ_ah_e¥6_¥ec
 
	mah_6_¥ec
;

861 
‘htoŞ_ah_e¥6_¥ec
 
	me¥_6_¥ec
;

862 
‘htoŞ_u¤6_¥ec
 
	mu¤_6_¥ec
;

863 
‘hhdr
 
	m‘h”_¥ec
;

864 
__u8
 
	mhd©a
[52];

878 
	s‘htoŞ_æow_ext
 {

879 
__u8
 
	m·ddšg
[2];

880 
	mh_de¡
[
ETH_ALEN
];

881 
__be16
 
	mvÏn_‘y³
;

882 
__be16
 
	mvÏn_tci
;

883 
__be32
 
	md©a
[2];

903 
	s‘htoŞ_rx_æow_¥ec
 {

904 
__u32
 
	mæow_ty³
;

905 
‘htoŞ_æow_uniÚ
 
	mh_u
;

906 
‘htoŞ_æow_ext
 
	mh_ext
;

907 
‘htoŞ_æow_uniÚ
 
	mm_u
;

908 
‘htoŞ_æow_ext
 
	mm_ext
;

909 
__u64
 
	mršg_cook›
;

910 
__u32
 
	mloÿtiÚ
;

924 
	#ETHTOOL_RX_FLOW_SPEC_RING
 0x00000000FFFFFFFFLL

	)

925 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF
 0x000000FF00000000LL

	)

926 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
 32

	)

927 
__šlše__
 
__u64
 
	$‘htoŞ_g‘_æow_¥ec_ršg
(
__u64
 
ršg_cook›
)

929  
ETHTOOL_RX_FLOW_SPEC_RING
 & 
ršg_cook›
;

930 
	}
}

932 
__šlše__
 
__u64
 
	$‘htoŞ_g‘_æow_¥ec_ršg_vf
(
__u64
 
ršg_cook›
)

934  (
ETHTOOL_RX_FLOW_SPEC_RING_VF
 & 
ršg_cook›
) >>

935 
ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
;

936 
	}
}

999 
	s‘htoŞ_rxnfc
 {

1000 
__u32
 
	mcmd
;

1001 
__u32
 
	mæow_ty³
;

1002 
__u64
 
	md©a
;

1003 
‘htoŞ_rx_æow_¥ec
 
	mfs
;

1005 
__u32
 
	mruË_út
;

1006 
__u32
 
	mrss_cÚ‹xt
;

1008 
__u32
 
	mruË_locs
[0];

1025 
	s‘htoŞ_rxfh_šdœ
 {

1026 
__u32
 
	mcmd
;

1027 
__u32
 
	msize
;

1028 
__u32
 
	mršg_šdex
[0];

1060 
	s‘htoŞ_rxfh
 {

1061 
__u32
 
	mcmd
;

1062 
__u32
 
	mrss_cÚ‹xt
;

1063 
__u32
 
	mšdœ_size
;

1064 
__u32
 
	mkey_size
;

1065 
__u8
 
	mhfunc
;

1066 
__u8
 
	mrsvd8
[3];

1067 
__u32
 
	mrsvd32
;

1068 
__u32
 
	mrss_cÚfig
[0];

1070 
	#ETH_RXFH_CONTEXT_ALLOC
 0xffffffff

	)

1071 
	#ETH_RXFH_INDIR_NO_CHANGE
 0xffffffff

	)

1089 
	s‘htoŞ_rx_Áu¶e_æow_¥ec
 {

1090 
__u32
 
	mæow_ty³
;

1092 
‘htoŞ_tı4_¥ec
 
	mtı_4_¥ec
;

1093 
‘htoŞ_tı4_¥ec
 
	mudp_4_¥ec
;

1094 
‘htoŞ_tı4_¥ec
 
	msùp_4_¥ec
;

1095 
‘htoŞ_ah_e¥4_¥ec
 
	mah_4_¥ec
;

1096 
‘htoŞ_ah_e¥4_¥ec
 
	me¥_4_¥ec
;

1097 
‘htoŞ_u¤4_¥ec
 
	mu¤_4_¥ec
;

1098 
‘hhdr
 
	m‘h”_¥ec
;

1099 
__u8
 
	mhd©a
[72];

1100 } 
	mh_u
, 
	mm_u
;

1102 
__u16
 
	mvÏn_g
;

1103 
__u16
 
	mvÏn_g_mask
;

1104 
__u64
 
	md©a
;

1105 
__u64
 
	md©a_mask
;

1107 
__s32
 
	maùiÚ
;

1108 
	#ETHTOOL_RXNTUPLE_ACTION_DROP
 (-1è

	)

1109 
	#ETHTOOL_RXNTUPLE_ACTION_CLEAR
 (-2è

	)

1117 
	s‘htoŞ_rx_Áu¶e
 {

1118 
__u32
 
	mcmd
;

1119 
‘htoŞ_rx_Áu¶e_æow_¥ec
 
	mfs
;

1122 
	#ETHTOOL_FLASH_MAX_FILENAME
 128

	)

1123 
	e‘htoŞ_æash_İ_ty³
 {

1124 
	mETHTOOL_FLASH_ALL_REGIONS
 = 0,

1128 
	s‘htoŞ_æash
 {

1129 
__u32
 
	mcmd
;

1130 
__u32
 
	m»giÚ
;

1131 
	md©a
[
ETHTOOL_FLASH_MAX_FILENAME
];

1148 
	s‘htoŞ_dump
 {

1149 
__u32
 
	mcmd
;

1150 
__u32
 
	mv”siÚ
;

1151 
__u32
 
	mæag
;

1152 
__u32
 
	mËn
;

1153 
__u8
 
	md©a
[0];

1156 
	#ETH_FW_DUMP_DISABLE
 0

	)

1167 
	s‘htoŞ_g‘_ã©u»s_block
 {

1168 
__u32
 
	mavaabË
;

1169 
__u32
 
	m»que¡ed
;

1170 
__u32
 
	maùive
;

1171 
__u32
 
	mÃv”_chªged
;

1182 
	s‘htoŞ_gã©u»s
 {

1183 
__u32
 
	mcmd
;

1184 
__u32
 
	msize
;

1185 
‘htoŞ_g‘_ã©u»s_block
 
	mã©u»s
[0];

1193 
	s‘htoŞ_£t_ã©u»s_block
 {

1194 
__u32
 
	mv®id
;

1195 
__u32
 
	m»que¡ed
;

1204 
	s‘htoŞ_sã©u»s
 {

1205 
__u32
 
	mcmd
;

1206 
__u32
 
	msize
;

1207 
‘htoŞ_£t_ã©u»s_block
 
	mã©u»s
[0];

1228 
	s‘htoŞ_ts_šfo
 {

1229 
__u32
 
	mcmd
;

1230 
__u32
 
	mso_time¡ampšg
;

1231 
__s32
 
	mphc_šdex
;

1232 
__u32
 
	mtx_ty³s
;

1233 
__u32
 
	mtx_»£rved
[3];

1234 
__u32
 
	mrx_f‹rs
;

1235 
__u32
 
	mrx_»£rved
[3];

1263 
	e‘htoŞ_sã©u»s_»tv®_b™s
 {

1264 
	mETHTOOL_F_UNSUPPORTED__BIT
,

1265 
	mETHTOOL_F_WISH__BIT
,

1266 
	mETHTOOL_F_COMPAT__BIT
,

1269 
	#ETHTOOL_F_UNSUPPORTED
 (1 << 
ETHTOOL_F_UNSUPPORTED__BIT
)

	)

1270 
	#ETHTOOL_F_WISH
 (1 << 
ETHTOOL_F_WISH__BIT
)

	)

1271 
	#ETHTOOL_F_COMPAT
 (1 << 
ETHTOOL_F_COMPAT__BIT
)

	)

1273 
	#MAX_NUM_QUEUE
 4096

	)

1282 
	s‘htoŞ_³r_queue_İ
 {

1283 
__u32
 
	mcmd
;

1284 
__u32
 
	msub_commªd
;

1285 
__u32
 
	mqueue_mask
[
__KERNEL_DIV_ROUND_UP
(
MAX_NUM_QUEUE
, 32)];

1286 
	md©a
[];

1300 
	s‘htoŞ_ãı¬am
 {

1301 
__u32
 
	mcmd
;

1303 
__u32
 
	maùive_ãc
;

1304 
__u32
 
	mãc
;

1305 
__u32
 
	m»£rved
;

1316 
	e‘htoŞ_ãc_cÚfig_b™s
 {

1317 
	mETHTOOL_FEC_NONE_BIT
,

1318 
	mETHTOOL_FEC_AUTO_BIT
,

1319 
	mETHTOOL_FEC_OFF_BIT
,

1320 
	mETHTOOL_FEC_RS_BIT
,

1321 
	mETHTOOL_FEC_BASER_BIT
,

1324 
	#ETHTOOL_FEC_NONE
 (1 << 
ETHTOOL_FEC_NONE_BIT
)

	)

1325 
	#ETHTOOL_FEC_AUTO
 (1 << 
ETHTOOL_FEC_AUTO_BIT
)

	)

1326 
	#ETHTOOL_FEC_OFF
 (1 << 
ETHTOOL_FEC_OFF_BIT
)

	)

1327 
	#ETHTOOL_FEC_RS
 (1 << 
ETHTOOL_FEC_RS_BIT
)

	)

1328 
	#ETHTOOL_FEC_BASER
 (1 << 
ETHTOOL_FEC_BASER_BIT
)

	)

1331 
	#ETHTOOL_GSET
 0x00000001

	)

1334 
	#ETHTOOL_SSET
 0x00000002

	)

1337 
	#ETHTOOL_GDRVINFO
 0x00000003

	)

1338 
	#ETHTOOL_GREGS
 0x00000004

	)

1339 
	#ETHTOOL_GWOL
 0x00000005

	)

1340 
	#ETHTOOL_SWOL
 0x00000006

	)

1341 
	#ETHTOOL_GMSGLVL
 0x00000007

	)

1342 
	#ETHTOOL_SMSGLVL
 0x00000008

	)

1343 
	#ETHTOOL_NWAY_RST
 0x00000009

	)

1346 
	#ETHTOOL_GLINK
 0x0000000a

	)

1347 
	#ETHTOOL_GEEPROM
 0x0000000b

	)

1348 
	#ETHTOOL_SEEPROM
 0x0000000ø

	)

1349 
	#ETHTOOL_GCOALESCE
 0x0000000

	)

1350 
	#ETHTOOL_SCOALESCE
 0x0000000à

	)

1351 
	#ETHTOOL_GRINGPARAM
 0x00000010

	)

1352 
	#ETHTOOL_SRINGPARAM
 0x00000011

	)

1353 
	#ETHTOOL_GPAUSEPARAM
 0x00000012

	)

1354 
	#ETHTOOL_SPAUSEPARAM
 0x00000013

	)

1355 
	#ETHTOOL_GRXCSUM
 0x00000014

	)

1356 
	#ETHTOOL_SRXCSUM
 0x00000015

	)

1357 
	#ETHTOOL_GTXCSUM
 0x00000016

	)

1358 
	#ETHTOOL_STXCSUM
 0x00000017

	)

1359 
	#ETHTOOL_GSG
 0x00000018

	)

1361 
	#ETHTOOL_SSG
 0x00000019

	)

1363 
	#ETHTOOL_TEST
 0x0000001¨

	)

1364 
	#ETHTOOL_GSTRINGS
 0x0000001b

	)

1365 
	#ETHTOOL_PHYS_ID
 0x0000001ø

	)

1366 
	#ETHTOOL_GSTATS
 0x0000001d

	)

1367 
	#ETHTOOL_GTSO
 0x0000001

	)

1368 
	#ETHTOOL_STSO
 0x0000001à

	)

1369 
	#ETHTOOL_GPERMADDR
 0x00000020

	)

1370 
	#ETHTOOL_GUFO
 0x00000021

	)

1371 
	#ETHTOOL_SUFO
 0x00000022

	)

1372 
	#ETHTOOL_GGSO
 0x00000023

	)

1373 
	#ETHTOOL_SGSO
 0x00000024

	)

1374 
	#ETHTOOL_GFLAGS
 0x00000025

	)

1375 
	#ETHTOOL_SFLAGS
 0x00000026

	)

1376 
	#ETHTOOL_GPFLAGS
 0x00000027

	)

1377 
	#ETHTOOL_SPFLAGS
 0x00000028

	)

1379 
	#ETHTOOL_GRXFH
 0x00000029

	)

1380 
	#ETHTOOL_SRXFH
 0x0000002¨

	)

1381 
	#ETHTOOL_GGRO
 0x0000002b

	)

1382 
	#ETHTOOL_SGRO
 0x0000002ø

	)

1383 
	#ETHTOOL_GRXRINGS
 0x0000002d

	)

1384 
	#ETHTOOL_GRXCLSRLCNT
 0x0000002

	)

1385 
	#ETHTOOL_GRXCLSRULE
 0x0000002à

	)

1386 
	#ETHTOOL_GRXCLSRLALL
 0x00000030

	)

1387 
	#ETHTOOL_SRXCLSRLDEL
 0x00000031

	)

1388 
	#ETHTOOL_SRXCLSRLINS
 0x00000032

	)

1389 
	#ETHTOOL_FLASHDEV
 0x00000033

	)

1390 
	#ETHTOOL_RESET
 0x00000034

	)

1391 
	#ETHTOOL_SRXNTUPLE
 0x00000035

	)

1392 
	#ETHTOOL_GRXNTUPLE
 0x00000036

	)

1393 
	#ETHTOOL_GSSET_INFO
 0x00000037

	)

1394 
	#ETHTOOL_GRXFHINDIR
 0x00000038

	)

1395 
	#ETHTOOL_SRXFHINDIR
 0x00000039

	)

1397 
	#ETHTOOL_GFEATURES
 0x0000003¨

	)

1398 
	#ETHTOOL_SFEATURES
 0x0000003b

	)

1399 
	#ETHTOOL_GCHANNELS
 0x0000003ø

	)

1400 
	#ETHTOOL_SCHANNELS
 0x0000003d

	)

1401 
	#ETHTOOL_SET_DUMP
 0x0000003

	)

1402 
	#ETHTOOL_GET_DUMP_FLAG
 0x0000003à

	)

1403 
	#ETHTOOL_GET_DUMP_DATA
 0x00000040

	)

1404 
	#ETHTOOL_GET_TS_INFO
 0x00000041

	)

1405 
	#ETHTOOL_GMODULEINFO
 0x00000042

	)

1406 
	#ETHTOOL_GMODULEEEPROM
 0x00000043

	)

1407 
	#ETHTOOL_GEEE
 0x00000044

	)

1408 
	#ETHTOOL_SEEE
 0x00000045

	)

1410 
	#ETHTOOL_GRSSH
 0x00000046

	)

1411 
	#ETHTOOL_SRSSH
 0x00000047

	)

1412 
	#ETHTOOL_GTUNABLE
 0x00000048

	)

1413 
	#ETHTOOL_STUNABLE
 0x00000049

	)

1414 
	#ETHTOOL_GPHYSTATS
 0x0000004¨

	)

1416 
	#ETHTOOL_PERQUEUE
 0x0000004b

	)

1418 
	#ETHTOOL_GLINKSETTINGS
 0x0000004ø

	)

1419 
	#ETHTOOL_SLINKSETTINGS
 0x0000004d

	)

1420 
	#ETHTOOL_PHY_GTUNABLE
 0x0000004

	)

1421 
	#ETHTOOL_PHY_STUNABLE
 0x0000004à

	)

1422 
	#ETHTOOL_GFECPARAM
 0x00000050

	)

1423 
	#ETHTOOL_SFECPARAM
 0x00000051

	)

1426 
	#SPARC_ETH_GSET
 
ETHTOOL_GSET


	)

1427 
	#SPARC_ETH_SSET
 
ETHTOOL_SSET


	)

1430 
	e‘htoŞ_lšk_mode_b™_šdiûs
 {

1431 
	mETHTOOL_LINK_MODE_10ba£T_H®f_BIT
 = 0,

1432 
	mETHTOOL_LINK_MODE_10ba£T_FuÎ_BIT
 = 1,

1433 
	mETHTOOL_LINK_MODE_100ba£T_H®f_BIT
 = 2,

1434 
	mETHTOOL_LINK_MODE_100ba£T_FuÎ_BIT
 = 3,

1435 
	mETHTOOL_LINK_MODE_1000ba£T_H®f_BIT
 = 4,

1436 
	mETHTOOL_LINK_MODE_1000ba£T_FuÎ_BIT
 = 5,

1437 
	mETHTOOL_LINK_MODE_AutÚeg_BIT
 = 6,

1438 
	mETHTOOL_LINK_MODE_TP_BIT
 = 7,

1439 
	mETHTOOL_LINK_MODE_AUI_BIT
 = 8,

1440 
	mETHTOOL_LINK_MODE_MII_BIT
 = 9,

1441 
	mETHTOOL_LINK_MODE_FIBRE_BIT
 = 10,

1442 
	mETHTOOL_LINK_MODE_BNC_BIT
 = 11,

1443 
	mETHTOOL_LINK_MODE_10000ba£T_FuÎ_BIT
 = 12,

1444 
	mETHTOOL_LINK_MODE_Pau£_BIT
 = 13,

1445 
	mETHTOOL_LINK_MODE_Asym_Pau£_BIT
 = 14,

1446 
	mETHTOOL_LINK_MODE_2500ba£X_FuÎ_BIT
 = 15,

1447 
	mETHTOOL_LINK_MODE_Back¶ªe_BIT
 = 16,

1448 
	mETHTOOL_LINK_MODE_1000ba£KX_FuÎ_BIT
 = 17,

1449 
	mETHTOOL_LINK_MODE_10000ba£KX4_FuÎ_BIT
 = 18,

1450 
	mETHTOOL_LINK_MODE_10000ba£KR_FuÎ_BIT
 = 19,

1451 
	mETHTOOL_LINK_MODE_10000ba£R_FEC_BIT
 = 20,

1452 
	mETHTOOL_LINK_MODE_20000ba£MLD2_FuÎ_BIT
 = 21,

1453 
	mETHTOOL_LINK_MODE_20000ba£KR2_FuÎ_BIT
 = 22,

1454 
	mETHTOOL_LINK_MODE_40000ba£KR4_FuÎ_BIT
 = 23,

1455 
	mETHTOOL_LINK_MODE_40000ba£CR4_FuÎ_BIT
 = 24,

1456 
	mETHTOOL_LINK_MODE_40000ba£SR4_FuÎ_BIT
 = 25,

1457 
	mETHTOOL_LINK_MODE_40000ba£LR4_FuÎ_BIT
 = 26,

1458 
	mETHTOOL_LINK_MODE_56000ba£KR4_FuÎ_BIT
 = 27,

1459 
	mETHTOOL_LINK_MODE_56000ba£CR4_FuÎ_BIT
 = 28,

1460 
	mETHTOOL_LINK_MODE_56000ba£SR4_FuÎ_BIT
 = 29,

1461 
	mETHTOOL_LINK_MODE_56000ba£LR4_FuÎ_BIT
 = 30,

1462 
	mETHTOOL_LINK_MODE_25000ba£CR_FuÎ_BIT
 = 31,

1470 
	mETHTOOL_LINK_MODE_25000ba£KR_FuÎ_BIT
 = 32,

1471 
	mETHTOOL_LINK_MODE_25000ba£SR_FuÎ_BIT
 = 33,

1472 
	mETHTOOL_LINK_MODE_50000ba£CR2_FuÎ_BIT
 = 34,

1473 
	mETHTOOL_LINK_MODE_50000ba£KR2_FuÎ_BIT
 = 35,

1474 
	mETHTOOL_LINK_MODE_100000ba£KR4_FuÎ_BIT
 = 36,

1475 
	mETHTOOL_LINK_MODE_100000ba£SR4_FuÎ_BIT
 = 37,

1476 
	mETHTOOL_LINK_MODE_100000ba£CR4_FuÎ_BIT
 = 38,

1477 
	mETHTOOL_LINK_MODE_100000ba£LR4_ER4_FuÎ_BIT
 = 39,

1478 
	mETHTOOL_LINK_MODE_50000ba£SR2_FuÎ_BIT
 = 40,

1479 
	mETHTOOL_LINK_MODE_1000ba£X_FuÎ_BIT
 = 41,

1480 
	mETHTOOL_LINK_MODE_10000ba£CR_FuÎ_BIT
 = 42,

1481 
	mETHTOOL_LINK_MODE_10000ba£SR_FuÎ_BIT
 = 43,

1482 
	mETHTOOL_LINK_MODE_10000ba£LR_FuÎ_BIT
 = 44,

1483 
	mETHTOOL_LINK_MODE_10000ba£LRM_FuÎ_BIT
 = 45,

1484 
	mETHTOOL_LINK_MODE_10000ba£ER_FuÎ_BIT
 = 46,

1485 
	mETHTOOL_LINK_MODE_2500ba£T_FuÎ_BIT
 = 47,

1486 
	mETHTOOL_LINK_MODE_5000ba£T_FuÎ_BIT
 = 48,

1488 
	mETHTOOL_LINK_MODE_FEC_NONE_BIT
 = 49,

1489 
	mETHTOOL_LINK_MODE_FEC_RS_BIT
 = 50,

1490 
	mETHTOOL_LINK_MODE_FEC_BASER_BIT
 = 51,

1491 
	mETHTOOL_LINK_MODE_50000ba£KR_FuÎ_BIT
 = 52,

1492 
	mETHTOOL_LINK_MODE_50000ba£SR_FuÎ_BIT
 = 53,

1493 
	mETHTOOL_LINK_MODE_50000ba£CR_FuÎ_BIT
 = 54,

1494 
	mETHTOOL_LINK_MODE_50000ba£LR_ER_FR_FuÎ_BIT
 = 55,

1495 
	mETHTOOL_LINK_MODE_50000ba£DR_FuÎ_BIT
 = 56,

1496 
	mETHTOOL_LINK_MODE_100000ba£KR2_FuÎ_BIT
 = 57,

1497 
	mETHTOOL_LINK_MODE_100000ba£SR2_FuÎ_BIT
 = 58,

1498 
	mETHTOOL_LINK_MODE_100000ba£CR2_FuÎ_BIT
 = 59,

1499 
	mETHTOOL_LINK_MODE_100000ba£LR2_ER2_FR2_FuÎ_BIT
 = 60,

1500 
	mETHTOOL_LINK_MODE_100000ba£DR2_FuÎ_BIT
 = 61,

1501 
	mETHTOOL_LINK_MODE_200000ba£KR4_FuÎ_BIT
 = 62,

1502 
	mETHTOOL_LINK_MODE_200000ba£SR4_FuÎ_BIT
 = 63,

1503 
	mETHTOOL_LINK_MODE_200000ba£LR4_ER4_FR4_FuÎ_BIT
 = 64,

1504 
	mETHTOOL_LINK_MODE_200000ba£DR4_FuÎ_BIT
 = 65,

1505 
	mETHTOOL_LINK_MODE_200000ba£CR4_FuÎ_BIT
 = 66,

1506 
	mETHTOOL_LINK_MODE_100ba£T1_FuÎ_BIT
 = 67,

1507 
	mETHTOOL_LINK_MODE_1000ba£T1_FuÎ_BIT
 = 68,

1510 
	m__ETHTOOL_LINK_MODE_MASK_NBITS


1513 
	#__ETHTOOL_LINK_MODE_LEGACY_MASK
(
ba£_Çme
) \

1514 (1UL << (
ETHTOOL_LINK_MODE_
 ## 
ba£_Çme
 ## 
_BIT
))

	)

1520 
	#SUPPORTED_10ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_H®f
)

	)

1521 
	#SUPPORTED_10ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuÎ
)

	)

1522 
	#SUPPORTED_100ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_H®f
)

	)

1523 
	#SUPPORTED_100ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuÎ
)

	)

1524 
	#SUPPORTED_1000ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_H®f
)

	)

1525 
	#SUPPORTED_1000ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuÎ
)

	)

1526 
	#SUPPORTED_AutÚeg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AutÚeg
)

	)

1527 
	#SUPPORTED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1528 
	#SUPPORTED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1529 
	#SUPPORTED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1530 
	#SUPPORTED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1531 
	#SUPPORTED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1532 
	#SUPPORTED_10000ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuÎ
)

	)

1533 
	#SUPPORTED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1534 
	#SUPPORTED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1535 
	#SUPPORTED_2500ba£X_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuÎ
)

	)

1536 
	#SUPPORTED_Back¶ªe
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back¶ªe
)

	)

1537 
	#SUPPORTED_1000ba£KX_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuÎ
)

	)

1538 
	#SUPPORTED_10000ba£KX4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuÎ
)

	)

1539 
	#SUPPORTED_10000ba£KR_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuÎ
)

	)

1540 
	#SUPPORTED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1541 
	#SUPPORTED_20000ba£MLD2_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuÎ
)

	)

1542 
	#SUPPORTED_20000ba£KR2_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuÎ
)

	)

1543 
	#SUPPORTED_40000ba£KR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuÎ
)

	)

1544 
	#SUPPORTED_40000ba£CR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuÎ
)

	)

1545 
	#SUPPORTED_40000ba£SR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuÎ
)

	)

1546 
	#SUPPORTED_40000ba£LR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuÎ
)

	)

1547 
	#SUPPORTED_56000ba£KR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuÎ
)

	)

1548 
	#SUPPORTED_56000ba£CR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuÎ
)

	)

1549 
	#SUPPORTED_56000ba£SR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuÎ
)

	)

1550 
	#SUPPORTED_56000ba£LR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuÎ
)

	)

1560 
	#ADVERTISED_10ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_H®f
)

	)

1561 
	#ADVERTISED_10ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuÎ
)

	)

1562 
	#ADVERTISED_100ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_H®f
)

	)

1563 
	#ADVERTISED_100ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuÎ
)

	)

1564 
	#ADVERTISED_1000ba£T_H®f
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_H®f
)

	)

1565 
	#ADVERTISED_1000ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuÎ
)

	)

1566 
	#ADVERTISED_AutÚeg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AutÚeg
)

	)

1567 
	#ADVERTISED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1568 
	#ADVERTISED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1569 
	#ADVERTISED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1570 
	#ADVERTISED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1571 
	#ADVERTISED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1572 
	#ADVERTISED_10000ba£T_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuÎ
)

	)

1573 
	#ADVERTISED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1574 
	#ADVERTISED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1575 
	#ADVERTISED_2500ba£X_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuÎ
)

	)

1576 
	#ADVERTISED_Back¶ªe
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back¶ªe
)

	)

1577 
	#ADVERTISED_1000ba£KX_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuÎ
)

	)

1578 
	#ADVERTISED_10000ba£KX4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuÎ
)

	)

1579 
	#ADVERTISED_10000ba£KR_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuÎ
)

	)

1580 
	#ADVERTISED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1581 
	#ADVERTISED_20000ba£MLD2_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuÎ
)

	)

1582 
	#ADVERTISED_20000ba£KR2_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuÎ
)

	)

1583 
	#ADVERTISED_40000ba£KR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuÎ
)

	)

1584 
	#ADVERTISED_40000ba£CR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuÎ
)

	)

1585 
	#ADVERTISED_40000ba£SR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuÎ
)

	)

1586 
	#ADVERTISED_40000ba£LR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuÎ
)

	)

1587 
	#ADVERTISED_56000ba£KR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuÎ
)

	)

1588 
	#ADVERTISED_56000ba£CR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuÎ
)

	)

1589 
	#ADVERTISED_56000ba£SR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuÎ
)

	)

1590 
	#ADVERTISED_56000ba£LR4_FuÎ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuÎ
)

	)

1605 
	#SPEED_10
 10

	)

1606 
	#SPEED_100
 100

	)

1607 
	#SPEED_1000
 1000

	)

1608 
	#SPEED_2500
 2500

	)

1609 
	#SPEED_5000
 5000

	)

1610 
	#SPEED_10000
 10000

	)

1611 
	#SPEED_14000
 14000

	)

1612 
	#SPEED_20000
 20000

	)

1613 
	#SPEED_25000
 25000

	)

1614 
	#SPEED_40000
 40000

	)

1615 
	#SPEED_50000
 50000

	)

1616 
	#SPEED_56000
 56000

	)

1617 
	#SPEED_100000
 100000

	)

1618 
	#SPEED_200000
 200000

	)

1620 
	#SPEED_UNKNOWN
 -1

	)

1622 
__šlše__
 
	$‘htoŞ_v®id©e_¥“d
(
__u32
 
¥“d
)

1624  
¥“d
 <ğ
INT_MAX
 || s³ed =ğ(
__u32
)
SPEED_UNKNOWN
;

1625 
	}
}

1628 
	#DUPLEX_HALF
 0x00

	)

1629 
	#DUPLEX_FULL
 0x01

	)

1630 
	#DUPLEX_UNKNOWN
 0xff

	)

1632 
__šlše__
 
	$‘htoŞ_v®id©e_du¶ex
(
__u8
 
du¶ex
)

1634 
du¶ex
) {

1635 
DUPLEX_HALF
:

1636 
DUPLEX_FULL
:

1637 
DUPLEX_UNKNOWN
:

1642 
	}
}

1645 
	#PORT_TP
 0x00

	)

1646 
	#PORT_AUI
 0x01

	)

1647 
	#PORT_MII
 0x02

	)

1648 
	#PORT_FIBRE
 0x03

	)

1649 
	#PORT_BNC
 0x04

	)

1650 
	#PORT_DA
 0x05

	)

1651 
	#PORT_NONE
 0xef

	)

1652 
	#PORT_OTHER
 0xff

	)

1655 
	#XCVR_INTERNAL
 0x00

	)

1656 
	#XCVR_EXTERNAL
 0x01

	)

1657 
	#XCVR_DUMMY1
 0x02

	)

1658 
	#XCVR_DUMMY2
 0x03

	)

1659 
	#XCVR_DUMMY3
 0x04

	)

1662 
	#AUTONEG_DISABLE
 0x00

	)

1663 
	#AUTONEG_ENABLE
 0x01

	)

1668 
	#ETH_TP_MDI_INVALID
 0x00

	)

1669 
	#ETH_TP_MDI
 0x01

	)

1670 
	#ETH_TP_MDI_X
 0x02

	)

1671 
	#ETH_TP_MDI_AUTO
 0x03

	)

1674 
	#WAKE_PHY
 (1 << 0)

	)

1675 
	#WAKE_UCAST
 (1 << 1)

	)

1676 
	#WAKE_MCAST
 (1 << 2)

	)

1677 
	#WAKE_BCAST
 (1 << 3)

	)

1678 
	#WAKE_ARP
 (1 << 4)

	)

1679 
	#WAKE_MAGIC
 (1 << 5)

	)

1680 
	#WAKE_MAGICSECURE
 (1 << 6è

	)

1681 
	#WAKE_FILTER
 (1 << 7)

	)

1684 
	#TCP_V4_FLOW
 0x01

	)

1685 
	#UDP_V4_FLOW
 0x02

	)

1686 
	#SCTP_V4_FLOW
 0x03

	)

1687 
	#AH_ESP_V4_FLOW
 0x04

	)

1688 
	#TCP_V6_FLOW
 0x05

	)

1689 
	#UDP_V6_FLOW
 0x06

	)

1690 
	#SCTP_V6_FLOW
 0x07

	)

1691 
	#AH_ESP_V6_FLOW
 0x08

	)

1692 
	#AH_V4_FLOW
 0x09

	)

1693 
	#ESP_V4_FLOW
 0x0¨

	)

1694 
	#AH_V6_FLOW
 0x0b

	)

1695 
	#ESP_V6_FLOW
 0x0ø

	)

1696 
	#IPV4_USER_FLOW
 0x0d

	)

1697 
	#IP_USER_FLOW
 
IPV4_USER_FLOW


	)

1698 
	#IPV6_USER_FLOW
 0x0

	)

1699 
	#IPV4_FLOW
 0x10

	)

1700 
	#IPV6_FLOW
 0x11

	)

1701 
	#ETHER_FLOW
 0x12

	)

1703 
	#FLOW_EXT
 0x80000000

	)

1704 
	#FLOW_MAC_EXT
 0x40000000

	)

1706 
	#FLOW_RSS
 0x20000000

	)

1709 
	#RXH_L2DA
 (1 << 1)

	)

1710 
	#RXH_VLAN
 (1 << 2)

	)

1711 
	#RXH_L3_PROTO
 (1 << 3)

	)

1712 
	#RXH_IP_SRC
 (1 << 4)

	)

1713 
	#RXH_IP_DST
 (1 << 5)

	)

1714 
	#RXH_L4_B_0_1
 (1 << 6è

	)

1715 
	#RXH_L4_B_2_3
 (1 << 7è

	)

1716 
	#RXH_DISCARD
 (1 << 31)

	)

1718 
	#RX_CLS_FLOW_DISC
 0xffffffffffffffffULL

	)

1719 
	#RX_CLS_FLOW_WAKE
 0xffffffffffffffãULL

	)

1722 
	#RX_CLS_LOC_SPECIAL
 0x80000000

	)

1723 
	#RX_CLS_LOC_ANY
 0xffffffff

	)

1724 
	#RX_CLS_LOC_FIRST
 0xffffffã

	)

1725 
	#RX_CLS_LOC_LAST
 0xfffffffd

	)

1728 
	#ETH_MODULE_SFF_8079
 0x1

	)

1729 
	#ETH_MODULE_SFF_8079_LEN
 256

	)

1730 
	#ETH_MODULE_SFF_8472
 0x2

	)

1731 
	#ETH_MODULE_SFF_8472_LEN
 512

	)

1732 
	#ETH_MODULE_SFF_8636
 0x3

	)

1733 
	#ETH_MODULE_SFF_8636_LEN
 256

	)

1734 
	#ETH_MODULE_SFF_8436
 0x4

	)

1735 
	#ETH_MODULE_SFF_8436_LEN
 256

	)

1737 
	#ETH_MODULE_SFF_8636_MAX_LEN
 640

	)

1738 
	#ETH_MODULE_SFF_8436_MAX_LEN
 640

	)

1747 
	e‘htoŞ_»£t_æags
 {

1753 
	mETH_RESET_MGMT
 = 1 << 0,

1754 
	mETH_RESET_IRQ
 = 1 << 1,

1755 
	mETH_RESET_DMA
 = 1 << 2,

1756 
	mETH_RESET_FILTER
 = 1 << 3,

1757 
	mETH_RESET_OFFLOAD
 = 1 << 4,

1758 
	mETH_RESET_MAC
 = 1 << 5,

1759 
	mETH_RESET_PHY
 = 1 << 6,

1760 
	mETH_RESET_RAM
 = 1 << 7,

1762 
	mETH_RESET_AP
 = 1 << 8,

1764 
	mETH_RESET_DEDICATED
 = 0x0000ffff,

1766 
	mETH_RESET_ALL
 = 0xffffffff,

1769 
	#ETH_RESET_SHARED_SHIFT
 16

	)

1868 
	s‘htoŞ_lšk_£‰šgs
 {

1869 
__u32
 
	mcmd
;

1870 
__u32
 
	m¥“d
;

1871 
__u8
 
	mdu¶ex
;

1872 
__u8
 
	mpÜt
;

1873 
__u8
 
	mphy_add»ss
;

1874 
__u8
 
	mautÚeg
;

1875 
__u8
 
	mmdio_suµÜt
;

1876 
__u8
 
	m‘h__mdix
;

1877 
__u8
 
	m‘h__mdix_ù¾
;

1878 
__s8
 
	mlšk_mode_masks_nwÜds
;

1879 
__u8
 
	mŒªsûiv”
;

1880 
__u8
 
	m»£rved1
[3];

1881 
__u32
 
	m»£rved
[7];

1882 
__u32
 
	mlšk_mode_masks
[0];

	@/usr/include/linux/filter.h

6 #iâdeà
__LINUX_FILTER_H__


7 
	#__LINUX_FILTER_H__


	)

10 
	~<lšux/ty³s.h
>

11 
	~<lšux/bpf_commÚ.h
>

16 
	#BPF_MAJOR_VERSION
 1

	)

17 
	#BPF_MINOR_VERSION
 1

	)

24 
	ssock_f‹r
 {

25 
__u16
 
	mcode
;

26 
__u8
 
	mjt
;

27 
__u8
 
	mjf
;

28 
__u32
 
	mk
;

31 
	ssock_årog
 {

32 
	mËn
;

33 
sock_f‹r
 *
	mf‹r
;

37 
	#BPF_RVAL
(
code
è((codeè& 0x18)

	)

38 
	#BPF_A
 0x10

	)

41 
	#BPF_MISCOP
(
code
è((codeè& 0xf8)

	)

42 
	#BPF_TAX
 0x00

	)

43 
	#BPF_TXA
 0x80

	)

48 #iâdeà
BPF_STMT


49 
	#BPF_STMT
(
code
, 
k
è{ ()(code), 0, 0, k }

	)

51 #iâdeà
BPF_JUMP


52 
	#BPF_JUMP
(
code
, 
k
, 
jt
, 
jf
è{ ()(code), jt, jf, k }

	)

58 
	#BPF_MEMWORDS
 16

	)

65 
	#SKF_AD_OFF
 (-0x1000)

	)

66 
	#SKF_AD_PROTOCOL
 0

	)

67 
	#SKF_AD_PKTTYPE
 4

	)

68 
	#SKF_AD_IFINDEX
 8

	)

69 
	#SKF_AD_NLATTR
 12

	)

70 
	#SKF_AD_NLATTR_NEST
 16

	)

71 
	#SKF_AD_MARK
 20

	)

72 
	#SKF_AD_QUEUE
 24

	)

73 
	#SKF_AD_HATYPE
 28

	)

74 
	#SKF_AD_RXHASH
 32

	)

75 
	#SKF_AD_CPU
 36

	)

76 
	#SKF_AD_ALU_XOR_X
 40

	)

77 
	#SKF_AD_VLAN_TAG
 44

	)

78 
	#SKF_AD_VLAN_TAG_PRESENT
 48

	)

79 
	#SKF_AD_PAY_OFFSET
 52

	)

80 
	#SKF_AD_RANDOM
 56

	)

81 
	#SKF_AD_VLAN_TPID
 60

	)

82 
	#SKF_AD_MAX
 64

	)

84 
	#SKF_NET_OFF
 (-0x100000)

	)

85 
	#SKF_LL_OFF
 (-0x200000)

	)

87 
	#BPF_NET_OFF
 
SKF_NET_OFF


	)

88 
	#BPF_LL_OFF
 
SKF_LL_OFF


	)

	@/usr/include/linux/if_vlan.h

14 #iâdeà
_LINUX_IF_VLAN_H_


15 
	#_LINUX_IF_VLAN_H_


	)

21 
	evÏn_ioùl_cmds
 {

22 
	mADD_VLAN_CMD
,

23 
	mDEL_VLAN_CMD
,

24 
	mSET_VLAN_INGRESS_PRIORITY_CMD
,

25 
	mSET_VLAN_EGRESS_PRIORITY_CMD
,

26 
	mGET_VLAN_INGRESS_PRIORITY_CMD
,

27 
	mGET_VLAN_EGRESS_PRIORITY_CMD
,

28 
	mSET_VLAN_NAME_TYPE_CMD
,

29 
	mSET_VLAN_FLAG_CMD
,

30 
	mGET_VLAN_REALDEV_NAME_CMD
,

31 
	mGET_VLAN_VID_CMD


34 
	evÏn_æags
 {

35 
	mVLAN_FLAG_REORDER_HDR
 = 0x1,

36 
	mVLAN_FLAG_GVRP
 = 0x2,

37 
	mVLAN_FLAG_LOOSE_BINDING
 = 0x4,

38 
	mVLAN_FLAG_MVRP
 = 0x8,

39 
	mVLAN_FLAG_BRIDGE_BINDING
 = 0x10,

42 
	evÏn_Çme_ty³s
 {

43 
	mVLAN_NAME_TYPE_PLUS_VID
,

44 
	mVLAN_NAME_TYPE_RAW_PLUS_VID
,

45 
	mVLAN_NAME_TYPE_PLUS_VID_NO_PAD
,

46 
	mVLAN_NAME_TYPE_RAW_PLUS_VID_NO_PAD
,

47 
	mVLAN_NAME_TYPE_HIGHEST


50 
	svÏn_ioùl_¬gs
 {

51 
	mcmd
;

52 
	mdeviû1
[24];

55 
	mdeviû2
[24];

56 
	mVID
;

57 
	mskb_´iÜ™y
;

58 
	mÇme_ty³
;

59 
	mbšd_ty³
;

60 
	mæag
;

61 } 
	mu
;

63 
	mvÏn_qos
;

	@/usr/include/linux/iommu.h

6 #iâdeà
_IOMMU_H


7 
	#_IOMMU_H


	)

9 
	~<lšux/ty³s.h
>

11 
	#IOMMU_FAULT_PERM_READ
 (1 << 0è

	)

12 
	#IOMMU_FAULT_PERM_WRITE
 (1 << 1è

	)

13 
	#IOMMU_FAULT_PERM_EXEC
 (1 << 2è

	)

14 
	#IOMMU_FAULT_PERM_PRIV
 (1 << 3è

	)

17 
	eiommu_çuÉ_ty³
 {

18 
	mIOMMU_FAULT_DMA_UNRECOV
 = 1,

19 
	mIOMMU_FAULT_PAGE_REQ
,

22 
	eiommu_çuÉ_»asÚ
 {

23 
	mIOMMU_FAULT_REASON_UNKNOWN
 = 0,

26 
	mIOMMU_FAULT_REASON_PASID_FETCH
,

29 
	mIOMMU_FAULT_REASON_BAD_PASID_ENTRY
,

35 
	mIOMMU_FAULT_REASON_PASID_INVALID
,

41 
	mIOMMU_FAULT_REASON_WALK_EABT
,

47 
	mIOMMU_FAULT_REASON_PTE_FETCH
,

50 
	mIOMMU_FAULT_REASON_PERMISSION
,

53 
	mIOMMU_FAULT_REASON_ACCESS
,

56 
	mIOMMU_FAULT_REASON_OOR_ADDRESS
,

69 
	siommu_çuÉ_uÄecov”abË
 {

70 
__u32
 
	m»asÚ
;

71 
	#IOMMU_FAULT_UNRECOV_PASID_VALID
 (1 << 0)

	)

72 
	#IOMMU_FAULT_UNRECOV_ADDR_VALID
 (1 << 1)

	)

73 
	#IOMMU_FAULT_UNRECOV_FETCH_ADDR_VALID
 (1 << 2)

	)

74 
__u32
 
	mæags
;

75 
__u32
 
	m·sid
;

76 
__u32
 
	m³rm
;

77 
__u64
 
	maddr
;

78 
__u64
 
	mãtch_addr
;

91 
	siommu_çuÉ_·ge_»que¡
 {

92 
	#IOMMU_FAULT_PAGE_REQUEST_PASID_VALID
 (1 << 0)

	)

93 
	#IOMMU_FAULT_PAGE_REQUEST_LAST_PAGE
 (1 << 1)

	)

94 
	#IOMMU_FAULT_PAGE_REQUEST_PRIV_DATA
 (1 << 2)

	)

95 
__u32
 
	mæags
;

96 
__u32
 
	m·sid
;

97 
__u32
 
	mg½id
;

98 
__u32
 
	m³rm
;

99 
__u64
 
	maddr
;

100 
__u64
 
	m´iv©e_d©a
[2];

111 
	siommu_çuÉ
 {

112 
__u32
 
	mty³
;

113 
__u32
 
	m·ddšg
;

115 
iommu_çuÉ_uÄecov”abË
 
	mev’t
;

116 
iommu_çuÉ_·ge_»que¡
 
	m´m
;

117 
__u8
 
	m·ddšg2
[56];

130 
	eiommu_·ge_»¥Ú£_code
 {

131 
	mIOMMU_PAGE_RESP_SUCCESS
 = 0,

132 
	mIOMMU_PAGE_RESP_INVALID
,

133 
	mIOMMU_PAGE_RESP_FAILURE
,

145 
	siommu_·ge_»¥Ú£
 {

146 
	#IOMMU_PAGE_RESP_VERSION_1
 1

	)

147 
__u32
 
	mv”siÚ
;

148 
	#IOMMU_PAGE_RESP_PASID_VALID
 (1 << 0)

	)

149 
__u32
 
	mæags
;

150 
__u32
 
	m·sid
;

151 
__u32
 
	mg½id
;

152 
__u32
 
	mcode
;

	@/usr/include/linux/kernel.h

2 #iâdeà
_LINUX_KERNEL_H


3 
	#_LINUX_KERNEL_H


	)

5 
	~<lšux/sysšfo.h
>

6 
	~<lšux/cÚ¡.h
>

	@/usr/include/linux/module.h

2 #iâdeà
_LINUX_MODULE_H


3 
	#_LINUX_MODULE_H


	)

6 
	#MODULE_INIT_IGNORE_MODVERSIONS
 1

	)

7 
	#MODULE_INIT_IGNORE_VERMAGIC
 2

	)

	@/usr/include/linux/net_tstamp.h

10 #iâdeà
_NET_TIMESTAMPING_H


11 
	#_NET_TIMESTAMPING_H


	)

13 
	~<lšux/ty³s.h
>

14 
	~<lšux/sock‘.h
>

18 
	mSOF_TIMESTAMPING_TX_HARDWARE
 = (1<<0),

19 
	mSOF_TIMESTAMPING_TX_SOFTWARE
 = (1<<1),

20 
	mSOF_TIMESTAMPING_RX_HARDWARE
 = (1<<2),

21 
	mSOF_TIMESTAMPING_RX_SOFTWARE
 = (1<<3),

22 
	mSOF_TIMESTAMPING_SOFTWARE
 = (1<<4),

23 
	mSOF_TIMESTAMPING_SYS_HARDWARE
 = (1<<5),

24 
	mSOF_TIMESTAMPING_RAW_HARDWARE
 = (1<<6),

25 
	mSOF_TIMESTAMPING_OPT_ID
 = (1<<7),

26 
	mSOF_TIMESTAMPING_TX_SCHED
 = (1<<8),

27 
	mSOF_TIMESTAMPING_TX_ACK
 = (1<<9),

28 
	mSOF_TIMESTAMPING_OPT_CMSG
 = (1<<10),

29 
	mSOF_TIMESTAMPING_OPT_TSONLY
 = (1<<11),

30 
	mSOF_TIMESTAMPING_OPT_STATS
 = (1<<12),

31 
	mSOF_TIMESTAMPING_OPT_PKTINFO
 = (1<<13),

32 
	mSOF_TIMESTAMPING_OPT_TX_SWHW
 = (1<<14),

34 
	mSOF_TIMESTAMPING_LAST
 = 
SOF_TIMESTAMPING_OPT_TX_SWHW
,

35 
	mSOF_TIMESTAMPING_MASK
 = (
SOF_TIMESTAMPING_LAST
 - 1) |

36 
SOF_TIMESTAMPING_LAST


44 
	#SOF_TIMESTAMPING_TX_RECORD_MASK
 (
SOF_TIMESTAMPING_TX_HARDWARE
 | \

45 
SOF_TIMESTAMPING_TX_SOFTWARE
 | \

46 
SOF_TIMESTAMPING_TX_SCHED
 | \

47 
SOF_TIMESTAMPING_TX_ACK
)

	)

62 
	shwt¡amp_cÚfig
 {

63 
	mæags
;

64 
	mtx_ty³
;

65 
	mrx_f‹r
;

69 
	ehwt¡amp_tx_ty³s
 {

75 
	mHWTSTAMP_TX_OFF
,

83 
	mHWTSTAMP_TX_ON
,

92 
	mHWTSTAMP_TX_ONESTEP_SYNC
,

96 
	ehwt¡amp_rx_f‹rs
 {

98 
	mHWTSTAMP_FILTER_NONE
,

101 
	mHWTSTAMP_FILTER_ALL
,

104 
	mHWTSTAMP_FILTER_SOME
,

107 
	mHWTSTAMP_FILTER_PTP_V1_L4_EVENT
,

109 
	mHWTSTAMP_FILTER_PTP_V1_L4_SYNC
,

111 
	mHWTSTAMP_FILTER_PTP_V1_L4_DELAY_REQ
,

113 
	mHWTSTAMP_FILTER_PTP_V2_L4_EVENT
,

115 
	mHWTSTAMP_FILTER_PTP_V2_L4_SYNC
,

117 
	mHWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ
,

120 
	mHWTSTAMP_FILTER_PTP_V2_L2_EVENT
,

122 
	mHWTSTAMP_FILTER_PTP_V2_L2_SYNC
,

124 
	mHWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ
,

127 
	mHWTSTAMP_FILTER_PTP_V2_EVENT
,

129 
	mHWTSTAMP_FILTER_PTP_V2_SYNC
,

131 
	mHWTSTAMP_FILTER_PTP_V2_DELAY_REQ
,

134 
	mHWTSTAMP_FILTER_NTP_ALL
,

138 
	sscm_ts_pktšfo
 {

139 
__u32
 
	mif_šdex
;

140 
__u32
 
	mpkt_Ëngth
;

141 
__u32
 
	m»£rved
[2];

148 
	etxtime_æags
 {

149 
	mSOF_TXTIME_DEADLINE_MODE
 = (1 << 0),

150 
	mSOF_TXTIME_REPORT_ERRORS
 = (1 << 1),

152 
	mSOF_TXTIME_FLAGS_LAST
 = 
SOF_TXTIME_REPORT_ERRORS
,

153 
	mSOF_TXTIME_FLAGS_MASK
 = (
SOF_TXTIME_FLAGS_LAST
 - 1) |

154 
SOF_TXTIME_FLAGS_LAST


157 
	ssock_txtime
 {

158 
__k”Ãl_şockid_t
 
	mşockid
;

159 
__u32
 
	mæags
;

	@/usr/include/linux/netdevice.h

26 #iâdeà
_LINUX_NETDEVICE_H


27 
	#_LINUX_NETDEVICE_H


	)

29 
	~<lšux/if.h
>

30 
	~<lšux/if_‘h”.h
>

31 
	~<lšux/if_·ck‘.h
>

32 
	~<lšux/if_lšk.h
>

35 
	#MAX_ADDR_LEN
 32

	)

38 
	#INIT_NETDEV_GROUP
 0

	)

42 
	#NET_NAME_UNKNOWN
 0

	)

43 
	#NET_NAME_ENUM
 1

	)

44 
	#NET_NAME_PREDICTABLE
 2

	)

45 
	#NET_NAME_USER
 3

	)

46 
	#NET_NAME_RENAMED
 4

	)

50 
	mIF_PORT_UNKNOWN
 = 0,

51 
	mIF_PORT_10BASE2
,

52 
	mIF_PORT_10BASET
,

53 
	mIF_PORT_AUI
,

54 
	mIF_PORT_100BASET
,

55 
	mIF_PORT_100BASETX
,

56 
	mIF_PORT_100BASEFX


60 
	#NET_ADDR_PERM
 0

	)

61 
	#NET_ADDR_RANDOM
 1

	)

62 
	#NET_ADDR_STOLEN
 2

	)

63 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/pci.h

18 #iâdeà
LINUX_PCI_H


19 
	#LINUX_PCI_H


	)

21 
	~<lšux/pci_»gs.h
>

31 
	#PCI_DEVFN
(
¦Ù
, 
func
è((((¦Ùè& 0x1fè<< 3è| ((funcè& 0x07))

	)

32 
	#PCI_SLOT
(
devâ
è(((devâè>> 3è& 0x1f)

	)

33 
	#PCI_FUNC
(
devâ
è((devâè& 0x07)

	)

36 
	#PCIIOC_BASE
 ('P' << 24 | 'C' << 16 | 'I' << 8)

	)

37 
	#PCIIOC_CONTROLLER
 (
PCIIOC_BASE
 | 0x00è

	)

38 
	#PCIIOC_MMAP_IS_IO
 (
PCIIOC_BASE
 | 0x01è

	)

39 
	#PCIIOC_MMAP_IS_MEM
 (
PCIIOC_BASE
 | 0x02è

	)

40 
	#PCIIOC_WRITE_COMBINE
 (
PCIIOC_BASE
 | 0x03è

	)

	@/usr/include/linux/sched.h

2 #iâdeà
_LINUX_SCHED_H


3 
	#_LINUX_SCHED_H


	)

5 
	~<lšux/ty³s.h
>

10 
	#CSIGNAL
 0x000000fà

	)

11 
	#CLONE_VM
 0x00000100

	)

12 
	#CLONE_FS
 0x00000200

	)

13 
	#CLONE_FILES
 0x00000400

	)

14 
	#CLONE_SIGHAND
 0x00000800

	)

15 
	#CLONE_PIDFD
 0x00001000

	)

16 
	#CLONE_PTRACE
 0x00002000

	)

17 
	#CLONE_VFORK
 0x00004000

	)

18 
	#CLONE_PARENT
 0x00008000

	)

19 
	#CLONE_THREAD
 0x00010000

	)

20 
	#CLONE_NEWNS
 0x00020000

	)

21 
	#CLONE_SYSVSEM
 0x00040000

	)

22 
	#CLONE_SETTLS
 0x00080000

	)

23 
	#CLONE_PARENT_SETTID
 0x00100000

	)

24 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

25 
	#CLONE_DETACHED
 0x00400000

	)

26 
	#CLONE_UNTRACED
 0x00800000

	)

27 
	#CLONE_CHILD_SETTID
 0x01000000

	)

28 
	#CLONE_NEWCGROUP
 0x02000000

	)

29 
	#CLONE_NEWUTS
 0x04000000

	)

30 
	#CLONE_NEWIPC
 0x08000000

	)

31 
	#CLONE_NEWUSER
 0x10000000

	)

32 
	#CLONE_NEWPID
 0x20000000

	)

33 
	#CLONE_NEWNET
 0x40000000

	)

34 
	#CLONE_IO
 0x80000000

	)

36 #iâdeà
__ASSEMBLY__


66 
	sşÚe_¬gs
 {

67 
__®igÃd_u64
 
	mæags
;

68 
__®igÃd_u64
 
	mpidfd
;

69 
__®igÃd_u64
 
	mchd_tid
;

70 
__®igÃd_u64
 
	m·»Á_tid
;

71 
__®igÃd_u64
 
	mex™_sigÇl
;

72 
__®igÃd_u64
 
	m¡ack
;

73 
__®igÃd_u64
 
	m¡ack_size
;

74 
__®igÃd_u64
 
	ms
;

78 
	#CLONE_ARGS_SIZE_VER0
 64

	)

83 
	#SCHED_NORMAL
 0

	)

84 
	#SCHED_FIFO
 1

	)

85 
	#SCHED_RR
 2

	)

86 
	#SCHED_BATCH
 3

	)

88 
	#SCHED_IDLE
 5

	)

89 
	#SCHED_DEADLINE
 6

	)

92 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

97 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

98 
	#SCHED_FLAG_RECLAIM
 0x02

	)

99 
	#SCHED_FLAG_DL_OVERRUN
 0x04

	)

100 
	#SCHED_FLAG_KEEP_POLICY
 0x08

	)

101 
	#SCHED_FLAG_KEEP_PARAMS
 0x10

	)

102 
	#SCHED_FLAG_UTIL_CLAMP_MIN
 0x20

	)

103 
	#SCHED_FLAG_UTIL_CLAMP_MAX
 0x40

	)

105 
	#SCHED_FLAG_KEEP_ALL
 (
SCHED_FLAG_KEEP_POLICY
 | \

106 
SCHED_FLAG_KEEP_PARAMS
)

	)

108 
	#SCHED_FLAG_UTIL_CLAMP
 (
SCHED_FLAG_UTIL_CLAMP_MIN
 | \

109 
SCHED_FLAG_UTIL_CLAMP_MAX
)

	)

111 
	#SCHED_FLAG_ALL
 (
SCHED_FLAG_RESET_ON_FORK
 | \

112 
SCHED_FLAG_RECLAIM
 | \

113 
SCHED_FLAG_DL_OVERRUN
 | \

114 
SCHED_FLAG_KEEP_ALL
 | \

115 
SCHED_FLAG_UTIL_CLAMP
)

	)

	@/usr/include/linux/stddef.h

4 #iâdeà
__®ways_šlše


5 
	#__®ways_šlše
 
__šlše__


	)

	@/usr/include/linux/time.h

2 #iâdeà
_LINUX_TIME_H


3 
	#_LINUX_TIME_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/time_ty³s.h
>

8 #iâdeà
_STRUCT_TIMESPEC


9 
	#_STRUCT_TIMESPEC


	)

10 
	stime¥ec
 {

11 
__k”Ãl_time_t
 
	mtv_£c
;

12 
	mtv_n£c
;

16 
	stimev®
 {

17 
__k”Ãl_time_t
 
	mtv_£c
;

18 
__k”Ãl_su£cÚds_t
 
	mtv_u£c
;

21 
	stimezÚe
 {

22 
	mtz_mšu‹swe¡
;

23 
	mtz_d¡time
;

30 
	#ITIMER_REAL
 0

	)

31 
	#ITIMER_VIRTUAL
 1

	)

32 
	#ITIMER_PROF
 2

	)

34 
	s™im”¥ec
 {

35 
time¥ec
 
	m™_š‹rv®
;

36 
time¥ec
 
	m™_v®ue
;

39 
	s™im”v®
 {

40 
timev®
 
	m™_š‹rv®
;

41 
timev®
 
	m™_v®ue
;

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

61 
	#CLOCK_SGI_CYCLE
 10

	)

62 
	#CLOCK_TAI
 11

	)

64 
	#MAX_CLOCKS
 16

	)

65 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

66 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

71 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/types.h

2 #iâdeà
_LINUX_TYPES_H


3 
	#_LINUX_TYPES_H


	)

5 
	~<asm/ty³s.h
>

7 #iâdeà
__ASSEMBLY__


9 
	~<lšux/posix_ty³s.h
>

17 #ifdeà
__CHECKER__


18 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

20 
	#__b™wi£__


	)

22 
	#__b™wi£
 
__b™wi£__


	)

24 
__u16
 
	t__b™wi£
 
	t__Ë16
;

25 
__u16
 
	t__b™wi£
 
	t__be16
;

26 
__u32
 
	t__b™wi£
 
	t__Ë32
;

27 
__u32
 
	t__b™wi£
 
	t__be32
;

28 
__u64
 
	t__b™wi£
 
	t__Ë64
;

29 
__u64
 
	t__b™wi£
 
	t__be64
;

31 
__u16
 
	t__b™wi£
 
	t__sum16
;

32 
__u32
 
	t__b™wi£
 
	t__wsum
;

43 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

44 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

45 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	t__b™wi£
 
	t__pŞl_t
;

	@/usr/include/asm/types.h

1 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

42 #iâdeà
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<b™s/wÜdsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifdeà
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #ià
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #ià
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifdeà
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


124 #šşude_Ãxˆ<
lim™s
.
h
>

130 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


131 #iâdeà
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #iâdeà
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #iâdeà
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

145 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

146 #iâdeà
CHAR_WIDTH


147 
	#CHAR_WIDTH
 8

	)

149 #iâdeà
SCHAR_WIDTH


150 
	#SCHAR_WIDTH
 8

	)

152 #iâdeà
UCHAR_WIDTH


153 
	#UCHAR_WIDTH
 8

	)

155 #iâdeà
SHRT_WIDTH


156 
	#SHRT_WIDTH
 16

	)

158 #iâdeà
USHRT_WIDTH


159 
	#USHRT_WIDTH
 16

	)

161 #iâdeà
INT_WIDTH


162 
	#INT_WIDTH
 32

	)

164 #iâdeà
UINT_WIDTH


165 
	#UINT_WIDTH
 32

	)

167 #iâdeà
LONG_WIDTH


168 
	#LONG_WIDTH
 
__WORDSIZE


	)

170 #iâdeà
ULONG_WIDTH


171 
	#ULONG_WIDTH
 
__WORDSIZE


	)

173 #iâdeà
LLONG_WIDTH


174 
	#LLONG_WIDTH
 64

	)

176 #iâdeà
ULLONG_WIDTH


177 
	#ULLONG_WIDTH
 64

	)

181 #ifdef 
__USE_POSIX


183 
	~<b™s/posix1_lim.h
>

186 #ifdef 
__USE_POSIX2


187 
	~<b™s/posix2_lim.h
>

190 #ifdef 
__USE_XOPEN


191 
	~<b™s/xİ’_lim.h
>

	@/usr/include/linux/bpf_common.h

2 #iâdeà
__LINUX_BPF_COMMON_H__


3 
	#__LINUX_BPF_COMMON_H__


	)

6 
	#BPF_CLASS
(
code
è((codeè& 0x07)

	)

7 
	#BPF_LD
 0x00

	)

8 
	#BPF_LDX
 0x01

	)

9 
	#BPF_ST
 0x02

	)

10 
	#BPF_STX
 0x03

	)

11 
	#BPF_ALU
 0x04

	)

12 
	#BPF_JMP
 0x05

	)

13 
	#BPF_RET
 0x06

	)

14 
	#BPF_MISC
 0x07

	)

17 
	#BPF_SIZE
(
code
è((codeè& 0x18)

	)

18 
	#BPF_W
 0x00

	)

19 
	#BPF_H
 0x08

	)

20 
	#BPF_B
 0x10

	)

22 
	#BPF_MODE
(
code
è((codeè& 0xe0)

	)

23 
	#BPF_IMM
 0x00

	)

24 
	#BPF_ABS
 0x20

	)

25 
	#BPF_IND
 0x40

	)

26 
	#BPF_MEM
 0x60

	)

27 
	#BPF_LEN
 0x80

	)

28 
	#BPF_MSH
 0xa0

	)

31 
	#BPF_OP
(
code
è((codeè& 0xf0)

	)

32 
	#BPF_ADD
 0x00

	)

33 
	#BPF_SUB
 0x10

	)

34 
	#BPF_MUL
 0x20

	)

35 
	#BPF_DIV
 0x30

	)

36 
	#BPF_OR
 0x40

	)

37 
	#BPF_AND
 0x50

	)

38 
	#BPF_LSH
 0x60

	)

39 
	#BPF_RSH
 0x70

	)

40 
	#BPF_NEG
 0x80

	)

41 
	#BPF_MOD
 0x90

	)

42 
	#BPF_XOR
 0xa0

	)

44 
	#BPF_JA
 0x00

	)

45 
	#BPF_JEQ
 0x10

	)

46 
	#BPF_JGT
 0x20

	)

47 
	#BPF_JGE
 0x30

	)

48 
	#BPF_JSET
 0x40

	)

49 
	#BPF_SRC
(
code
è((codeè& 0x08)

	)

50 
	#BPF_K
 0x00

	)

51 
	#BPF_X
 0x08

	)

53 #iâdeà
BPF_MAXINSNS


54 
	#BPF_MAXINSNS
 4096

	)

	@/usr/include/linux/byteorder/little_endian.h

2 #iâdeà
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


3 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

5 #iâdeà
__LITTLE_ENDIAN


6 
	#__LITTLE_ENDIAN
 1234

	)

8 #iâdeà
__LITTLE_ENDIAN_BITFIELD


9 
	#__LITTLE_ENDIAN_BITFIELD


	)

12 
	~<lšux/ty³s.h
>

13 
	~<lšux/swab.h
>

15 
	#__cÚ¡ªt_htÚl
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

16 
	#__cÚ¡ªt_Áohl
(
x
è
	`___cÚ¡ªt_swab32
((
__be32
)(x))

	)

17 
	#__cÚ¡ªt_htÚs
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

18 
	#__cÚ¡ªt_Áohs
(
x
è
	`___cÚ¡ªt_swab16
((
__be16
)(x))

	)

19 
	#__cÚ¡ªt_ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

20 
	#__cÚ¡ªt_Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

21 
	#__cÚ¡ªt_ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

22 
	#__cÚ¡ªt_Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

23 
	#__cÚ¡ªt_ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

24 
	#__cÚ¡ªt_Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

25 
	#__cÚ¡ªt_ıu_to_be64
(
x
è((
__be64
)
	`___cÚ¡ªt_swab64
((x)))

	)

26 
	#__cÚ¡ªt_be64_to_ıu
(
x
è
	`___cÚ¡ªt_swab64
((
__u64
)(
__be64
)(x))

	)

27 
	#__cÚ¡ªt_ıu_to_be32
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

28 
	#__cÚ¡ªt_be32_to_ıu
(
x
è
	`___cÚ¡ªt_swab32
((
__u32
)(
__be32
)(x))

	)

29 
	#__cÚ¡ªt_ıu_to_be16
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

30 
	#__cÚ¡ªt_be16_to_ıu
(
x
è
	`___cÚ¡ªt_swab16
((
__u16
)(
__be16
)(x))

	)

31 
	#__ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

32 
	#__Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

33 
	#__ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

34 
	#__Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

35 
	#__ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

36 
	#__Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

37 
	#__ıu_to_be64
(
x
è((
__be64
)
	`__swab64
((x)))

	)

38 
	#__be64_to_ıu
(
x
è
	`__swab64
((
__u64
)(
__be64
)(x))

	)

39 
	#__ıu_to_be32
(
x
è((
__be32
)
	`__swab32
((x)))

	)

40 
	#__be32_to_ıu
(
x
è
	`__swab32
((
__u32
)(
__be32
)(x))

	)

41 
	#__ıu_to_be16
(
x
è((
__be16
)
	`__swab16
((x)))

	)

42 
	#__be16_to_ıu
(
x
è
	`__swab16
((
__u16
)(
__be16
)(x))

	)

44 
__®ways_šlše
 
__Ë64
 
	$__ıu_to_Ë64p
(cÚ¡ 
__u64
 *
p
)

46  (
__Ë64
)*
p
;

47 
	}
}

48 
__®ways_šlše
 
__u64
 
	$__Ë64_to_ıup
(cÚ¡ 
__Ë64
 *
p
)

50  (
__u64
)*
p
;

51 
	}
}

52 
__®ways_šlše
 
__Ë32
 
	$__ıu_to_Ë32p
(cÚ¡ 
__u32
 *
p
)

54  (
__Ë32
)*
p
;

55 
	}
}

56 
__®ways_šlše
 
__u32
 
	$__Ë32_to_ıup
(cÚ¡ 
__Ë32
 *
p
)

58  (
__u32
)*
p
;

59 
	}
}

60 
__®ways_šlše
 
__Ë16
 
	$__ıu_to_Ë16p
(cÚ¡ 
__u16
 *
p
)

62  (
__Ë16
)*
p
;

63 
	}
}

64 
__®ways_šlše
 
__u16
 
	$__Ë16_to_ıup
(cÚ¡ 
__Ë16
 *
p
)

66  (
__u16
)*
p
;

67 
	}
}

68 
__®ways_šlše
 
__be64
 
	$__ıu_to_be64p
(cÚ¡ 
__u64
 *
p
)

70  (
__be64
)
	`__swab64p
(
p
);

71 
	}
}

72 
__®ways_šlše
 
__u64
 
	$__be64_to_ıup
(cÚ¡ 
__be64
 *
p
)

74  
	`__swab64p
((
__u64
 *)
p
);

75 
	}
}

76 
__®ways_šlše
 
__be32
 
	$__ıu_to_be32p
(cÚ¡ 
__u32
 *
p
)

78  (
__be32
)
	`__swab32p
(
p
);

79 
	}
}

80 
__®ways_šlše
 
__u32
 
	$__be32_to_ıup
(cÚ¡ 
__be32
 *
p
)

82  
	`__swab32p
((
__u32
 *)
p
);

83 
	}
}

84 
__®ways_šlše
 
__be16
 
	$__ıu_to_be16p
(cÚ¡ 
__u16
 *
p
)

86  (
__be16
)
	`__swab16p
(
p
);

87 
	}
}

88 
__®ways_šlše
 
__u16
 
	$__be16_to_ıup
(cÚ¡ 
__be16
 *
p
)

90  
	`__swab16p
((
__u16
 *)
p
);

91 
	}
}

92 
	#__ıu_to_Ë64s
(
x
èdØ{ ()(x); } 0)

	)

93 
	#__Ë64_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

94 
	#__ıu_to_Ë32s
(
x
èdØ{ ()(x); } 0)

	)

95 
	#__Ë32_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

96 
	#__ıu_to_Ë16s
(
x
èdØ{ ()(x); } 0)

	)

97 
	#__Ë16_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

98 
	#__ıu_to_be64s
(
x
è
	`__swab64s
((x))

	)

99 
	#__be64_to_ıus
(
x
è
	`__swab64s
((x))

	)

100 
	#__ıu_to_be32s
(
x
è
	`__swab32s
((x))

	)

101 
	#__be32_to_ıus
(
x
è
	`__swab32s
((x))

	)

102 
	#__ıu_to_be16s
(
x
è
	`__swab16s
((x))

	)

103 
	#__be16_to_ıus
(
x
è
	`__swab16s
((x))

	)

	@/usr/include/linux/const.h

4 #iâdeà
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifdeà
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
è
	)
X

18 
	#_AT
(
T
,
X
è
	)
X

20 
	#__AC
(
X
,
Y
è(X##Y)

	)

21 
	#_AC
(
X
,
Y
è
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
è((T)(X))

	)

25 
	#_UL
(
x
è(
	`_AC
(x, 
UL
))

	)

26 
	#_ULL
(
x
è(
	`_AC
(x, 
ULL
))

	)

28 
	#_BITUL
(
x
è(
	`_UL
(1è<< (x))

	)

29 
	#_BITULL
(
x
è(
	`_ULL
(1è<< (x))

	)

31 
	#__ALIGN_KERNEL
(
x
, 
a
è
	`__ALIGN_KERNEL_MASK
(x, (
	`ty³of
(x))×è- 1)

	)

32 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
è(((xè+ (mask)è& ~(mask))

	)

34 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
è((Òè+ (dè- 1è/ (d))

	)

	@/usr/include/linux/if.h

20 #iâdeà
_LINUX_IF_H


21 
	#_LINUX_IF_H


	)

23 
	~<lšux/libc-com·t.h
>

24 
	~<lšux/ty³s.h
>

25 
	~<lšux/sock‘.h
>

28 
	~<sys/sock‘.h
>

30 #ià
__UAPI_DEF_IF_IFNAMSIZ


31 
	#IFNAMSIZ
 16

	)

33 
	#IFALIASZ
 256

	)

34 
	~<lšux/hdlc/ioùl.h
>

37 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 || \

38 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

79 
	eÃt_deviû_æags
 {

81 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


82 
IFF_UP
 = 1<<0,

83 
	mIFF_BROADCAST
 = 1<<1,

84 
	mIFF_DEBUG
 = 1<<2,

85 
	mIFF_LOOPBACK
 = 1<<3,

86 
	mIFF_POINTOPOINT
 = 1<<4,

87 
	mIFF_NOTRAILERS
 = 1<<5,

88 
	mIFF_RUNNING
 = 1<<6,

89 
	mIFF_NOARP
 = 1<<7,

90 
	mIFF_PROMISC
 = 1<<8,

91 
	mIFF_ALLMULTI
 = 1<<9,

92 
	mIFF_MASTER
 = 1<<10,

93 
	mIFF_SLAVE
 = 1<<11,

94 
	mIFF_MULTICAST
 = 1<<12,

95 
	mIFF_PORTSEL
 = 1<<13,

96 
	mIFF_AUTOMEDIA
 = 1<<14,

97 
	mIFF_DYNAMIC
 = 1<<15,

99 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


100 
	mIFF_LOWER_UP
 = 1<<16,

101 
	mIFF_DORMANT
 = 1<<17,

102 
	mIFF_ECHO
 = 1<<18,

108 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


109 
	#IFF_UP
 
IFF_UP


	)

110 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

111 
	#IFF_DEBUG
 
IFF_DEBUG


	)

112 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

113 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

114 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

115 
	#IFF_RUNNING
 
IFF_RUNNING


	)

116 
	#IFF_NOARP
 
IFF_NOARP


	)

117 
	#IFF_PROMISC
 
IFF_PROMISC


	)

118 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

119 
	#IFF_MASTER
 
IFF_MASTER


	)

120 
	#IFF_SLAVE
 
IFF_SLAVE


	)

121 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

122 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

123 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

124 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

127 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


128 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

129 
	#IFF_DORMANT
 
IFF_DORMANT


	)

130 
	#IFF_ECHO
 
IFF_ECHO


	)

133 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

134 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

136 
	#IF_GET_IFACE
 0x0001

	)

137 
	#IF_GET_PROTO
 0x0002

	)

140 
	#IF_IFACE_V35
 0x1000

	)

141 
	#IF_IFACE_V24
 0x1001

	)

142 
	#IF_IFACE_X21
 0x1002

	)

143 
	#IF_IFACE_T1
 0x1003

	)

144 
	#IF_IFACE_E1
 0x1004

	)

145 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

146 
	#IF_IFACE_X21D
 0x1006

	)

149 
	#IF_PROTO_HDLC
 0x2000

	)

150 
	#IF_PROTO_PPP
 0x2001

	)

151 
	#IF_PROTO_CISCO
 0x2002

	)

152 
	#IF_PROTO_FR
 0x2003

	)

153 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

154 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

155 
	#IF_PROTO_X25
 0x2006

	)

156 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

157 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

158 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

159 
	#IF_PROTO_FR_PVC
 0x200A

	)

160 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

161 
	#IF_PROTO_RAW
 0x200C

	)

165 
	mIF_OPER_UNKNOWN
,

166 
	mIF_OPER_NOTPRESENT
,

167 
	mIF_OPER_DOWN
,

168 
	mIF_OPER_LOWERLAYERDOWN
,

169 
	mIF_OPER_TESTING
,

170 
	mIF_OPER_DORMANT
,

171 
	mIF_OPER_UP
,

176 
	mIF_LINK_MODE_DEFAULT
,

177 
	mIF_LINK_MODE_DORMANT
,

191 #ià
__UAPI_DEF_IF_IFMAP


192 
	sifm­
 {

193 
	mmem_¡¬t
;

194 
	mmem_’d
;

195 
	mba£_addr
;

196 
	mœq
;

197 
	mdma
;

198 
	mpÜt
;

203 
	sif_£‰šgs
 {

204 
	mty³
;

205 
	msize
;

208 
¿w_hdlc_´Ùo
 *
	m¿w_hdlc
;

209 
cisco_´Ùo
 *
	mcisco
;

210 
ä_´Ùo
 *
	mä
;

211 
ä_´Ùo_pvc
 *
	mä_pvc
;

212 
ä_´Ùo_pvc_šfo
 *
	mä_pvc_šfo
;

215 
sync_£rŸl_£‰šgs
 *
	msync
;

216 
‹1_£‰šgs
 *
	m‹1
;

217 } 
	mifs_ifsu
;

228 #ià
__UAPI_DEF_IF_IFREQ


229 
	siäeq
 {

230 
	#IFHWADDRLEN
 6

	)

233 
	miän_Çme
[
IFNAMSIZ
];

234 } 
	miä_iän
;

237 
sockaddr
 
	miäu_addr
;

238 
sockaddr
 
	miäu_d¡addr
;

239 
sockaddr
 
	miäu_brßdaddr
;

240 
sockaddr
 
	miäu_Ãtmask
;

241 
sockaddr
 
	miäu_hwaddr
;

242 
	miäu_æags
;

243 
	miäu_iv®ue
;

244 
	miäu_mtu
;

245 
ifm­
 
	miäu_m­
;

246 
	miäu_¦ave
[
IFNAMSIZ
];

247 
	miäu_ÃwÇme
[
IFNAMSIZ
];

248 * 
	miäu_d©a
;

249 
if_£‰šgs
 
	miäu_£‰šgs
;

250 } 
	miä_iäu
;

254 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

255 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

256 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

257 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

258 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

259 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

260 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

261 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

262 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

263 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

264 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

265 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

266 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

267 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

268 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

269 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

270 
	#iä_£‰šgs
 
iä_iäu
.
iäu_£‰šgs


	)

280 #ià
__UAPI_DEF_IF_IFCONF


281 
	sifcÚf
 {

282 
	mifc_Ën
;

284 *
	mifcu_buf
;

285 
iäeq
 *
	mifcu_»q
;

286 } 
	mifc_ifcu
;

290 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

291 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

	@/usr/include/linux/if_ether.h

22 #iâdeà
_LINUX_IF_ETHER_H


23 
	#_LINUX_IF_ETHER_H


	)

25 
	~<lšux/ty³s.h
>

32 
	#ETH_ALEN
 6

	)

33 
	#ETH_TLEN
 2

	)

34 
	#ETH_HLEN
 14

	)

35 
	#ETH_ZLEN
 60

	)

36 
	#ETH_DATA_LEN
 1500

	)

37 
	#ETH_FRAME_LEN
 1514

	)

38 
	#ETH_FCS_LEN
 4

	)

40 
	#ETH_MIN_MTU
 68

	)

41 
	#ETH_MAX_MTU
 0xFFFFU

	)

47 
	#ETH_P_LOOP
 0x0060

	)

48 
	#ETH_P_PUP
 0x0200

	)

49 
	#ETH_P_PUPAT
 0x0201

	)

50 
	#ETH_P_TSN
 0x22F0

	)

51 
	#ETH_P_ERSPAN2
 0x22EB

	)

52 
	#ETH_P_IP
 0x0800

	)

53 
	#ETH_P_X25
 0x0805

	)

54 
	#ETH_P_ARP
 0x0806

	)

55 
	#ETH_P_BPQ
 0x08FF

	)

56 
	#ETH_P_IEEEPUP
 0x0a00

	)

57 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

58 
	#ETH_P_BATMAN
 0x4305

	)

59 
	#ETH_P_DEC
 0x6000

	)

60 
	#ETH_P_DNA_DL
 0x6001

	)

61 
	#ETH_P_DNA_RC
 0x6002

	)

62 
	#ETH_P_DNA_RT
 0x6003

	)

63 
	#ETH_P_LAT
 0x6004

	)

64 
	#ETH_P_DIAG
 0x6005

	)

65 
	#ETH_P_CUST
 0x6006

	)

66 
	#ETH_P_SCA
 0x6007

	)

67 
	#ETH_P_TEB
 0x6558

	)

68 
	#ETH_P_RARP
 0x8035

	)

69 
	#ETH_P_ATALK
 0x809B

	)

70 
	#ETH_P_AARP
 0x80F3

	)

71 
	#ETH_P_8021Q
 0x8100

	)

72 
	#ETH_P_ERSPAN
 0x88BE

	)

73 
	#ETH_P_IPX
 0x8137

	)

74 
	#ETH_P_IPV6
 0x86DD

	)

75 
	#ETH_P_PAUSE
 0x8808

	)

76 
	#ETH_P_SLOW
 0x8809

	)

77 
	#ETH_P_WCCP
 0x883E

	)

79 
	#ETH_P_MPLS_UC
 0x8847

	)

80 
	#ETH_P_MPLS_MC
 0x8848

	)

81 
	#ETH_P_ATMMPOA
 0x884ø

	)

82 
	#ETH_P_PPP_DISC
 0x8863

	)

83 
	#ETH_P_PPP_SES
 0x8864

	)

84 
	#ETH_P_LINK_CTL
 0x886ø

	)

85 
	#ETH_P_ATMFATE
 0x8884

	)

88 
	#ETH_P_PAE
 0x888E

	)

89 
	#ETH_P_AOE
 0x88A2

	)

90 
	#ETH_P_8021AD
 0x88A8

	)

91 
	#ETH_P_802_EX1
 0x88B5

	)

92 
	#ETH_P_PREAUTH
 0x88C7

	)

93 
	#ETH_P_TIPC
 0x88CA

	)

94 
	#ETH_P_LLDP
 0x88CC

	)

95 
	#ETH_P_MACSEC
 0x88E5

	)

96 
	#ETH_P_8021AH
 0x88E7

	)

97 
	#ETH_P_MVRP
 0x88F5

	)

98 
	#ETH_P_1588
 0x88F7

	)

99 
	#ETH_P_NCSI
 0x88F8

	)

100 
	#ETH_P_PRP
 0x88FB

	)

101 
	#ETH_P_FCOE
 0x8906

	)

102 
	#ETH_P_IBOE
 0x8915

	)

103 
	#ETH_P_TDLS
 0x890D

	)

104 
	#ETH_P_FIP
 0x8914

	)

105 
	#ETH_P_80221
 0x8917

	)

106 
	#ETH_P_HSR
 0x892F

	)

107 
	#ETH_P_NSH
 0x894F

	)

108 
	#ETH_P_LOOPBACK
 0x9000

	)

109 
	#ETH_P_QINQ1
 0x9100

	)

110 
	#ETH_P_QINQ2
 0x9200

	)

111 
	#ETH_P_QINQ3
 0x9300

	)

112 
	#ETH_P_EDSA
 0xDADA

	)

113 
	#ETH_P_DSA_8021Q
 0xDADB

	)

114 
	#ETH_P_IFE
 0xED3E

	)

115 
	#ETH_P_AF_IUCV
 0xFBFB

	)

117 
	#ETH_P_802_3_MIN
 0x0600

	)

124 
	#ETH_P_802_3
 0x0001

	)

125 
	#ETH_P_AX25
 0x0002

	)

126 
	#ETH_P_ALL
 0x0003

	)

127 
	#ETH_P_802_2
 0x0004

	)

128 
	#ETH_P_SNAP
 0x0005

	)

129 
	#ETH_P_DDCMP
 0x0006

	)

130 
	#ETH_P_WAN_PPP
 0x0007

	)

131 
	#ETH_P_PPP_MP
 0x0008

	)

132 
	#ETH_P_LOCALTALK
 0x0009

	)

133 
	#ETH_P_CAN
 0x000C

	)

134 
	#ETH_P_CANFD
 0x000D

	)

135 
	#ETH_P_PPPTALK
 0x0010

	)

136 
	#ETH_P_TR_802_2
 0x0011

	)

137 
	#ETH_P_MOBITEX
 0x0015

	)

138 
	#ETH_P_CONTROL
 0x0016

	)

139 
	#ETH_P_IRDA
 0x0017

	)

140 
	#ETH_P_ECONET
 0x0018

	)

141 
	#ETH_P_HDLC
 0x0019

	)

142 
	#ETH_P_ARCNET
 0x001A

	)

143 
	#ETH_P_DSA
 0x001B

	)

144 
	#ETH_P_TRAILER
 0x001C

	)

145 
	#ETH_P_PHONET
 0x00F5

	)

146 
	#ETH_P_IEEE802154
 0x00F6

	)

147 
	#ETH_P_CAIF
 0x00F7

	)

148 
	#ETH_P_XDSA
 0x00F8

	)

149 
	#ETH_P_MAP
 0x00F9

	)

158 #iâdeà
__UAPI_DEF_ETHHDR


159 
	#__UAPI_DEF_ETHHDR
 1

	)

162 #ià
__UAPI_DEF_ETHHDR


163 
	s‘hhdr
 {

164 
	mh_de¡
[
ETH_ALEN
];

165 
	mh_sourû
[
ETH_ALEN
];

166 
__be16
 
	mh_´Ùo
;

167 } 
__©Œibu‹__
((
·cked
));

	@/usr/include/linux/if_link.h

2 #iâdeà
_LINUX_IF_LINK_H


3 
	#_LINUX_IF_LINK_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/Ãšk.h
>

9 
	s¹Æ_lšk_¡©s
 {

10 
__u32
 
	mrx_·ck‘s
;

11 
__u32
 
	mtx_·ck‘s
;

12 
__u32
 
	mrx_by‹s
;

13 
__u32
 
	mtx_by‹s
;

14 
__u32
 
	mrx_”rÜs
;

15 
__u32
 
	mtx_”rÜs
;

16 
__u32
 
	mrx_drİ³d
;

17 
__u32
 
	mtx_drİ³d
;

18 
__u32
 
	mmuÉiÿ¡
;

19 
__u32
 
	mcŞlisiÚs
;

22 
__u32
 
	mrx_Ëngth_”rÜs
;

23 
__u32
 
	mrx_ov”_”rÜs
;

24 
__u32
 
	mrx_üc_”rÜs
;

25 
__u32
 
	mrx_äame_”rÜs
;

26 
__u32
 
	mrx_fifo_”rÜs
;

27 
__u32
 
	mrx_mis£d_”rÜs
;

30 
__u32
 
	mtx_abÜ‹d_”rÜs
;

31 
__u32
 
	mtx_ÿ¼›r_”rÜs
;

32 
__u32
 
	mtx_fifo_”rÜs
;

33 
__u32
 
	mtx_h—¹b—t_”rÜs
;

34 
__u32
 
	mtx_wšdow_”rÜs
;

37 
__u32
 
	mrx_com´es£d
;

38 
__u32
 
	mtx_com´es£d
;

40 
__u32
 
	mrx_nohªdËr
;

44 
	s¹Æ_lšk_¡©s64
 {

45 
__u64
 
	mrx_·ck‘s
;

46 
__u64
 
	mtx_·ck‘s
;

47 
__u64
 
	mrx_by‹s
;

48 
__u64
 
	mtx_by‹s
;

49 
__u64
 
	mrx_”rÜs
;

50 
__u64
 
	mtx_”rÜs
;

51 
__u64
 
	mrx_drİ³d
;

52 
__u64
 
	mtx_drİ³d
;

53 
__u64
 
	mmuÉiÿ¡
;

54 
__u64
 
	mcŞlisiÚs
;

57 
__u64
 
	mrx_Ëngth_”rÜs
;

58 
__u64
 
	mrx_ov”_”rÜs
;

59 
__u64
 
	mrx_üc_”rÜs
;

60 
__u64
 
	mrx_äame_”rÜs
;

61 
__u64
 
	mrx_fifo_”rÜs
;

62 
__u64
 
	mrx_mis£d_”rÜs
;

65 
__u64
 
	mtx_abÜ‹d_”rÜs
;

66 
__u64
 
	mtx_ÿ¼›r_”rÜs
;

67 
__u64
 
	mtx_fifo_”rÜs
;

68 
__u64
 
	mtx_h—¹b—t_”rÜs
;

69 
__u64
 
	mtx_wšdow_”rÜs
;

72 
__u64
 
	mrx_com´es£d
;

73 
__u64
 
	mtx_com´es£d
;

75 
__u64
 
	mrx_nohªdËr
;

79 
	s¹Æ_lšk_ifm­
 {

80 
__u64
 
	mmem_¡¬t
;

81 
__u64
 
	mmem_’d
;

82 
__u64
 
	mba£_addr
;

83 
__u16
 
	mœq
;

84 
__u8
 
	mdma
;

85 
__u8
 
	mpÜt
;

107 
	mIFLA_UNSPEC
,

108 
	mIFLA_ADDRESS
,

109 
	mIFLA_BROADCAST
,

110 
	mIFLA_IFNAME
,

111 
	mIFLA_MTU
,

112 
	mIFLA_LINK
,

113 
	mIFLA_QDISC
,

114 
	mIFLA_STATS
,

115 
	mIFLA_COST
,

116 
	#IFLA_COST
 
IFLA_COST


	)

117 
	mIFLA_PRIORITY
,

118 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

119 
	mIFLA_MASTER
,

120 
	#IFLA_MASTER
 
IFLA_MASTER


	)

121 
	mIFLA_WIRELESS
,

122 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

123 
	mIFLA_PROTINFO
,

124 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

125 
	mIFLA_TXQLEN
,

126 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

127 
	mIFLA_MAP
,

128 
	#IFLA_MAP
 
IFLA_MAP


	)

129 
	mIFLA_WEIGHT
,

130 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

131 
	mIFLA_OPERSTATE
,

132 
	mIFLA_LINKMODE
,

133 
	mIFLA_LINKINFO
,

134 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

135 
	mIFLA_NET_NS_PID
,

136 
	mIFLA_IFALIAS
,

137 
	mIFLA_NUM_VF
,

138 
	mIFLA_VFINFO_LIST
,

139 
	mIFLA_STATS64
,

140 
	mIFLA_VF_PORTS
,

141 
	mIFLA_PORT_SELF
,

142 
	mIFLA_AF_SPEC
,

143 
	mIFLA_GROUP
,

144 
	mIFLA_NET_NS_FD
,

145 
	mIFLA_EXT_MASK
,

146 
	mIFLA_PROMISCUITY
,

147 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

148 
	mIFLA_NUM_TX_QUEUES
,

149 
	mIFLA_NUM_RX_QUEUES
,

150 
	mIFLA_CARRIER
,

151 
	mIFLA_PHYS_PORT_ID
,

152 
	mIFLA_CARRIER_CHANGES
,

153 
	mIFLA_PHYS_SWITCH_ID
,

154 
	mIFLA_LINK_NETNSID
,

155 
	mIFLA_PHYS_PORT_NAME
,

156 
	mIFLA_PROTO_DOWN
,

157 
	mIFLA_GSO_MAX_SEGS
,

158 
	mIFLA_GSO_MAX_SIZE
,

159 
	mIFLA_PAD
,

160 
	mIFLA_XDP
,

161 
	mIFLA_EVENT
,

162 
	mIFLA_NEW_NETNSID
,

163 
	mIFLA_IF_NETNSID
,

164 
	mIFLA_TARGET_NETNSID
 = 
IFLA_IF_NETNSID
,

165 
	mIFLA_CARRIER_UP_COUNT
,

166 
	mIFLA_CARRIER_DOWN_COUNT
,

167 
	mIFLA_NEW_IFINDEX
,

168 
	mIFLA_MIN_MTU
,

169 
	mIFLA_MAX_MTU
,

170 
	m__IFLA_MAX


174 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

177 
	#IFLA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
ifšfomsg
))))

	)

178 
	#IFLA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
ifšfomsg
))

	)

181 
	mIFLA_INET_UNSPEC
,

182 
	mIFLA_INET_CONF
,

183 
	m__IFLA_INET_MAX
,

186 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

219 
	mIFLA_INET6_UNSPEC
,

220 
	mIFLA_INET6_FLAGS
,

221 
	mIFLA_INET6_CONF
,

222 
	mIFLA_INET6_STATS
,

223 
	mIFLA_INET6_MCAST
,

224 
	mIFLA_INET6_CACHEINFO
,

225 
	mIFLA_INET6_ICMP6STATS
,

226 
	mIFLA_INET6_TOKEN
,

227 
	mIFLA_INET6_ADDR_GEN_MODE
,

228 
	m__IFLA_INET6_MAX


231 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

233 
	eš6_addr_g’_mode
 {

234 
	mIN6_ADDR_GEN_MODE_EUI64
,

235 
	mIN6_ADDR_GEN_MODE_NONE
,

236 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

237 
	mIN6_ADDR_GEN_MODE_RANDOM
,

243 
	mIFLA_BR_UNSPEC
,

244 
	mIFLA_BR_FORWARD_DELAY
,

245 
	mIFLA_BR_HELLO_TIME
,

246 
	mIFLA_BR_MAX_AGE
,

247 
	mIFLA_BR_AGEING_TIME
,

248 
	mIFLA_BR_STP_STATE
,

249 
	mIFLA_BR_PRIORITY
,

250 
	mIFLA_BR_VLAN_FILTERING
,

251 
	mIFLA_BR_VLAN_PROTOCOL
,

252 
	mIFLA_BR_GROUP_FWD_MASK
,

253 
	mIFLA_BR_ROOT_ID
,

254 
	mIFLA_BR_BRIDGE_ID
,

255 
	mIFLA_BR_ROOT_PORT
,

256 
	mIFLA_BR_ROOT_PATH_COST
,

257 
	mIFLA_BR_TOPOLOGY_CHANGE
,

258 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

259 
	mIFLA_BR_HELLO_TIMER
,

260 
	mIFLA_BR_TCN_TIMER
,

261 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

262 
	mIFLA_BR_GC_TIMER
,

263 
	mIFLA_BR_GROUP_ADDR
,

264 
	mIFLA_BR_FDB_FLUSH
,

265 
	mIFLA_BR_MCAST_ROUTER
,

266 
	mIFLA_BR_MCAST_SNOOPING
,

267 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

268 
	mIFLA_BR_MCAST_QUERIER
,

269 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

270 
	mIFLA_BR_MCAST_HASH_MAX
,

271 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

272 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

273 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

274 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

275 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

276 
	mIFLA_BR_MCAST_QUERY_INTVL
,

277 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

278 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

279 
	mIFLA_BR_NF_CALL_IPTABLES
,

280 
	mIFLA_BR_NF_CALL_IP6TABLES
,

281 
	mIFLA_BR_NF_CALL_ARPTABLES
,

282 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

283 
	mIFLA_BR_PAD
,

284 
	mIFLA_BR_VLAN_STATS_ENABLED
,

285 
	mIFLA_BR_MCAST_STATS_ENABLED
,

286 
	mIFLA_BR_MCAST_IGMP_VERSION
,

287 
	mIFLA_BR_MCAST_MLD_VERSION
,

288 
	mIFLA_BR_VLAN_STATS_PER_PORT
,

289 
	mIFLA_BR_MULTI_BOOLOPT
,

290 
	m__IFLA_BR_MAX
,

293 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

295 
	siæa_bridge_id
 {

296 
__u8
 
	m´io
[2];

297 
__u8
 
	maddr
[6];

301 
	mBRIDGE_MODE_UNSPEC
,

302 
	mBRIDGE_MODE_HAIRPIN
,

306 
	mIFLA_BRPORT_UNSPEC
,

307 
	mIFLA_BRPORT_STATE
,

308 
	mIFLA_BRPORT_PRIORITY
,

309 
	mIFLA_BRPORT_COST
,

310 
	mIFLA_BRPORT_MODE
,

311 
	mIFLA_BRPORT_GUARD
,

312 
	mIFLA_BRPORT_PROTECT
,

313 
	mIFLA_BRPORT_FAST_LEAVE
,

314 
	mIFLA_BRPORT_LEARNING
,

315 
	mIFLA_BRPORT_UNICAST_FLOOD
,

316 
	mIFLA_BRPORT_PROXYARP
,

317 
	mIFLA_BRPORT_LEARNING_SYNC
,

318 
	mIFLA_BRPORT_PROXYARP_WIFI
,

319 
	mIFLA_BRPORT_ROOT_ID
,

320 
	mIFLA_BRPORT_BRIDGE_ID
,

321 
	mIFLA_BRPORT_DESIGNATED_PORT
,

322 
	mIFLA_BRPORT_DESIGNATED_COST
,

323 
	mIFLA_BRPORT_ID
,

324 
	mIFLA_BRPORT_NO
,

325 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

326 
	mIFLA_BRPORT_CONFIG_PENDING
,

327 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

328 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

329 
	mIFLA_BRPORT_HOLD_TIMER
,

330 
	mIFLA_BRPORT_FLUSH
,

331 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

332 
	mIFLA_BRPORT_PAD
,

333 
	mIFLA_BRPORT_MCAST_FLOOD
,

334 
	mIFLA_BRPORT_MCAST_TO_UCAST
,

335 
	mIFLA_BRPORT_VLAN_TUNNEL
,

336 
	mIFLA_BRPORT_BCAST_FLOOD
,

337 
	mIFLA_BRPORT_GROUP_FWD_MASK
,

338 
	mIFLA_BRPORT_NEIGH_SUPPRESS
,

339 
	mIFLA_BRPORT_ISOLATED
,

340 
	mIFLA_BRPORT_BACKUP_PORT
,

341 
	m__IFLA_BRPORT_MAX


343 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

345 
	siæa_ÿchešfo
 {

346 
__u32
 
	mmax_»asm_Ën
;

347 
__u32
 
	mt¡amp
;

348 
__u32
 
	m»achabË_time
;

349 
__u32
 
	m»Œªs_time
;

353 
	mIFLA_INFO_UNSPEC
,

354 
	mIFLA_INFO_KIND
,

355 
	mIFLA_INFO_DATA
,

356 
	mIFLA_INFO_XSTATS
,

357 
	mIFLA_INFO_SLAVE_KIND
,

358 
	mIFLA_INFO_SLAVE_DATA
,

359 
	m__IFLA_INFO_MAX
,

362 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

367 
	mIFLA_VLAN_UNSPEC
,

368 
	mIFLA_VLAN_ID
,

369 
	mIFLA_VLAN_FLAGS
,

370 
	mIFLA_VLAN_EGRESS_QOS
,

371 
	mIFLA_VLAN_INGRESS_QOS
,

372 
	mIFLA_VLAN_PROTOCOL
,

373 
	m__IFLA_VLAN_MAX
,

376 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

378 
	siæa_vÏn_æags
 {

379 
__u32
 
	mæags
;

380 
__u32
 
	mmask
;

384 
	mIFLA_VLAN_QOS_UNSPEC
,

385 
	mIFLA_VLAN_QOS_MAPPING
,

386 
	m__IFLA_VLAN_QOS_MAX


389 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

391 
	siæa_vÏn_qos_m­pšg
 {

392 
__u32
 
	mäom
;

393 
__u32
 
	mto
;

398 
	mIFLA_MACVLAN_UNSPEC
,

399 
	mIFLA_MACVLAN_MODE
,

400 
	mIFLA_MACVLAN_FLAGS
,

401 
	mIFLA_MACVLAN_MACADDR_MODE
,

402 
	mIFLA_MACVLAN_MACADDR
,

403 
	mIFLA_MACVLAN_MACADDR_DATA
,

404 
	mIFLA_MACVLAN_MACADDR_COUNT
,

405 
	m__IFLA_MACVLAN_MAX
,

408 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

410 
	emacvÏn_mode
 {

411 
	mMACVLAN_MODE_PRIVATE
 = 1,

412 
	mMACVLAN_MODE_VEPA
 = 2,

413 
	mMACVLAN_MODE_BRIDGE
 = 4,

414 
	mMACVLAN_MODE_PASSTHRU
 = 8,

415 
	mMACVLAN_MODE_SOURCE
 = 16,

418 
	emacvÏn_maÿddr_mode
 {

419 
	mMACVLAN_MACADDR_ADD
,

420 
	mMACVLAN_MACADDR_DEL
,

421 
	mMACVLAN_MACADDR_FLUSH
,

422 
	mMACVLAN_MACADDR_SET
,

425 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

429 
	mIFLA_VRF_UNSPEC
,

430 
	mIFLA_VRF_TABLE
,

431 
	m__IFLA_VRF_MAX


434 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

437 
	mIFLA_VRF_PORT_UNSPEC
,

438 
	mIFLA_VRF_PORT_TABLE
,

439 
	m__IFLA_VRF_PORT_MAX


442 
	#IFLA_VRF_PORT_MAX
 (
__IFLA_VRF_PORT_MAX
 - 1)

	)

446 
	mIFLA_MACSEC_UNSPEC
,

447 
	mIFLA_MACSEC_SCI
,

448 
	mIFLA_MACSEC_PORT
,

449 
	mIFLA_MACSEC_ICV_LEN
,

450 
	mIFLA_MACSEC_CIPHER_SUITE
,

451 
	mIFLA_MACSEC_WINDOW
,

452 
	mIFLA_MACSEC_ENCODING_SA
,

453 
	mIFLA_MACSEC_ENCRYPT
,

454 
	mIFLA_MACSEC_PROTECT
,

455 
	mIFLA_MACSEC_INC_SCI
,

456 
	mIFLA_MACSEC_ES
,

457 
	mIFLA_MACSEC_SCB
,

458 
	mIFLA_MACSEC_REPLAY_PROTECT
,

459 
	mIFLA_MACSEC_VALIDATION
,

460 
	mIFLA_MACSEC_PAD
,

461 
	m__IFLA_MACSEC_MAX
,

464 
	#IFLA_MACSEC_MAX
 (
__IFLA_MACSEC_MAX
 - 1)

	)

468 
	mIFLA_XFRM_UNSPEC
,

469 
	mIFLA_XFRM_LINK
,

470 
	mIFLA_XFRM_IF_ID
,

471 
	m__IFLA_XFRM_MAX


474 
	#IFLA_XFRM_MAX
 (
__IFLA_XFRM_MAX
 - 1)

	)

476 
	emac£c_v®id©iÚ_ty³
 {

477 
	mMACSEC_VALIDATE_DISABLED
 = 0,

478 
	mMACSEC_VALIDATE_CHECK
 = 1,

479 
	mMACSEC_VALIDATE_STRICT
 = 2,

480 
	m__MACSEC_VALIDATE_END
,

481 
	mMACSEC_VALIDATE_MAX
 = 
__MACSEC_VALIDATE_END
 - 1,

486 
	mIFLA_IPVLAN_UNSPEC
,

487 
	mIFLA_IPVLAN_MODE
,

488 
	mIFLA_IPVLAN_FLAGS
,

489 
	m__IFLA_IPVLAN_MAX


492 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

494 
	evÏn_mode
 {

495 
	mIPVLAN_MODE_L2
 = 0,

496 
	mIPVLAN_MODE_L3
,

497 
	mIPVLAN_MODE_L3S
,

498 
	mIPVLAN_MODE_MAX


501 
	#IPVLAN_F_PRIVATE
 0x01

	)

502 
	#IPVLAN_F_VEPA
 0x02

	)

506 
	mIFLA_VXLAN_UNSPEC
,

507 
	mIFLA_VXLAN_ID
,

508 
	mIFLA_VXLAN_GROUP
,

509 
	mIFLA_VXLAN_LINK
,

510 
	mIFLA_VXLAN_LOCAL
,

511 
	mIFLA_VXLAN_TTL
,

512 
	mIFLA_VXLAN_TOS
,

513 
	mIFLA_VXLAN_LEARNING
,

514 
	mIFLA_VXLAN_AGEING
,

515 
	mIFLA_VXLAN_LIMIT
,

516 
	mIFLA_VXLAN_PORT_RANGE
,

517 
	mIFLA_VXLAN_PROXY
,

518 
	mIFLA_VXLAN_RSC
,

519 
	mIFLA_VXLAN_L2MISS
,

520 
	mIFLA_VXLAN_L3MISS
,

521 
	mIFLA_VXLAN_PORT
,

522 
	mIFLA_VXLAN_GROUP6
,

523 
	mIFLA_VXLAN_LOCAL6
,

524 
	mIFLA_VXLAN_UDP_CSUM
,

525 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

526 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

527 
	mIFLA_VXLAN_REMCSUM_TX
,

528 
	mIFLA_VXLAN_REMCSUM_RX
,

529 
	mIFLA_VXLAN_GBP
,

530 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

531 
	mIFLA_VXLAN_COLLECT_METADATA
,

532 
	mIFLA_VXLAN_LABEL
,

533 
	mIFLA_VXLAN_GPE
,

534 
	mIFLA_VXLAN_TTL_INHERIT
,

535 
	mIFLA_VXLAN_DF
,

536 
	mIFLA_VXLAN_FAN_MAP
 = 33,

537 
	m__IFLA_VXLAN_MAX


539 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

541 
	siæa_vxÏn_pÜt_¿nge
 {

542 
__be16
 
	mlow
;

543 
__be16
 
	mhigh
;

546 
	eiæa_vxÏn_df
 {

547 
	mVXLAN_DF_UNSET
 = 0,

548 
	mVXLAN_DF_SET
,

549 
	mVXLAN_DF_INHERIT
,

550 
	m__VXLAN_DF_END
,

551 
	mVXLAN_DF_MAX
 = 
__VXLAN_DF_END
 - 1,

556 
	mIFLA_GENEVE_UNSPEC
,

557 
	mIFLA_GENEVE_ID
,

558 
	mIFLA_GENEVE_REMOTE
,

559 
	mIFLA_GENEVE_TTL
,

560 
	mIFLA_GENEVE_TOS
,

561 
	mIFLA_GENEVE_PORT
,

562 
	mIFLA_GENEVE_COLLECT_METADATA
,

563 
	mIFLA_GENEVE_REMOTE6
,

564 
	mIFLA_GENEVE_UDP_CSUM
,

565 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

566 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

567 
	mIFLA_GENEVE_LABEL
,

568 
	mIFLA_GENEVE_TTL_INHERIT
,

569 
	mIFLA_GENEVE_DF
,

570 
	m__IFLA_GENEVE_MAX


572 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

574 
	eiæa_g’eve_df
 {

575 
	mGENEVE_DF_UNSET
 = 0,

576 
	mGENEVE_DF_SET
,

577 
	mGENEVE_DF_INHERIT
,

578 
	m__GENEVE_DF_END
,

579 
	mGENEVE_DF_MAX
 = 
__GENEVE_DF_END
 - 1,

584 
	mIFLA_PPP_UNSPEC
,

585 
	mIFLA_PPP_DEV_FD
,

586 
	m__IFLA_PPP_MAX


588 
	#IFLA_PPP_MAX
 (
__IFLA_PPP_MAX
 - 1)

	)

592 
	eiæa_g_rŞe
 {

593 
	mGTP_ROLE_GGSN
 = 0,

594 
	mGTP_ROLE_SGSN
,

598 
	mIFLA_GTP_UNSPEC
,

599 
	mIFLA_GTP_FD0
,

600 
	mIFLA_GTP_FD1
,

601 
	mIFLA_GTP_PDP_HASHSIZE
,

602 
	mIFLA_GTP_ROLE
,

603 
	m__IFLA_GTP_MAX
,

605 
	#IFLA_GTP_MAX
 (
__IFLA_GTP_MAX
 - 1)

	)

610 
	mIFLA_BOND_UNSPEC
,

611 
	mIFLA_BOND_MODE
,

612 
	mIFLA_BOND_ACTIVE_SLAVE
,

613 
	mIFLA_BOND_MIIMON
,

614 
	mIFLA_BOND_UPDELAY
,

615 
	mIFLA_BOND_DOWNDELAY
,

616 
	mIFLA_BOND_USE_CARRIER
,

617 
	mIFLA_BOND_ARP_INTERVAL
,

618 
	mIFLA_BOND_ARP_IP_TARGET
,

619 
	mIFLA_BOND_ARP_VALIDATE
,

620 
	mIFLA_BOND_ARP_ALL_TARGETS
,

621 
	mIFLA_BOND_PRIMARY
,

622 
	mIFLA_BOND_PRIMARY_RESELECT
,

623 
	mIFLA_BOND_FAIL_OVER_MAC
,

624 
	mIFLA_BOND_XMIT_HASH_POLICY
,

625 
	mIFLA_BOND_RESEND_IGMP
,

626 
	mIFLA_BOND_NUM_PEER_NOTIF
,

627 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

628 
	mIFLA_BOND_MIN_LINKS
,

629 
	mIFLA_BOND_LP_INTERVAL
,

630 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

631 
	mIFLA_BOND_AD_LACP_RATE
,

632 
	mIFLA_BOND_AD_SELECT
,

633 
	mIFLA_BOND_AD_INFO
,

634 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

635 
	mIFLA_BOND_AD_USER_PORT_KEY
,

636 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

637 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

638 
	mIFLA_BOND_PEER_NOTIF_DELAY
,

639 
	m__IFLA_BOND_MAX
,

642 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

645 
	mIFLA_BOND_AD_INFO_UNSPEC
,

646 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

647 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

648 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

649 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

650 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

651 
	m__IFLA_BOND_AD_INFO_MAX
,

654 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

657 
	mIFLA_BOND_SLAVE_UNSPEC
,

658 
	mIFLA_BOND_SLAVE_STATE
,

659 
	mIFLA_BOND_SLAVE_MII_STATUS
,

660 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

661 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

662 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

663 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

664 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

665 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

666 
	m__IFLA_BOND_SLAVE_MAX
,

669 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

674 
	mIFLA_VF_INFO_UNSPEC
,

675 
	mIFLA_VF_INFO
,

676 
	m__IFLA_VF_INFO_MAX
,

679 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

682 
	mIFLA_VF_UNSPEC
,

683 
	mIFLA_VF_MAC
,

684 
	mIFLA_VF_VLAN
,

685 
	mIFLA_VF_TX_RATE
,

686 
	mIFLA_VF_SPOOFCHK
,

687 
	mIFLA_VF_LINK_STATE
,

688 
	mIFLA_VF_RATE
,

689 
	mIFLA_VF_RSS_QUERY_EN
,

692 
	mIFLA_VF_STATS
,

693 
	mIFLA_VF_TRUST
,

694 
	mIFLA_VF_IB_NODE_GUID
,

695 
	mIFLA_VF_IB_PORT_GUID
,

696 
	mIFLA_VF_VLAN_LIST
,

697 
	mIFLA_VF_BROADCAST
,

698 
	m__IFLA_VF_MAX
,

701 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

703 
	siæa_vf_mac
 {

704 
__u32
 
	mvf
;

705 
__u8
 
	mmac
[32];

708 
	siæa_vf_brßdÿ¡
 {

709 
__u8
 
	mbrßdÿ¡
[32];

712 
	siæa_vf_vÏn
 {

713 
__u32
 
	mvf
;

714 
__u32
 
	mvÏn
;

715 
__u32
 
	mqos
;

719 
	mIFLA_VF_VLAN_INFO_UNSPEC
,

720 
	mIFLA_VF_VLAN_INFO
,

721 
	m__IFLA_VF_VLAN_INFO_MAX
,

724 
	#IFLA_VF_VLAN_INFO_MAX
 (
__IFLA_VF_VLAN_INFO_MAX
 - 1)

	)

725 
	#MAX_VLAN_LIST_LEN
 1

	)

727 
	siæa_vf_vÏn_šfo
 {

728 
__u32
 
	mvf
;

729 
__u32
 
	mvÏn
;

730 
__u32
 
	mqos
;

731 
__be16
 
	mvÏn_´Ùo
;

734 
	siæa_vf_tx_¿‹
 {

735 
__u32
 
	mvf
;

736 
__u32
 
	m¿‹
;

739 
	siæa_vf_¿‹
 {

740 
__u32
 
	mvf
;

741 
__u32
 
	mmš_tx_¿‹
;

742 
__u32
 
	mmax_tx_¿‹
;

745 
	siæa_vf_¥oofchk
 {

746 
__u32
 
	mvf
;

747 
__u32
 
	m£‰šg
;

750 
	siæa_vf_guid
 {

751 
__u32
 
	mvf
;

752 
__u64
 
	mguid
;

756 
	mIFLA_VF_LINK_STATE_AUTO
,

757 
	mIFLA_VF_LINK_STATE_ENABLE
,

758 
	mIFLA_VF_LINK_STATE_DISABLE
,

759 
	m__IFLA_VF_LINK_STATE_MAX
,

762 
	siæa_vf_lšk_¡©e
 {

763 
__u32
 
	mvf
;

764 
__u32
 
	mlšk_¡©e
;

767 
	siæa_vf_rss_qu”y_’
 {

768 
__u32
 
	mvf
;

769 
__u32
 
	m£‰šg
;

773 
	mIFLA_VF_STATS_RX_PACKETS
,

774 
	mIFLA_VF_STATS_TX_PACKETS
,

775 
	mIFLA_VF_STATS_RX_BYTES
,

776 
	mIFLA_VF_STATS_TX_BYTES
,

777 
	mIFLA_VF_STATS_BROADCAST
,

778 
	mIFLA_VF_STATS_MULTICAST
,

779 
	mIFLA_VF_STATS_PAD
,

780 
	mIFLA_VF_STATS_RX_DROPPED
,

781 
	mIFLA_VF_STATS_TX_DROPPED
,

782 
	m__IFLA_VF_STATS_MAX
,

785 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

787 
	siæa_vf_Œu¡
 {

788 
__u32
 
	mvf
;

789 
__u32
 
	m£‰šg
;

808 
	mIFLA_VF_PORT_UNSPEC
,

809 
	mIFLA_VF_PORT
,

810 
	m__IFLA_VF_PORT_MAX
,

813 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

816 
	mIFLA_PORT_UNSPEC
,

817 
	mIFLA_PORT_VF
,

818 
	mIFLA_PORT_PROFILE
,

819 
	mIFLA_PORT_VSI_TYPE
,

820 
	mIFLA_PORT_INSTANCE_UUID
,

821 
	mIFLA_PORT_HOST_UUID
,

822 
	mIFLA_PORT_REQUEST
,

823 
	mIFLA_PORT_RESPONSE
,

824 
	m__IFLA_PORT_MAX
,

827 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

829 
	#PORT_PROFILE_MAX
 40

	)

830 
	#PORT_UUID_MAX
 16

	)

831 
	#PORT_SELF_VF
 -1

	)

834 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

835 
	mPORT_REQUEST_PREASSOCIATE_RR
,

836 
	mPORT_REQUEST_ASSOCIATE
,

837 
	mPORT_REQUEST_DISASSOCIATE
,

841 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

842 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

843 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

844 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

845 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

846 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

847 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

849 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

850 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

851 
	mPORT_PROFILE_RESPONSE_INVALID
,

852 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

853 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

854 
	mPORT_PROFILE_RESPONSE_ERROR
,

857 
	siæa_pÜt_vsi
 {

858 
__u8
 
	mvsi_mgr_id
;

859 
__u8
 
	mvsi_ty³_id
[3];

860 
__u8
 
	mvsi_ty³_v”siÚ
;

861 
__u8
 
	m·d
[3];

868 
	mIFLA_IPOIB_UNSPEC
,

869 
	mIFLA_IPOIB_PKEY
,

870 
	mIFLA_IPOIB_MODE
,

871 
	mIFLA_IPOIB_UMCAST
,

872 
	m__IFLA_IPOIB_MAX


876 
	mIPOIB_MODE_DATAGRAM
 = 0,

877 
	mIPOIB_MODE_CONNECTED
 = 1,

880 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

886 
	mIFLA_HSR_UNSPEC
,

887 
	mIFLA_HSR_SLAVE1
,

888 
	mIFLA_HSR_SLAVE2
,

889 
	mIFLA_HSR_MULTICAST_SPEC
,

890 
	mIFLA_HSR_SUPERVISION_ADDR
,

891 
	mIFLA_HSR_SEQ_NR
,

892 
	mIFLA_HSR_VERSION
,

893 
	m__IFLA_HSR_MAX
,

896 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

900 
	sif_¡©s_msg
 {

901 
__u8
 
	mçmy
;

902 
__u8
 
	m·d1
;

903 
__u16
 
	m·d2
;

904 
__u32
 
	mifšdex
;

905 
__u32
 
	mf‹r_mask
;

912 
	mIFLA_STATS_UNSPEC
,

913 
	mIFLA_STATS_LINK_64
,

914 
	mIFLA_STATS_LINK_XSTATS
,

915 
	mIFLA_STATS_LINK_XSTATS_SLAVE
,

916 
	mIFLA_STATS_LINK_OFFLOAD_XSTATS
,

917 
	mIFLA_STATS_AF_SPEC
,

918 
	m__IFLA_STATS_MAX
,

921 
	#IFLA_STATS_MAX
 (
__IFLA_STATS_MAX
 - 1)

	)

923 
	#IFLA_STATS_FILTER_BIT
(
ATTR
è(1 << (ATTR - 1))

	)

931 
	mLINK_XSTATS_TYPE_UNSPEC
,

932 
	mLINK_XSTATS_TYPE_BRIDGE
,

933 
	mLINK_XSTATS_TYPE_BOND
,

934 
	m__LINK_XSTATS_TYPE_MAX


936 
	#LINK_XSTATS_TYPE_MAX
 (
__LINK_XSTATS_TYPE_MAX
 - 1)

	)

940 
	mIFLA_OFFLOAD_XSTATS_UNSPEC
,

941 
	mIFLA_OFFLOAD_XSTATS_CPU_HIT
,

942 
	m__IFLA_OFFLOAD_XSTATS_MAX


944 
	#IFLA_OFFLOAD_XSTATS_MAX
 (
__IFLA_OFFLOAD_XSTATS_MAX
 - 1)

	)

948 
	#XDP_FLAGS_UPDATE_IF_NOEXIST
 (1U << 0)

	)

949 
	#XDP_FLAGS_SKB_MODE
 (1U << 1)

	)

950 
	#XDP_FLAGS_DRV_MODE
 (1U << 2)

	)

951 
	#XDP_FLAGS_HW_MODE
 (1U << 3)

	)

952 
	#XDP_FLAGS_MODES
 (
XDP_FLAGS_SKB_MODE
 | \

953 
XDP_FLAGS_DRV_MODE
 | \

954 
XDP_FLAGS_HW_MODE
)

	)

955 
	#XDP_FLAGS_MASK
 (
XDP_FLAGS_UPDATE_IF_NOEXIST
 | \

956 
XDP_FLAGS_MODES
)

	)

960 
	mXDP_ATTACHED_NONE
 = 0,

961 
	mXDP_ATTACHED_DRV
,

962 
	mXDP_ATTACHED_SKB
,

963 
	mXDP_ATTACHED_HW
,

964 
	mXDP_ATTACHED_MULTI
,

968 
	mIFLA_XDP_UNSPEC
,

969 
	mIFLA_XDP_FD
,

970 
	mIFLA_XDP_ATTACHED
,

971 
	mIFLA_XDP_FLAGS
,

972 
	mIFLA_XDP_PROG_ID
,

973 
	mIFLA_XDP_DRV_PROG_ID
,

974 
	mIFLA_XDP_SKB_PROG_ID
,

975 
	mIFLA_XDP_HW_PROG_ID
,

976 
	m__IFLA_XDP_MAX
,

979 
	#IFLA_XDP_MAX
 (
__IFLA_XDP_MAX
 - 1)

	)

982 
	mIFLA_EVENT_NONE
,

983 
	mIFLA_EVENT_REBOOT
,

984 
	mIFLA_EVENT_FEATURES
,

985 
	mIFLA_EVENT_BONDING_FAILOVER
,

986 
	mIFLA_EVENT_NOTIFY_PEERS
,

987 
	mIFLA_EVENT_IGMP_RESEND
,

988 
	mIFLA_EVENT_BONDING_OPTIONS
,

994 
	mIFLA_TUN_UNSPEC
,

995 
	mIFLA_TUN_OWNER
,

996 
	mIFLA_TUN_GROUP
,

997 
	mIFLA_TUN_TYPE
,

998 
	mIFLA_TUN_PI
,

999 
	mIFLA_TUN_VNET_HDR
,

1000 
	mIFLA_TUN_PERSIST
,

1001 
	mIFLA_TUN_MULTI_QUEUE
,

1002 
	mIFLA_TUN_NUM_QUEUES
,

1003 
	mIFLA_TUN_NUM_DISABLED_QUEUES
,

1004 
	m__IFLA_TUN_MAX
,

1007 
	#IFLA_TUN_MAX
 (
__IFLA_TUN_MAX
 - 1)

	)

1011 
	#RMNET_FLAGS_INGRESS_DEAGGREGATION
 (1U << 0)

	)

1012 
	#RMNET_FLAGS_INGRESS_MAP_COMMANDS
 (1U << 1)

	)

1013 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV4
 (1U << 2)

	)

1014 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV4
 (1U << 3)

	)

1017 
	mIFLA_RMNET_UNSPEC
,

1018 
	mIFLA_RMNET_MUX_ID
,

1019 
	mIFLA_RMNET_FLAGS
,

1020 
	m__IFLA_RMNET_MAX
,

1023 
	#IFLA_RMNET_MAX
 (
__IFLA_RMNET_MAX
 - 1)

	)

1025 
	siæa_rmÃt_æags
 {

1026 
__u32
 
	mæags
;

1027 
__u32
 
	mmask
;

	@/usr/include/linux/if_packet.h

2 #iâdeà
__LINUX_IF_PACKET_H


3 
	#__LINUX_IF_PACKET_H


	)

5 
	~<lšux/ty³s.h
>

7 
	ssockaddr_pkt
 {

8 
	m¥kt_çmy
;

9 
	m¥kt_deviû
[14];

10 
__be16
 
	m¥kt_´ÙocŞ
;

13 
	ssockaddr_Î
 {

14 
	m¦l_çmy
;

15 
__be16
 
	m¦l_´ÙocŞ
;

16 
	m¦l_ifšdex
;

17 
	m¦l_h©y³
;

18 
	m¦l_pk‰y³
;

19 
	m¦l_h®’
;

20 
	m¦l_addr
[8];

25 
	#PACKET_HOST
 0

	)

26 
	#PACKET_BROADCAST
 1

	)

27 
	#PACKET_MULTICAST
 2

	)

28 
	#PACKET_OTHERHOST
 3

	)

29 
	#PACKET_OUTGOING
 4

	)

30 
	#PACKET_LOOPBACK
 5

	)

31 
	#PACKET_USER
 6

	)

32 
	#PACKET_KERNEL
 7

	)

34 
	#PACKET_FASTROUTE
 6

	)

38 
	#PACKET_ADD_MEMBERSHIP
 1

	)

39 
	#PACKET_DROP_MEMBERSHIP
 2

	)

40 
	#PACKET_RECV_OUTPUT
 3

	)

42 
	#PACKET_RX_RING
 5

	)

43 
	#PACKET_STATISTICS
 6

	)

44 
	#PACKET_COPY_THRESH
 7

	)

45 
	#PACKET_AUXDATA
 8

	)

46 
	#PACKET_ORIGDEV
 9

	)

47 
	#PACKET_VERSION
 10

	)

48 
	#PACKET_HDRLEN
 11

	)

49 
	#PACKET_RESERVE
 12

	)

50 
	#PACKET_TX_RING
 13

	)

51 
	#PACKET_LOSS
 14

	)

52 
	#PACKET_VNET_HDR
 15

	)

53 
	#PACKET_TX_TIMESTAMP
 16

	)

54 
	#PACKET_TIMESTAMP
 17

	)

55 
	#PACKET_FANOUT
 18

	)

56 
	#PACKET_TX_HAS_OFF
 19

	)

57 
	#PACKET_QDISC_BYPASS
 20

	)

58 
	#PACKET_ROLLOVER_STATS
 21

	)

59 
	#PACKET_FANOUT_DATA
 22

	)

60 
	#PACKET_IGNORE_OUTGOING
 23

	)

62 
	#PACKET_FANOUT_HASH
 0

	)

63 
	#PACKET_FANOUT_LB
 1

	)

64 
	#PACKET_FANOUT_CPU
 2

	)

65 
	#PACKET_FANOUT_ROLLOVER
 3

	)

66 
	#PACKET_FANOUT_RND
 4

	)

67 
	#PACKET_FANOUT_QM
 5

	)

68 
	#PACKET_FANOUT_CBPF
 6

	)

69 
	#PACKET_FANOUT_EBPF
 7

	)

70 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

71 
	#PACKET_FANOUT_FLAG_UNIQUEID
 0x2000

	)

72 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

74 
	sack‘_¡©s
 {

75 
	m_·ck‘s
;

76 
	m_drİs
;

79 
	sack‘_¡©s_v3
 {

80 
	m_·ck‘s
;

81 
	m_drİs
;

82 
	m_ä“ze_q_út
;

85 
	sack‘_rŞlov”_¡©s
 {

86 
__®igÃd_u64
 
	m_®l
;

87 
__®igÃd_u64
 
	m_huge
;

88 
__®igÃd_u64
 
	m_çed
;

91 
	uack‘_¡©s_u
 {

92 
ack‘_¡©s
 
	m¡©s1
;

93 
ack‘_¡©s_v3
 
	m¡©s3
;

96 
	sack‘_auxd©a
 {

97 
__u32
 
	m_¡©us
;

98 
__u32
 
	m_Ën
;

99 
__u32
 
	m_¢­Ën
;

100 
__u16
 
	m_mac
;

101 
__u16
 
	m_Ãt
;

102 
__u16
 
	m_vÏn_tci
;

103 
__u16
 
	m_vÏn_id
;

107 
	#TP_STATUS_KERNEL
 0

	)

108 
	#TP_STATUS_USER
 (1 << 0)

	)

109 
	#TP_STATUS_COPY
 (1 << 1)

	)

110 
	#TP_STATUS_LOSING
 (1 << 2)

	)

111 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

112 
	#TP_STATUS_VLAN_VALID
 (1 << 4è

	)

113 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

114 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6è

	)

115 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

118 
	#TP_STATUS_AVAILABLE
 0

	)

119 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

120 
	#TP_STATUS_SENDING
 (1 << 1)

	)

121 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

124 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

125 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30è

	)

126 
	#TP_STATUS_TS_RAW_HARDWARE
 (1U << 31)

	)

129 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

131 
	sack‘_hdr
 {

132 
	m_¡©us
;

133 
	m_Ën
;

134 
	m_¢­Ën
;

135 
	m_mac
;

136 
	m_Ãt
;

137 
	m_£c
;

138 
	m_u£c
;

141 
	#TPACKET_ALIGNMENT
 16

	)

142 
	#TPACKET_ALIGN
(
x
è(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

143 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘_hdr
)è+ (
sockaddr_Î
))

	)

145 
	sack‘2_hdr
 {

146 
__u32
 
	m_¡©us
;

147 
__u32
 
	m_Ën
;

148 
__u32
 
	m_¢­Ën
;

149 
__u16
 
	m_mac
;

150 
__u16
 
	m_Ãt
;

151 
__u32
 
	m_£c
;

152 
__u32
 
	m_n£c
;

153 
__u16
 
	m_vÏn_tci
;

154 
__u16
 
	m_vÏn_id
;

155 
__u8
 
	m_·ddšg
[4];

158 
	sack‘_hdr_v¬ŸÁ1
 {

159 
__u32
 
	m_rxhash
;

160 
__u32
 
	m_vÏn_tci
;

161 
__u16
 
	m_vÏn_id
;

162 
__u16
 
	m_·ddšg
;

165 
	sack‘3_hdr
 {

166 
__u32
 
	m_Ãxt_off£t
;

167 
__u32
 
	m_£c
;

168 
__u32
 
	m_n£c
;

169 
__u32
 
	m_¢­Ën
;

170 
__u32
 
	m_Ën
;

171 
__u32
 
	m_¡©us
;

172 
__u16
 
	m_mac
;

173 
__u16
 
	m_Ãt
;

176 
ack‘_hdr_v¬ŸÁ1
 
	mhv1
;

178 
__u8
 
	m_·ddšg
[8];

181 
	sack‘_bd_ts
 {

182 
	mts_£c
;

184 
	mts_u£c
;

185 
	mts_n£c
;

189 
	sack‘_hdr_v1
 {

190 
__u32
 
	mblock_¡©us
;

191 
__u32
 
	mnum_pkts
;

192 
__u32
 
	moff£t_to_fœ¡_pkt
;

197 
__u32
 
	mblk_Ën
;

208 
__®igÃd_u64
 
	m£q_num
;

235 
ack‘_bd_ts
 
	mts_fœ¡_pkt
, 
	mts_Ï¡_pkt
;

238 
	uack‘_bd_h—d”_u
 {

239 
ack‘_hdr_v1
 
	mbh1
;

242 
	sack‘_block_desc
 {

243 
__u32
 
	mv”siÚ
;

244 
__u32
 
	moff£t_to_´iv
;

245 
ack‘_bd_h—d”_u
 
	mhdr
;

248 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘2_hdr
)è+ (
sockaddr_Î
))

	)

249 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘3_hdr
)è+ (
sockaddr_Î
))

	)

251 
	eack‘_v”siÚs
 {

252 
	mTPACKET_V1
,

253 
	mTPACKET_V2
,

254 
	mTPACKET_V3


270 
	sack‘_»q
 {

271 
	m_block_size
;

272 
	m_block_Ä
;

273 
	m_äame_size
;

274 
	m_äame_Ä
;

277 
	sack‘_»q3
 {

278 
	m_block_size
;

279 
	m_block_Ä
;

280 
	m_äame_size
;

281 
	m_äame_Ä
;

282 
	m_»tœe_blk_tov
;

283 
	m_sizeof_´iv
;

284 
	m_ã©u»_»q_wÜd
;

287 
	uack‘_»q_u
 {

288 
ack‘_»q
 
	m»q
;

289 
ack‘_»q3
 
	m»q3
;

292 
	s·ck‘_m»q
 {

293 
	mmr_ifšdex
;

294 
	mmr_ty³
;

295 
	mmr_®’
;

296 
	mmr_add»ss
[8];

299 
	#PACKET_MR_MULTICAST
 0

	)

300 
	#PACKET_MR_PROMISC
 1

	)

301 
	#PACKET_MR_ALLMULTI
 2

	)

302 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/pci_regs.h

21 #iâdeà
LINUX_PCI_REGS_H


22 
	#LINUX_PCI_REGS_H


	)

29 
	#PCI_CFG_SPACE_SIZE
 256

	)

30 
	#PCI_CFG_SPACE_EXP_SIZE
 4096

	)

36 
	#PCI_STD_HEADER_SIZEOF
 64

	)

37 
	#PCI_VENDOR_ID
 0x00

	)

38 
	#PCI_DEVICE_ID
 0x02

	)

39 
	#PCI_COMMAND
 0x04

	)

40 
	#PCI_COMMAND_IO
 0x1

	)

41 
	#PCI_COMMAND_MEMORY
 0x2

	)

42 
	#PCI_COMMAND_MASTER
 0x4

	)

43 
	#PCI_COMMAND_SPECIAL
 0x8

	)

44 
	#PCI_COMMAND_INVALIDATE
 0x10

	)

45 
	#PCI_COMMAND_VGA_PALETTE
 0x20

	)

46 
	#PCI_COMMAND_PARITY
 0x40

	)

47 
	#PCI_COMMAND_WAIT
 0x80

	)

48 
	#PCI_COMMAND_SERR
 0x100

	)

49 
	#PCI_COMMAND_FAST_BACK
 0x200

	)

50 
	#PCI_COMMAND_INTX_DISABLE
 0x400

	)

52 
	#PCI_STATUS
 0x06

	)

53 
	#PCI_STATUS_IMM_READY
 0x01

	)

54 
	#PCI_STATUS_INTERRUPT
 0x08

	)

55 
	#PCI_STATUS_CAP_LIST
 0x10

	)

56 
	#PCI_STATUS_66MHZ
 0x20

	)

57 
	#PCI_STATUS_UDF
 0x40

	)

58 
	#PCI_STATUS_FAST_BACK
 0x80

	)

59 
	#PCI_STATUS_PARITY
 0x100

	)

60 
	#PCI_STATUS_DEVSEL_MASK
 0x600

	)

61 
	#PCI_STATUS_DEVSEL_FAST
 0x000

	)

62 
	#PCI_STATUS_DEVSEL_MEDIUM
 0x200

	)

63 
	#PCI_STATUS_DEVSEL_SLOW
 0x400

	)

64 
	#PCI_STATUS_SIG_TARGET_ABORT
 0x800

	)

65 
	#PCI_STATUS_REC_TARGET_ABORT
 0x1000

	)

66 
	#PCI_STATUS_REC_MASTER_ABORT
 0x2000

	)

67 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 0x4000

	)

68 
	#PCI_STATUS_DETECTED_PARITY
 0x8000

	)

70 
	#PCI_CLASS_REVISION
 0x08

	)

71 
	#PCI_REVISION_ID
 0x08

	)

72 
	#PCI_CLASS_PROG
 0x09

	)

73 
	#PCI_CLASS_DEVICE
 0x0¨

	)

75 
	#PCI_CACHE_LINE_SIZE
 0x0ø

	)

76 
	#PCI_LATENCY_TIMER
 0x0d

	)

77 
	#PCI_HEADER_TYPE
 0x0

	)

78 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

79 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

80 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

82 
	#PCI_BIST
 0x0à

	)

83 
	#PCI_BIST_CODE_MASK
 0x0à

	)

84 
	#PCI_BIST_START
 0x40

	)

85 
	#PCI_BIST_CAPABLE
 0x80

	)

93 
	#PCI_BASE_ADDRESS_0
 0x10

	)

94 
	#PCI_BASE_ADDRESS_1
 0x14

	)

95 
	#PCI_BASE_ADDRESS_2
 0x18

	)

96 
	#PCI_BASE_ADDRESS_3
 0x1ø

	)

97 
	#PCI_BASE_ADDRESS_4
 0x20

	)

98 
	#PCI_BASE_ADDRESS_5
 0x24

	)

99 
	#PCI_BASE_ADDRESS_SPACE
 0x01

	)

100 
	#PCI_BASE_ADDRESS_SPACE_IO
 0x01

	)

101 
	#PCI_BASE_ADDRESS_SPACE_MEMORY
 0x00

	)

102 
	#PCI_BASE_ADDRESS_MEM_TYPE_MASK
 0x06

	)

103 
	#PCI_BASE_ADDRESS_MEM_TYPE_32
 0x00

	)

104 
	#PCI_BASE_ADDRESS_MEM_TYPE_1M
 0x02

	)

105 
	#PCI_BASE_ADDRESS_MEM_TYPE_64
 0x04

	)

106 
	#PCI_BASE_ADDRESS_MEM_PREFETCH
 0x08

	)

107 
	#PCI_BASE_ADDRESS_MEM_MASK
 (~0x0fUL)

	)

108 
	#PCI_BASE_ADDRESS_IO_MASK
 (~0x03UL)

	)

112 
	#PCI_CARDBUS_CIS
 0x28

	)

113 
	#PCI_SUBSYSTEM_VENDOR_ID
 0x2c

	)

114 
	#PCI_SUBSYSTEM_ID
 0x2e

	)

115 
	#PCI_ROM_ADDRESS
 0x30

	)

116 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

117 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffU)

	)

119 
	#PCI_CAPABILITY_LIST
 0x34

	)

122 
	#PCI_INTERRUPT_LINE
 0x3ø

	)

123 
	#PCI_INTERRUPT_PIN
 0x3d

	)

124 
	#PCI_MIN_GNT
 0x3

	)

125 
	#PCI_MAX_LAT
 0x3à

	)

128 
	#PCI_PRIMARY_BUS
 0x18

	)

129 
	#PCI_SECONDARY_BUS
 0x19

	)

130 
	#PCI_SUBORDINATE_BUS
 0x1¨

	)

131 
	#PCI_SEC_LATENCY_TIMER
 0x1b

	)

132 
	#PCI_IO_BASE
 0x1ø

	)

133 
	#PCI_IO_LIMIT
 0x1d

	)

134 
	#PCI_IO_RANGE_TYPE_MASK
 0x0fUL

	)

135 
	#PCI_IO_RANGE_TYPE_16
 0x00

	)

136 
	#PCI_IO_RANGE_TYPE_32
 0x01

	)

137 
	#PCI_IO_RANGE_MASK
 (~0x0fULè

	)

138 
	#PCI_IO_1K_RANGE_MASK
 (~0x03ULè

	)

139 
	#PCI_SEC_STATUS
 0x1

	)

140 
	#PCI_MEMORY_BASE
 0x20

	)

141 
	#PCI_MEMORY_LIMIT
 0x22

	)

142 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

143 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

144 
	#PCI_PREF_MEMORY_BASE
 0x24

	)

145 
	#PCI_PREF_MEMORY_LIMIT
 0x26

	)

146 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

147 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

148 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

149 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

150 
	#PCI_PREF_BASE_UPPER32
 0x28

	)

151 
	#PCI_PREF_LIMIT_UPPER32
 0x2c

	)

152 
	#PCI_IO_BASE_UPPER16
 0x30

	)

153 
	#PCI_IO_LIMIT_UPPER16
 0x32

	)

156 
	#PCI_ROM_ADDRESS1
 0x38

	)

158 
	#PCI_BRIDGE_CONTROL
 0x3e

	)

159 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

160 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

161 
	#PCI_BRIDGE_CTL_ISA
 0x04

	)

162 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

163 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

164 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

165 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

168 
	#PCI_CB_CAPABILITY_LIST
 0x14

	)

170 
	#PCI_CB_SEC_STATUS
 0x16

	)

171 
	#PCI_CB_PRIMARY_BUS
 0x18

	)

172 
	#PCI_CB_CARD_BUS
 0x19

	)

173 
	#PCI_CB_SUBORDINATE_BUS
 0x1¨

	)

174 
	#PCI_CB_LATENCY_TIMER
 0x1b

	)

175 
	#PCI_CB_MEMORY_BASE_0
 0x1c

	)

176 
	#PCI_CB_MEMORY_LIMIT_0
 0x20

	)

177 
	#PCI_CB_MEMORY_BASE_1
 0x24

	)

178 
	#PCI_CB_MEMORY_LIMIT_1
 0x28

	)

179 
	#PCI_CB_IO_BASE_0
 0x2c

	)

180 
	#PCI_CB_IO_BASE_0_HI
 0x2e

	)

181 
	#PCI_CB_IO_LIMIT_0
 0x30

	)

182 
	#PCI_CB_IO_LIMIT_0_HI
 0x32

	)

183 
	#PCI_CB_IO_BASE_1
 0x34

	)

184 
	#PCI_CB_IO_BASE_1_HI
 0x36

	)

185 
	#PCI_CB_IO_LIMIT_1
 0x38

	)

186 
	#PCI_CB_IO_LIMIT_1_HI
 0x3a

	)

187 
	#PCI_CB_IO_RANGE_MASK
 (~0x03UL)

	)

189 
	#PCI_CB_BRIDGE_CONTROL
 0x3e

	)

190 
	#PCI_CB_BRIDGE_CTL_PARITY
 0x01

	)

191 
	#PCI_CB_BRIDGE_CTL_SERR
 0x02

	)

192 
	#PCI_CB_BRIDGE_CTL_ISA
 0x04

	)

193 
	#PCI_CB_BRIDGE_CTL_VGA
 0x08

	)

194 
	#PCI_CB_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

195 
	#PCI_CB_BRIDGE_CTL_CB_RESET
 0x40

	)

196 
	#PCI_CB_BRIDGE_CTL_16BIT_INT
 0x80

	)

197 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM0
 0x100

	)

198 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM1
 0x200

	)

199 
	#PCI_CB_BRIDGE_CTL_POST_WRITES
 0x400

	)

200 
	#PCI_CB_SUBSYSTEM_VENDOR_ID
 0x40

	)

201 
	#PCI_CB_SUBSYSTEM_ID
 0x42

	)

202 
	#PCI_CB_LEGACY_MODE_BASE
 0x44

	)

207 
	#PCI_CAP_LIST_ID
 0

	)

208 
	#PCI_CAP_ID_PM
 0x01

	)

209 
	#PCI_CAP_ID_AGP
 0x02

	)

210 
	#PCI_CAP_ID_VPD
 0x03

	)

211 
	#PCI_CAP_ID_SLOTID
 0x04

	)

212 
	#PCI_CAP_ID_MSI
 0x05

	)

213 
	#PCI_CAP_ID_CHSWP
 0x06

	)

214 
	#PCI_CAP_ID_PCIX
 0x07

	)

215 
	#PCI_CAP_ID_HT
 0x08

	)

216 
	#PCI_CAP_ID_VNDR
 0x09

	)

217 
	#PCI_CAP_ID_DBG
 0x0A

	)

218 
	#PCI_CAP_ID_CCRC
 0x0B

	)

219 
	#PCI_CAP_ID_SHPC
 0x0C

	)

220 
	#PCI_CAP_ID_SSVID
 0x0D

	)

221 
	#PCI_CAP_ID_AGP3
 0x0E

	)

222 
	#PCI_CAP_ID_SECDEV
 0x0F

	)

223 
	#PCI_CAP_ID_EXP
 0x10

	)

224 
	#PCI_CAP_ID_MSIX
 0x11

	)

225 
	#PCI_CAP_ID_SATA
 0x12

	)

226 
	#PCI_CAP_ID_AF
 0x13

	)

227 
	#PCI_CAP_ID_EA
 0x14

	)

228 
	#PCI_CAP_ID_MAX
 
PCI_CAP_ID_EA


	)

229 
	#PCI_CAP_LIST_NEXT
 1

	)

230 
	#PCI_CAP_FLAGS
 2

	)

231 
	#PCI_CAP_SIZEOF
 4

	)

235 
	#PCI_PM_PMC
 2

	)

236 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

237 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

238 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

239 
	#PCI_PM_CAP_DSI
 0x0020

	)

240 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

241 
	#PCI_PM_CAP_D1
 0x0200

	)

242 
	#PCI_PM_CAP_D2
 0x0400

	)

243 
	#PCI_PM_CAP_PME
 0x0800

	)

244 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

245 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

246 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

247 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

248 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

249 
	#PCI_PM_CAP_PME_D3cŞd
 0x8000

	)

250 
	#PCI_PM_CAP_PME_SHIFT
 11

	)

251 
	#PCI_PM_CTRL
 4

	)

252 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

253 
	#PCI_PM_CTRL_NO_SOFT_RESET
 0x0008

	)

254 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

255 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

256 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

257 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

258 
	#PCI_PM_PPB_EXTENSIONS
 6

	)

259 
	#PCI_PM_PPB_B2_B3
 0x40

	)

260 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

261 
	#PCI_PM_DATA_REGISTER
 7

	)

262 
	#PCI_PM_SIZEOF
 8

	)

266 
	#PCI_AGP_VERSION
 2

	)

267 
	#PCI_AGP_RFU
 3

	)

268 
	#PCI_AGP_STATUS
 4

	)

269 
	#PCI_AGP_STATUS_RQ_MASK
 0xff000000

	)

270 
	#PCI_AGP_STATUS_SBA
 0x0200

	)

271 
	#PCI_AGP_STATUS_64BIT
 0x0020

	)

272 
	#PCI_AGP_STATUS_FW
 0x0010

	)

273 
	#PCI_AGP_STATUS_RATE4
 0x0004

	)

274 
	#PCI_AGP_STATUS_RATE2
 0x0002

	)

275 
	#PCI_AGP_STATUS_RATE1
 0x0001

	)

276 
	#PCI_AGP_COMMAND
 8

	)

277 
	#PCI_AGP_COMMAND_RQ_MASK
 0xff000000

	)

278 
	#PCI_AGP_COMMAND_SBA
 0x0200

	)

279 
	#PCI_AGP_COMMAND_AGP
 0x0100

	)

280 
	#PCI_AGP_COMMAND_64BIT
 0x0020

	)

281 
	#PCI_AGP_COMMAND_FW
 0x0010

	)

282 
	#PCI_AGP_COMMAND_RATE4
 0x0004

	)

283 
	#PCI_AGP_COMMAND_RATE2
 0x0002

	)

284 
	#PCI_AGP_COMMAND_RATE1
 0x0001

	)

285 
	#PCI_AGP_SIZEOF
 12

	)

289 
	#PCI_VPD_ADDR
 2

	)

290 
	#PCI_VPD_ADDR_MASK
 0x7ffà

	)

291 
	#PCI_VPD_ADDR_F
 0x8000

	)

292 
	#PCI_VPD_DATA
 4

	)

293 
	#PCI_CAP_VPD_SIZEOF
 8

	)

297 
	#PCI_SID_ESR
 2

	)

298 
	#PCI_SID_ESR_NSLOTS
 0x1à

	)

299 
	#PCI_SID_ESR_FIC
 0x20

	)

300 
	#PCI_SID_CHASSIS_NR
 3

	)

304 
	#PCI_MSI_FLAGS
 2

	)

305 
	#PCI_MSI_FLAGS_ENABLE
 0x0001

	)

306 
	#PCI_MSI_FLAGS_QMASK
 0x000

	)

307 
	#PCI_MSI_FLAGS_QSIZE
 0x0070

	)

308 
	#PCI_MSI_FLAGS_64BIT
 0x0080

	)

309 
	#PCI_MSI_FLAGS_MASKBIT
 0x0100

	)

310 
	#PCI_MSI_RFU
 3

	)

311 
	#PCI_MSI_ADDRESS_LO
 4

	)

312 
	#PCI_MSI_ADDRESS_HI
 8

	)

313 
	#PCI_MSI_DATA_32
 8

	)

314 
	#PCI_MSI_MASK_32
 12

	)

315 
	#PCI_MSI_PENDING_32
 16

	)

316 
	#PCI_MSI_DATA_64
 12

	)

317 
	#PCI_MSI_MASK_64
 16

	)

318 
	#PCI_MSI_PENDING_64
 20

	)

321 
	#PCI_MSIX_FLAGS
 2

	)

322 
	#PCI_MSIX_FLAGS_QSIZE
 0x07FF

	)

323 
	#PCI_MSIX_FLAGS_MASKALL
 0x4000

	)

324 
	#PCI_MSIX_FLAGS_ENABLE
 0x8000

	)

325 
	#PCI_MSIX_TABLE
 4

	)

326 
	#PCI_MSIX_TABLE_BIR
 0x00000007

	)

327 
	#PCI_MSIX_TABLE_OFFSET
 0xfffffff8

	)

328 
	#PCI_MSIX_PBA
 8

	)

329 
	#PCI_MSIX_PBA_BIR
 0x00000007

	)

330 
	#PCI_MSIX_PBA_OFFSET
 0xfffffff8

	)

331 
	#PCI_MSIX_FLAGS_BIRMASK
 
PCI_MSIX_PBA_BIR


	)

332 
	#PCI_CAP_MSIX_SIZEOF
 12

	)

335 
	#PCI_MSIX_ENTRY_SIZE
 16

	)

336 
	#PCI_MSIX_ENTRY_LOWER_ADDR
 0

	)

337 
	#PCI_MSIX_ENTRY_UPPER_ADDR
 4

	)

338 
	#PCI_MSIX_ENTRY_DATA
 8

	)

339 
	#PCI_MSIX_ENTRY_VECTOR_CTRL
 12

	)

340 
	#PCI_MSIX_ENTRY_CTRL_MASKBIT
 0x00000001

	)

344 
	#PCI_CHSWP_CSR
 2

	)

345 
	#PCI_CHSWP_DHA
 0x01

	)

346 
	#PCI_CHSWP_EIM
 0x02

	)

347 
	#PCI_CHSWP_PIE
 0x04

	)

348 
	#PCI_CHSWP_LOO
 0x08

	)

349 
	#PCI_CHSWP_PI
 0x30

	)

350 
	#PCI_CHSWP_EXT
 0x40

	)

351 
	#PCI_CHSWP_INS
 0x80

	)

355 
	#PCI_AF_LENGTH
 2

	)

356 
	#PCI_AF_CAP
 3

	)

357 
	#PCI_AF_CAP_TP
 0x01

	)

358 
	#PCI_AF_CAP_FLR
 0x02

	)

359 
	#PCI_AF_CTRL
 4

	)

360 
	#PCI_AF_CTRL_FLR
 0x01

	)

361 
	#PCI_AF_STATUS
 5

	)

362 
	#PCI_AF_STATUS_TP
 0x01

	)

363 
	#PCI_CAP_AF_SIZEOF
 6

	)

367 
	#PCI_EA_NUM_ENT
 2

	)

368 
	#PCI_EA_NUM_ENT_MASK
 0x3à

	)

369 
	#PCI_EA_FIRST_ENT
 4

	)

370 
	#PCI_EA_FIRST_ENT_BRIDGE
 8

	)

371 
	#PCI_EA_ES
 0x00000007

	)

372 
	#PCI_EA_BEI
 0x000000f0

	)

375 
	#PCI_EA_SEC_BUS_MASK
 0xff

	)

376 
	#PCI_EA_SUB_BUS_MASK
 0xff00

	)

377 
	#PCI_EA_SUB_BUS_SHIFT
 8

	)

380 
	#PCI_EA_BEI_BAR0
 0

	)

381 
	#PCI_EA_BEI_BAR5
 5

	)

382 
	#PCI_EA_BEI_BRIDGE
 6

	)

383 
	#PCI_EA_BEI_ENI
 7

	)

384 
	#PCI_EA_BEI_ROM
 8

	)

386 
	#PCI_EA_BEI_VF_BAR0
 9

	)

387 
	#PCI_EA_BEI_VF_BAR5
 14

	)

388 
	#PCI_EA_BEI_RESERVED
 15

	)

389 
	#PCI_EA_PP
 0x0000ff00

	)

390 
	#PCI_EA_SP
 0x00ff0000

	)

391 
	#PCI_EA_P_MEM
 0x00

	)

392 
	#PCI_EA_P_MEM_PREFETCH
 0x01

	)

393 
	#PCI_EA_P_IO
 0x02

	)

394 
	#PCI_EA_P_VF_MEM_PREFETCH
 0x03

	)

395 
	#PCI_EA_P_VF_MEM
 0x04

	)

396 
	#PCI_EA_P_BRIDGE_MEM
 0x05

	)

397 
	#PCI_EA_P_BRIDGE_MEM_PREFETCH
 0x06

	)

398 
	#PCI_EA_P_BRIDGE_IO
 0x07

	)

400 
	#PCI_EA_P_MEM_RESERVED
 0xfd

	)

401 
	#PCI_EA_P_IO_RESERVED
 0xã

	)

402 
	#PCI_EA_P_UNAVAILABLE
 0xfà

	)

403 
	#PCI_EA_WRITABLE
 0x40000000

	)

404 
	#PCI_EA_ENABLE
 0x80000000

	)

405 
	#PCI_EA_BASE
 4

	)

406 
	#PCI_EA_MAX_OFFSET
 8

	)

408 
	#PCI_EA_IS_64
 0x00000002

	)

409 
	#PCI_EA_FIELD_MASK
 0xfffffffø

	)

413 
	#PCI_X_CMD
 2

	)

414 
	#PCI_X_CMD_DPERR_E
 0x0001

	)

415 
	#PCI_X_CMD_ERO
 0x0002

	)

416 
	#PCI_X_CMD_READ_512
 0x0000

	)

417 
	#PCI_X_CMD_READ_1K
 0x0004

	)

418 
	#PCI_X_CMD_READ_2K
 0x0008

	)

419 
	#PCI_X_CMD_READ_4K
 0x000ø

	)

420 
	#PCI_X_CMD_MAX_READ
 0x000ø

	)

422 
	#PCI_X_CMD_SPLIT_1
 0x0000

	)

423 
	#PCI_X_CMD_SPLIT_2
 0x0010

	)

424 
	#PCI_X_CMD_SPLIT_3
 0x0020

	)

425 
	#PCI_X_CMD_SPLIT_4
 0x0030

	)

426 
	#PCI_X_CMD_SPLIT_8
 0x0040

	)

427 
	#PCI_X_CMD_SPLIT_12
 0x0050

	)

428 
	#PCI_X_CMD_SPLIT_16
 0x0060

	)

429 
	#PCI_X_CMD_SPLIT_32
 0x0070

	)

430 
	#PCI_X_CMD_MAX_SPLIT
 0x0070

	)

431 
	#PCI_X_CMD_VERSION
(
x
è(((xè>> 12è& 3è

	)

432 
	#PCI_X_STATUS
 4

	)

433 
	#PCI_X_STATUS_DEVFN
 0x000000fà

	)

434 
	#PCI_X_STATUS_BUS
 0x0000ff00

	)

435 
	#PCI_X_STATUS_64BIT
 0x00010000

	)

436 
	#PCI_X_STATUS_133MHZ
 0x00020000

	)

437 
	#PCI_X_STATUS_SPL_DISC
 0x00040000

	)

438 
	#PCI_X_STATUS_UNX_SPL
 0x00080000

	)

439 
	#PCI_X_STATUS_COMPLEX
 0x00100000

	)

440 
	#PCI_X_STATUS_MAX_READ
 0x00600000

	)

441 
	#PCI_X_STATUS_MAX_SPLIT
 0x03800000

	)

442 
	#PCI_X_STATUS_MAX_CUM
 0x1c000000

	)

443 
	#PCI_X_STATUS_SPL_ERR
 0x20000000

	)

444 
	#PCI_X_STATUS_266MHZ
 0x40000000

	)

445 
	#PCI_X_STATUS_533MHZ
 0x80000000

	)

446 
	#PCI_X_ECC_CSR
 8

	)

447 
	#PCI_CAP_PCIX_SIZEOF_V0
 8

	)

448 
	#PCI_CAP_PCIX_SIZEOF_V1
 24

	)

449 
	#PCI_CAP_PCIX_SIZEOF_V2
 
PCI_CAP_PCIX_SIZEOF_V1


	)

453 
	#PCI_X_BRIDGE_SSTATUS
 2

	)

454 
	#PCI_X_SSTATUS_64BIT
 0x0001

	)

455 
	#PCI_X_SSTATUS_133MHZ
 0x0002

	)

456 
	#PCI_X_SSTATUS_FREQ
 0x03c0

	)

457 
	#PCI_X_SSTATUS_VERS
 0x3000

	)

458 
	#PCI_X_SSTATUS_V1
 0x1000

	)

459 
	#PCI_X_SSTATUS_V2
 0x2000

	)

460 
	#PCI_X_SSTATUS_266MHZ
 0x4000

	)

461 
	#PCI_X_SSTATUS_533MHZ
 0x8000

	)

462 
	#PCI_X_BRIDGE_STATUS
 4

	)

466 
	#PCI_SSVID_VENDOR_ID
 4

	)

467 
	#PCI_SSVID_DEVICE_ID
 6

	)

471 
	#PCI_EXP_FLAGS
 2

	)

472 
	#PCI_EXP_FLAGS_VERS
 0x000à

	)

473 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

474 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

475 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

476 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

477 
	#PCI_EXP_TYPE_UPSTREAM
 0x5

	)

478 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

479 
	#PCI_EXP_TYPE_PCI_BRIDGE
 0x7

	)

480 
	#PCI_EXP_TYPE_PCIE_BRIDGE
 0x8

	)

481 
	#PCI_EXP_TYPE_RC_END
 0x9

	)

482 
	#PCI_EXP_TYPE_RC_EC
 0x¨

	)

483 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

484 
	#PCI_EXP_FLAGS_IRQ
 0x3e00

	)

485 
	#PCI_EXP_DEVCAP
 4

	)

486 
	#PCI_EXP_DEVCAP_PAYLOAD
 0x00000007

	)

487 
	#PCI_EXP_DEVCAP_PHANTOM
 0x00000018

	)

488 
	#PCI_EXP_DEVCAP_EXT_TAG
 0x00000020

	)

489 
	#PCI_EXP_DEVCAP_L0S
 0x000001c0

	)

490 
	#PCI_EXP_DEVCAP_L1
 0x00000e00

	)

491 
	#PCI_EXP_DEVCAP_ATN_BUT
 0x00001000

	)

492 
	#PCI_EXP_DEVCAP_ATN_IND
 0x00002000

	)

493 
	#PCI_EXP_DEVCAP_PWR_IND
 0x00004000

	)

494 
	#PCI_EXP_DEVCAP_RBER
 0x00008000

	)

495 
	#PCI_EXP_DEVCAP_PWR_VAL
 0x03fc0000

	)

496 
	#PCI_EXP_DEVCAP_PWR_SCL
 0x0c000000

	)

497 
	#PCI_EXP_DEVCAP_FLR
 0x10000000

	)

498 
	#PCI_EXP_DEVCTL
 8

	)

499 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

500 
	#PCI_EXP_DEVCTL_NFERE
 0x0002

	)

501 
	#PCI_EXP_DEVCTL_FERE
 0x0004

	)

502 
	#PCI_EXP_DEVCTL_URRE
 0x0008

	)

503 
	#PCI_EXP_DEVCTL_RELAX_EN
 0x0010

	)

504 
	#PCI_EXP_DEVCTL_PAYLOAD
 0x00e0

	)

505 
	#PCI_EXP_DEVCTL_PAYLOAD_128B
 0x0000

	)

506 
	#PCI_EXP_DEVCTL_PAYLOAD_256B
 0x0020

	)

507 
	#PCI_EXP_DEVCTL_PAYLOAD_512B
 0x0040

	)

508 
	#PCI_EXP_DEVCTL_PAYLOAD_1024B
 0x0060

	)

509 
	#PCI_EXP_DEVCTL_PAYLOAD_2048B
 0x0080

	)

510 
	#PCI_EXP_DEVCTL_PAYLOAD_4096B
 0x00a0

	)

511 
	#PCI_EXP_DEVCTL_EXT_TAG
 0x0100

	)

512 
	#PCI_EXP_DEVCTL_PHANTOM
 0x0200

	)

513 
	#PCI_EXP_DEVCTL_AUX_PME
 0x0400

	)

514 
	#PCI_EXP_DEVCTL_NOSNOOP_EN
 0x0800

	)

515 
	#PCI_EXP_DEVCTL_READRQ
 0x7000

	)

516 
	#PCI_EXP_DEVCTL_READRQ_128B
 0x0000

	)

517 
	#PCI_EXP_DEVCTL_READRQ_256B
 0x1000

	)

518 
	#PCI_EXP_DEVCTL_READRQ_512B
 0x2000

	)

519 
	#PCI_EXP_DEVCTL_READRQ_1024B
 0x3000

	)

520 
	#PCI_EXP_DEVCTL_READRQ_2048B
 0x4000

	)

521 
	#PCI_EXP_DEVCTL_READRQ_4096B
 0x5000

	)

522 
	#PCI_EXP_DEVCTL_BCR_FLR
 0x8000

	)

523 
	#PCI_EXP_DEVSTA
 10

	)

524 
	#PCI_EXP_DEVSTA_CED
 0x0001

	)

525 
	#PCI_EXP_DEVSTA_NFED
 0x0002

	)

526 
	#PCI_EXP_DEVSTA_FED
 0x0004

	)

527 
	#PCI_EXP_DEVSTA_URD
 0x0008

	)

528 
	#PCI_EXP_DEVSTA_AUXPD
 0x0010

	)

529 
	#PCI_EXP_DEVSTA_TRPND
 0x0020

	)

530 
	#PCI_CAP_EXP_RC_ENDPOINT_SIZEOF_V1
 12

	)

531 
	#PCI_EXP_LNKCAP
 12

	)

532 
	#PCI_EXP_LNKCAP_SLS
 0x0000000à

	)

533 
	#PCI_EXP_LNKCAP_SLS_2_5GB
 0x00000001

	)

534 
	#PCI_EXP_LNKCAP_SLS_5_0GB
 0x00000002

	)

535 
	#PCI_EXP_LNKCAP_SLS_8_0GB
 0x00000003

	)

536 
	#PCI_EXP_LNKCAP_SLS_16_0GB
 0x00000004

	)

537 
	#PCI_EXP_LNKCAP_SLS_32_0GB
 0x00000005

	)

538 
	#PCI_EXP_LNKCAP_MLW
 0x000003f0

	)

539 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

540 
	#PCI_EXP_LNKCAP_L0SEL
 0x00007000

	)

541 
	#PCI_EXP_LNKCAP_L1EL
 0x00038000

	)

542 
	#PCI_EXP_LNKCAP_CLKPM
 0x00040000

	)

543 
	#PCI_EXP_LNKCAP_SDERC
 0x00080000

	)

544 
	#PCI_EXP_LNKCAP_DLLLARC
 0x00100000

	)

545 
	#PCI_EXP_LNKCAP_LBNC
 0x00200000

	)

546 
	#PCI_EXP_LNKCAP_PN
 0xff000000

	)

547 
	#PCI_EXP_LNKCTL
 16

	)

548 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

549 
	#PCI_EXP_LNKCTL_ASPM_L0S
 0x0001

	)

550 
	#PCI_EXP_LNKCTL_ASPM_L1
 0x0002

	)

551 
	#PCI_EXP_LNKCTL_RCB
 0x0008

	)

552 
	#PCI_EXP_LNKCTL_LD
 0x0010

	)

553 
	#PCI_EXP_LNKCTL_RL
 0x0020

	)

554 
	#PCI_EXP_LNKCTL_CCC
 0x0040

	)

555 
	#PCI_EXP_LNKCTL_ES
 0x0080

	)

556 
	#PCI_EXP_LNKCTL_CLKREQ_EN
 0x0100

	)

557 
	#PCI_EXP_LNKCTL_HAWD
 0x0200

	)

558 
	#PCI_EXP_LNKCTL_LBMIE
 0x0400

	)

559 
	#PCI_EXP_LNKCTL_LABIE
 0x0800

	)

560 
	#PCI_EXP_LNKSTA
 18

	)

561 
	#PCI_EXP_LNKSTA_CLS
 0x000à

	)

562 
	#PCI_EXP_LNKSTA_CLS_2_5GB
 0x0001

	)

563 
	#PCI_EXP_LNKSTA_CLS_5_0GB
 0x0002

	)

564 
	#PCI_EXP_LNKSTA_CLS_8_0GB
 0x0003

	)

565 
	#PCI_EXP_LNKSTA_CLS_16_0GB
 0x0004

	)

566 
	#PCI_EXP_LNKSTA_CLS_32_0GB
 0x0005

	)

567 
	#PCI_EXP_LNKSTA_NLW
 0x03f0

	)

568 
	#PCI_EXP_LNKSTA_NLW_X1
 0x0010

	)

569 
	#PCI_EXP_LNKSTA_NLW_X2
 0x0020

	)

570 
	#PCI_EXP_LNKSTA_NLW_X4
 0x0040

	)

571 
	#PCI_EXP_LNKSTA_NLW_X8
 0x0080

	)

572 
	#PCI_EXP_LNKSTA_NLW_SHIFT
 4

	)

573 
	#PCI_EXP_LNKSTA_LT
 0x0800

	)

574 
	#PCI_EXP_LNKSTA_SLC
 0x1000

	)

575 
	#PCI_EXP_LNKSTA_DLLLA
 0x2000

	)

576 
	#PCI_EXP_LNKSTA_LBMS
 0x4000

	)

577 
	#PCI_EXP_LNKSTA_LABS
 0x8000

	)

578 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V1
 20

	)

579 
	#PCI_EXP_SLTCAP
 20

	)

580 
	#PCI_EXP_SLTCAP_ABP
 0x00000001

	)

581 
	#PCI_EXP_SLTCAP_PCP
 0x00000002

	)

582 
	#PCI_EXP_SLTCAP_MRLSP
 0x00000004

	)

583 
	#PCI_EXP_SLTCAP_AIP
 0x00000008

	)

584 
	#PCI_EXP_SLTCAP_PIP
 0x00000010

	)

585 
	#PCI_EXP_SLTCAP_HPS
 0x00000020

	)

586 
	#PCI_EXP_SLTCAP_HPC
 0x00000040

	)

587 
	#PCI_EXP_SLTCAP_SPLV
 0x00007f80

	)

588 
	#PCI_EXP_SLTCAP_SPLS
 0x00018000

	)

589 
	#PCI_EXP_SLTCAP_EIP
 0x00020000

	)

590 
	#PCI_EXP_SLTCAP_NCCS
 0x00040000

	)

591 
	#PCI_EXP_SLTCAP_PSN
 0xfff80000

	)

592 
	#PCI_EXP_SLTCTL
 24

	)

593 
	#PCI_EXP_SLTCTL_ABPE
 0x0001

	)

594 
	#PCI_EXP_SLTCTL_PFDE
 0x0002

	)

595 
	#PCI_EXP_SLTCTL_MRLSCE
 0x0004

	)

596 
	#PCI_EXP_SLTCTL_PDCE
 0x0008

	)

597 
	#PCI_EXP_SLTCTL_CCIE
 0x0010

	)

598 
	#PCI_EXP_SLTCTL_HPIE
 0x0020

	)

599 
	#PCI_EXP_SLTCTL_AIC
 0x00c0

	)

600 
	#PCI_EXP_SLTCTL_ATTN_IND_SHIFT
 6

	)

601 
	#PCI_EXP_SLTCTL_ATTN_IND_ON
 0x0040

	)

602 
	#PCI_EXP_SLTCTL_ATTN_IND_BLINK
 0x0080

	)

603 
	#PCI_EXP_SLTCTL_ATTN_IND_OFF
 0x00c0

	)

604 
	#PCI_EXP_SLTCTL_PIC
 0x0300

	)

605 
	#PCI_EXP_SLTCTL_PWR_IND_ON
 0x0100

	)

606 
	#PCI_EXP_SLTCTL_PWR_IND_BLINK
 0x0200

	)

607 
	#PCI_EXP_SLTCTL_PWR_IND_OFF
 0x0300

	)

608 
	#PCI_EXP_SLTCTL_PCC
 0x0400

	)

609 
	#PCI_EXP_SLTCTL_PWR_ON
 0x0000

	)

610 
	#PCI_EXP_SLTCTL_PWR_OFF
 0x0400

	)

611 
	#PCI_EXP_SLTCTL_EIC
 0x0800

	)

612 
	#PCI_EXP_SLTCTL_DLLSCE
 0x1000

	)

613 
	#PCI_EXP_SLTSTA
 26

	)

614 
	#PCI_EXP_SLTSTA_ABP
 0x0001

	)

615 
	#PCI_EXP_SLTSTA_PFD
 0x0002

	)

616 
	#PCI_EXP_SLTSTA_MRLSC
 0x0004

	)

617 
	#PCI_EXP_SLTSTA_PDC
 0x0008

	)

618 
	#PCI_EXP_SLTSTA_CC
 0x0010

	)

619 
	#PCI_EXP_SLTSTA_MRLSS
 0x0020

	)

620 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

621 
	#PCI_EXP_SLTSTA_EIS
 0x0080

	)

622 
	#PCI_EXP_SLTSTA_DLLSC
 0x0100

	)

623 
	#PCI_EXP_RTCTL
 28

	)

624 
	#PCI_EXP_RTCTL_SECEE
 0x0001

	)

625 
	#PCI_EXP_RTCTL_SENFEE
 0x0002

	)

626 
	#PCI_EXP_RTCTL_SEFEE
 0x0004

	)

627 
	#PCI_EXP_RTCTL_PMEIE
 0x0008

	)

628 
	#PCI_EXP_RTCTL_CRSSVE
 0x0010

	)

629 
	#PCI_EXP_RTCAP
 30

	)

630 
	#PCI_EXP_RTCAP_CRSVIS
 0x0001

	)

631 
	#PCI_EXP_RTSTA
 32

	)

632 
	#PCI_EXP_RTSTA_PME
 0x00010000

	)

633 
	#PCI_EXP_RTSTA_PENDING
 0x00020000

	)

642 
	#PCI_EXP_DEVCAP2
 36

	)

643 
	#PCI_EXP_DEVCAP2_COMP_TMOUT_DIS
 0x00000010

	)

644 
	#PCI_EXP_DEVCAP2_ARI
 0x00000020

	)

645 
	#PCI_EXP_DEVCAP2_ATOMIC_ROUTE
 0x00000040

	)

646 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP32
 0x00000080

	)

647 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP64
 0x00000100

	)

648 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP128
 0x00000200

	)

649 
	#PCI_EXP_DEVCAP2_LTR
 0x00000800

	)

650 
	#PCI_EXP_DEVCAP2_OBFF_MASK
 0x000c0000

	)

651 
	#PCI_EXP_DEVCAP2_OBFF_MSG
 0x00040000

	)

652 
	#PCI_EXP_DEVCAP2_OBFF_WAKE
 0x00080000

	)

653 
	#PCI_EXP_DEVCAP2_EE_PREFIX
 0x00200000

	)

654 
	#PCI_EXP_DEVCTL2
 40

	)

655 
	#PCI_EXP_DEVCTL2_COMP_TIMEOUT
 0x000à

	)

656 
	#PCI_EXP_DEVCTL2_COMP_TMOUT_DIS
 0x0010

	)

657 
	#PCI_EXP_DEVCTL2_ARI
 0x0020

	)

658 
	#PCI_EXP_DEVCTL2_ATOMIC_REQ
 0x0040

	)

659 
	#PCI_EXP_DEVCTL2_ATOMIC_EGRESS_BLOCK
 0x0080

	)

660 
	#PCI_EXP_DEVCTL2_IDO_REQ_EN
 0x0100

	)

661 
	#PCI_EXP_DEVCTL2_IDO_CMP_EN
 0x0200

	)

662 
	#PCI_EXP_DEVCTL2_LTR_EN
 0x0400

	)

663 
	#PCI_EXP_DEVCTL2_OBFF_MSGA_EN
 0x2000

	)

664 
	#PCI_EXP_DEVCTL2_OBFF_MSGB_EN
 0x4000

	)

665 
	#PCI_EXP_DEVCTL2_OBFF_WAKE_EN
 0x6000

	)

666 
	#PCI_EXP_DEVSTA2
 42

	)

667 
	#PCI_CAP_EXP_RC_ENDPOINT_SIZEOF_V2
 44

	)

668 
	#PCI_EXP_LNKCAP2
 44

	)

669 
	#PCI_EXP_LNKCAP2_SLS_2_5GB
 0x00000002

	)

670 
	#PCI_EXP_LNKCAP2_SLS_5_0GB
 0x00000004

	)

671 
	#PCI_EXP_LNKCAP2_SLS_8_0GB
 0x00000008

	)

672 
	#PCI_EXP_LNKCAP2_SLS_16_0GB
 0x00000010

	)

673 
	#PCI_EXP_LNKCAP2_SLS_32_0GB
 0x00000020

	)

674 
	#PCI_EXP_LNKCAP2_CROSSLINK
 0x00000100

	)

675 
	#PCI_EXP_LNKCTL2
 48

	)

676 
	#PCI_EXP_LNKCTL2_TLS
 0x000f

	)

677 
	#PCI_EXP_LNKCTL2_TLS_2_5GT
 0x0001

	)

678 
	#PCI_EXP_LNKCTL2_TLS_5_0GT
 0x0002

	)

679 
	#PCI_EXP_LNKCTL2_TLS_8_0GT
 0x0003

	)

680 
	#PCI_EXP_LNKCTL2_TLS_16_0GT
 0x0004

	)

681 
	#PCI_EXP_LNKCTL2_TLS_32_0GT
 0x0005

	)

682 
	#PCI_EXP_LNKSTA2
 50

	)

683 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V2
 52

	)

684 
	#PCI_EXP_SLTCAP2
 52

	)

685 
	#PCI_EXP_SLTCTL2
 56

	)

686 
	#PCI_EXP_SLTSTA2
 58

	)

689 
	#PCI_EXT_CAP_ID
(
h—d”
è(h—d” & 0x0000ffff)

	)

690 
	#PCI_EXT_CAP_VER
(
h—d”
è((h—d” >> 16è& 0xf)

	)

691 
	#PCI_EXT_CAP_NEXT
(
h—d”
è((h—d” >> 20è& 0xffc)

	)

693 
	#PCI_EXT_CAP_ID_ERR
 0x01

	)

694 
	#PCI_EXT_CAP_ID_VC
 0x02

	)

695 
	#PCI_EXT_CAP_ID_DSN
 0x03

	)

696 
	#PCI_EXT_CAP_ID_PWR
 0x04

	)

697 
	#PCI_EXT_CAP_ID_RCLD
 0x05

	)

698 
	#PCI_EXT_CAP_ID_RCILC
 0x06

	)

699 
	#PCI_EXT_CAP_ID_RCEC
 0x07

	)

700 
	#PCI_EXT_CAP_ID_MFVC
 0x08

	)

701 
	#PCI_EXT_CAP_ID_VC9
 0x09

	)

702 
	#PCI_EXT_CAP_ID_RCRB
 0x0A

	)

703 
	#PCI_EXT_CAP_ID_VNDR
 0x0B

	)

704 
	#PCI_EXT_CAP_ID_CAC
 0x0C

	)

705 
	#PCI_EXT_CAP_ID_ACS
 0x0D

	)

706 
	#PCI_EXT_CAP_ID_ARI
 0x0E

	)

707 
	#PCI_EXT_CAP_ID_ATS
 0x0F

	)

708 
	#PCI_EXT_CAP_ID_SRIOV
 0x10

	)

709 
	#PCI_EXT_CAP_ID_MRIOV
 0x11

	)

710 
	#PCI_EXT_CAP_ID_MCAST
 0x12

	)

711 
	#PCI_EXT_CAP_ID_PRI
 0x13

	)

712 
	#PCI_EXT_CAP_ID_AMD_XXX
 0x14

	)

713 
	#PCI_EXT_CAP_ID_REBAR
 0x15

	)

714 
	#PCI_EXT_CAP_ID_DPA
 0x16

	)

715 
	#PCI_EXT_CAP_ID_TPH
 0x17

	)

716 
	#PCI_EXT_CAP_ID_LTR
 0x18

	)

717 
	#PCI_EXT_CAP_ID_SECPCI
 0x19

	)

718 
	#PCI_EXT_CAP_ID_PMUX
 0x1A

	)

719 
	#PCI_EXT_CAP_ID_PASID
 0x1B

	)

720 
	#PCI_EXT_CAP_ID_DPC
 0x1D

	)

721 
	#PCI_EXT_CAP_ID_L1SS
 0x1E

	)

722 
	#PCI_EXT_CAP_ID_PTM
 0x1F

	)

723 
	#PCI_EXT_CAP_ID_DLF
 0x25

	)

724 
	#PCI_EXT_CAP_ID_PL_16GT
 0x26

	)

725 
	#PCI_EXT_CAP_ID_MAX
 
PCI_EXT_CAP_ID_PL_16GT


	)

727 
	#PCI_EXT_CAP_DSN_SIZEOF
 12

	)

728 
	#PCI_EXT_CAP_MCAST_ENDPOINT_SIZEOF
 40

	)

731 
	#PCI_ERR_UNCOR_STATUS
 4

	)

732 
	#PCI_ERR_UNC_UND
 0x00000001

	)

733 
	#PCI_ERR_UNC_DLP
 0x00000010

	)

734 
	#PCI_ERR_UNC_SURPDN
 0x00000020

	)

735 
	#PCI_ERR_UNC_POISON_TLP
 0x00001000

	)

736 
	#PCI_ERR_UNC_FCP
 0x00002000

	)

737 
	#PCI_ERR_UNC_COMP_TIME
 0x00004000

	)

738 
	#PCI_ERR_UNC_COMP_ABORT
 0x00008000

	)

739 
	#PCI_ERR_UNC_UNX_COMP
 0x00010000

	)

740 
	#PCI_ERR_UNC_RX_OVER
 0x00020000

	)

741 
	#PCI_ERR_UNC_MALF_TLP
 0x00040000

	)

742 
	#PCI_ERR_UNC_ECRC
 0x00080000

	)

743 
	#PCI_ERR_UNC_UNSUP
 0x00100000

	)

744 
	#PCI_ERR_UNC_ACSV
 0x00200000

	)

745 
	#PCI_ERR_UNC_INTN
 0x00400000

	)

746 
	#PCI_ERR_UNC_MCBTLP
 0x00800000

	)

747 
	#PCI_ERR_UNC_ATOMEG
 0x01000000

	)

748 
	#PCI_ERR_UNC_TLPPRE
 0x02000000

	)

749 
	#PCI_ERR_UNCOR_MASK
 8

	)

751 
	#PCI_ERR_UNCOR_SEVER
 12

	)

753 
	#PCI_ERR_COR_STATUS
 16

	)

754 
	#PCI_ERR_COR_RCVR
 0x00000001

	)

755 
	#PCI_ERR_COR_BAD_TLP
 0x00000040

	)

756 
	#PCI_ERR_COR_BAD_DLLP
 0x00000080

	)

757 
	#PCI_ERR_COR_REP_ROLL
 0x00000100

	)

758 
	#PCI_ERR_COR_REP_TIMER
 0x00001000

	)

759 
	#PCI_ERR_COR_ADV_NFAT
 0x00002000

	)

760 
	#PCI_ERR_COR_INTERNAL
 0x00004000

	)

761 
	#PCI_ERR_COR_LOG_OVER
 0x00008000

	)

762 
	#PCI_ERR_COR_MASK
 20

	)

764 
	#PCI_ERR_CAP
 24

	)

765 
	#PCI_ERR_CAP_FEP
(
x
è((xè& 31è

	)

766 
	#PCI_ERR_CAP_ECRC_GENC
 0x00000020

	)

767 
	#PCI_ERR_CAP_ECRC_GENE
 0x00000040

	)

768 
	#PCI_ERR_CAP_ECRC_CHKC
 0x00000080

	)

769 
	#PCI_ERR_CAP_ECRC_CHKE
 0x00000100

	)

770 
	#PCI_ERR_HEADER_LOG
 28

	)

771 
	#PCI_ERR_ROOT_COMMAND
 44

	)

772 
	#PCI_ERR_ROOT_CMD_COR_EN
 0x00000001

	)

773 
	#PCI_ERR_ROOT_CMD_NONFATAL_EN
 0x00000002

	)

774 
	#PCI_ERR_ROOT_CMD_FATAL_EN
 0x00000004

	)

775 
	#PCI_ERR_ROOT_STATUS
 48

	)

776 
	#PCI_ERR_ROOT_COR_RCV
 0x00000001

	)

777 
	#PCI_ERR_ROOT_MULTI_COR_RCV
 0x00000002

	)

778 
	#PCI_ERR_ROOT_UNCOR_RCV
 0x00000004

	)

779 
	#PCI_ERR_ROOT_MULTI_UNCOR_RCV
 0x00000008

	)

780 
	#PCI_ERR_ROOT_FIRST_FATAL
 0x00000010

	)

781 
	#PCI_ERR_ROOT_NONFATAL_RCV
 0x00000020

	)

782 
	#PCI_ERR_ROOT_FATAL_RCV
 0x00000040

	)

783 
	#PCI_ERR_ROOT_AER_IRQ
 0xf8000000

	)

784 
	#PCI_ERR_ROOT_ERR_SRC
 52

	)

787 
	#PCI_VC_PORT_CAP1
 4

	)

788 
	#PCI_VC_CAP1_EVCC
 0x00000007

	)

789 
	#PCI_VC_CAP1_LPEVCC
 0x00000070

	)

790 
	#PCI_VC_CAP1_ARB_SIZE
 0x00000c00

	)

791 
	#PCI_VC_PORT_CAP2
 8

	)

792 
	#PCI_VC_CAP2_32_PHASE
 0x00000002

	)

793 
	#PCI_VC_CAP2_64_PHASE
 0x00000004

	)

794 
	#PCI_VC_CAP2_128_PHASE
 0x00000008

	)

795 
	#PCI_VC_CAP2_ARB_OFF
 0xff000000

	)

796 
	#PCI_VC_PORT_CTRL
 12

	)

797 
	#PCI_VC_PORT_CTRL_LOAD_TABLE
 0x00000001

	)

798 
	#PCI_VC_PORT_STATUS
 14

	)

799 
	#PCI_VC_PORT_STATUS_TABLE
 0x00000001

	)

800 
	#PCI_VC_RES_CAP
 16

	)

801 
	#PCI_VC_RES_CAP_32_PHASE
 0x00000002

	)

802 
	#PCI_VC_RES_CAP_64_PHASE
 0x00000004

	)

803 
	#PCI_VC_RES_CAP_128_PHASE
 0x00000008

	)

804 
	#PCI_VC_RES_CAP_128_PHASE_TB
 0x00000010

	)

805 
	#PCI_VC_RES_CAP_256_PHASE
 0x00000020

	)

806 
	#PCI_VC_RES_CAP_ARB_OFF
 0xff000000

	)

807 
	#PCI_VC_RES_CTRL
 20

	)

808 
	#PCI_VC_RES_CTRL_LOAD_TABLE
 0x00010000

	)

809 
	#PCI_VC_RES_CTRL_ARB_SELECT
 0x000e0000

	)

810 
	#PCI_VC_RES_CTRL_ID
 0x07000000

	)

811 
	#PCI_VC_RES_CTRL_ENABLE
 0x80000000

	)

812 
	#PCI_VC_RES_STATUS
 26

	)

813 
	#PCI_VC_RES_STATUS_TABLE
 0x00000001

	)

814 
	#PCI_VC_RES_STATUS_NEGO
 0x00000002

	)

815 
	#PCI_CAP_VC_BASE_SIZEOF
 0x10

	)

816 
	#PCI_CAP_VC_PER_VC_SIZEOF
 0x0C

	)

819 
	#PCI_PWR_DSR
 4

	)

820 
	#PCI_PWR_DATA
 8

	)

821 
	#PCI_PWR_DATA_BASE
(
x
è((xè& 0xffè

	)

822 
	#PCI_PWR_DATA_SCALE
(
x
è(((xè>> 8è& 3è

	)

823 
	#PCI_PWR_DATA_PM_SUB
(
x
è(((xè>> 10è& 7è

	)

824 
	#PCI_PWR_DATA_PM_STATE
(
x
è(((xè>> 13è& 3è

	)

825 
	#PCI_PWR_DATA_TYPE
(
x
è(((xè>> 15è& 7è

	)

826 
	#PCI_PWR_DATA_RAIL
(
x
è(((xè>> 18è& 7è

	)

827 
	#PCI_PWR_CAP
 12

	)

828 
	#PCI_PWR_CAP_BUDGET
(
x
è((xè& 1è

	)

829 
	#PCI_EXT_CAP_PWR_SIZEOF
 16

	)

832 
	#PCI_VNDR_HEADER
 4

	)

833 
	#PCI_VNDR_HEADER_ID
(
x
è((xè& 0xffff)

	)

834 
	#PCI_VNDR_HEADER_REV
(
x
è(((xè>> 16è& 0xf)

	)

835 
	#PCI_VNDR_HEADER_LEN
(
x
è(((xè>> 20è& 0xfff)

	)

845 
	#HT_3BIT_CAP_MASK
 0xE0

	)

846 
	#HT_CAPTYPE_SLAVE
 0x00

	)

847 
	#HT_CAPTYPE_HOST
 0x20

	)

849 
	#HT_5BIT_CAP_MASK
 0xF8

	)

850 
	#HT_CAPTYPE_IRQ
 0x80

	)

851 
	#HT_CAPTYPE_REMAPPING_40
 0xA0

	)

852 
	#HT_CAPTYPE_REMAPPING_64
 0xA2

	)

853 
	#HT_CAPTYPE_UNITID_CLUMP
 0x90

	)

854 
	#HT_CAPTYPE_EXTCONF
 0x98

	)

855 
	#HT_CAPTYPE_MSI_MAPPING
 0xA8

	)

856 
	#HT_MSI_FLAGS
 0x02

	)

857 
	#HT_MSI_FLAGS_ENABLE
 0x1

	)

858 
	#HT_MSI_FLAGS_FIXED
 0x2

	)

859 
	#HT_MSI_FIXED_ADDR
 0x00000000FEE00000ULL

	)

860 
	#HT_MSI_ADDR_LO
 0x04

	)

861 
	#HT_MSI_ADDR_LO_MASK
 0xFFF00000

	)

862 
	#HT_MSI_ADDR_HI
 0x08

	)

863 
	#HT_CAPTYPE_DIRECT_ROUTE
 0xB0

	)

864 
	#HT_CAPTYPE_VCSET
 0xB8

	)

865 
	#HT_CAPTYPE_ERROR_RETRY
 0xC0

	)

866 
	#HT_CAPTYPE_GEN3
 0xD0

	)

867 
	#HT_CAPTYPE_PM
 0xE0

	)

868 
	#HT_CAP_SIZEOF_LONG
 28

	)

869 
	#HT_CAP_SIZEOF_SHORT
 24

	)

872 
	#PCI_ARI_CAP
 0x04

	)

873 
	#PCI_ARI_CAP_MFVC
 0x0001

	)

874 
	#PCI_ARI_CAP_ACS
 0x0002

	)

875 
	#PCI_ARI_CAP_NFN
(
x
è(((xè>> 8è& 0xffè

	)

876 
	#PCI_ARI_CTRL
 0x06

	)

877 
	#PCI_ARI_CTRL_MFVC
 0x0001

	)

878 
	#PCI_ARI_CTRL_ACS
 0x0002

	)

879 
	#PCI_ARI_CTRL_FG
(
x
è(((xè>> 4è& 7è

	)

880 
	#PCI_EXT_CAP_ARI_SIZEOF
 8

	)

883 
	#PCI_ATS_CAP
 0x04

	)

884 
	#PCI_ATS_CAP_QDEP
(
x
è((xè& 0x1fè

	)

885 
	#PCI_ATS_MAX_QDEP
 32

	)

886 
	#PCI_ATS_CAP_PAGE_ALIGNED
 0x0020

	)

887 
	#PCI_ATS_CTRL
 0x06

	)

888 
	#PCI_ATS_CTRL_ENABLE
 0x8000

	)

889 
	#PCI_ATS_CTRL_STU
(
x
è((xè& 0x1fè

	)

890 
	#PCI_ATS_MIN_STU
 12

	)

891 
	#PCI_EXT_CAP_ATS_SIZEOF
 8

	)

894 
	#PCI_PRI_CTRL
 0x04

	)

895 
	#PCI_PRI_CTRL_ENABLE
 0x0001

	)

896 
	#PCI_PRI_CTRL_RESET
 0x0002

	)

897 
	#PCI_PRI_STATUS
 0x06

	)

898 
	#PCI_PRI_STATUS_RF
 0x0001

	)

899 
	#PCI_PRI_STATUS_UPRGI
 0x0002

	)

900 
	#PCI_PRI_STATUS_STOPPED
 0x0100

	)

901 
	#PCI_PRI_STATUS_PASID
 0x8000

	)

902 
	#PCI_PRI_MAX_REQ
 0x08

	)

903 
	#PCI_PRI_ALLOC_REQ
 0x0ø

	)

904 
	#PCI_EXT_CAP_PRI_SIZEOF
 16

	)

907 
	#PCI_PASID_CAP
 0x04

	)

908 
	#PCI_PASID_CAP_EXEC
 0x02

	)

909 
	#PCI_PASID_CAP_PRIV
 0x04

	)

910 
	#PCI_PASID_CTRL
 0x06

	)

911 
	#PCI_PASID_CTRL_ENABLE
 0x01

	)

912 
	#PCI_PASID_CTRL_EXEC
 0x02

	)

913 
	#PCI_PASID_CTRL_PRIV
 0x04

	)

914 
	#PCI_EXT_CAP_PASID_SIZEOF
 8

	)

917 
	#PCI_SRIOV_CAP
 0x04

	)

918 
	#PCI_SRIOV_CAP_VFM
 0x00000001

	)

919 
	#PCI_SRIOV_CAP_INTR
(
x
è((xè>> 21è

	)

920 
	#PCI_SRIOV_CTRL
 0x08

	)

921 
	#PCI_SRIOV_CTRL_VFE
 0x0001

	)

922 
	#PCI_SRIOV_CTRL_VFM
 0x0002

	)

923 
	#PCI_SRIOV_CTRL_INTR
 0x0004

	)

924 
	#PCI_SRIOV_CTRL_MSE
 0x0008

	)

925 
	#PCI_SRIOV_CTRL_ARI
 0x0010

	)

926 
	#PCI_SRIOV_STATUS
 0x0¨

	)

927 
	#PCI_SRIOV_STATUS_VFM
 0x0001

	)

928 
	#PCI_SRIOV_INITIAL_VF
 0x0ø

	)

929 
	#PCI_SRIOV_TOTAL_VF
 0x0

	)

930 
	#PCI_SRIOV_NUM_VF
 0x10

	)

931 
	#PCI_SRIOV_FUNC_LINK
 0x12

	)

932 
	#PCI_SRIOV_VF_OFFSET
 0x14

	)

933 
	#PCI_SRIOV_VF_STRIDE
 0x16

	)

934 
	#PCI_SRIOV_VF_DID
 0x1¨

	)

935 
	#PCI_SRIOV_SUP_PGSIZE
 0x1ø

	)

936 
	#PCI_SRIOV_SYS_PGSIZE
 0x20

	)

937 
	#PCI_SRIOV_BAR
 0x24

	)

938 
	#PCI_SRIOV_NUM_BARS
 6

	)

939 
	#PCI_SRIOV_VFM
 0x3ø

	)

940 
	#PCI_SRIOV_VFM_BIR
(
x
è((xè& 7è

	)

941 
	#PCI_SRIOV_VFM_OFFSET
(
x
è((xè& ~7è

	)

942 
	#PCI_SRIOV_VFM_UA
 0x0

	)

943 
	#PCI_SRIOV_VFM_MI
 0x1

	)

944 
	#PCI_SRIOV_VFM_MO
 0x2

	)

945 
	#PCI_SRIOV_VFM_AV
 0x3

	)

946 
	#PCI_EXT_CAP_SRIOV_SIZEOF
 64

	)

948 
	#PCI_LTR_MAX_SNOOP_LAT
 0x4

	)

949 
	#PCI_LTR_MAX_NOSNOOP_LAT
 0x6

	)

950 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

951 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

952 
	#PCI_LTR_SCALE_SHIFT
 10

	)

953 
	#PCI_EXT_CAP_LTR_SIZEOF
 8

	)

956 
	#PCI_ACS_CAP
 0x04

	)

957 
	#PCI_ACS_SV
 0x0001

	)

958 
	#PCI_ACS_TB
 0x0002

	)

959 
	#PCI_ACS_RR
 0x0004

	)

960 
	#PCI_ACS_CR
 0x0008

	)

961 
	#PCI_ACS_UF
 0x0010

	)

962 
	#PCI_ACS_EC
 0x0020

	)

963 
	#PCI_ACS_DT
 0x0040

	)

964 
	#PCI_ACS_EGRESS_BITS
 0x05

	)

965 
	#PCI_ACS_CTRL
 0x06

	)

966 
	#PCI_ACS_EGRESS_CTL_V
 0x08

	)

968 
	#PCI_VSEC_HDR
 4

	)

969 
	#PCI_VSEC_HDR_LEN_SHIFT
 20

	)

972 
	#PCI_SATA_REGS
 4

	)

973 
	#PCI_SATA_REGS_MASK
 0xF

	)

974 
	#PCI_SATA_REGS_INLINE
 0xF

	)

975 
	#PCI_SATA_SIZEOF_SHORT
 8

	)

976 
	#PCI_SATA_SIZEOF_LONG
 16

	)

979 
	#PCI_REBAR_CAP
 4

	)

980 
	#PCI_REBAR_CAP_SIZES
 0x00FFFFF0

	)

981 
	#PCI_REBAR_CTRL
 8

	)

982 
	#PCI_REBAR_CTRL_BAR_IDX
 0x00000007

	)

983 
	#PCI_REBAR_CTRL_NBAR_MASK
 0x000000E0

	)

984 
	#PCI_REBAR_CTRL_NBAR_SHIFT
 5

	)

985 
	#PCI_REBAR_CTRL_BAR_SIZE
 0x00001F00

	)

986 
	#PCI_REBAR_CTRL_BAR_SHIFT
 8

	)

989 
	#PCI_DPA_CAP
 4

	)

990 
	#PCI_DPA_CAP_SUBSTATE_MASK
 0x1F

	)

991 
	#PCI_DPA_BASE_SIZEOF
 16

	)

994 
	#PCI_TPH_CAP
 4

	)

995 
	#PCI_TPH_CAP_LOC_MASK
 0x600

	)

996 
	#PCI_TPH_LOC_NONE
 0x000

	)

997 
	#PCI_TPH_LOC_CAP
 0x200

	)

998 
	#PCI_TPH_LOC_MSIX
 0x400

	)

999 
	#PCI_TPH_CAP_ST_MASK
 0x07FF0000

	)

1000 
	#PCI_TPH_CAP_ST_SHIFT
 16

	)

1001 
	#PCI_TPH_BASE_SIZEOF
 12

	)

1004 
	#PCI_EXP_DPC_CAP
 4

	)

1005 
	#PCI_EXP_DPC_IRQ
 0x001F

	)

1006 
	#PCI_EXP_DPC_CAP_RP_EXT
 0x0020

	)

1007 
	#PCI_EXP_DPC_CAP_POISONED_TLP
 0x0040

	)

1008 
	#PCI_EXP_DPC_CAP_SW_TRIGGER
 0x0080

	)

1009 
	#PCI_EXP_DPC_RP_PIO_LOG_SIZE
 0x0F00

	)

1010 
	#PCI_EXP_DPC_CAP_DL_ACTIVE
 0x1000

	)

1012 
	#PCI_EXP_DPC_CTL
 6

	)

1013 
	#PCI_EXP_DPC_CTL_EN_FATAL
 0x0001

	)

1014 
	#PCI_EXP_DPC_CTL_EN_NONFATAL
 0x0002

	)

1015 
	#PCI_EXP_DPC_CTL_INT_EN
 0x0008

	)

1017 
	#PCI_EXP_DPC_STATUS
 8

	)

1018 
	#PCI_EXP_DPC_STATUS_TRIGGER
 0x0001

	)

1019 
	#PCI_EXP_DPC_STATUS_TRIGGER_RSN
 0x0006

	)

1020 
	#PCI_EXP_DPC_STATUS_INTERRUPT
 0x0008

	)

1021 
	#PCI_EXP_DPC_RP_BUSY
 0x0010

	)

1022 
	#PCI_EXP_DPC_STATUS_TRIGGER_RSN_EXT
 0x0060

	)

1024 
	#PCI_EXP_DPC_SOURCE_ID
 10

	)

1026 
	#PCI_EXP_DPC_RP_PIO_STATUS
 0x0C

	)

1027 
	#PCI_EXP_DPC_RP_PIO_MASK
 0x10

	)

1028 
	#PCI_EXP_DPC_RP_PIO_SEVERITY
 0x14

	)

1029 
	#PCI_EXP_DPC_RP_PIO_SYSERROR
 0x18

	)

1030 
	#PCI_EXP_DPC_RP_PIO_EXCEPTION
 0x1C

	)

1031 
	#PCI_EXP_DPC_RP_PIO_HEADER_LOG
 0x20

	)

1032 
	#PCI_EXP_DPC_RP_PIO_IMPSPEC_LOG
 0x30

	)

1033 
	#PCI_EXP_DPC_RP_PIO_TLPPREFIX_LOG
 0x34

	)

1036 
	#PCI_PTM_CAP
 0x04

	)

1037 
	#PCI_PTM_CAP_REQ
 0x00000001

	)

1038 
	#PCI_PTM_CAP_ROOT
 0x00000004

	)

1039 
	#PCI_PTM_GRANULARITY_MASK
 0x0000FF00

	)

1040 
	#PCI_PTM_CTRL
 0x08

	)

1041 
	#PCI_PTM_CTRL_ENABLE
 0x00000001

	)

1042 
	#PCI_PTM_CTRL_ROOT
 0x00000002

	)

1045 
	#PCI_L1SS_CAP
 0x04

	)

1046 
	#PCI_L1SS_CAP_PCIPM_L1_2
 0x00000001

	)

1047 
	#PCI_L1SS_CAP_PCIPM_L1_1
 0x00000002

	)

1048 
	#PCI_L1SS_CAP_ASPM_L1_2
 0x00000004

	)

1049 
	#PCI_L1SS_CAP_ASPM_L1_1
 0x00000008

	)

1050 
	#PCI_L1SS_CAP_L1_PM_SS
 0x00000010

	)

1051 
	#PCI_L1SS_CAP_CM_RESTORE_TIME
 0x0000ff00

	)

1052 
	#PCI_L1SS_CAP_P_PWR_ON_SCALE
 0x00030000

	)

1053 
	#PCI_L1SS_CAP_P_PWR_ON_VALUE
 0x00f80000

	)

1054 
	#PCI_L1SS_CTL1
 0x08

	)

1055 
	#PCI_L1SS_CTL1_PCIPM_L1_2
 0x00000001

	)

1056 
	#PCI_L1SS_CTL1_PCIPM_L1_1
 0x00000002

	)

1057 
	#PCI_L1SS_CTL1_ASPM_L1_2
 0x00000004

	)

1058 
	#PCI_L1SS_CTL1_ASPM_L1_1
 0x00000008

	)

1059 
	#PCI_L1SS_CTL1_L1SS_MASK
 0x0000000f

	)

1060 
	#PCI_L1SS_CTL1_CM_RESTORE_TIME
 0x0000ff00

	)

1061 
	#PCI_L1SS_CTL1_LTR_L12_TH_VALUE
 0x03ff0000

	)

1062 
	#PCI_L1SS_CTL1_LTR_L12_TH_SCALE
 0xe0000000

	)

1063 
	#PCI_L1SS_CTL2
 0x0ø

	)

1066 
	#PCI_DLF_CAP
 0x04

	)

1067 
	#PCI_DLF_EXCHANGE_ENABLE
 0x80000000

	)

1070 
	#PCI_PL_16GT_LE_CTRL
 0x20

	)

1071 
	#PCI_PL_16GT_LE_CTRL_DSP_TX_PRESET_MASK
 0x0000000F

	)

1072 
	#PCI_PL_16GT_LE_CTRL_USP_TX_PRESET_MASK
 0x000000F0

	)

1073 
	#PCI_PL_16GT_LE_CTRL_USP_TX_PRESET_SHIFT
 4

	)

	@/usr/include/linux/posix_types.h

2 #iâdeà
_LINUX_POSIX_TYPES_H


3 
	#_LINUX_POSIX_TYPES_H


	)

5 
	~<lšux/¡ddef.h
>

22 #undeà
__FD_SETSIZE


23 
	#__FD_SETSIZE
 1024

	)

26 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

27 } 
	t__k”Ãl_fd_£t
;

30 (*
	t__k”Ãl_sighªdËr_t
)();

33 
	t__k”Ãl_key_t
;

34 
	t__k”Ãl_mqd_t
;

36 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/socket.h

2 #iâdeà
_LINUX_SOCKET_H


3 
	#_LINUX_SOCKET_H


	)

8 
	#_K_SS_MAXSIZE
 128

	)

10 
	t__k”Ãl_§_çmy_t
;

16 
	s__k”Ãl_sockaddr_¡Üage
 {

19 
__k”Ãl_§_çmy_t
 
	mss_çmy
;

21 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

25 *
	m__®ign
;

	@/usr/include/linux/sysinfo.h

2 #iâdeà
_LINUX_SYSINFO_H


3 
	#_LINUX_SYSINFO_H


	)

5 
	~<lšux/ty³s.h
>

7 
	#SI_LOAD_SHIFT
 16

	)

8 
	ssysšfo
 {

9 
__k”Ãl_lÚg_t
 
	mu±ime
;

10 
__k”Ãl_ulÚg_t
 
	mlßds
[3];

11 
__k”Ãl_ulÚg_t
 
	mtÙ®¿m
;

12 
__k”Ãl_ulÚg_t
 
	mä“¿m
;

13 
__k”Ãl_ulÚg_t
 
	msh¬ed¿m
;

14 
__k”Ãl_ulÚg_t
 
	mbufã¼am
;

15 
__k”Ãl_ulÚg_t
 
	mtÙ®sw­
;

16 
__k”Ãl_ulÚg_t
 
	mä“sw­
;

17 
__u16
 
	m´ocs
;

18 
__u16
 
	m·d
;

19 
__k”Ãl_ulÚg_t
 
	mtÙ®high
;

20 
__k”Ãl_ulÚg_t
 
	mä“high
;

21 
__u32
 
	mmem_un™
;

22 
	m_f
[20-2*(
__k”Ãl_ulÚg_t
)-(
__u32
)];

	@/usr/include/linux/time_types.h

2 #iâdeà
_LINUX_TIME_TYPES_H


3 
	#_LINUX_TIME_TYPES_H


	)

5 
	~<lšux/ty³s.h
>

7 
	s__k”Ãl_time¥ec
 {

8 
__k”Ãl_time64_t
 
	mtv_£c
;

9 
	mtv_n£c
;

12 
	s__k”Ãl_™im”¥ec
 {

13 
__k”Ãl_time¥ec
 
	m™_š‹rv®
;

14 
__k”Ãl_time¥ec
 
	m™_v®ue
;

24 #iâdeà
__k”Ãl_Şd_timev®


25 
	s__k”Ãl_Şd_timev®
 {

26 
__k”Ãl_lÚg_t
 
	mtv_£c
;

27 
__k”Ãl_lÚg_t
 
	mtv_u£c
;

31 
	s__k”Ãl_sock_timev®
 {

32 
__s64
 
	mtv_£c
;

33 
__s64
 
	mtv_u£c
;

	@/usr/include/asm-generic/types.h

2 #iâdeà
_ASM_GENERIC_TYPES_H


3 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-g’”ic/št-Î64.h
>

	@/usr/include/asm/posix_types.h

2 #ifdeà
__i386__


3 
	~<asm/posix_ty³s_32.h
>

4 #–ià
defšed
(
__ILP32__
)

5 
	~<asm/posix_ty³s_x32.h
>

7 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/bits/libc-header-start.h

27 #iâdeà
__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


31 #undeà
__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


33 
	~<ã©u»s.h
>

37 #undeà
__GLIBC_USE_LIB_EXT2


38 #ià(
defšed
 
__USE_GNU
 \

39 || (
defšed
 
	g__STDC_WANT_LIB_EXT2__
 && __STDC_WANT_LIB_EXT2__ > 0))

40 
	#__GLIBC_USE_LIB_EXT2
 1

	)

42 
	#__GLIBC_USE_LIB_EXT2
 0

	)

49 #undeà
__GLIBC_USE_IEC_60559_BFP_EXT


50 #ià
defšed
 
__USE_GNU
 || defšed 
__STDC_WANT_IEC_60559_BFP_EXT__


51 
	#__GLIBC_USE_IEC_60559_BFP_EXT
 1

	)

53 
	#__GLIBC_USE_IEC_60559_BFP_EXT
 0

	)

55 #undeà
__GLIBC_USE_IEC_60559_BFP_EXT_C2X


56 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
è|| __GLIBC_USE (
ISOC2X
)

57 
	#__GLIBC_USE_IEC_60559_BFP_EXT_C2X
 1

	)

59 
	#__GLIBC_USE_IEC_60559_BFP_EXT_C2X
 0

	)

66 #undeà
__GLIBC_USE_IEC_60559_FUNCS_EXT


67 #ià
defšed
 
__USE_GNU
 || defšed 
__STDC_WANT_IEC_60559_FUNCS_EXT__


68 
	#__GLIBC_USE_IEC_60559_FUNCS_EXT
 1

	)

70 
	#__GLIBC_USE_IEC_60559_FUNCS_EXT
 0

	)

72 #undeà
__GLIBC_USE_IEC_60559_FUNCS_EXT_C2X


73 #ià
__GLIBC_USE
 (
IEC_60559_FUNCS_EXT
è|| __GLIBC_USE (
ISOC2X
)

74 
	#__GLIBC_USE_IEC_60559_FUNCS_EXT_C2X
 1

	)

76 
	#__GLIBC_USE_IEC_60559_FUNCS_EXT_C2X
 0

	)

81 #undeà
__GLIBC_USE_IEC_60559_TYPES_EXT


82 #ià
defšed
 
__USE_GNU
 || defšed 
__STDC_WANT_IEC_60559_TYPES_EXT__


83 
	#__GLIBC_USE_IEC_60559_TYPES_EXT
 1

	)

85 
	#__GLIBC_USE_IEC_60559_TYPES_EXT
 0

	)

	@/usr/include/bits/posix1_lim.h

24 #iâdef 
_BITS_POSIX1_LIM_H


25 
	#_BITS_POSIX1_LIM_H
 1

	)

27 
	~<b™s/wÜdsize.h
>

32 
	#_POSIX_AIO_LISTIO_MAX
 2

	)

35 
	#_POSIX_AIO_MAX
 1

	)

38 
	#_POSIX_ARG_MAX
 4096

	)

41 #ifdeà
__USE_XOPEN2K


42 
	#_POSIX_CHILD_MAX
 25

	)

44 
	#_POSIX_CHILD_MAX
 6

	)

48 
	#_POSIX_DELAYTIMER_MAX
 32

	)

52 
	#_POSIX_HOST_NAME_MAX
 255

	)

55 
	#_POSIX_LINK_MAX
 8

	)

58 
	#_POSIX_LOGIN_NAME_MAX
 9

	)

61 
	#_POSIX_MAX_CANON
 255

	)

65 
	#_POSIX_MAX_INPUT
 255

	)

68 
	#_POSIX_MQ_OPEN_MAX
 8

	)

71 
	#_POSIX_MQ_PRIO_MAX
 32

	)

74 
	#_POSIX_NAME_MAX
 14

	)

77 #ifdeà
__USE_XOPEN2K


78 
	#_POSIX_NGROUPS_MAX
 8

	)

80 
	#_POSIX_NGROUPS_MAX
 0

	)

84 #ifdeà
__USE_XOPEN2K


85 
	#_POSIX_OPEN_MAX
 20

	)

87 
	#_POSIX_OPEN_MAX
 16

	)

90 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


93 
	#_POSIX_FD_SETSIZE
 
_POSIX_OPEN_MAX


	)

97 
	#_POSIX_PATH_MAX
 256

	)

100 
	#_POSIX_PIPE_BUF
 512

	)

104 
	#_POSIX_RE_DUP_MAX
 255

	)

107 
	#_POSIX_RTSIG_MAX
 8

	)

110 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

113 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

116 
	#_POSIX_SIGQUEUE_MAX
 32

	)

119 
	#_POSIX_SSIZE_MAX
 32767

	)

122 
	#_POSIX_STREAM_MAX
 8

	)

125 
	#_POSIX_SYMLINK_MAX
 255

	)

129 
	#_POSIX_SYMLOOP_MAX
 8

	)

132 
	#_POSIX_TIMER_MAX
 32

	)

135 
	#_POSIX_TTY_NAME_MAX
 9

	)

138 #ifdeà
__USE_XOPEN2K


139 
	#_POSIX_TZNAME_MAX
 6

	)

141 
	#_POSIX_TZNAME_MAX
 3

	)

144 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


146 
	#_POSIX_QLIMIT
 1

	)

150 
	#_POSIX_HIWAT
 
_POSIX_PIPE_BUF


	)

153 
	#_POSIX_UIO_MAXIOV
 16

	)

157 
	#_POSIX_CLOCKRES_MIN
 20000000

	)

161 
	~<b™s/loÿl_lim.h
>

164 #iâdef 
SSIZE_MAX


168 #ià
__WORDSIZE
 =ğ64 || 
__WORDSIZE32_SIZE_ULONG


169 
	#SSIZE_MAX
 
LONG_MAX


	)

171 
	#SSIZE_MAX
 
INT_MAX


	)

179 #iâdef 
NGROUPS_MAX


180 
	#NGROUPS_MAX
 8

	)

	@/usr/include/bits/posix2_lim.h

22 #iâdef 
_BITS_POSIX2_LIM_H


23 
	#_BITS_POSIX2_LIM_H
 1

	)

27 
	#_POSIX2_BC_BASE_MAX
 99

	)

30 
	#_POSIX2_BC_DIM_MAX
 2048

	)

33 
	#_POSIX2_BC_SCALE_MAX
 99

	)

36 
	#_POSIX2_BC_STRING_MAX
 1000

	)

40 
	#_POSIX2_COLL_WEIGHTS_MAX
 2

	)

44 
	#_POSIX2_EXPR_NEST_MAX
 32

	)

47 
	#_POSIX2_LINE_MAX
 2048

	)

51 
	#_POSIX2_RE_DUP_MAX
 255

	)

55 
	#_POSIX2_CHARCLASS_NAME_MAX
 14

	)

62 #iâdef 
BC_BASE_MAX


63 
	#BC_BASE_MAX
 
_POSIX2_BC_BASE_MAX


	)

65 #iâdef 
BC_DIM_MAX


66 
	#BC_DIM_MAX
 
_POSIX2_BC_DIM_MAX


	)

68 #iâdef 
BC_SCALE_MAX


69 
	#BC_SCALE_MAX
 
_POSIX2_BC_SCALE_MAX


	)

71 #iâdef 
BC_STRING_MAX


72 
	#BC_STRING_MAX
 
_POSIX2_BC_STRING_MAX


	)

74 #iâdef 
COLL_WEIGHTS_MAX


75 
	#COLL_WEIGHTS_MAX
 255

	)

77 #iâdef 
EXPR_NEST_MAX


78 
	#EXPR_NEST_MAX
 
_POSIX2_EXPR_NEST_MAX


	)

80 #iâdef 
LINE_MAX


81 
	#LINE_MAX
 
_POSIX2_LINE_MAX


	)

83 #iâdef 
CHARCLASS_NAME_MAX


84 
	#CHARCLASS_NAME_MAX
 2048

	)

88 
	#RE_DUP_MAX
 (0x7fff)

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__
 && !defšed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

7 
	#__WORDSIZE32_SIZE_ULONG
 0

	)

8 
	#__WORDSIZE32_PTRDIFF_LONG
 0

	)

11 #ifdeà
__x86_64__


12 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

14 
	#__SYSCALL_WORDSIZE
 64

	)

16 
	#__WORDSIZE_TIME64_COMPAT32
 0

	)

	@/usr/include/bits/xopen_lim.h

29 #iâdeà
_XOPEN_LIM_H


30 
	#_XOPEN_LIM_H
 1

	)

62 
	#_XOPEN_IOV_MAX
 
_POSIX_UIO_MAXIOV


	)

64 
	~<b™s/uio_lim.h
>

65 #ifdeà
__IOV_MAX


66 
	#IOV_MAX
 
__IOV_MAX


	)

68 #undeà
IOV_MAX


73 
	#NL_ARGMAX
 
_POSIX_ARG_MAX


	)

76 
	#NL_LANGMAX
 
_POSIX2_LINE_MAX


	)

79 
	#NL_MSGMAX
 
INT_MAX


	)

83 #ià
defšed
 
__USE_GNU
 || !defšed 
__USE_XOPEN2K8


84 
	#NL_NMAX
 
INT_MAX


	)

88 
	#NL_SETMAX
 
INT_MAX


	)

91 
	#NL_TEXTMAX
 
INT_MAX


	)

94 
	#NZERO
 20

	)

98 #ifdeà
INT_MAX


99 #ià
INT_MAX
 == 32767

100 
	#WORD_BIT
 16

	)

102 #ià
INT_MAX
 == 2147483647

103 
	#WORD_BIT
 32

	)

106 
	#WORD_BIT
 64

	)

109 #–ià
defšed
 
__INT_MAX__


110 #ià
__INT_MAX__
 == 32767

111 
	#WORD_BIT
 16

	)

113 #ià
__INT_MAX__
 == 2147483647

114 
	#WORD_BIT
 32

	)

117 
	#WORD_BIT
 64

	)

121 
	#WORD_BIT
 32

	)

125 #ifdeà
LONG_MAX


126 #ià
LONG_MAX
 == 2147483647

127 
	#LONG_BIT
 32

	)

130 
	#LONG_BIT
 64

	)

132 #–ià
defšed
 
__LONG_MAX__


133 #ià
__LONG_MAX__
 == 2147483647

134 
	#LONG_BIT
 32

	)

137 
	#LONG_BIT
 64

	)

140 
	~<b™s/wÜdsize.h
>

141 #ià
__WORDSIZE
 == 64

142 
	#LONG_BIT
 64

	)

144 
	#LONG_BIT
 32

	)

	@/usr/include/linux/hdlc/ioctl.h

2 #iâdeà
__HDLC_IOCTL_H__


3 
	#__HDLC_IOCTL_H__


	)

6 
	#GENERIC_HDLC_VERSION
 4

	)

8 
	#CLOCK_DEFAULT
 0

	)

9 
	#CLOCK_EXT
 1

	)

10 
	#CLOCK_INT
 2

	)

11 
	#CLOCK_TXINT
 3

	)

12 
	#CLOCK_TXFROMRX
 4

	)

15 
	#ENCODING_DEFAULT
 0

	)

16 
	#ENCODING_NRZ
 1

	)

17 
	#ENCODING_NRZI
 2

	)

18 
	#ENCODING_FM_MARK
 3

	)

19 
	#ENCODING_FM_SPACE
 4

	)

20 
	#ENCODING_MANCHESTER
 5

	)

23 
	#PARITY_DEFAULT
 0

	)

24 
	#PARITY_NONE
 1

	)

25 
	#PARITY_CRC16_PR0
 2

	)

26 
	#PARITY_CRC16_PR1
 3

	)

27 
	#PARITY_CRC16_PR0_CCITT
 4

	)

28 
	#PARITY_CRC16_PR1_CCITT
 5

	)

29 
	#PARITY_CRC32_PR0_CCITT
 6

	)

30 
	#PARITY_CRC32_PR1_CCITT
 7

	)

32 
	#LMI_DEFAULT
 0

	)

33 
	#LMI_NONE
 1

	)

34 
	#LMI_ANSI
 2

	)

35 
	#LMI_CCITT
 3

	)

36 
	#LMI_CISCO
 4

	)

38 #iâdeà
__ASSEMBLY__


41 
	mşock_¿‹
;

42 
	mşock_ty³
;

43 
	mloİback
;

44 } 
	tsync_£rŸl_£‰šgs
;

47 
	mşock_¿‹
;

48 
	mşock_ty³
;

49 
	mloİback
;

50 
	m¦Ù_m­
;

51 } 
	t‹1_£‰šgs
;

54 
	m’codšg
;

55 
	m·r™y
;

56 } 
	t¿w_hdlc_´Ùo
;

59 
	mt391
;

60 
	mt392
;

61 
	mn391
;

62 
	mn392
;

63 
	mn393
;

64 
	mlmi
;

65 
	mdû
;

66 } 
	tä_´Ùo
;

69 
	mdlci
;

70 } 
	tä_´Ùo_pvc
;

73 
	mdlci
;

74 
	mma¡”
[
IFNAMSIZ
];

75 }
	tä_´Ùo_pvc_šfo
;

78 
	mš‹rv®
;

79 
	mtimeout
;

80 } 
	tcisco_´Ùo
;

	@/usr/include/linux/libc-compat.h

49 #iâdeà
_LIBC_COMPAT_H


50 
	#_LIBC_COMPAT_H


	)

53 #ià
defšed
(
__GLIBC__
)

56 #ià
defšed
(
_NET_IF_H
è&& defšed(
__USE_MISC
)

61 
	#__UAPI_DEF_IF_IFCONF
 0

	)

62 
	#__UAPI_DEF_IF_IFMAP
 0

	)

63 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

64 
	#__UAPI_DEF_IF_IFREQ
 0

	)

66 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

68 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


69 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

78 
	#__UAPI_DEF_IF_IFCONF
 1

	)

79 
	#__UAPI_DEF_IF_IFMAP
 1

	)

80 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

81 
	#__UAPI_DEF_IF_IFREQ
 1

	)

83 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

85 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

90 #ià
defšed
(
_NETINET_IN_H
)

94 
	#__UAPI_DEF_IN_ADDR
 0

	)

95 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

96 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

97 
	#__UAPI_DEF_IP_MREQ
 0

	)

98 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

99 
	#__UAPI_DEF_IN_CLASS
 0

	)

101 
	#__UAPI_DEF_IN6_ADDR
 0

	)

106 #ià
defšed
(
__USE_MISC
è|| defšed (
__USE_GNU
)

107 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

109 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

111 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

112 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

113 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

114 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

115 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

116 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

123 
	#__UAPI_DEF_IN_ADDR
 1

	)

124 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

125 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

126 
	#__UAPI_DEF_IP_MREQ
 1

	)

127 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

128 
	#__UAPI_DEF_IN_CLASS
 1

	)

130 
	#__UAPI_DEF_IN6_ADDR
 1

	)

133 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

134 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

135 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

136 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

137 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

138 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

139 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

144 #ià
defšed
(
__NETIPX_IPX_H
)

146 
	#__UAPI_DEF_SOCKADDR_IPX
 0

	)

147 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 0

	)

148 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 0

	)

149 
	#__UAPI_DEF_IPX_CONFIG_DATA
 0

	)

150 
	#__UAPI_DEF_IPX_ROUTE_DEF
 0

	)

154 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

155 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

156 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

157 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

158 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

163 #ià
defšed
(
_SYS_XATTR_H
)

164 
	#__UAPI_DEF_XATTR
 0

	)

166 
	#__UAPI_DEF_XATTR
 1

	)

176 #iâdeà
__UAPI_DEF_IF_IFCONF


177 
	#__UAPI_DEF_IF_IFCONF
 1

	)

179 #iâdeà
__UAPI_DEF_IF_IFMAP


180 
	#__UAPI_DEF_IF_IFMAP
 1

	)

182 #iâdeà
__UAPI_DEF_IF_IFNAMSIZ


183 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

185 #iâdeà
__UAPI_DEF_IF_IFREQ


186 
	#__UAPI_DEF_IF_IFREQ
 1

	)

189 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS


190 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

193 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


194 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

198 #iâdeà
__UAPI_DEF_IN_ADDR


199 
	#__UAPI_DEF_IN_ADDR
 1

	)

201 #iâdeà
__UAPI_DEF_IN_IPPROTO


202 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

204 #iâdeà
__UAPI_DEF_IN_PKTINFO


205 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

207 #iâdeà
__UAPI_DEF_IP_MREQ


208 
	#__UAPI_DEF_IP_MREQ
 1

	)

210 #iâdeà
__UAPI_DEF_SOCKADDR_IN


211 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

213 #iâdeà
__UAPI_DEF_IN_CLASS


214 
	#__UAPI_DEF_IN_CLASS
 1

	)

218 #iâdeà
__UAPI_DEF_IN6_ADDR


219 
	#__UAPI_DEF_IN6_ADDR
 1

	)

221 #iâdeà
__UAPI_DEF_IN6_ADDR_ALT


222 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

224 #iâdeà
__UAPI_DEF_SOCKADDR_IN6


225 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

227 #iâdeà
__UAPI_DEF_IPV6_MREQ


228 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

230 #iâdeà
__UAPI_DEF_IPPROTO_V6


231 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

233 #iâdeà
__UAPI_DEF_IPV6_OPTIONS


234 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

236 #iâdeà
__UAPI_DEF_IN6_PKTINFO


237 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

239 #iâdeà
__UAPI_DEF_IP6_MTUINFO


240 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

244 #iâdeà
__UAPI_DEF_SOCKADDR_IPX


245 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

247 #iâdeà
__UAPI_DEF_IPX_ROUTE_DEFINITION


248 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

250 #iâdeà
__UAPI_DEF_IPX_INTERFACE_DEFINITION


251 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

253 #iâdeà
__UAPI_DEF_IPX_CONFIG_DATA


254 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

256 #iâdeà
__UAPI_DEF_IPX_ROUTE_DEF


257 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

261 #iâdeà
__UAPI_DEF_XATTR


262 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/netlink.h

2 #iâdeà
__LINUX_NETLINK_H


3 
	#__LINUX_NETLINK_H


	)

5 
	~<lšux/cÚ¡.h
>

6 
	~<lšux/sock‘.h
>

7 
	~<lšux/ty³s.h
>

9 
	#NETLINK_ROUTE
 0

	)

10 
	#NETLINK_UNUSED
 1

	)

11 
	#NETLINK_USERSOCK
 2

	)

12 
	#NETLINK_FIREWALL
 3

	)

13 
	#NETLINK_SOCK_DIAG
 4

	)

14 
	#NETLINK_NFLOG
 5

	)

15 
	#NETLINK_XFRM
 6

	)

16 
	#NETLINK_SELINUX
 7

	)

17 
	#NETLINK_ISCSI
 8

	)

18 
	#NETLINK_AUDIT
 9

	)

19 
	#NETLINK_FIB_LOOKUP
 10

	)

20 
	#NETLINK_CONNECTOR
 11

	)

21 
	#NETLINK_NETFILTER
 12

	)

22 
	#NETLINK_IP6_FW
 13

	)

23 
	#NETLINK_DNRTMSG
 14

	)

24 
	#NETLINK_KOBJECT_UEVENT
 15

	)

25 
	#NETLINK_GENERIC
 16

	)

27 
	#NETLINK_SCSITRANSPORT
 18

	)

28 
	#NETLINK_ECRYPTFS
 19

	)

29 
	#NETLINK_RDMA
 20

	)

30 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_SMC
 22

	)

33 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

35 
	#MAX_LINKS
 32

	)

37 
	ssockaddr_Æ
 {

38 
__k”Ãl_§_çmy_t
 
	mÆ_çmy
;

39 
	mÆ_·d
;

40 
__u32
 
	mÆ_pid
;

41 
__u32
 
	mÆ_groups
;

44 
	sÆmsghdr
 {

45 
__u32
 
	mÆmsg_Ën
;

46 
__u16
 
	mÆmsg_ty³
;

47 
__u16
 
	mÆmsg_æags
;

48 
__u32
 
	mÆmsg_£q
;

49 
__u32
 
	mÆmsg_pid
;

54 
	#NLM_F_REQUEST
 0x01

	)

55 
	#NLM_F_MULTI
 0x02

	)

56 
	#NLM_F_ACK
 0x04

	)

57 
	#NLM_F_ECHO
 0x08

	)

58 
	#NLM_F_DUMP_INTR
 0x10

	)

59 
	#NLM_F_DUMP_FILTERED
 0x20

	)

62 
	#NLM_F_ROOT
 0x100

	)

63 
	#NLM_F_MATCH
 0x200

	)

64 
	#NLM_F_ATOMIC
 0x400

	)

65 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

68 
	#NLM_F_REPLACE
 0x100

	)

69 
	#NLM_F_EXCL
 0x200

	)

70 
	#NLM_F_CREATE
 0x400

	)

71 
	#NLM_F_APPEND
 0x800

	)

74 
	#NLM_F_NONREC
 0x100

	)

77 
	#NLM_F_CAPPED
 0x100

	)

78 
	#NLM_F_ACK_TLVS
 0x200

	)

89 
	#NLMSG_ALIGNTO
 4U

	)

90 
	#NLMSG_ALIGN
(
Ën
èĞ(Ö’)+
NLMSG_ALIGNTO
-1è& ~(NLMSG_ALIGNTO-1è)

	)

91 
	#NLMSG_HDRLEN
 ((è
	`NLMSG_ALIGN
((
Æmsghdr
)))

	)

92 
	#NLMSG_LENGTH
(
Ën
è(Ö’è+ 
NLMSG_HDRLEN
)

	)

93 
	#NLMSG_SPACE
(
Ën
è
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
Ö’))

	)

94 
	#NLMSG_DATA
(
Æh
è((*)(((*êlhè+ 
	`NLMSG_LENGTH
(0)))

	)

95 
	#NLMSG_NEXT
(
Æh
,
Ën
è(Ö’è-ğ
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
), \

96 (
Æmsghdr
*)(((*)(
Æh
)è+ 
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
)))

	)

97 
	#NLMSG_OK
(
Æh
,
Ën
è(Ö’è>ğ()(
Æmsghdr
) && \

98 (
Æh
)->
Æmsg_Ën
 >ğ(
Æmsghdr
) && \

99 (
Æh
)->
Æmsg_Ën
 <ğ(
Ën
))

	)

100 
	#NLMSG_PAYLOAD
(
Æh
,
Ën
è(Òlh)->
Æmsg_Ën
 - 
	`NLMSG_SPACE
(Ö’)))

	)

102 
	#NLMSG_NOOP
 0x1

	)

103 
	#NLMSG_ERROR
 0x2

	)

104 
	#NLMSG_DONE
 0x3

	)

105 
	#NLMSG_OVERRUN
 0x4

	)

107 
	#NLMSG_MIN_TYPE
 0x10

	)

109 
	sÆmsg”r
 {

110 
	m”rÜ
;

111 
Æmsghdr
 
	mmsg
;

135 
	eÆmsg”r_©Œs
 {

136 
	mNLMSGERR_ATTR_UNUSED
,

137 
	mNLMSGERR_ATTR_MSG
,

138 
	mNLMSGERR_ATTR_OFFS
,

139 
	mNLMSGERR_ATTR_COOKIE
,

141 
	m__NLMSGERR_ATTR_MAX
,

142 
	mNLMSGERR_ATTR_MAX
 = 
__NLMSGERR_ATTR_MAX
 - 1

145 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

146 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

147 
	#NETLINK_PKTINFO
 3

	)

148 
	#NETLINK_BROADCAST_ERROR
 4

	)

149 
	#NETLINK_NO_ENOBUFS
 5

	)

150 
	#NETLINK_RX_RING
 6

	)

151 
	#NETLINK_TX_RING
 7

	)

152 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

153 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

154 
	#NETLINK_CAP_ACK
 10

	)

155 
	#NETLINK_EXT_ACK
 11

	)

156 
	#NETLINK_GET_STRICT_CHK
 12

	)

158 
	sÆ_pktšfo
 {

159 
__u32
 
	mgroup
;

162 
	sÆ_mm­_»q
 {

163 
	mnm_block_size
;

164 
	mnm_block_Ä
;

165 
	mnm_äame_size
;

166 
	mnm_äame_Ä
;

169 
	sÆ_mm­_hdr
 {

170 
	mnm_¡©us
;

171 
	mnm_Ën
;

172 
__u32
 
	mnm_group
;

174 
__u32
 
	mnm_pid
;

175 
__u32
 
	mnm_uid
;

176 
__u32
 
	mnm_gid
;

179 
	eÆ_mm­_¡©us
 {

180 
	mNL_MMAP_STATUS_UNUSED
,

181 
	mNL_MMAP_STATUS_RESERVED
,

182 
	mNL_MMAP_STATUS_VALID
,

183 
	mNL_MMAP_STATUS_COPY
,

184 
	mNL_MMAP_STATUS_SKIP
,

187 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

188 
	#NL_MMAP_MSG_ALIGN
(
sz
è
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

189 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
Æ_mm­_hdr
))

	)

191 
	#NET_MAJOR
 36

	)

194 
	mNETLINK_UNCONNECTED
 = 0,

195 
	mNETLINK_CONNECTED
,

207 
	sÆ©Œ
 {

208 
__u16
 
	mÆa_Ën
;

209 
__u16
 
	mÆa_ty³
;

222 
	#NLA_F_NESTED
 (1 << 15)

	)

223 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

224 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

226 
	#NLA_ALIGNTO
 4

	)

227 
	#NLA_ALIGN
(
Ën
è((Ö’è+ 
NLA_ALIGNTO
 - 1è& ~(NLA_ALIGNTO - 1))

	)

228 
	#NLA_HDRLEN
 ((è
	`NLA_ALIGN
((
Æ©Œ
)))

	)

243 
	sÆa_b™f›ld32
 {

244 
__u32
 
	mv®ue
;

245 
__u32
 
	m£ËùÜ
;

	@/usr/include/linux/swab.h

2 #iâdeà
_LINUX_SWAB_H


3 
	#_LINUX_SWAB_H


	)

5 
	~<lšux/ty³s.h
>

7 
	~<asm/b™¥”lÚg.h
>

8 
	~<asm/swab.h
>

14 
	#___cÚ¡ªt_swab16
(
x
è((
__u16
)( \

15 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

16 (((
__u16
)(
x
è& (__u16)0xff00Uè>> 8)))

	)

18 
	#___cÚ¡ªt_swab32
(
x
è((
__u32
)( \

19 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

20 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

21 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

22 (((
__u32
)(
x
è& (__u32)0xff000000ULè>> 24)))

	)

24 
	#___cÚ¡ªt_swab64
(
x
è((
__u64
)( \

25 (((
__u64
)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

26 (((
__u64
)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

27 (((
__u64
)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

28 (((
__u64
)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

29 (((
__u64
)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

30 (((
__u64
)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

31 (((
__u64
)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

32 (((
__u64
)(
x
è& (__u64)0xff00000000000000ULLè>> 56)))

	)

34 
	#___cÚ¡ªt_swahw32
(
x
è((
__u32
)( \

35 (((
__u32
)(
x
) & (__u32)0x0000ffffUL) << 16) | \

36 (((
__u32
)(
x
è& (__u32)0xffff0000ULè>> 16)))

	)

38 
	#___cÚ¡ªt_swahb32
(
x
è((
__u32
)( \

39 (((
__u32
)(
x
) & (__u32)0x00ff00ffUL) << 8) | \

40 (((
__u32
)(
x
è& (__u32)0xff00ff00ULè>> 8)))

	)

48 
__šlše__
 
__u16
 
	$__fswab16
(
__u16
 
v®
)

50 #ià
	`defšed
 (
__¬ch_swab16
)

51  
	`__¬ch_swab16
(
v®
);

53  
	`___cÚ¡ªt_swab16
(
v®
);

55 
	}
}

57 
__šlše__
 
__u32
 
	$__fswab32
(
__u32
 
v®
)

59 #ià
	`defšed
(
__¬ch_swab32
)

60  
	`__¬ch_swab32
(
v®
);

62  
	`___cÚ¡ªt_swab32
(
v®
);

64 
	}
}

66 
__šlše__
 
__u64
 
	$__fswab64
(
__u64
 
v®
)

68 #ià
	`defšed
 (
__¬ch_swab64
)

69  
	`__¬ch_swab64
(
v®
);

70 #–ià
	`defšed
(
__SWAB_64_THRU_32__
)

71 
__u32
 
h
 = 
v®
 >> 32;

72 
__u32
 
l
 = 
v®
 & ((1ULL << 32) - 1);

73  (((
__u64
)
	`__fswab32
(
l
)è<< 32è| ((__u64)(__fswab32(
h
)));

75  
	`___cÚ¡ªt_swab64
(
v®
);

77 
	}
}

79 
__šlše__
 
__u32
 
	$__fswahw32
(
__u32
 
v®
)

81 #ifdeà
__¬ch_swahw32


82  
	`__¬ch_swahw32
(
v®
);

84  
	`___cÚ¡ªt_swahw32
(
v®
);

86 
	}
}

88 
__šlše__
 
__u32
 
	$__fswahb32
(
__u32
 
v®
)

90 #ifdeà
__¬ch_swahb32


91  
	`__¬ch_swahb32
(
v®
);

93  
	`___cÚ¡ªt_swahb32
(
v®
);

95 
	}
}

101 #ifdeà
__HAVE_BUILTIN_BSWAP16__


102 
	#__swab16
(
x
è(
__u16
)
	`__butš_bsw­16
((__u16)(x))

	)

104 
	#__swab16
(
x
) \

105 (
	`__butš_cÚ¡ªt_p
((
__u16
)(
x
)) ? \

106 
	`___cÚ¡ªt_swab16
(
x
) : \

107 
	`__fswab16
(
x
))

	)

114 #ifdeà
__HAVE_BUILTIN_BSWAP32__


115 
	#__swab32
(
x
è(
__u32
)
	`__butš_bsw­32
((__u32)(x))

	)

117 
	#__swab32
(
x
) \

118 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

119 
	`___cÚ¡ªt_swab32
(
x
) : \

120 
	`__fswab32
(
x
))

	)

127 #ifdeà
__HAVE_BUILTIN_BSWAP64__


128 
	#__swab64
(
x
è(
__u64
)
	`__butš_bsw­64
((__u64)(x))

	)

130 
	#__swab64
(
x
) \

131 (
	`__butš_cÚ¡ªt_p
((
__u64
)(
x
)) ? \

132 
	`___cÚ¡ªt_swab64
(
x
) : \

133 
	`__fswab64
(
x
))

	)

136 
__®ways_šlše
 
	$__swab
(cÚ¡ 
y
)

138 #ià
__BITS_PER_LONG
 == 64

139  
	`__swab64
(
y
);

141  
	`__swab32
(
y
);

143 
	}
}

151 
	#__swahw32
(
x
) \

152 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

153 
	`___cÚ¡ªt_swahw32
(
x
) : \

154 
	`__fswahw32
(
x
))

	)

162 
	#__swahb32
(
x
) \

163 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

164 
	`___cÚ¡ªt_swahb32
(
x
) : \

165 
	`__fswahb32
(
x
))

	)

171 
__®ways_šlše
 
__u16
 
	$__swab16p
(cÚ¡ 
__u16
 *
p
)

173 #ifdeà
__¬ch_swab16p


174  
	`__¬ch_swab16p
(
p
);

176  
	`__swab16
(*
p
);

178 
	}
}

184 
__®ways_šlše
 
__u32
 
	$__swab32p
(cÚ¡ 
__u32
 *
p
)

186 #ifdeà
__¬ch_swab32p


187  
	`__¬ch_swab32p
(
p
);

189  
	`__swab32
(*
p
);

191 
	}
}

197 
__®ways_šlše
 
__u64
 
	$__swab64p
(cÚ¡ 
__u64
 *
p
)

199 #ifdeà
__¬ch_swab64p


200  
	`__¬ch_swab64p
(
p
);

202  
	`__swab64
(*
p
);

204 
	}
}

212 
__šlše__
 
__u32
 
	$__swahw32p
(cÚ¡ 
__u32
 *
p
)

214 #ifdeà
__¬ch_swahw32p


215  
	`__¬ch_swahw32p
(
p
);

217  
	`__swahw32
(*
p
);

219 
	}
}

227 
__šlše__
 
__u32
 
	$__swahb32p
(cÚ¡ 
__u32
 *
p
)

229 #ifdeà
__¬ch_swahb32p


230  
	`__¬ch_swahb32p
(
p
);

232  
	`__swahb32
(*
p
);

234 
	}
}

240 
__šlše__
 
	$__swab16s
(
__u16
 *
p
)

242 #ifdeà
__¬ch_swab16s


243 
	`__¬ch_swab16s
(
p
);

245 *
p
 = 
	`__swab16p
(p);

247 
	}
}

252 
__®ways_šlše
 
	$__swab32s
(
__u32
 *
p
)

254 #ifdeà
__¬ch_swab32s


255 
	`__¬ch_swab32s
(
p
);

257 *
p
 = 
	`__swab32p
(p);

259 
	}
}

265 
__®ways_šlše
 
	$__swab64s
(
__u64
 *
p
)

267 #ifdeà
__¬ch_swab64s


268 
	`__¬ch_swab64s
(
p
);

270 *
p
 = 
	`__swab64p
(p);

272 
	}
}

280 
__šlše__
 
	$__swahw32s
(
__u32
 *
p
)

282 #ifdeà
__¬ch_swahw32s


283 
	`__¬ch_swahw32s
(
p
);

285 *
p
 = 
	`__swahw32p
(p);

287 
	}
}

295 
__šlše__
 
	$__swahb32s
(
__u32
 *
p
)

297 #ifdeà
__¬ch_swahb32s


298 
	`__¬ch_swahb32s
(
p
);

300 *
p
 = 
	`__swahb32p
(p);

302 
	}
}

	@/usr/include/sys/socket.h

19 #iâdef 
_SYS_SOCKET_H


20 
	#_SYS_SOCKET_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	g__BEGIN_DECLS


26 
	~<b™s/ty³s/¡ruù_iovec.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

33 
	~<b™s/sock‘.h
>

35 #ifdeà
__USE_MISC


36 
	~<b™s/ty³s/¡ruù_osockaddr.h
>

43 
	mSHUT_RD
 = 0,

44 
	#SHUT_RD
 
SHUT_RD


	)

45 
	mSHUT_WR
,

46 
	#SHUT_WR
 
SHUT_WR


	)

47 
	mSHUT_RDWR


48 
	#SHUT_RDWR
 
SHUT_RDWR


	)

57 #ià
defšed
 
__ılu¥lus
 || !
__GNUC_PREREQ
 (2, 7è|| !defšed 
__USE_GNU


58 
	#__SOCKADDR_ARG
 
sockaddr
 *
__»¡riù


	)

59 
	#__CONST_SOCKADDR_ARG
 cÚ¡ 
sockaddr
 *

	)

63 
	#__SOCKADDR_ALLTYPES
 \

64 
	`__SOCKADDR_ONETYPE
 (
sockaddr
) \

65 
	`__SOCKADDR_ONETYPE
 (
sockaddr_©
) \

66 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ax25
) \

67 
	`__SOCKADDR_ONETYPE
 (
sockaddr_dl
) \

68 
	`__SOCKADDR_ONETYPE
 (
sockaddr_eÚ
) \

69 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š
) \

70 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š6
) \

71 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š¬p
) \

72 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x
) \

73 
	`__SOCKADDR_ONETYPE
 (
sockaddr_iso
) \

74 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ns
) \

75 
	`__SOCKADDR_ONETYPE
 (
sockaddr_un
) \

76 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x25
)

	)

78 
	#__SOCKADDR_ONETYPE
(
ty³
èty³ *
__»¡riù
 
__
##ty³##__;

	)

79 uniÚ { 
	m__SOCKADDR_ALLTYPES


80 } 
	t__SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

81 #undeà
__SOCKADDR_ONETYPE


82 
	#__SOCKADDR_ONETYPE
(
ty³
ècÚ¡ ty³ *
__»¡riù
 
__
##ty³##__;

	)

83 uniÚ { 
	m__SOCKADDR_ALLTYPES


84 } 
	t__CONST_SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

85 #undeà
__SOCKADDR_ONETYPE


88 #ifdeà
__USE_GNU


90 
	smmsghdr


92 
msghdr
 
	mmsg_hdr
;

93 
	mmsg_Ën
;

102 
	$sock‘
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
è
__THROW
;

108 
	$sock‘·œ
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
,

109 
__fds
[2]è
__THROW
;

112 
	$bšd
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
)

113 
__THROW
;

116 
	$g‘sockÇme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

117 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

126 
	`cÚÃù
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
);

130 
	$g‘³”Çme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

131 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

138 
ssize_t
 
	`£nd
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
, 
__æags
);

145 
ssize_t
 
	`»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
);

152 
ssize_t
 
	`£ndto
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

153 
__æags
, 
__CONST_SOCKADDR_ARG
 
__addr
,

154 
sockËn_t
 
__addr_Ën
);

163 
ssize_t
 
	`»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

164 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

165 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

173 
ssize_t
 
	`£ndmsg
 (
__fd
, cÚ¡ 
msghdr
 *
__mes§ge
,

174 
__æags
);

176 #ifdeà
__USE_GNU


182 
	`£ndmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

183 
__vËn
, 
__æags
);

191 
ssize_t
 
	`»cvmsg
 (
__fd
, 
msghdr
 *
__mes§ge
, 
__æags
);

193 #ifdeà
__USE_GNU


199 
	`»cvmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

200 
__vËn
, 
__æags
,

201 
time¥ec
 *
__tmo
);

208 
	$g‘sockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

209 *
__»¡riù
 
__İtv®
,

210 
sockËn_t
 *
__»¡riù
 
__İ’
è
__THROW
;

215 
	$£tsockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

216 cÚ¡ *
__İtv®
, 
sockËn_t
 
__İ’
è
__THROW
;

222 
	$li¡’
 (
__fd
, 
__n
è
__THROW
;

232 
	`acû±
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

233 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

235 #ifdeà
__USE_GNU


240 
	`acû±4
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

241 
sockËn_t
 *
__»¡riù
 
__addr_Ën
, 
__æags
);

250 
	$shutdown
 (
__fd
, 
__how
è
__THROW
;

253 #ifdeà
__USE_XOPEN2K


255 
	$sock©m¬k
 (
__fd
è
__THROW
;

259 #ifdeà
__USE_MISC


263 
	$isfdty³
 (
__fd
, 
__fdty³
è
__THROW
;

268 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


269 
	~<b™s/sock‘2.h
>

272 
__END_DECLS


	@/usr/include/asm-generic/int-ll64.h

9 #iâdeà
_ASM_GENERIC_INT_LL64_H


10 
	#_ASM_GENERIC_INT_LL64_H


	)

12 
	~<asm/b™¥”lÚg.h
>

14 #iâdeà
__ASSEMBLY__


20 
__sigÃd__
 
	t__s8
;

21 
	t__u8
;

23 
__sigÃd__
 
	t__s16
;

24 
	t__u16
;

26 
__sigÃd__
 
	t__s32
;

27 
	t__u32
;

29 #ifdeà
__GNUC__


30 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

31 
__ex‹nsiÚ__
 
	t__u64
;

33 
__sigÃd__
 
	t__s64
;

34 
	t__u64
;

	@/usr/include/asm/bitsperlong.h

2 #iâdeà
__ASM_X86_BITSPERLONG_H


3 
	#__ASM_X86_BITSPERLONG_H


	)

5 #ià
defšed
(
__x86_64__
è&& !defšed(
__ILP32__
)

6 
	#__BITS_PER_LONG
 64

	)

8 
	#__BITS_PER_LONG
 32

	)

11 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/asm/posix_types_32.h

2 #iâdeà
_ASM_X86_POSIX_TYPES_32_H


3 
	#_ASM_X86_POSIX_TYPES_32_H


	)

11 
	t__k”Ãl_mode_t
;

12 
	#__k”Ãl_mode_t
 
__k”Ãl_mode_t


	)

14 
	t__k”Ãl_c_pid_t
;

15 
	#__k”Ãl_c_pid_t
 
__k”Ãl_c_pid_t


	)

17 
	t__k”Ãl_uid_t
;

18 
	t__k”Ãl_gid_t
;

19 
	#__k”Ãl_uid_t
 
__k”Ãl_uid_t


	)

21 
	t__k”Ãl_Şd_dev_t
;

22 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

24 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_64.h

2 #iâdeà
_ASM_X86_POSIX_TYPES_64_H


3 
	#_ASM_X86_POSIX_TYPES_64_H


	)

11 
	t__k”Ãl_Şd_uid_t
;

12 
	t__k”Ãl_Şd_gid_t
;

13 
	#__k”Ãl_Şd_uid_t
 
__k”Ãl_Şd_uid_t


	)

15 
	t__k”Ãl_Şd_dev_t
;

16 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

18 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_x32.h

2 #iâdeà
_ASM_X86_POSIX_TYPES_X32_H


3 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

14 
	t__k”Ãl_lÚg_t
;

15 
	t__k”Ãl_ulÚg_t
;

16 
	#__k”Ãl_lÚg_t
 
__k”Ãl_lÚg_t


	)

18 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm/swab.h

2 #iâdeà
_ASM_X86_SWAB_H


3 
	#_ASM_X86_SWAB_H


	)

5 
	~<lšux/ty³s.h
>

8 
__šlše__
 
__u32
 
	$__¬ch_swab32
(
__u32
 
v®
)

10 
	`__asm__
("bsw­È%0" : "ô" (
v®
) : "0" (val));

11  
v®
;

12 
	}
}

13 
	#__¬ch_swab32
 
__¬ch_swab32


	)

15 
__šlše__
 
__u64
 
	$__¬ch_swab64
(
__u64
 
v®
)

17 #ifdeà
__i386__


20 
__u32
 
a
;

21 
__u32
 
b
;

22 } 
s
;

23 
__u64
 
u
;

24 } 
v
;

25 
v
.
u
 = 
v®
;

26 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

27 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

28 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

29  
v
.
u
;

31 
	`__asm__
("bsw­q %0" : "ô" (
v®
) : "0" (val));

32  
v®
;

34 
	}
}

35 
	#__¬ch_swab64
 
__¬ch_swab64


	)

	@/usr/include/bits/local_lim.h

24 #iâdeà
NR_OPEN


25 
	#__undef_NR_OPEN


	)

27 #iâdeà
LINK_MAX


28 
	#__undef_LINK_MAX


	)

30 #iâdeà
OPEN_MAX


31 
	#__undef_OPEN_MAX


	)

33 #iâdeà
ARG_MAX


34 
	#__undef_ARG_MAX


	)

38 
	~<lšux/lim™s.h
>

41 #ifdeà
__undef_NR_OPEN


42 #undeà
NR_OPEN


43 #undeà
__undef_NR_OPEN


46 #ifdeà
__undef_LINK_MAX


47 #undeà
LINK_MAX


48 #undeà
__undef_LINK_MAX


51 #ifdeà
__undef_OPEN_MAX


52 #undeà
OPEN_MAX


53 #undeà
__undef_OPEN_MAX


56 #ifdeà
__undef_ARG_MAX


57 #undeà
ARG_MAX


58 #undeà
__undef_ARG_MAX


62 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

64 
	#PTHREAD_KEYS_MAX
 1024

	)

67 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

69 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

72 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

74 #undeà
PTHREAD_THREADS_MAX


78 
	#AIO_PRIO_DELTA_MAX
 20

	)

81 
	#PTHREAD_STACK_MIN
 16384

	)

84 
	#DELAYTIMER_MAX
 2147483647

	)

87 
	#TTY_NAME_MAX
 32

	)

90 
	#LOGIN_NAME_MAX
 256

	)

93 
	#HOST_NAME_MAX
 64

	)

96 
	#MQ_PRIO_MAX
 32768

	)

99 
	#SEM_VALUE_MAX
 (2147483647)

	)

	@/usr/include/bits/socket.h

19 #iâdeà
__BITS_SOCKET_H


20 
	#__BITS_SOCKET_H


	)

22 #iâdeà
_SYS_SOCKET_H


26 
	#__Ãed_size_t


	)

27 
	~<¡ddef.h
>

29 
	~<sys/ty³s.h
>

32 #iâdeà
__sockËn_t_defšed


33 
__sockËn_t
 
	tsockËn_t
;

34 
	#__sockËn_t_defšed


	)

38 
	~<b™s/sock‘_ty³.h
>

41 
	#PF_UNSPEC
 0

	)

42 
	#PF_LOCAL
 1

	)

43 
	#PF_UNIX
 
PF_LOCAL


	)

44 
	#PF_FILE
 
PF_LOCAL


	)

45 
	#PF_INET
 2

	)

46 
	#PF_AX25
 3

	)

47 
	#PF_IPX
 4

	)

48 
	#PF_APPLETALK
 5

	)

49 
	#PF_NETROM
 6

	)

50 
	#PF_BRIDGE
 7

	)

51 
	#PF_ATMPVC
 8

	)

52 
	#PF_X25
 9

	)

53 
	#PF_INET6
 10

	)

54 
	#PF_ROSE
 11

	)

55 
	#PF_DECÃt
 12

	)

56 
	#PF_NETBEUI
 13

	)

57 
	#PF_SECURITY
 14

	)

58 
	#PF_KEY
 15

	)

59 
	#PF_NETLINK
 16

	)

60 
	#PF_ROUTE
 
PF_NETLINK


	)

61 
	#PF_PACKET
 17

	)

62 
	#PF_ASH
 18

	)

63 
	#PF_ECONET
 19

	)

64 
	#PF_ATMSVC
 20

	)

65 
	#PF_RDS
 21

	)

66 
	#PF_SNA
 22

	)

67 
	#PF_IRDA
 23

	)

68 
	#PF_PPPOX
 24

	)

69 
	#PF_WANPIPE
 25

	)

70 
	#PF_LLC
 26

	)

71 
	#PF_IB
 27

	)

72 
	#PF_MPLS
 28

	)

73 
	#PF_CAN
 29

	)

74 
	#PF_TIPC
 30

	)

75 
	#PF_BLUETOOTH
 31

	)

76 
	#PF_IUCV
 32

	)

77 
	#PF_RXRPC
 33

	)

78 
	#PF_ISDN
 34

	)

79 
	#PF_PHONET
 35

	)

80 
	#PF_IEEE802154
 36

	)

81 
	#PF_CAIF
 37

	)

82 
	#PF_ALG
 38

	)

83 
	#PF_NFC
 39

	)

84 
	#PF_VSOCK
 40

	)

85 
	#PF_KCM
 41

	)

86 
	#PF_QIPCRTR
 42

	)

87 
	#PF_SMC
 43

	)

88 
	#PF_XDP
 44

	)

89 
	#PF_MAX
 45

	)

92 
	#AF_UNSPEC
 
PF_UNSPEC


	)

93 
	#AF_LOCAL
 
PF_LOCAL


	)

94 
	#AF_UNIX
 
PF_UNIX


	)

95 
	#AF_FILE
 
PF_FILE


	)

96 
	#AF_INET
 
PF_INET


	)

97 
	#AF_AX25
 
PF_AX25


	)

98 
	#AF_IPX
 
PF_IPX


	)

99 
	#AF_APPLETALK
 
PF_APPLETALK


	)

100 
	#AF_NETROM
 
PF_NETROM


	)

101 
	#AF_BRIDGE
 
PF_BRIDGE


	)

102 
	#AF_ATMPVC
 
PF_ATMPVC


	)

103 
	#AF_X25
 
PF_X25


	)

104 
	#AF_INET6
 
PF_INET6


	)

105 
	#AF_ROSE
 
PF_ROSE


	)

106 
	#AF_DECÃt
 
PF_DECÃt


	)

107 
	#AF_NETBEUI
 
PF_NETBEUI


	)

108 
	#AF_SECURITY
 
PF_SECURITY


	)

109 
	#AF_KEY
 
PF_KEY


	)

110 
	#AF_NETLINK
 
PF_NETLINK


	)

111 
	#AF_ROUTE
 
PF_ROUTE


	)

112 
	#AF_PACKET
 
PF_PACKET


	)

113 
	#AF_ASH
 
PF_ASH


	)

114 
	#AF_ECONET
 
PF_ECONET


	)

115 
	#AF_ATMSVC
 
PF_ATMSVC


	)

116 
	#AF_RDS
 
PF_RDS


	)

117 
	#AF_SNA
 
PF_SNA


	)

118 
	#AF_IRDA
 
PF_IRDA


	)

119 
	#AF_PPPOX
 
PF_PPPOX


	)

120 
	#AF_WANPIPE
 
PF_WANPIPE


	)

121 
	#AF_LLC
 
PF_LLC


	)

122 
	#AF_IB
 
PF_IB


	)

123 
	#AF_MPLS
 
PF_MPLS


	)

124 
	#AF_CAN
 
PF_CAN


	)

125 
	#AF_TIPC
 
PF_TIPC


	)

126 
	#AF_BLUETOOTH
 
PF_BLUETOOTH


	)

127 
	#AF_IUCV
 
PF_IUCV


	)

128 
	#AF_RXRPC
 
PF_RXRPC


	)

129 
	#AF_ISDN
 
PF_ISDN


	)

130 
	#AF_PHONET
 
PF_PHONET


	)

131 
	#AF_IEEE802154
 
PF_IEEE802154


	)

132 
	#AF_CAIF
 
PF_CAIF


	)

133 
	#AF_ALG
 
PF_ALG


	)

134 
	#AF_NFC
 
PF_NFC


	)

135 
	#AF_VSOCK
 
PF_VSOCK


	)

136 
	#AF_KCM
 
PF_KCM


	)

137 
	#AF_QIPCRTR
 
PF_QIPCRTR


	)

138 
	#AF_SMC
 
PF_SMC


	)

139 
	#AF_XDP
 
PF_XDP


	)

140 
	#AF_MAX
 
PF_MAX


	)

146 
	#SOL_RAW
 255

	)

147 
	#SOL_DECNET
 261

	)

148 
	#SOL_X25
 262

	)

149 
	#SOL_PACKET
 263

	)

150 
	#SOL_ATM
 264

	)

151 
	#SOL_AAL
 265

	)

152 
	#SOL_IRDA
 266

	)

153 
	#SOL_NETBEUI
 267

	)

154 
	#SOL_LLC
 268

	)

155 
	#SOL_DCCP
 269

	)

156 
	#SOL_NETLINK
 270

	)

157 
	#SOL_TIPC
 271

	)

158 
	#SOL_RXRPC
 272

	)

159 
	#SOL_PPPOL2TP
 273

	)

160 
	#SOL_BLUETOOTH
 274

	)

161 
	#SOL_PNPIPE
 275

	)

162 
	#SOL_RDS
 276

	)

163 
	#SOL_IUCV
 277

	)

164 
	#SOL_CAIF
 278

	)

165 
	#SOL_ALG
 279

	)

166 
	#SOL_NFC
 280

	)

167 
	#SOL_KCM
 281

	)

168 
	#SOL_TLS
 282

	)

169 
	#SOL_XDP
 283

	)

172 
	#SOMAXCONN
 4096

	)

175 
	~<b™s/sockaddr.h
>

178 
	ssockaddr


180 
__SOCKADDR_COMMON
 (
§_
);

181 
	m§_d©a
[14];

187 
	#__ss_®igÁy³
 

	)

188 
	#_SS_PADSIZE
 \

189 (
_SS_SIZE
 - 
__SOCKADDR_COMMON_SIZE
 -  (
__ss_®igÁy³
))

	)

191 
	ssockaddr_¡Üage


193 
__SOCKADDR_COMMON
 (
ss_
);

194 
	m__ss_·ddšg
[
_SS_PADSIZE
];

195 
__ss_®igÁy³
 
	m__ss_®ign
;

202 
	mMSG_OOB
 = 0x01,

203 
	#MSG_OOB
 
MSG_OOB


	)

204 
	mMSG_PEEK
 = 0x02,

205 
	#MSG_PEEK
 
MSG_PEEK


	)

206 
	mMSG_DONTROUTE
 = 0x04,

207 
	#MSG_DONTROUTE
 
MSG_DONTROUTE


	)

208 #ifdeà
__USE_GNU


210 
	mMSG_TRYHARD
 = 
MSG_DONTROUTE
,

211 
	#MSG_TRYHARD
 
MSG_DONTROUTE


	)

213 
	mMSG_CTRUNC
 = 0x08,

214 
	#MSG_CTRUNC
 
MSG_CTRUNC


	)

215 
	mMSG_PROXY
 = 0x10,

216 
	#MSG_PROXY
 
MSG_PROXY


	)

217 
	mMSG_TRUNC
 = 0x20,

218 
	#MSG_TRUNC
 
MSG_TRUNC


	)

219 
	mMSG_DONTWAIT
 = 0x40,

220 
	#MSG_DONTWAIT
 
MSG_DONTWAIT


	)

221 
	mMSG_EOR
 = 0x80,

222 
	#MSG_EOR
 
MSG_EOR


	)

223 
	mMSG_WAITALL
 = 0x100,

224 
	#MSG_WAITALL
 
MSG_WAITALL


	)

225 
	mMSG_FIN
 = 0x200,

226 
	#MSG_FIN
 
MSG_FIN


	)

227 
	mMSG_SYN
 = 0x400,

228 
	#MSG_SYN
 
MSG_SYN


	)

229 
	mMSG_CONFIRM
 = 0x800,

230 
	#MSG_CONFIRM
 
MSG_CONFIRM


	)

231 
	mMSG_RST
 = 0x1000,

232 
	#MSG_RST
 
MSG_RST


	)

233 
	mMSG_ERRQUEUE
 = 0x2000,

234 
	#MSG_ERRQUEUE
 
MSG_ERRQUEUE


	)

235 
	mMSG_NOSIGNAL
 = 0x4000,

236 
	#MSG_NOSIGNAL
 
MSG_NOSIGNAL


	)

237 
	mMSG_MORE
 = 0x8000,

238 
	#MSG_MORE
 
MSG_MORE


	)

239 
	mMSG_WAITFORONE
 = 0x10000,

240 
	#MSG_WAITFORONE
 
MSG_WAITFORONE


	)

241 
	mMSG_BATCH
 = 0x40000,

242 
	#MSG_BATCH
 
MSG_BATCH


	)

243 
	mMSG_ZEROCOPY
 = 0x4000000,

244 
	#MSG_ZEROCOPY
 
MSG_ZEROCOPY


	)

245 
	mMSG_FASTOPEN
 = 0x20000000,

246 
	#MSG_FASTOPEN
 
MSG_FASTOPEN


	)

248 
	mMSG_CMSG_CLOEXEC
 = 0x40000000

251 
	#MSG_CMSG_CLOEXEC
 
MSG_CMSG_CLOEXEC


	)

257 
	smsghdr


259 *
	mmsg_Çme
;

260 
sockËn_t
 
	mmsg_Çm–’
;

262 
iovec
 *
	mmsg_iov
;

263 
size_t
 
	mmsg_iovËn
;

265 *
	mmsg_cÚŒŞ
;

266 
size_t
 
	mmsg_cÚŒŞËn
;

271 
	mmsg_æags
;

275 
	scmsghdr


277 
size_t
 
	mcmsg_Ën
;

282 
	mcmsg_Ëv–
;

283 
	mcmsg_ty³
;

284 #ià
__glibc_c99_æex¬r_avaabË


285 
__ex‹nsiÚ__
 
__cmsg_d©a
 
	m__æex¬r
;

290 #ià
__glibc_c99_æex¬r_avaabË


291 
	#CMSG_DATA
(
cmsg
è((cmsg)->
__cmsg_d©a
)

	)

293 
	#CMSG_DATA
(
cmsg
è((*è((
cmsghdr
 *è(cmsgè+ 1))

	)

295 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`__cmsg_nxthdr
 (mhdr, cmsg)

	)

296 
	#CMSG_FIRSTHDR
(
mhdr
) \

297 ((
size_t
è(
mhdr
)->
msg_cÚŒŞËn
 >ğ (
cmsghdr
) \

298 ? (
cmsghdr
 *è(
mhdr
)->
msg_cÚŒŞ
 : (cmsghd¸*è0)

	)

299 
	#CMSG_ALIGN
(
Ën
è((Ö’è+  (
size_t
) - 1) \

300 & (
size_t
è~( (size_tè- 1))

	)

301 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
 (len) \

302 + 
	`CMSG_ALIGN
 ( (
cmsghdr
)))

	)

303 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
 ( (
cmsghdr
)è+ (Ën))

	)

305 
cmsghdr
 *
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
,

306 
cmsghdr
 *
__cmsg
è
__THROW
;

307 #ifdeà
__USE_EXTERN_INLINES


308 #iâdeà
_EXTERN_INLINE


309 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

311 
_EXTERN_INLINE
 
cmsghdr
 *

312 
	`__NTH
 (
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
, 
cmsghdr
 *
__cmsg
))

314 ià((
size_t
è
__cmsg
->
cmsg_Ën
 <  (
cmsghdr
))

316  (
cmsghdr
 *) 0;

318 
__cmsg
 = (
cmsghdr
 *) ((*) __cmsg

319 + 
	`CMSG_ALIGN
 (
__cmsg
->
cmsg_Ën
));

320 ià((*è(
__cmsg
 + 1è> ((*è
__mhdr
->
msg_cÚŒŞ


321 + 
__mhdr
->
msg_cÚŒŞËn
)

322 || ((*è
__cmsg
 + 
	`CMSG_ALIGN
 (__cmsg->
cmsg_Ën
)

323 > ((*è
__mhdr
->
msg_cÚŒŞ
 + __mhdr->
msg_cÚŒŞËn
)))

325  (
cmsghdr
 *) 0;

326  
__cmsg
;

327 
	}
}

334 
	mSCM_RIGHTS
 = 0x01

335 
	#SCM_RIGHTS
 
SCM_RIGHTS


	)

336 #ifdeà
__USE_GNU


337 , 
	mSCM_CREDENTIALS
 = 0x02

338 
	#SCM_CREDENTIALS
 
SCM_CREDENTIALS


	)

342 #ifdeà
__USE_GNU


344 
	suüed


346 
pid_t
 
	mpid
;

347 
uid_t
 
	muid
;

348 
gid_t
 
	mgid
;

352 #ifdeà
__USE_MISC


353 
	~<b™s/ty³s/time_t.h
>

354 
	~<asm/sock‘.h
>

356 
	#SO_DEBUG
 1

	)

357 
	~<b™s/sock‘-cÚ¡ªts.h
>

361 
	slšg”


363 
	ml_Úoff
;

364 
	ml_lšg”
;

	@/usr/include/bits/socket2.h

19 #iâdeà
_SYS_SOCKET_H


23 
ssize_t
 
__»cv_chk
 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

24 
__æags
);

25 
ssize_t
 
__REDIRECT
 (
__»cv_®Ÿs
, (
__fd
, *
__buf
, 
size_t
 
__n
,

26 
__æags
), 
»cv
);

27 
ssize_t
 
__REDIRECT
 (
__»cv_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

29 
__æags
), 
__»cv_chk
)

30 
__w¬Ç‰r
 ("recv called with bigger†engthhan size of destination "

33 
__fÜtify_funùiÚ
 
ssize_t


34 
	$»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

39  
	`__»cv_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

41 ià(
__n
 > 
	`__bos0
 (
__buf
))

42  
	`__»cv_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

44  
	`__»cv_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
);

45 
	}
}

47 
ssize_t
 
__»cväom_chk
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

48 
size_t
 
__buæ’
, 
__æags
,

49 
__SOCKADDR_ARG
 
__addr
,

50 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

51 
ssize_t
 
__REDIRECT
 (
__»cväom_®Ÿs
,

52 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

53 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

54 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
»cväom
);

55 
ssize_t
 
__REDIRECT
 (
__»cväom_chk_w¬n
,

56 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

57 
size_t
 
__buæ’
, 
__æags
,

58 
__SOCKADDR_ARG
 
__addr
,

59 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
__»cväom_chk
)

60 
__w¬Ç‰r
 ("recvfrom called with bigger†engthhan size of "

63 
__fÜtify_funùiÚ
 
ssize_t


64 
	$»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
, 
__æags
,

65 
__SOCKADDR_ARG
 
__addr
, 
sockËn_t
 *
__»¡riù
 
__addr_Ën
)

67 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

70  
	`__»cväom_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

71 
__addr
, 
__addr_Ën
);

72 ià(
__n
 > 
	`__bos0
 (
__buf
))

73  
	`__»cväom_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

74 
__addr
, 
__addr_Ën
);

76  
	`__»cväom_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
, 
__addr
, 
__addr_Ën
);

77 
	}
}

	@/usr/include/bits/types/struct_iovec.h

19 #iâdeà
__iovec_defšed


20 
	#__iovec_defšed
 1

	)

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

26 
	siovec


28 *
	miov_ba£
;

29 
size_t
 
	miov_Ën
;

	@/usr/include/bits/types/struct_osockaddr.h

1 #iâdeà
__osockaddr_defšed


2 
	#__osockaddr_defšed
 1

	)

6 
	sosockaddr


8 
	m§_çmy
;

9 
	m§_d©a
[14];

	@/usr/include/bits/uio_lim.h

19 #iâdeà
_BITS_UIO_LIM_H


20 
	#_BITS_UIO_LIM_H
 1

	)

30 
	#__IOV_MAX
 1024

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

120 #undeà
__USE_ISOC11


121 #undeà
__USE_ISOC99


122 #undeà
__USE_ISOC95


123 #undeà
__USE_ISOCXX11


124 #undeà
__USE_POSIX


125 #undeà
__USE_POSIX2


126 #undeà
__USE_POSIX199309


127 #undeà
__USE_POSIX199506


128 #undeà
__USE_XOPEN


129 #undeà
__USE_XOPEN_EXTENDED


130 #undeà
__USE_UNIX98


131 #undeà
__USE_XOPEN2K


132 #undeà
__USE_XOPEN2KXSI


133 #undeà
__USE_XOPEN2K8


134 #undeà
__USE_XOPEN2K8XSI


135 #undeà
__USE_LARGEFILE


136 #undeà
__USE_LARGEFILE64


137 #undeà
__USE_FILE_OFFSET64


138 #undeà
__USE_MISC


139 #undeà
__USE_ATFILE


140 #undeà
__USE_GNU


141 #undeà
__USE_FORTIFY_LEVEL


142 #undeà
__KERNEL_STRICT_NAMES


143 #undeà
__GLIBC_USE_ISOC2X


144 #undeà
__GLIBC_USE_DEPRECATED_GETS


145 #undeà
__GLIBC_USE_DEPRECATED_SCANF


149 #iâdeà
_LOOSE_KERNEL_NAMES


150 
	#__KERNEL_STRICT_NAMES


	)

160 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


161 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

162 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

164 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

171 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

173 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

175 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

179 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

185 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

186 && !
defšed
 
	g_DEFAULT_SOURCE


188 #undeà
_DEFAULT_SOURCE


189 
	#_DEFAULT_SOURCE
 1

	)

193 #ifdeà
_GNU_SOURCE


194 #undeà
_ISOC95_SOURCE


195 
	#_ISOC95_SOURCE
 1

	)

196 #undeà
_ISOC99_SOURCE


197 
	#_ISOC99_SOURCE
 1

	)

198 #undeà
_ISOC11_SOURCE


199 
	#_ISOC11_SOURCE
 1

	)

200 #undeà
_ISOC2X_SOURCE


201 
	#_ISOC2X_SOURCE
 1

	)

202 #undeà
_POSIX_SOURCE


203 
	#_POSIX_SOURCE
 1

	)

204 #undeà
_POSIX_C_SOURCE


205 
	#_POSIX_C_SOURCE
 200809L

	)

206 #undeà
_XOPEN_SOURCE


207 
	#_XOPEN_SOURCE
 700

	)

208 #undeà
_XOPEN_SOURCE_EXTENDED


209 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

210 #undeà
_LARGEFILE64_SOURCE


211 
	#_LARGEFILE64_SOURCE
 1

	)

212 #undeà
_DEFAULT_SOURCE


213 
	#_DEFAULT_SOURCE
 1

	)

214 #undeà
_ATFILE_SOURCE


215 
	#_ATFILE_SOURCE
 1

	)

220 #ià(
defšed
 
_DEFAULT_SOURCE
 \

221 || (!
defšed
 
	g__STRICT_ANSI__
 \

222 && !
defšed
 
	g_ISOC99_SOURCE
 && !defšed 
	g_ISOC11_SOURCE
 \

223 && !
defšed
 
	g_ISOC2X_SOURCE
 \

224 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

225 && !
defšed
 
	g_XOPEN_SOURCE
))

226 #undeà
_DEFAULT_SOURCE


227 
	#_DEFAULT_SOURCE
 1

	)

231 #ià(
defšed
 
_ISOC2X_SOURCE
 \

232 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ > 201710L))

233 
	#__GLIBC_USE_ISOC2X
 1

	)

235 
	#__GLIBC_USE_ISOC2X
 0

	)

239 #ià(
defšed
 
_ISOC11_SOURCE
 || defšed 
_ISOC2X_SOURCE
 \

240 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

241 
	#__USE_ISOC11
 1

	)

245 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

246 || 
defšed
 
_ISOC2X_SOURCE
 \

247 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

248 
	#__USE_ISOC99
 1

	)

252 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

253 || 
defšed
 
_ISOC2X_SOURCE
 \

254 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

255 
	#__USE_ISOC95
 1

	)

258 #ifdeà
__ılu¥lus


260 #ià
__ılu¥lus
 >= 201703L

261 
	#__USE_ISOC11
 1

	)

265 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


266 
	#__USE_ISOCXX11
 1

	)

267 
	#__USE_ISOC99
 1

	)

274 #ifdeà
_DEFAULT_SOURCE


275 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


276 
	#__USE_POSIX_IMPLICITLY
 1

	)

278 #undeà
_POSIX_SOURCE


279 
	#_POSIX_SOURCE
 1

	)

280 #undeà
_POSIX_C_SOURCE


281 
	#_POSIX_C_SOURCE
 200809L

	)

284 #ià((!
defšed
 
__STRICT_ANSI__
 \

285 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

286 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

287 
	#_POSIX_SOURCE
 1

	)

288 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

289 
	#_POSIX_C_SOURCE
 2

	)

290 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

291 
	#_POSIX_C_SOURCE
 199506L

	)

292 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

293 
	#_POSIX_C_SOURCE
 200112L

	)

295 
	#_POSIX_C_SOURCE
 200809L

	)

297 
	#__USE_POSIX_IMPLICITLY
 1

	)

306 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

307 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

308 
	#_POSIX_SOURCE
 1

	)

309 #undeà
_POSIX_C_SOURCE


310 
	#_POSIX_C_SOURCE
 199506L

	)

313 #ià(
defšed
 
_POSIX_SOURCE
 \

314 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

315 || 
defšed
 
_XOPEN_SOURCE
)

316 
	#__USE_POSIX
 1

	)

319 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


320 
	#__USE_POSIX2
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

324 
	#__USE_POSIX199309
 1

	)

327 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

328 
	#__USE_POSIX199506
 1

	)

331 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

332 
	#__USE_XOPEN2K
 1

	)

333 #undeà
__USE_ISOC95


334 
	#__USE_ISOC95
 1

	)

335 #undeà
__USE_ISOC99


336 
	#__USE_ISOC99
 1

	)

339 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

340 
	#__USE_XOPEN2K8
 1

	)

341 #undeà
_ATFILE_SOURCE


342 
	#_ATFILE_SOURCE
 1

	)

345 #ifdef 
_XOPEN_SOURCE


346 
	#__USE_XOPEN
 1

	)

347 #ià(
_XOPEN_SOURCE
 - 0) >= 500

348 
	#__USE_XOPEN_EXTENDED
 1

	)

349 
	#__USE_UNIX98
 1

	)

350 #undeà
_LARGEFILE_SOURCE


351 
	#_LARGEFILE_SOURCE
 1

	)

352 #ià(
_XOPEN_SOURCE
 - 0) >= 600

353 #ià(
_XOPEN_SOURCE
 - 0) >= 700

354 
	#__USE_XOPEN2K8
 1

	)

355 
	#__USE_XOPEN2K8XSI
 1

	)

357 
	#__USE_XOPEN2K
 1

	)

358 
	#__USE_XOPEN2KXSI
 1

	)

359 #undeà
__USE_ISOC95


360 
	#__USE_ISOC95
 1

	)

361 #undeà
__USE_ISOC99


362 
	#__USE_ISOC99
 1

	)

365 #ifdeà
_XOPEN_SOURCE_EXTENDED


366 
	#__USE_XOPEN_EXTENDED
 1

	)

371 #ifdeà
_LARGEFILE_SOURCE


372 
	#__USE_LARGEFILE
 1

	)

375 #ifdeà
_LARGEFILE64_SOURCE


376 
	#__USE_LARGEFILE64
 1

	)

379 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

380 
	#__USE_FILE_OFFSET64
 1

	)

383 #ià
defšed
 
_DEFAULT_SOURCE


384 
	#__USE_MISC
 1

	)

387 #ifdef 
_ATFILE_SOURCE


388 
	#__USE_ATFILE
 1

	)

391 #ifdef 
_GNU_SOURCE


392 
	#__USE_GNU
 1

	)

395 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

396 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

397 #ià
_FORTIFY_SOURCE
 > 1

398 
	#__USE_FORTIFY_LEVEL
 2

	)

400 
	#__USE_FORTIFY_LEVEL
 1

	)

403 
	#__USE_FORTIFY_LEVEL
 0

	)

410 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


411 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

413 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

428 #ià(
defšed
 
__USE_GNU
 \

429 && (
defšed
 
	g__ılu¥lus
 \

430 ? (
	g__ılu¥lus
 < 201103L && !
defšed
 
	g__GXX_EXPERIMENTAL_CXX0X__
) \

431 : (!
defšed
 
__STDC_VERSION__
 || __STDC_VERSION__ < 199901L)))

432 
	#__GLIBC_USE_DEPRECATED_SCANF
 1

	)

434 
	#__GLIBC_USE_DEPRECATED_SCANF
 0

	)

439 
	~<¡dc-´edef.h
>

447 #undeà
__GNU_LIBRARY__


448 
	#__GNU_LIBRARY__
 6

	)

452 
	#__GLIBC__
 2

	)

453 
	#__GLIBC_MINOR__
 31

	)

455 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

456 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

459 #iâdeà
__ASSEMBLER__


460 #iâdeà
_SYS_CDEFS_H


461 
	~<sys/cdefs.h
>

466 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


467 
	#__USE_LARGEFILE
 1

	)

468 
	#__USE_LARGEFILE64
 1

	)

474 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

475 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

476 && 
defšed
 
	g__ex‹º_šlše


477 
	#__USE_EXTERN_INLINES
 1

	)

485 
	~<gnu/¡ubs.h
>

	@/usr/include/asm-generic/bitsperlong.h

2 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


3 
	#__ASM_GENERIC_BITS_PER_LONG


	)

12 #iâdeà
__BITS_PER_LONG


13 
	#__BITS_PER_LONG
 32

	)

	@/usr/include/asm-generic/posix_types.h

2 #iâdeà
__ASM_GENERIC_POSIX_TYPES_H


3 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

5 
	~<asm/b™¥”lÚg.h
>

14 #iâdeà
__k”Ãl_lÚg_t


15 
	t__k”Ãl_lÚg_t
;

16 
	t__k”Ãl_ulÚg_t
;

19 #iâdeà
__k”Ãl_šo_t


20 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_šo_t
;

23 #iâdeà
__k”Ãl_mode_t


24 
	t__k”Ãl_mode_t
;

27 #iâdeà
__k”Ãl_pid_t


28 
	t__k”Ãl_pid_t
;

31 #iâdeà
__k”Ãl_c_pid_t


32 
	t__k”Ãl_c_pid_t
;

35 #iâdeà
__k”Ãl_uid_t


36 
	t__k”Ãl_uid_t
;

37 
	t__k”Ãl_gid_t
;

40 #iâdeà
__k”Ãl_su£cÚds_t


41 
__k”Ãl_lÚg_t
 
	t__k”Ãl_su£cÚds_t
;

44 #iâdeà
__k”Ãl_daddr_t


45 
	t__k”Ãl_daddr_t
;

48 #iâdeà
__k”Ãl_uid32_t


49 
	t__k”Ãl_uid32_t
;

50 
	t__k”Ãl_gid32_t
;

53 #iâdeà
__k”Ãl_Şd_uid_t


54 
__k”Ãl_uid_t
 
	t__k”Ãl_Şd_uid_t
;

55 
__k”Ãl_gid_t
 
	t__k”Ãl_Şd_gid_t
;

58 #iâdeà
__k”Ãl_Şd_dev_t


59 
	t__k”Ãl_Şd_dev_t
;

66 #iâdeà
__k”Ãl_size_t


67 #ià
__BITS_PER_LONG
 != 64

68 
	t__k”Ãl_size_t
;

69 
	t__k”Ãl_ssize_t
;

70 
	t__k”Ãl_±rdiff_t
;

72 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_size_t
;

73 
__k”Ãl_lÚg_t
 
	t__k”Ãl_ssize_t
;

74 
__k”Ãl_lÚg_t
 
	t__k”Ãl_±rdiff_t
;

78 #iâdeà
__k”Ãl_fsid_t


80 
	mv®
[2];

81 } 
	t__k”Ãl_fsid_t
;

87 
__k”Ãl_lÚg_t
 
	t__k”Ãl_off_t
;

88 
	t__k”Ãl_loff_t
;

89 
__k”Ãl_lÚg_t
 
	t__k”Ãl_time_t
;

90 
	t__k”Ãl_time64_t
;

91 
__k”Ãl_lÚg_t
 
	t__k”Ãl_şock_t
;

92 
	t__k”Ãl_tim”_t
;

93 
	t__k”Ãl_şockid_t
;

94 * 
	t__k”Ãl_ÿddr_t
;

95 
	t__k”Ãl_uid16_t
;

96 
	t__k”Ãl_gid16_t
;

	@/usr/include/asm/socket.h

1 
	~<asm-g’”ic/sock‘.h
>

	@/usr/include/bits/sockaddr.h

23 #iâdeà
_BITS_SOCKADDR_H


24 
	#_BITS_SOCKADDR_H
 1

	)

28 
	t§_çmy_t
;

34 
	#__SOCKADDR_COMMON
(
§_´efix
) \

35 
§_çmy_t
 
§_´efix
##
çmy


	)

37 
	#__SOCKADDR_COMMON_SIZE
 ( ())

	)

40 
	#_SS_SIZE
 128

	)

	@/usr/include/bits/socket-constants.h

19 #iâdeà
_SYS_SOCKET_H


23 
	#SOL_SOCKET
 1

	)

24 
	#SO_ACCEPTCONN
 30

	)

25 
	#SO_BROADCAST
 6

	)

26 
	#SO_DONTROUTE
 5

	)

27 
	#SO_ERROR
 4

	)

28 
	#SO_KEEPALIVE
 9

	)

29 
	#SO_LINGER
 13

	)

30 
	#SO_OOBINLINE
 10

	)

31 
	#SO_RCVBUF
 8

	)

32 
	#SO_RCVLOWAT
 18

	)

33 
	#SO_RCVTIMEO
 20

	)

34 
	#SO_REUSEADDR
 2

	)

35 
	#SO_SNDBUF
 7

	)

36 
	#SO_SNDLOWAT
 19

	)

37 
	#SO_SNDTIMEO
 21

	)

38 
	#SO_TYPE
 3

	)

	@/usr/include/bits/socket_type.h

19 #iâdeà
_SYS_SOCKET_H


24 
	e__sock‘_ty³


26 
	mSOCK_STREAM
 = 1,

28 
	#SOCK_STREAM
 
SOCK_STREAM


	)

29 
	mSOCK_DGRAM
 = 2,

31 
	#SOCK_DGRAM
 
SOCK_DGRAM


	)

32 
	mSOCK_RAW
 = 3,

33 
	#SOCK_RAW
 
SOCK_RAW


	)

34 
	mSOCK_RDM
 = 4,

35 
	#SOCK_RDM
 
SOCK_RDM


	)

36 
	mSOCK_SEQPACKET
 = 5,

38 
	#SOCK_SEQPACKET
 
SOCK_SEQPACKET


	)

39 
	mSOCK_DCCP
 = 6,

40 
	#SOCK_DCCP
 
SOCK_DCCP


	)

41 
	mSOCK_PACKET
 = 10,

44 
	#SOCK_PACKET
 
SOCK_PACKET


	)

49 
	mSOCK_CLOEXEC
 = 02000000,

51 
	#SOCK_CLOEXEC
 
SOCK_CLOEXEC


	)

52 
	mSOCK_NONBLOCK
 = 00004000

54 
	#SOCK_NONBLOCK
 
SOCK_NONBLOCK


	)

	@/usr/include/bits/types/time_t.h

1 #iâdeà
__time_t_defšed


2 
	#__time_t_defšed
 1

	)

4 
	~<b™s/ty³s.h
>

7 
__time_t
 
	ttime_t
;

	@/usr/include/gnu/stubs.h

6 #ià!
defšed
 
__x86_64__


7 
	~<gnu/¡ubs-32.h
>

9 #ià
defšed
 
__x86_64__
 && defšed 
__LP64__


10 
	~<gnu/¡ubs-64.h
>

12 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


13 
	~<gnu/¡ubs-x32.h
>

	@/usr/include/linux/limits.h

2 #iâdeà
_LINUX_LIMITS_H


3 
	#_LINUX_LIMITS_H


	)

5 
	#NR_OPEN
 1024

	)

7 
	#NGROUPS_MAX
 65536

	)

8 
	#ARG_MAX
 131072

	)

9 
	#LINK_MAX
 127

	)

10 
	#MAX_CANON
 255

	)

11 
	#MAX_INPUT
 255

	)

12 
	#NAME_MAX
 255

	)

13 
	#PATH_MAX
 4096

	)

14 
	#PIPE_BUF
 4096

	)

15 
	#XATTR_NAME_MAX
 255

	)

16 
	#XATTR_SIZE_MAX
 65536

	)

17 
	#XATTR_LIST_MAX
 65536

	)

19 
	#RTSIG_MAX
 32

	)

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

	@/usr/include/sys/cdefs.h

18 #iâdef 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #iâdeà
_FEATURES_H


23 
	~<ã©u»s.h
>

29 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


34 #undeà
__P


35 #undeà
__PMT


37 #ifdeà
__GNUC__


41 #ià
__GNUC_PREREQ
 (4, 6è&& !
defšed
 
_LIBC


42 
	#__LEAF
 , 
__Ëaf__


	)

43 
	#__LEAF_ATTR
 
	`__©Œibu‹__
 ((
__Ëaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

57 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
)è
	)
fct

58 
	#__NTHNL
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
)è
	)
fct

60 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

61 
	#__THROW
 
	`throw
 ()

	)

62 
	#__THROWNL
 
	`throw
 ()

	)

63 
	#__NTH
(
fù
è
__LEAF_ATTR
 fù 
	`throw
 ()

	)

64 
	#__NTHNL
(
fù
èfù 
	`throw
 ()

	)

66 
	#__THROW


	)

67 
	#__THROWNL


	)

68 
	#__NTH
(
fù
è
	)
fct

69 
	#__NTHNL
(
fù
è
	)
fct

75 #ià(
defšed
 
__ılu¥lus
 \

76 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

77 
	#__šlše
 
šlše


	)

79 
	#__šlše


	)

82 
	#__THROW


	)

83 
	#__THROWNL


	)

84 
	#__NTH
(
fù
è
	)
fct

91 #ià
defšed
 
__şªg__
 && defšed 
__has_ex‹nsiÚ


92 
	#__glibc_şªg_has_ex‹nsiÚ
(
ext
è
	`__has_ex‹nsiÚ
 (ext)

	)

94 
	#__glibc_şªg_has_ex‹nsiÚ
(
ext
è0

	)

99 
	#__P
(
¬gs
è
	)
args

100 
	#__PMT
(
¬gs
è
	)
args

105 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

106 
	#__STRING
(
x
è#x

	)

109 
	#__±r_t
 *

	)

113 #ifdef 
__ılu¥lus


114 
	#__BEGIN_DECLS
 "C" {

	)

115 
	#__END_DECLS
 }

	)

117 
	#__BEGIN_DECLS


	)

118 
	#__END_DECLS


	)

123 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

124 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

126 #ià
__GNUC_PREREQ
 (4,3)

127 
	#__w¬ndeş
(
Çme
, 
msg
) \

128 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

129 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

130 
	#__”rÜdeş
(
Çme
, 
msg
) \

131 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

133 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

134 
	#__w¬Ç‰r
(
msg
)

	)

135 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

142 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

143 
	#__æex¬r
 []

	)

144 
	#__glibc_c99_æex¬r_avaabË
 1

	)

145 #–ià
__GNUC_PREREQ
 (2,97)

148 
	#__æex¬r
 []

	)

149 
	#__glibc_c99_æex¬r_avaabË
 1

	)

150 #–ià
defšed
 
__GNUC__


153 
	#__æex¬r
 [0]

	)

154 
	#__glibc_c99_æex¬r_avaabË
 1

	)

157 
	#__æex¬r
 [1]

	)

158 
	#__glibc_c99_æex¬r_avaabË
 0

	)

172 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

174 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

175 #ifdeà
__ılu¥lus


176 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

177 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

178 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

179 
Çme
 
´Ùo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

182 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

183 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

184 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROWNL


	)

186 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

187 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

200 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

201 
	#__©Œibu‹__
(
xyz
è

	)

207 #ià
__GNUC_PREREQ
 (2,96)

208 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

210 
	#__©Œibu‹_m®loc__


	)

215 #ià
__GNUC_PREREQ
 (4, 3)

216 
	#__©Œibu‹_®loc_size__
(
·¿ms
) \

217 
	`__©Œibu‹__
 ((
__®loc_size__
 
·¿ms
))

	)

219 
	#__©Œibu‹_®loc_size__
(
·¿ms
è

	)

225 #ià
__GNUC_PREREQ
 (2,96)

226 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

228 
	#__©Œibu‹_pu»__


	)

232 #ià
__GNUC_PREREQ
 (2,5)

233 
	#__©Œibu‹_cÚ¡__
 
	`__©Œibu‹__
 ((
__cÚ¡__
))

	)

235 
	#__©Œibu‹_cÚ¡__


	)

241 #ià
__GNUC_PREREQ
 (3,1)

242 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

243 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

245 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

246 
	#__©Œibu‹_nošlše__


	)

250 #ià
__GNUC_PREREQ
 (3,2)

251 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

253 
	#__©Œibu‹_d•»ÿ‹d__


	)

259 #ià
__GNUC_PREREQ
 (4,5) \

260 || 
	$__glibc_şªg_has_ex‹nsiÚ
 (
__©Œibu‹_d•»ÿ‹d_w™h_mes§ge__
)

261 
	#__©Œibu‹_d•»ÿ‹d_msg__
(
msg
) \

262 
	`__©Œibu‹__
 ((
	`__d•»ÿ‹d__
 (
msg
)))

	)

264 
	#__©Œibu‹_d•»ÿ‹d_msg__
(
msg
è
__©Œibu‹_d•»ÿ‹d__


	)

273 #ià
	`__GNUC_PREREQ
 (2,8)

274 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

276 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

283 #ià
	`__GNUC_PREREQ
 (2,97)

284 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

285 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

287 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

292 #ià
	`__GNUC_PREREQ
 (3,3)

293 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

295 
	#__nÚnuÎ
(
·¿ms
)

	)

300 #ià
	`__GNUC_PREREQ
 (3,4)

301 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

302 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

303 #ià
__USE_FORTIFY_LEVEL
 > 0

304 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

307 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

309 #iâdeà
__wur


310 
	#__wur


	)

314 #ià
	`__GNUC_PREREQ
 (3,2)

318 #undeà
__®ways_šlše


319 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

321 #undeà
__®ways_šlše


322 
	#__®ways_šlše
 
__šlše


	)

327 #ià
	`__GNUC_PREREQ
 (4,3)

328 
	#__©Œibu‹_¬tificŸl__
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

330 
	#__©Œibu‹_¬tificŸl__


	)

342 #ià(!
defšed
 
__ılu¥lus
 || 
	`__GNUC_PREREQ
 (4,3) \

343 || (
defšed
 
__şªg__
 && (defšed 
__GNUC_STDC_INLINE__
 \

344 || 
defšed
 
__GNUC_GNU_INLINE__
)))

345 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


346 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

347 
	#__ex‹º_®ways_šlše
 \

348 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

350 
	#__ex‹º_šlše
 
__šlše


	)

351 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

355 #ifdeà
__ex‹º_®ways_šlše


356 
	#__fÜtify_funùiÚ
 
__ex‹º_®ways_šlše
 
__©Œibu‹_¬tificŸl__


	)

361 #ià
	`__GNUC_PREREQ
 (4,3)

362 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

363 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

370 #ià!
	`__GNUC_PREREQ
 (2,8)

371 
	#__ex‹nsiÚ__


	)

375 #ià!
	`__GNUC_PREREQ
 (2,92)

376 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

377 
	#__»¡riù
 
»¡riù


	)

379 
	#__»¡riù


	)

386 #ià
	`__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


387 
	#__»¡riù_¬r
 
__»¡riù


	)

389 #ifdeà
__GNUC__


390 
	#__»¡riù_¬r


	)

392 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

393 
	#__»¡riù_¬r
 
»¡riù


	)

396 
	#__»¡riù_¬r


	)

401 #ià
__GNUC__
 >= 3

402 
	#__glibc_uÆik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 0)

	)

403 
	#__glibc_lik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 1)

	)

405 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

406 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

409 #ifdeà
__has_©Œibu‹


410 
	#__glibc_has_©Œibu‹
(
©Œ
è
	`__has_©Œibu‹
 (©Œ)

	)

412 
	#__glibc_has_©Œibu‹
(
©Œ
è0

	)

415 #ià(!
defšed
 
_NÜ‘uº
 \

416 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

417 && !
	$__GNUC_PREREQ
 (4,7))

418 #ià
	`__GNUC_PREREQ
 (2,8)

419 
	#_NÜ‘uº
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

	)

421 
	#_NÜ‘uº


	)

425 #ià
	`__GNUC_PREREQ
 (8, 0)

429 
	#__©Œibu‹_nÚ¡ršg__
 
	`__©Œibu‹__
 ((
__nÚ¡ršg__
))

	)

431 
	#__©Œibu‹_nÚ¡ršg__


	)

435 #undeà
__©Œibu‹_cİy__


436 #ià
	`__GNUC_PREREQ
 (9, 0)

439 
	#__©Œibu‹_cİy__
(
¬g
è
	`__©Œibu‹__
 ((
	`__cİy__
 (¬g)))

	)

441 
	#__©Œibu‹_cİy__
(
¬g
)

	)

444 #ià(!
defšed
 
_Stic_as£¹
 && !defšed 
__ılu¥lus
 \

445 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

446 && (!
	`__GNUC_PREREQ
 (4, 6è|| 
defšed
 
__STRICT_ANSI__
))

447 
	#_Stic_as£¹
(
ex´
, 
dŸgno¡ic
) \

448 (*
	`__Stic_as£¹_funùiÚ
 ()) \

449 [!! (¡ruù { 
__”rÜ_if_Ãg©ive
: (
ex´
è? 2 : -1; })]

	)

452 
	~<b™s/wÜdsize.h
>

453 
	~<b™s/lÚg-doubË.h
>

455 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


456 
	#__LDBL_COMPAT
 1

	)

457 #ifdeà
__REDIRECT


458 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

459 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

460 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

461 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

462 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

463 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

464 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

465 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

466 
	#__LDBL_REDIR_DECL
(
Çme
) \

467 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

468 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

469 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

470 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

471 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

474 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


475 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

476 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

477 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

478 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

479 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

480 #ifdeà
__REDIRECT


481 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

482 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

483 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

492 #ià
	`__GNUC_PREREQ
 (4,8è|| 
	`__glibc_şªg_´”eq
 (3,5)

493 
	#__glibc_maüo_w¬nšg1
(
mes§ge
è
	`_P¿gma
 (#mes§ge)

	)

494 
	#__glibc_maüo_w¬nšg
(
mes§ge
) \

495 
	`__glibc_maüo_w¬nšg1
 (
GCC
 
w¬nšg
 
mes§ge
)

	)

497 
	#__glibc_maüo_w¬nšg
(
msg
)

	)

507 #ià!
defšed
 
__ılu¥lus
 \

508 && (
	`__GNUC_PREREQ
 (4, 9) \

509 || 
	`__glibc_şªg_has_ex‹nsiÚ
 (
c_g’”ic_£ËùiÚs
) \

510 || (!
defšed
 
__GNUC__
 && defšed 
__STDC_VERSION__
 \

511 && 
__STDC_VERSION__
 >= 201112L))

512 
	#__HAVE_GENERIC_SELECTION
 1

	)

514 
	#__HAVE_GENERIC_SELECTION
 0

	)

	@/usr/include/sys/types.h

22 #iâdef 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 #ifdef 
__USE_MISC


32 #iâdeà
__u_ch¬_defšed


33 
__u_ch¬
 
	tu_ch¬
;

34 
__u_shÜt
 
	tu_shÜt
;

35 
__u_št
 
	tu_št
;

36 
__u_lÚg
 
	tu_lÚg
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¬_defšed


	)

42 
__loff_t
 
	tloff_t
;

45 #iâdeà
__šo_t_defšed


46 #iâdeà
__USE_FILE_OFFSET64


47 
__šo_t
 
	tšo_t
;

49 
__šo64_t
 
	tšo_t
;

51 
	#__šo_t_defšed


	)

53 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


54 
__šo64_t
 
	tšo64_t
;

55 
	#__šo64_t_defšed


	)

58 #iâdeà
__dev_t_defšed


59 
__dev_t
 
	tdev_t
;

60 
	#__dev_t_defšed


	)

63 #iâdeà
__gid_t_defšed


64 
__gid_t
 
	tgid_t
;

65 
	#__gid_t_defšed


	)

68 #iâdeà
__mode_t_defšed


69 
__mode_t
 
	tmode_t
;

70 
	#__mode_t_defšed


	)

73 #iâdeà
__Æšk_t_defšed


74 
__Æšk_t
 
	tÆšk_t
;

75 
	#__Æšk_t_defšed


	)

78 #iâdeà
__uid_t_defšed


79 
__uid_t
 
	tuid_t
;

80 
	#__uid_t_defšed


	)

83 #iâdeà
__off_t_defšed


84 #iâdeà
__USE_FILE_OFFSET64


85 
__off_t
 
	toff_t
;

87 
__off64_t
 
	toff_t
;

89 
	#__off_t_defšed


	)

91 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


92 
__off64_t
 
	toff64_t
;

93 
	#__off64_t_defšed


	)

96 #iâdeà
__pid_t_defšed


97 
__pid_t
 
	tpid_t
;

98 
	#__pid_t_defšed


	)

101 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

102 && !
defšed
 
__id_t_defšed


103 
__id_t
 
	tid_t
;

104 
	#__id_t_defšed


	)

107 #iâdeà
__ssize_t_defšed


108 
__ssize_t
 
	tssize_t
;

109 
	#__ssize_t_defšed


	)

112 #ifdef 
__USE_MISC


113 #iâdeà
__daddr_t_defšed


114 
__daddr_t
 
	tdaddr_t
;

115 
__ÿddr_t
 
	tÿddr_t
;

116 
	#__daddr_t_defšed


	)

120 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


121 
__key_t
 
	tkey_t
;

122 
	#__key_t_defšed


	)

125 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


126 
	~<b™s/ty³s/şock_t.h
>

128 
	~<b™s/ty³s/şockid_t.h
>

129 
	~<b™s/ty³s/time_t.h
>

130 
	~<b™s/ty³s/tim”_t.h
>

132 #ifdeà
__USE_XOPEN


133 #iâdeà
__u£cÚds_t_defšed


134 
__u£cÚds_t
 
	tu£cÚds_t
;

135 
	#__u£cÚds_t_defšed


	)

137 #iâdeà
__su£cÚds_t_defšed


138 
__su£cÚds_t
 
	tsu£cÚds_t
;

139 
	#__su£cÚds_t_defšed


	)

143 
	#__Ãed_size_t


	)

144 
	~<¡ddef.h
>

146 #ifdeà
__USE_MISC


148 
	tulÚg
;

149 
	tushÜt
;

150 
	tušt
;

155 
	~<b™s/¡dšt-šŠ.h
>

158 
__ušt8_t
 
	tu_št8_t
;

159 
__ušt16_t
 
	tu_št16_t
;

160 
__ušt32_t
 
	tu_št32_t
;

161 
__ušt64_t
 
	tu_št64_t
;

163 #ià
__GNUC_PREREQ
 (2, 7)

164 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

166 
	t»gi¡”_t
;

171 
	#__BIT_TYPES_DEFINED__
 1

	)

174 #ifdef 
__USE_MISC


176 
	~<’dŸn.h
>

179 
	~<sys/£Ëù.h
>

183 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

184 && !
defšed
 
__blksize_t_defšed


185 
__blksize_t
 
	tblksize_t
;

186 
	#__blksize_t_defšed


	)

190 #iâdeà
__USE_FILE_OFFSET64


191 #iâdeà
__blkút_t_defšed


192 
__blkút_t
 
	tblkút_t
;

193 
	#__blkút_t_defšed


	)

195 #iâdeà
__fsblkút_t_defšed


196 
__fsblkút_t
 
	tfsblkút_t
;

197 
	#__fsblkút_t_defšed


	)

199 #iâdeà
__fsfút_t_defšed


200 
__fsfút_t
 
	tfsfút_t
;

201 
	#__fsfút_t_defšed


	)

204 #iâdeà
__blkút_t_defšed


205 
__blkút64_t
 
	tblkút_t
;

206 
	#__blkút_t_defšed


	)

208 #iâdeà
__fsblkút_t_defšed


209 
__fsblkút64_t
 
	tfsblkút_t
;

210 
	#__fsblkút_t_defšed


	)

212 #iâdeà
__fsfút_t_defšed


213 
__fsfút64_t
 
	tfsfút_t
;

214 
	#__fsfút_t_defšed


	)

218 #ifdeà
__USE_LARGEFILE64


219 
__blkút64_t
 
	tblkút64_t
;

220 
__fsblkút64_t
 
	tfsblkút64_t
;

221 
__fsfút64_t
 
	tfsfút64_t
;

226 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


227 
	~<b™s/±h»adty³s.h
>

230 
	g__END_DECLS


	@/usr/include/asm-generic/socket.h

2 #iâdeà
__ASM_GENERIC_SOCKET_H


3 
	#__ASM_GENERIC_SOCKET_H


	)

5 
	~<lšux/posix_ty³s.h
>

6 
	~<asm/sockios.h
>

9 
	#SOL_SOCKET
 1

	)

11 
	#SO_DEBUG
 1

	)

12 
	#SO_REUSEADDR
 2

	)

13 
	#SO_TYPE
 3

	)

14 
	#SO_ERROR
 4

	)

15 
	#SO_DONTROUTE
 5

	)

16 
	#SO_BROADCAST
 6

	)

17 
	#SO_SNDBUF
 7

	)

18 
	#SO_RCVBUF
 8

	)

19 
	#SO_SNDBUFFORCE
 32

	)

20 
	#SO_RCVBUFFORCE
 33

	)

21 
	#SO_KEEPALIVE
 9

	)

22 
	#SO_OOBINLINE
 10

	)

23 
	#SO_NO_CHECK
 11

	)

24 
	#SO_PRIORITY
 12

	)

25 
	#SO_LINGER
 13

	)

26 
	#SO_BSDCOMPAT
 14

	)

27 
	#SO_REUSEPORT
 15

	)

28 #iâdeà
SO_PASSCRED


29 
	#SO_PASSCRED
 16

	)

30 
	#SO_PEERCRED
 17

	)

31 
	#SO_RCVLOWAT
 18

	)

32 
	#SO_SNDLOWAT
 19

	)

33 
	#SO_RCVTIMEO_OLD
 20

	)

34 
	#SO_SNDTIMEO_OLD
 21

	)

38 
	#SO_SECURITY_AUTHENTICATION
 22

	)

39 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

40 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

42 
	#SO_BINDTODEVICE
 25

	)

45 
	#SO_ATTACH_FILTER
 26

	)

46 
	#SO_DETACH_FILTER
 27

	)

47 
	#SO_GET_FILTER
 
SO_ATTACH_FILTER


	)

49 
	#SO_PEERNAME
 28

	)

51 
	#SO_ACCEPTCONN
 30

	)

53 
	#SO_PEERSEC
 31

	)

54 
	#SO_PASSSEC
 34

	)

56 
	#SO_MARK
 36

	)

58 
	#SO_PROTOCOL
 38

	)

59 
	#SO_DOMAIN
 39

	)

61 
	#SO_RXQ_OVFL
 40

	)

63 
	#SO_WIFI_STATUS
 41

	)

64 
	#SCM_WIFI_STATUS
 
SO_WIFI_STATUS


	)

65 
	#SO_PEEK_OFF
 42

	)

68 
	#SO_NOFCS
 43

	)

70 
	#SO_LOCK_FILTER
 44

	)

72 
	#SO_SELECT_ERR_QUEUE
 45

	)

74 
	#SO_BUSY_POLL
 46

	)

76 
	#SO_MAX_PACING_RATE
 47

	)

78 
	#SO_BPF_EXTENSIONS
 48

	)

80 
	#SO_INCOMING_CPU
 49

	)

82 
	#SO_ATTACH_BPF
 50

	)

83 
	#SO_DETACH_BPF
 
SO_DETACH_FILTER


	)

85 
	#SO_ATTACH_REUSEPORT_CBPF
 51

	)

86 
	#SO_ATTACH_REUSEPORT_EBPF
 52

	)

88 
	#SO_CNX_ADVICE
 53

	)

90 
	#SCM_TIMESTAMPING_OPT_STATS
 54

	)

92 
	#SO_MEMINFO
 55

	)

94 
	#SO_INCOMING_NAPI_ID
 56

	)

96 
	#SO_COOKIE
 57

	)

98 
	#SCM_TIMESTAMPING_PKTINFO
 58

	)

100 
	#SO_PEERGROUPS
 59

	)

102 
	#SO_ZEROCOPY
 60

	)

104 
	#SO_TXTIME
 61

	)

105 
	#SCM_TXTIME
 
SO_TXTIME


	)

107 
	#SO_BINDTOIFINDEX
 62

	)

109 
	#SO_TIMESTAMP_OLD
 29

	)

110 
	#SO_TIMESTAMPNS_OLD
 35

	)

111 
	#SO_TIMESTAMPING_OLD
 37

	)

113 
	#SO_TIMESTAMP_NEW
 63

	)

114 
	#SO_TIMESTAMPNS_NEW
 64

	)

115 
	#SO_TIMESTAMPING_NEW
 65

	)

117 
	#SO_RCVTIMEO_NEW
 66

	)

118 
	#SO_SNDTIMEO_NEW
 67

	)

120 
	#SO_DETACH_REUSEPORT_BPF
 68

	)

123 #ià
__BITS_PER_LONG
 =ğ64 || (
defšed
(
__x86_64__
è&& defšed(
__ILP32__
))

125 
	#SO_TIMESTAMP
 
SO_TIMESTAMP_OLD


	)

126 
	#SO_TIMESTAMPNS
 
SO_TIMESTAMPNS_OLD


	)

127 
	#SO_TIMESTAMPING
 
SO_TIMESTAMPING_OLD


	)

129 
	#SO_RCVTIMEO
 
SO_RCVTIMEO_OLD


	)

130 
	#SO_SNDTIMEO
 
SO_SNDTIMEO_OLD


	)

132 
	#SO_TIMESTAMP
 ((
time_t
è=ğ(
__k”Ãl_lÚg_t
è? 
SO_TIMESTAMP_OLD
 : 
SO_TIMESTAMP_NEW
)

	)

133 
	#SO_TIMESTAMPNS
 ((
time_t
è=ğ(
__k”Ãl_lÚg_t
è? 
SO_TIMESTAMPNS_OLD
 : 
SO_TIMESTAMPNS_NEW
)

	)

134 
	#SO_TIMESTAMPING
 ((
time_t
è=ğ(
__k”Ãl_lÚg_t
è? 
SO_TIMESTAMPING_OLD
 : 
SO_TIMESTAMPING_NEW
)

	)

136 
	#SO_RCVTIMEO
 ((
time_t
è=ğ(
__k”Ãl_lÚg_t
è? 
SO_RCVTIMEO_OLD
 : 
SO_RCVTIMEO_NEW
)

	)

137 
	#SO_SNDTIMEO
 ((
time_t
è=ğ(
__k”Ãl_lÚg_t
è? 
SO_SNDTIMEO_OLD
 : 
SO_SNDTIMEO_NEW
)

	)

140 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

141 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

142 
	#SCM_TIMESTAMPING
 
SO_TIMESTAMPING


	)

	@/usr/include/bits/long-double.h

21 
	#__LONG_DOUBLE_USES_FLOAT128
 0

	)

	@/usr/include/bits/pthreadtypes.h

19 #iâdeà
_BITS_PTHREADTYPES_COMMON_H


20 
	#_BITS_PTHREADTYPES_COMMON_H
 1

	)

23 
	~<b™s/th»ad-sh¬ed-ty³s.h
>

27 
	t±h»ad_t
;

34 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

35 
	m__®ign
;

36 } 
	t±h»ad_mu‹x©Œ_t
;

43 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

44 
	m__®ign
;

45 } 
	t±h»ad_cÚd©Œ_t
;

49 
	t±h»ad_key_t
;

53 
	t__ONCE_ALIGNMENT
 
	t±h»ad_Úû_t
;

56 
	u±h»ad_©Œ_t


58 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

59 
	m__®ign
;

61 #iâdeà
__have_±h»ad_©Œ_t


62 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

63 
	#__have_±h»ad_©Œ_t
 1

	)

69 
__±h»ad_mu‹x_s
 
	m__d©a
;

70 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

71 
	m__®ign
;

72 } 
	t±h»ad_mu‹x_t
;

77 
__±h»ad_cÚd_s
 
	m__d©a
;

78 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

79 
__ex‹nsiÚ__
 
	m__®ign
;

80 } 
	t±h»ad_cÚd_t
;

83 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


88 
__±h»ad_rwlock_¬ch_t
 
	m__d©a
;

89 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

90 
	m__®ign
;

91 } 
	t±h»ad_rwlock_t
;

95 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

96 
	m__®ign
;

97 } 
	t±h»ad_rwlock©Œ_t
;

101 #ifdeà
__USE_XOPEN2K


103 vŞ©
	t±h»ad_¥šlock_t
;

110 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

111 
	m__®ign
;

112 } 
	t±h»ad_b¬r›r_t
;

116 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

117 
	m__®ign
;

118 } 
	t±h»ad_b¬r›¿‰r_t
;

	@/usr/include/bits/stdint-intn.h

19 #iâdeà
_BITS_STDINT_INTN_H


20 
	#_BITS_STDINT_INTN_H
 1

	)

22 
	~<b™s/ty³s.h
>

24 
__št8_t
 
	tšt8_t
;

25 
__št16_t
 
	tšt16_t
;

26 
__št32_t
 
	tšt32_t
;

27 
__št64_t
 
	tšt64_t
;

	@/usr/include/bits/types.h

23 #iâdef 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wÜdsize.h
>

28 
	~<b™s/timesize.h
>

31 
	t__u_ch¬
;

32 
	t__u_shÜt
;

33 
	t__u_št
;

34 
	t__u_lÚg
;

37 sigÃd 
	t__št8_t
;

38 
	t__ušt8_t
;

39 sigÃd 
	t__št16_t
;

40 
	t__ušt16_t
;

41 sigÃd 
	t__št32_t
;

42 
	t__ušt32_t
;

43 #ià
__WORDSIZE
 == 64

44 sigÃd 
	t__št64_t
;

45 
	t__ušt64_t
;

47 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

48 
__ex‹nsiÚ__
 
	t__ušt64_t
;

52 
__št8_t
 
	t__št_Ëa¡8_t
;

53 
__ušt8_t
 
	t__ušt_Ëa¡8_t
;

54 
__št16_t
 
	t__št_Ëa¡16_t
;

55 
__ušt16_t
 
	t__ušt_Ëa¡16_t
;

56 
__št32_t
 
	t__št_Ëa¡32_t
;

57 
__ušt32_t
 
	t__ušt_Ëa¡32_t
;

58 
__št64_t
 
	t__št_Ëa¡64_t
;

59 
__ušt64_t
 
	t__ušt_Ëa¡64_t
;

62 #ià
__WORDSIZE
 == 64

63 
	t__quad_t
;

64 
	t__u_quad_t
;

66 
__ex‹nsiÚ__
 
	t__quad_t
;

67 
__ex‹nsiÚ__
 
	t__u_quad_t
;

71 #ià
__WORDSIZE
 == 64

72 
	t__štmax_t
;

73 
	t__uštmax_t
;

75 
__ex‹nsiÚ__
 
	t__štmax_t
;

76 
__ex‹nsiÚ__
 
	t__uštmax_t
;

109 
	#__S16_TYPE
 

	)

110 
	#__U16_TYPE
 

	)

111 
	#__S32_TYPE
 

	)

112 
	#__U32_TYPE
 

	)

113 
	#__SLONGWORD_TYPE
 

	)

114 
	#__ULONGWORD_TYPE
 

	)

115 #ià
__WORDSIZE
 == 32

116 
	#__SQUAD_TYPE
 
__št64_t


	)

117 
	#__UQUAD_TYPE
 
__ušt64_t


	)

118 
	#__SWORD_TYPE
 

	)

119 
	#__UWORD_TYPE
 

	)

120 
	#__SLONG32_TYPE
 

	)

121 
	#__ULONG32_TYPE
 

	)

122 
	#__S64_TYPE
 
__št64_t


	)

123 
	#__U64_TYPE
 
__ušt64_t


	)

126 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

127 #–ià
__WORDSIZE
 == 64

128 
	t__SQUAD_TYPE
 

	)

129 
	t__UQUAD_TYPE
 

	)

130 
	t__SWORD_TYPE
 

	)

131 
	t__UWORD_TYPE
 

	)

132 
	t__SLONG32_TYPE
 

	)

133 
	t__ULONG32_TYPE
 

	)

134 
	t__S64_TYPE
 

	)

135 
	t__U64_TYPE
 

	)

137 
	t__STD_TYPE
 

	)

141 
	~<b™s/ty³sizes.h
>

142 
	~<b™s/time64.h
>

145 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

146 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

147 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

148 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

149 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

150 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

151 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

152 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

153 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

154 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

155 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

156 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

157 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

158 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

159 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

160 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

161 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

162 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

164 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

165 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

168 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

171 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

174 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

179 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

180 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

183 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

184 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

187 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

188 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

191 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fswÜd_t
;

193 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

196 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysÿÎ_¦Úg_t
;

198 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysÿÎ_ulÚg_t
;

202 
__off64_t
 
	t__loff_t
;

203 *
	t__ÿddr_t
;

206 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

209 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

214 
	t__sig_©omic_t
;

219 #ià
__TIMESIZE
 =ğ64 && 
defšed
 
__LIBC


220 
	#__time64_t
 
__time_t


	)

221 #–ià
__TIMESIZE
 != 64

222 
__STD_TYPE
 
__TIME64_T_TYPE
 
	g__time64_t
;

225 #undeà
__STD_TYPE


	@/usr/include/bits/types/clock_t.h

1 #iâdeà
__şock_t_defšed


2 
	#__şock_t_defšed
 1

	)

4 
	~<b™s/ty³s.h
>

7 
__şock_t
 
	tşock_t
;

	@/usr/include/bits/types/clockid_t.h

1 #iâdeà
__şockid_t_defšed


2 
	#__şockid_t_defšed
 1

	)

4 
	~<b™s/ty³s.h
>

7 
__şockid_t
 
	tşockid_t
;

	@/usr/include/bits/types/timer_t.h

1 #iâdeà
__tim”_t_defšed


2 
	#__tim”_t_defšed
 1

	)

4 
	~<b™s/ty³s.h
>

7 
__tim”_t
 
	ttim”_t
;

	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

24 
	~<b™s/’dŸn.h
>

26 #ifdeà
__USE_MISC


27 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

28 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

29 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

30 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

33 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


35 
	~<b™s/by‹sw­.h
>

36 
	~<b™s/ušŠ-id’t™y.h
>

38 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


39 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

40 
	#htŞe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

41 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

42 
	#Ë16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

44 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

45 
	#htŞe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

46 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

47 
	#Ë32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

49 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

50 
	#htŞe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

51 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

52 
	#Ë64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

55 
	#htobe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

56 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

57 
	#be16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

58 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

60 
	#htobe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

61 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

62 
	#be32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

63 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

65 
	#htobe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

66 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

67 
	#be64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

68 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_chæags


	)

11 
	#__¡ub_fchæags


	)

12 
	#__¡ub_g‰y


	)

13 
	#__¡ub_lchmod


	)

14 
	#__¡ub_»voke


	)

15 
	#__¡ub_£ogš


	)

16 
	#__¡ub_sig»tuº


	)

17 
	#__¡ub_s¡k


	)

18 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___com·t_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_fchæags


	)

13 
	#__¡ub_g‰y


	)

14 
	#__¡ub_lchmod


	)

15 
	#__¡ub_»voke


	)

16 
	#__¡ub_£ogš


	)

17 
	#__¡ub_sig»tuº


	)

18 
	#__¡ub_s¡k


	)

19 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-x32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___com·t_bdæush


	)

11 
	#__¡ub___com·t_ü—‹_moduË


	)

12 
	#__¡ub___com·t_g‘_k”Ãl_syms


	)

13 
	#__¡ub___com·t_nfs£rvùl


	)

14 
	#__¡ub___com·t_qu”y_moduË


	)

15 
	#__¡ub___com·t_u£lib


	)

16 
	#__¡ub_chæags


	)

17 
	#__¡ub_fchæags


	)

18 
	#__¡ub_g‰y


	)

19 
	#__¡ub_lchmod


	)

20 
	#__¡ub_»voke


	)

21 
	#__¡ub_£ogš


	)

22 
	#__¡ub_sig»tuº


	)

23 
	#__¡ub_s¡k


	)

24 
	#__¡ub_¡ty


	)

	@/usr/include/sys/select.h

21 #iâdeà
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	~<b™s/£Ëù.h
>

33 
	~<b™s/ty³s/sig£t_t.h
>

36 
	~<b™s/ty³s/time_t.h
>

37 
	~<b™s/ty³s/¡ruù_timev®.h
>

38 #ifdeà
__USE_XOPEN2K


39 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

42 #iâdeà
__su£cÚds_t_defšed


43 
__su£cÚds_t
 
	tsu£cÚds_t
;

44 
	#__su£cÚds_t_defšed


	)

49 
	t__fd_mask
;

52 #undeà
__NFDBITS


54 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

55 
	#__FD_ELT
(
d
è((dè/ 
__NFDBITS
)

	)

56 
	#__FD_MASK
(
d
è((
__fd_mask
è(1UL << ((dè% 
__NFDBITS
)))

	)

63 #ifdeà
__USE_XOPEN


64 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

65 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

67 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

68 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

70 } 
	tfd_£t
;

73 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

75 #ifdeà
__USE_MISC


77 
__fd_mask
 
	tfd_mask
;

80 
	#NFDBITS
 
__NFDBITS


	)

85 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

86 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

87 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

88 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

91 
__BEGIN_DECLS


101 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

102 
fd_£t
 *
__»¡riù
 
__wr™efds
,

103 
fd_£t
 *
__»¡riù
 
__exû±fds
,

104 
timev®
 *
__»¡riù
 
__timeout
);

106 #ifdeà
__USE_XOPEN2K


113 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

114 
fd_£t
 *
__»¡riù
 
__wr™efds
,

115 
fd_£t
 *
__»¡riù
 
__exû±fds
,

116 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

117 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

122 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__GNUC__


123 
	~<b™s/£Ëù2.h
>

126 
	g__END_DECLS


	@/usr/include/asm/sockios.h

1 
	~<asm-g’”ic/sockios.h
>

	@/usr/include/bits/byteswap.h

19 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	#__bsw­_cÚ¡ªt_16
(
x
) \

31 ((
__ušt16_t
è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

33 
__šlše
 
__ušt16_t


34 
	$__bsw­_16
 (
__ušt16_t
 
__bsx
)

36 #ià
	`__GNUC_PREREQ
 (4, 8)

37  
	`__butš_bsw­16
 (
__bsx
);

39  
	`__bsw­_cÚ¡ªt_16
 (
__bsx
);

41 
	}
}

44 
	#__bsw­_cÚ¡ªt_32
(
x
) \

45 ((((
x
) & 0xff000000u) >> 24) | (((x) & 0x00ff0000u) >> 8) \

46 | (((
x
è& 0x0000ff00uè<< 8è| (((xè& 0x000000ffuè<< 24))

	)

48 
__šlše
 
__ušt32_t


49 
	$__bsw­_32
 (
__ušt32_t
 
__bsx
)

51 #ià
	`__GNUC_PREREQ
 (4, 3)

52  
	`__butš_bsw­32
 (
__bsx
);

54  
	`__bsw­_cÚ¡ªt_32
 (
__bsx
);

56 
	}
}

59 
	#__bsw­_cÚ¡ªt_64
(
x
) \

60 ((((
x
) & 0xff00000000000000ull) >> 56) \

61 | (((
x
) & 0x00ff000000000000ull) >> 40) \

62 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

63 | (((
x
) & 0x000000ff00000000ull) >> 8) \

64 | (((
x
) & 0x00000000ff000000ull) << 8) \

65 | (((
x
) & 0x0000000000ff0000ull) << 24) \

66 | (((
x
) & 0x000000000000ff00ull) << 40) \

67 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

69 
__ex‹nsiÚ__
 
__šlše
 
__ušt64_t


70 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

72 #ià
	`__GNUC_PREREQ
 (4, 3)

73  
	`__butš_bsw­64
 (
__bsx
);

75  
	`__bsw­_cÚ¡ªt_64
 (
__bsx
);

77 
	}
}

	@/usr/include/bits/endian.h

19 #iâdeà
_BITS_ENDIAN_H


20 
	#_BITS_ENDIAN_H
 1

	)

30 
	#__LITTLE_ENDIAN
 1234

	)

31 
	#__BIG_ENDIAN
 4321

	)

32 
	#__PDP_ENDIAN
 3412

	)

35 
	~<b™s/’dŸÂess.h
>

39 #iâdeà
__FLOAT_WORD_ORDER


40 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

43 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


44 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

45 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


46 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

	@/usr/include/bits/select.h

18 #iâdeà
_SYS_SELECT_H


22 
	~<b™s/wÜdsize.h
>

25 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

27 #ià
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "¡osq"

	)

30 
	#__FD_ZERO_STOS
 "¡o¦"

	)

33 
	#__FD_ZERO
(
fd¥
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¬r
 = (
£t
); \

52 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |ğ
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &ğ~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)è!ğ0)

	)

	@/usr/include/bits/select2.h

19 #iâdeà
_SYS_SELECT_H


24 
__fd–t_chk
 (
__d
);

25 
	$__fd–t_w¬n
 (
__d
)

26 
	`__w¬Ç‰r
 ("bit outside of fd_set selected");

27 #undeà
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__ex‹nsiÚ__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__butš_cÚ¡ªt_p
 (
__d
) \

32 ? (0 <ğ
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fd–t_w¬n
 (
__d
)) \

35 : 
	`__fd–t_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/thread-shared-types.h

19 #iâdeà
_THREAD_SHARED_TYPES_H


20 
	#_THREAD_SHARED_TYPES_H
 1

	)

44 
	~<b™s/±h»adty³s-¬ch.h
>

49 
	s__±h»ad_š‹º®_li¡


51 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

52 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

53 } 
	t__±h»ad_li¡_t
;

55 
	s__±h»ad_š‹º®_¦i¡


57 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

58 } 
	t__±h»ad_¦i¡_t
;

74 
	~<b™s/¡ruù_mu‹x.h
>

87 
	~<b™s/¡ruù_rwlock.h
>

92 
	s__±h»ad_cÚd_s


94 
__ex‹nsiÚ__
 union

96 
__ex‹nsiÚ__
 
	m__w£q
;

99 
	m__low
;

100 
	m__high
;

101 } 
	m__w£q32
;

103 
__ex‹nsiÚ__
 union

105 
__ex‹nsiÚ__
 
	m__g1_¡¬t
;

108 
	m__low
;

109 
	m__high
;

110 } 
	m__g1_¡¬t32
;

112 
	m__g_»fs
[2] 
	m__LOCK_ALIGNMENT
;

113 
	m__g_size
[2];

114 
	m__g1_Üig_size
;

115 
	m__w»fs
;

116 
	m__g_sigÇls
[2];

	@/usr/include/bits/time64.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TIME64_H


24 
	#_BITS_TIME64_H
 1

	)

28 #ià
__TIMESIZE
 == 64

30 
	#__TIME64_T_TYPE
 
__TIME_T_TYPE


	)

33 
	#__TIME64_T_TYPE
 
__SQUAD_TYPE


	)

	@/usr/include/bits/timesize.h

19 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


21 
	#__TIMESIZE
 64

	)

24 
	#__TIMESIZE
 
__WORDSIZE


	)

	@/usr/include/bits/types/sigset_t.h

1 #iâdeà
__sig£t_t_defšed


2 
	#__sig£t_t_defšed
 1

	)

4 
	~<b™s/ty³s/__sig£t_t.h
>

7 
__sig£t_t
 
	tsig£t_t
;

	@/usr/include/bits/types/struct_timespec.h

2 #iâdeà
_STRUCT_TIMESPEC


3 
	#_STRUCT_TIMESPEC
 1

	)

5 
	~<b™s/ty³s.h
>

6 
	~<b™s/’dŸn.h
>

10 
	stime¥ec


12 
__time_t
 
	mtv_£c
;

13 #ià
__WORDSIZE
 == 64 \

14 || (
defšed
 
	m__SYSCALL_WORDSIZE
 && __SYSCALL_WORDSIZE == 64) \

15 || 
__TIMESIZE
 == 32

16 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

18 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


20 
	mtv_n£c
;

22 
	mtv_n£c
;

	@/usr/include/bits/types/struct_timeval.h

1 #iâdeà
__timev®_defšed


2 
	#__timev®_defšed
 1

	)

4 
	~<b™s/ty³s.h
>

8 
	stimev®


10 
__time_t
 
	mtv_£c
;

11 
__su£cÚds_t
 
	mtv_u£c
;

	@/usr/include/bits/typesizes.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifdeà
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

74 
	#__CPU_MASK_TYPE
 
__SYSCALL_ULONG_TYPE


	)

76 #ifdeà
__x86_64__


80 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

83 
	#__INO_T_MATCHES_INO64_T
 1

	)

86 
	#__RLIM_T_MATCHES_RLIM64_T
 1

	)

89 
	#__STATFS_MATCHES_STATFS64
 1

	)

91 
	#__RLIM_T_MATCHES_RLIM64_T
 0

	)

93 
	#__STATFS_MATCHES_STATFS64
 0

	)

97 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/uintn-identity.h

19 #ià!
defšed
 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_UINTN_IDENTITY_H


24 
	#_BITS_UINTN_IDENTITY_H
 1

	)

26 
	~<b™s/ty³s.h
>

32 
__šlše
 
__ušt16_t


33 
	$__ušt16_id’t™y
 (
__ušt16_t
 
__x
)

35  
__x
;

36 
	}
}

38 
__šlše
 
__ušt32_t


39 
	$__ušt32_id’t™y
 (
__ušt32_t
 
__x
)

41  
__x
;

42 
	}
}

44 
__šlše
 
__ušt64_t


45 
	$__ušt64_id’t™y
 (
__ušt64_t
 
__x
)

47  
__x
;

48 
	}
}

	@/usr/include/asm-generic/sockios.h

2 #iâdeà
__ASM_GENERIC_SOCKIOS_H


3 
	#__ASM_GENERIC_SOCKIOS_H


	)

6 
	#FIOSETOWN
 0x8901

	)

7 
	#SIOCSPGRP
 0x8902

	)

8 
	#FIOGETOWN
 0x8903

	)

9 
	#SIOCGPGRP
 0x8904

	)

10 
	#SIOCATMARK
 0x8905

	)

11 
	#SIOCGSTAMP_OLD
 0x8906

	)

12 
	#SIOCGSTAMPNS_OLD
 0x8907

	)

	@/usr/include/bits/endianness.h

1 #iâdeà
_BITS_ENDIANNESS_H


2 
	#_BITS_ENDIANNESS_H
 1

	)

4 #iâdeà
_BITS_ENDIAN_H


9 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/pthreadtypes-arch.h

18 #iâdeà
_BITS_PTHREADTYPES_ARCH_H


19 
	#_BITS_PTHREADTYPES_ARCH_H
 1

	)

21 
	~<b™s/wÜdsize.h
>

23 #ifdeà
__x86_64__


24 #ià
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

26 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

27 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

28 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

30 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

31 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

32 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

33 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

37 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

38 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

39 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

41 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

42 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

43 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

44 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

45 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

47 
	#__LOCK_ALIGNMENT


	)

48 
	#__ONCE_ALIGNMENT


	)

50 #iâdeà
__x86_64__


52 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/struct_mutex.h

19 #iâdeà
_THREAD_MUTEX_INTERNAL_H


20 
	#_THREAD_MUTEX_INTERNAL_H
 1

	)

22 
	s__±h»ad_mu‹x_s


24 
	m__lock
;

25 
	m__couÁ
;

26 
	m__owÃr
;

27 #ifdeà
__x86_64__


28 
	m__nu£rs
;

32 
	m__kšd
;

33 #ifdeà
__x86_64__


34 
	m__¥šs
;

35 
	m__–isiÚ
;

36 
__±h»ad_li¡_t
 
	m__li¡
;

37 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

39 
	m__nu£rs
;

40 
__ex‹nsiÚ__
 union

44 
	m__e¥šs
;

45 
	m__“lisiÚ
;

46 
	#__¥šs
 
__–isiÚ_d©a
.
__e¥šs


	)

47 
	#__–isiÚ
 
__–isiÚ_d©a
.
__“lisiÚ


	)

48 } 
	m__–isiÚ_d©a
;

49 
__±h»ad_¦i¡_t
 
	m__li¡
;

51 
	#__PTHREAD_MUTEX_HAVE_PREV
 0

	)

55 #ifdeà
__x86_64__


56 
	#__PTHREAD_MUTEX_INITIALIZER
(
__kšd
) \

57 0, 0, 0, 0, 
__kšd
, 0, 0, { 0, 0 }

	)

59 
	#__PTHREAD_MUTEX_INITIALIZER
(
__kšd
) \

60 0, 0, 0, 
__kšd
, 0, { { 0, 0 } }

	)

	@/usr/include/bits/struct_rwlock.h

20 #iâdeà
_RWLOCK_INTERNAL_H


21 
	#_RWLOCK_INTERNAL_H


	)

23 
	s__±h»ad_rwlock_¬ch_t


25 
	m__»ad”s
;

26 
	m__wr™”s
;

27 
	m__w½ha£_fu‹x
;

28 
	m__wr™”s_fu‹x
;

29 
	m__·d3
;

30 
	m__·d4
;

31 #ifdeà
__x86_64__


32 
	m__cur_wr™”
;

33 
	m__sh¬ed
;

34 sigÃd 
	m__rw–isiÚ
;

35 #ifdeà 
__ILP32__


36 
	m__·d1
[3];

37 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0 }

	)

39 
	m__·d1
[7];

40 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0, 0, 0, 0, 0 }

	)

42 
	m__·d2
;

45 
	m__æags
;

49 
	m__æags
;

50 
	m__sh¬ed
;

51 sigÃd 
	m__rw–isiÚ
;

52 
	m__·d2
;

53 
	m__cur_wr™”
;

57 #ifdeà
__x86_64__


58 
	#__PTHREAD_RWLOCK_INITIALIZER
(
__æags
) \

59 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 
__æags


	)

61 
	#__PTHREAD_RWLOCK_INITIALIZER
(
__æags
) \

62 0, 0, 0, 0, 0, 0, 
__æags
, 0, 0, 0, 0

	)

	@/usr/include/bits/types/__sigset_t.h

1 #iâdeà
____sig£t_t_defšed


2 
	#____sig£t_t_defšed


	)

4 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

7 
	m__v®
[
_SIGSET_NWORDS
];

8 } 
	t__sig£t_t
;

	@
1
.
1
/usr/include
132
3410
bpf_jit.h
cn10k.c
cn10k.h
otx2_bpf.c
otx2_bpf.h
otx2_bpf_arch_insn.c
otx2_common.c
otx2_common.h
otx2_dcbnl.c
otx2_devlink.c
otx2_devlink.h
otx2_dmac_flt.c
otx2_ethtool.c
otx2_flows.c
otx2_map.c
otx2_map.h
otx2_pf.c
otx2_ptp.c
otx2_ptp.h
otx2_reg.h
otx2_smqvf.c
otx2_struct.h
otx2_tc.c
otx2_thread.c
otx2_thread.h
otx2_txrx.c
otx2_txrx.h
otx2_vf.c
otx2_xdp.c
otx2_xdp.h
otx2_xdp_debug.h
qos.c
qos.h
qos_sq.c
/usr/include/asm/byteorder.h
/usr/include/linux/bpf.h
/usr/include/linux/ethtool.h
/usr/include/linux/filter.h
/usr/include/linux/if_vlan.h
/usr/include/linux/iommu.h
/usr/include/linux/kernel.h
/usr/include/linux/module.h
/usr/include/linux/net_tstamp.h
/usr/include/linux/netdevice.h
/usr/include/linux/pci.h
/usr/include/linux/sched.h
/usr/include/linux/stddef.h
/usr/include/linux/time.h
/usr/include/linux/types.h
/usr/include/asm/types.h
/usr/include/limits.h
/usr/include/linux/bpf_common.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/const.h
/usr/include/linux/if.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/pci_regs.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/linux/sysinfo.h
/usr/include/linux/time_types.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/bits/libc-header-start.h
/usr/include/bits/posix1_lim.h
/usr/include/bits/posix2_lim.h
/usr/include/bits/wordsize.h
/usr/include/bits/xopen_lim.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/libc-compat.h
/usr/include/linux/netlink.h
/usr/include/linux/swab.h
/usr/include/sys/socket.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/bitsperlong.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm/swab.h
/usr/include/bits/local_lim.h
/usr/include/bits/socket.h
/usr/include/bits/socket2.h
/usr/include/bits/types/struct_iovec.h
/usr/include/bits/types/struct_osockaddr.h
/usr/include/bits/uio_lim.h
/usr/include/features.h
/usr/include/asm-generic/bitsperlong.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/socket.h
/usr/include/bits/sockaddr.h
/usr/include/bits/socket-constants.h
/usr/include/bits/socket_type.h
/usr/include/bits/types/time_t.h
/usr/include/gnu/stubs.h
/usr/include/linux/limits.h
/usr/include/stdc-predef.h
/usr/include/sys/cdefs.h
/usr/include/sys/types.h
/usr/include/asm-generic/socket.h
/usr/include/bits/long-double.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/stdint-intn.h
/usr/include/bits/types.h
/usr/include/bits/types/clock_t.h
/usr/include/bits/types/clockid_t.h
/usr/include/bits/types/timer_t.h
/usr/include/endian.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/gnu/stubs-x32.h
/usr/include/sys/select.h
/usr/include/asm/sockios.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/thread-shared-types.h
/usr/include/bits/time64.h
/usr/include/bits/timesize.h
/usr/include/bits/types/sigset_t.h
/usr/include/bits/types/struct_timespec.h
/usr/include/bits/types/struct_timeval.h
/usr/include/bits/typesizes.h
/usr/include/bits/uintn-identity.h
/usr/include/asm-generic/sockios.h
/usr/include/bits/endianness.h
/usr/include/bits/pthreadtypes-arch.h
/usr/include/bits/struct_mutex.h
/usr/include/bits/struct_rwlock.h
/usr/include/bits/types/__sigset_t.h
